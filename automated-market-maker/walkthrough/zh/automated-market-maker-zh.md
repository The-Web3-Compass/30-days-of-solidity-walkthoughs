# è‡ªåŠ¨åšå¸‚å•†åˆçº¦

Day: Day 25
ID: 25
åŸæ–‡: https://www.notion.so/Automated-Market-Maker-1df5720a23ef807cac40e0ddc4e22224?source=copy_link
çŠ¶æ€: å®Œæˆ
è¯‘è€…: è¿æ¥ç«™ æœˆçƒ
éš¾åº¦ç­‰çº§: é«˜çº§

æ¬¢è¿å›åˆ° **30å¤©å­¦Solidity** â€”â€” åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ¯å¤©æŠŠä¸€ä¸ªå¤æ‚æ¦‚å¿µå˜æˆä½ çœŸæ­£èƒ½ç†è§£çš„ä»£ç ã€‚

ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æ­å¼€ DeFi ä¸­æœ€ä¼ å¥‡æœºåˆ¶ä¹‹ä¸€çš„ç¥ç§˜é¢çº±ï¼š

**è‡ªåŠ¨åŒ–åšå¸‚å•†ï¼ˆAutomated Market Makerï¼‰**ï¼Œç®€ç§° AMMã€‚

# äº§å“éœ€æ±‚è¯´æ˜ä¹¦

## ç”¨æˆ·æµç¨‹

```mermaid
graph TD
    è‡ªåŠ¨åšå¸‚å•†åˆçº¦ --> åˆå§‹åŒ– --> è®¾ç½®ä»£å¸å¯¹[/è®¾ç½®TokenAå’ŒTokenBåœ°å€/]
    
    è‡ªåŠ¨åšå¸‚å•†åˆçº¦ --> æ·»åŠ æµåŠ¨æ€§ --> ç”¨æˆ·[/ç”¨æˆ·æä¾›TokenAå’ŒTokenB/] --> è®¡ç®—æµåŠ¨æ€§ä»£å¸ --> é“¸é€ LPä»£å¸ --> æ›´æ–°å‚¨å¤‡é‡
    
    è‡ªåŠ¨åšå¸‚å•†åˆçº¦ --> ç§»é™¤æµåŠ¨æ€§ --> ç”¨æˆ·[/ç”¨æˆ·é”€æ¯LPä»£å¸/] --> è®¡ç®—è¿”è¿˜æ¯”ä¾‹ --> æå–ä»£å¸ --> æ›´æ–°å‚¨å¤‡é‡
    
    è‡ªåŠ¨åšå¸‚å•†åˆçº¦ --> ä»£å¸äº¤æ¢Aæ¢B --> ç”¨æˆ·[/ç”¨æˆ·è¾“å…¥TokenAæ•°é‡/] --> è®¡ç®—æ‰‹ç»­è´¹ --> è®¡ç®—è¾“å‡ºé‡ --> æ»‘ç‚¹æ£€æŸ¥ --> æ‰§è¡Œäº¤æ¢ --> æ›´æ–°å‚¨å¤‡é‡
    
    è‡ªåŠ¨åšå¸‚å•†åˆçº¦ --> ä»£å¸äº¤æ¢Bæ¢A --> ç”¨æˆ·[/ç”¨æˆ·è¾“å…¥TokenBæ•°é‡/] --> è®¡ç®—æ‰‹ç»­è´¹ --> è®¡ç®—è¾“å‡ºé‡ --> æ»‘ç‚¹æ£€æŸ¥ --> æ‰§è¡Œäº¤æ¢ --> æ›´æ–°å‚¨å¤‡é‡
    
    è‡ªåŠ¨åšå¸‚å•†åˆçº¦ --> æŸ¥è¯¢åŠŸèƒ½ --> æŸ¥çœ‹å‚¨å¤‡é‡[/è·å–å½“å‰å‚¨å¤‡é‡/]
    
    æ·»åŠ æµåŠ¨æ€§ --> æ£€æŸ¥æ¡ä»¶{å‚¨å¤‡é‡ä¸º0?}
    æ£€æŸ¥æ¡ä»¶ -->|æ˜¯| é¦–æ¬¡æ·»åŠ [æŒ‰å‡ ä½•å¹³å‡æ•°è®¡ç®—æµåŠ¨æ€§]
    æ£€æŸ¥æ¡ä»¶ -->|å¦| æŒ‰æ¯”ä¾‹è®¡ç®—[æŒ‰æœ€å°æ¯”ä¾‹è®¡ç®—æµåŠ¨æ€§]
    
    ä»£å¸äº¤æ¢Aæ¢B --> æ»‘ç‚¹ä¿æŠ¤{è¾“å‡ºé‡>=æœ€å°è¾“å‡º?}
    æ»‘ç‚¹ä¿æŠ¤ -->|å¦| äº¤æ˜“å¤±è´¥[äº¤æ˜“å›æ»š]
    æ»‘ç‚¹ä¿æŠ¤ -->|æ˜¯| æ‰§è¡Œäº¤æ˜“[æ›´æ–°å‚¨å¤‡é‡]
    
    ä»£å¸äº¤æ¢Bæ¢A --> æ»‘ç‚¹ä¿æŠ¤2{è¾“å‡ºé‡>=æœ€å°è¾“å‡º?}
    æ»‘ç‚¹ä¿æŠ¤2 -->|å¦| äº¤æ˜“å¤±è´¥2[äº¤æ˜“å›æ»š]
    æ»‘ç‚¹ä¿æŠ¤2 -->|æ˜¯| æ‰§è¡Œäº¤æ˜“2[æ›´æ–°å‚¨å¤‡é‡]
```

## æ•°æ®åº“

| Contract | Type | Bases |
| --- | --- | --- |
| **AutomatedMarketMaker** | Implementation | ERC20 |

### çŠ¶æ€å˜é‡

| å˜é‡å | ç±»å‹ | å¯è§æ€§ | è¯´æ˜ |
| --- | --- | --- | --- |
| tokenA | IERC20 | Public | ä»£å¸Aåˆçº¦åœ°å€ |
| tokenB | IERC20 | Public | ä»£å¸Båˆçº¦åœ°å€ |
| reserveA | uint256 | Public | ä»£å¸Aå‚¨å¤‡é‡ |
| reserveB | uint256 | Public | ä»£å¸Bå‚¨å¤‡é‡ |
| owner | address | Public | åˆçº¦æ‰€æœ‰è€… |

### å‡½æ•°æ¸…å•

| Function Name | Visibility | Mutability | è¯´æ˜ |
| --- | --- | --- | --- |
| **constructor** | Public â—ï¸ | ğŸ›‘ | æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–ä»£å¸å¯¹å’Œåˆçº¦åç§° |
| **addLiquidity** | Public â—ï¸ | ğŸ›‘ | æ·»åŠ æµåŠ¨æ€§åˆ°èµ„é‡‘æ±  |
| **removeLiquidity** | Public â—ï¸ | ğŸ›‘ | ä»èµ„é‡‘æ± ç§»é™¤æµåŠ¨æ€§ |
| **swapAforB** | Public â—ï¸ | ğŸ›‘ | ç”¨ä»£å¸Aäº¤æ¢ä»£å¸B |
| **swapBforA** | Public â—ï¸ | ğŸ›‘ | ç”¨ä»£å¸Bäº¤æ¢ä»£å¸A |
| **getReserves** | Public â—ï¸ |  | æŸ¥çœ‹å½“å‰å‚¨å¤‡é‡ |
| **min** | Internal |  | è¿”å›ä¸¤ä¸ªå€¼ä¸­çš„è¾ƒå°å€¼ |
| **sqrt** | Internal |  | å·´æ¯”ä¼¦å¹³æ–¹æ ¹ç®—æ³• |

### äº‹ä»¶

| Event Name | å‚æ•° | è¯´æ˜ |
| --- | --- | --- |
| **LiquidityAdded** | provider, amountA, amountB, liquidity | æµåŠ¨æ€§æ·»åŠ äº‹ä»¶ |
| **LiquidityRemoved** | provider, amountA, amountB, liquidity | æµåŠ¨æ€§ç§»é™¤äº‹ä»¶ |
| **TokensSwapped** | trader, tokenIn, amountIn, tokenOut, amountOut | ä»£å¸äº¤æ¢äº‹ä»¶ |

### ç»§æ‰¿çš„ERC20å‡½æ•°

| Function Name | Visibility | Mutability | è¯´æ˜ |
| --- | --- | --- | --- |
| **totalSupply** | Public â—ï¸ |  | è·å–æ€»ä¾›åº”é‡ |
| **balanceOf** | Public â—ï¸ |  | è·å–è´¦æˆ·ä½™é¢ |
| **_mint** | Internal | ğŸ›‘ | é“¸é€ ä»£å¸ |
| **_burn** | Internal | ğŸ›‘ | é”€æ¯ä»£å¸ |
| **transfer** | Public â—ï¸ | ğŸ›‘ | è½¬è´¦ä»£å¸ |
| **transferFrom** | Public â—ï¸ | ğŸ›‘ | ä»æŒ‡å®šåœ°å€è½¬è´¦ |

# ç»†èŠ‚è§£é‡Š

---

è‡ªåŠ¨åŒ–åšå¸‚å•†æ˜¯ **DeFi æœ€å¼ºå¤§çš„å‘æ˜ä¹‹ä¸€** â€”â€” è¿™ç§ä¸œè¥¿å¸®åŠ©æ™ºèƒ½åˆçº¦å˜æˆæˆç†Ÿçš„é‡‘èåº”ç”¨ç¨‹åº

æˆ‘ä»¬åœ¨è°ˆè®ºï¼š

**è‡ªåŠ¨åŒ–åšå¸‚å•†** â€”â€” ä¹Ÿå°±æ˜¯ AMMã€‚

ä½†å¦‚æœä½ è§‰å¾—å¬èµ·æ¥å¾ˆé«˜å¤§ä¸Šï¼Œä¸ç”¨æ‹…å¿ƒ â€”â€”

å› ä¸ºåœ¨å­¦ä¹ ç»“æŸæ—¶ï¼Œä½ ä¸ä»…ä¼šçŸ¥é“ AMM æ˜¯ä»€ä¹ˆï¼Œ

ä½ è¿˜èƒ½å¤Ÿè‡ªå·±æ„å»ºä¸€ä¸ª AMMã€‚

è®©æˆ‘ä»¬å…ˆä» **ä¸ºä»€ä¹ˆ AMM ä¼šå­˜åœ¨** çš„æ•…äº‹å¼€å§‹ã€‚

---

## ğŸ›ï¸ å›åˆ°è¿‡å»ï¼šäººä»¬å¦‚ä½•äº¤æ˜“åŠ å¯†è´§å¸

è®©æˆ‘ä»¬å›åˆ°äº¤æ˜“æœ€åˆçš„è¿ä½œæ–¹å¼ â€”â€” å³ä½¿åœ¨åŠ å¯†è´§å¸çš„æ—©æœŸï¼š

å®ƒå°±åƒä¸€ä¸ªè‚¡ç¥¨å¸‚åœºã€‚

- **ä¹°å®¶**è¯´ï¼š
    
    *â€œæˆ‘æƒ³ä¹° 1 ä¸ª DAIï¼Œæˆ‘æ„¿æ„ä»˜ 0.95 ä¸ª ETHã€‚â€*
    
- **å–å®¶**è¯´ï¼š
    
    *â€œæˆ‘æœ‰ 1 ä¸ª DAI æƒ³å–ï¼Œä½†æˆ‘æƒ³è¦ 1 ä¸ª ETHã€‚â€*
    
- ä¹°å®¶å’Œå–å®¶ä¸­é—´åç€ä¸€ä¸ªå«åš **è®¢å•ç°¿** çš„ç³»ç»Ÿã€‚
    
    æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå·¨å¤§çš„åˆ—è¡¨ï¼Œç”¨æ¥åŒ¹é…ä¹°å®¶å’Œå–å®¶ã€‚
    

å½“ä¹°å®¶å’Œå–å®¶å¯¹ä»·æ ¼è¾¾æˆä¸€è‡´ï¼Ÿç ° â€”â€” äº¤æ˜“å‘ç”Ÿäº†ã€‚

è¿™ç§ç³»ç»Ÿåœ¨åƒ Binance æˆ– Coinbase è¿™æ ·çš„ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ä¸Šè¿è¡Œè‰¯å¥½ã€‚

ä½†æœ‰ä¸€ä¸ªé—®é¢˜â€¦â€¦

---

## ğŸ¤• ä¸ºä»€ä¹ˆé“¾ä¸Šä¸èƒ½è¿™æ ·åš

åœ¨åŒºå—é“¾ä¸Šï¼Œä¸€åˆ‡éƒ½è¦æ¶ˆè€— **gas**ã€‚

å³ä¾¿æ˜¯åƒâ€œæˆ‘æƒ³ä¹° DAIâ€è¿™æ ·ç®€å•çš„æ“ä½œï¼Œä¹Ÿæ„å‘³ç€ï¼š

- å‘é€äº¤æ˜“
- æ”¯ä»˜æ‰‹ç»­è´¹
- ç­‰å¾…ç¡®è®¤

æƒ³è±¡ä¸€ä¸‹ï¼Œå¯¹äºä¹°å…¥æˆ–å–å‡ºä»·æ ¼çš„**æ¯ä¸€ä¸ªå¾®å°åŠ¨ä½œå˜åŒ–** ï¼Œéƒ½å¿…é¡»éµå¾ªè¿™æ ·çš„æµç¨‹ã€‚é‚£å°†æ˜¯å™©æ¢¦ã€‚

è€Œä¸”å¦‚æœé‚£æ—¶æ²¡æœ‰äººæ„¿æ„å’Œä½ äº¤æ˜“å‘¢ï¼Ÿ

ä½ å°±è¢«å¡ä½äº†ã€‚ä½ çš„è®¢å•å°±é‚£æ ·æŒ‚ç€ï¼Œæµªè´¹ gas å’Œæ—¶é—´ã€‚

æ‰€ä»¥æ ¸å¿ƒé—®é¢˜æ˜¯ï¼š

- è®¢å•ç°¿æ˜¯**ä¸­å¿ƒåŒ–çš„**
- å®ƒä»¬éœ€è¦äººä¸€ç›´æ´»è·ƒ
- é“¾ä¸Šä½¿ç”¨æ—¢æ…¢åˆè´µ

DeFi éœ€è¦ä¸€äº›**æ›´å¥½çš„æ–¹å¼**ã€‚

---

## ğŸ’¡ çªç ´å£ï¼šå¦‚æœä¸éœ€è¦ä¹°å®¶å’Œå–å®¶ä¼šæ€æ ·ï¼Ÿ

è¿™æ˜¯æ”¹å˜ä¸€åˆ‡çš„ç»å¦™æƒ³æ³•ï¼š

> å¦‚æœäººä»¬ä¸éœ€è¦ç­‰å¾…äº¤æ˜“ä¼™ä¼´å‘¢ï¼Ÿ
> 

> å¦‚æœæ™ºèƒ½åˆçº¦å¯ä»¥åƒè‡ªåŠ¨å”®è´§æœºä¸€æ ·æä¾›ä»£å¸å‘¢ï¼Ÿ
> 

æ‰€ä»¥ï¼Œä¸å†ä¾èµ–åˆ«äººæ¥äº¤æ˜“â€¦â€¦

ä½ å°†æ‹¥æœ‰ä¸€ä¸ªåŒ…å«ä¸¤ç§ä»£å¸çš„æ± å­ â€”â€” æ¯”å¦‚ DAI å’Œ ETH â€”â€”

è¯¥æ± å­é”åœ¨ä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨çš„åˆçº¦ä¸­ã€‚

æƒ³**ç”¨ DAI ä¹° ETH**ï¼Ÿ

åˆçº¦åšæ•°å­¦è¿ç®—ï¼Œç»™ä½  ETHï¼ŒåŒæ—¶æ”¶ä¸‹ä½ çš„ DAIã€‚

æƒ³**å‡ºå”®ETH æ¢å– DAI**ï¼Ÿ

åŒæ · â€”â€” åˆçº¦ç»™ä½  DAIï¼ŒåŒæ—¶ç•™å­˜ä½ çš„ ETHã€‚

ä¸éœ€è¦ä¹°å®¶ï¼Œä¸éœ€è¦å–å®¶ã€‚åªéœ€è¦æ•°å­¦ã€‚

---

## ğŸ“ é‚£å®ƒå®é™…ä¸Šæ˜¯å¦‚ä½•è¿ä½œçš„ï¼Ÿ

AMM ä½¿ç”¨ä¸€ä¸ªç®€å•å…¬å¼ï¼š

> x Ã— y = k
> 

è®©æˆ‘ä»¬æ‹†è§£ä¸€ä¸‹ã€‚

- `x` = æ± ä¸­ä»£å¸ A çš„æ•°é‡
- `y` = æ± ä¸­ä»£å¸ B çš„æ•°é‡
- `k` = æŸä¸ªå¸¸æ•°ï¼ˆæ°¸è¿œä¸å˜ï¼‰

æ‰€ä»¥ **ä¸¤ä¸ªä»£å¸å‚¨å¤‡çš„ä¹˜ç§¯å¿…é¡»å§‹ç»ˆä¿æŒä¸å˜**ã€‚

è¿™é‡Œçš„é­”åŠ›æ˜¯ï¼š

å¦‚æœæœ‰äººæƒ³æ·»åŠ æ›´å¤šçš„ä»£å¸ Aï¼ˆæ¯”å¦‚ ETHï¼‰ï¼Œ

ä¿æŒ `k` ä¸å˜çš„å”¯ä¸€æ–¹æ³•æ˜¯è®©åˆçº¦ç»™Taä»¬æ›´å°‘çš„ä»£å¸ Bï¼ˆæ¯”å¦‚ DAIï¼‰ã€‚

è¿™å°±æ˜¯ä»·æ ¼**è‡ªåŠ¨**è°ƒæ•´çš„æ–¹å¼ã€‚

éšç€äº¤æ˜“çš„å¢å¤šï¼Œæ¯”ä¾‹ä¼šå‘ç”Ÿå˜åŒ– â€”â€” ä»·æ ¼ä¹Ÿéšä¹‹è‡ªåŠ¨æ›´æ–°ã€‚

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒå«**è‡ªåŠ¨åŒ–åšå¸‚å•†**ã€‚

åˆçº¦ä½¿ç”¨æ•°å­¦æ¥åˆ›é€ å¸‚åœºï¼Œè€Œä¸æ˜¯ä¾èµ–äººå·¥è®¢å•ã€‚

---

## ğŸ” é‚£ä¹ˆ AMM å¯ä»¥åšä»€ä¹ˆï¼Ÿ

ä¸»è¦æœ‰ä¸‰ä»¶å¤§äº‹å¯ä»¥åšï¼š

1. **å…‘æ¢**ä»£å¸
    - å³æ—¶å°†ä»£å¸ A æ¢æˆä»£å¸ Bï¼ˆæˆ–åè¿‡æ¥ï¼‰
    - ä¸ç”¨ç­‰å¾…åŒ¹é…
    - åªéœ€å‘é€ä»£å¸ï¼Œå³å¯å¾—åˆ°å¦ä¸€ç§ä»£å¸
2. **æ·»åŠ æµåŠ¨æ€§**
    - å­˜å…¥ç­‰å€¼çš„ä»£å¸ A å’Œ B
    - è·å¾— **LP ä»£å¸**ï¼ˆç±»ä¼¼æ”¶æ®ï¼‰
    - å½“ä½ çš„ä»£å¸åœ¨æ± ä¸­æ—¶ï¼Œä½ ä¼šè·å¾—äº¤æ˜“è´¹ç”¨åˆ†æˆ
3. **ç§»é™¤æµåŠ¨æ€§**
    - å½’è¿˜ LP ä»£å¸
    - å–å›ä½ å¯¹åº”ä»½é¢çš„ä¸¤ç§ä»£å¸

---

ç°åœ¨ä½ å·²ç»ç†è§£äº†æ¦‚å¿µâ€¦â€¦

ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†æŸ¥çœ‹ä¸€ä¸ªçœŸå®çš„ Solidity åˆçº¦ â€”â€” å¹¶æ¼”ç¤ºå¦‚ä½•**ä»é›¶å¼€å§‹ç¼–ç è‡ªå·±çš„ AMM**ã€‚

æˆ‘ä»¬å°†å±•ç¤ºï¼š

- æµåŠ¨æ€§æ± æ˜¯å¦‚ä½•å·¥ä½œçš„
- ä»·æ ¼è®¡ç®—æ˜¯å¦‚ä½•å®Œæˆçš„
- å¦‚ä½•ç¡®ä¿ä¸€åˆ‡å…¬å¹³å¹³è¡¡

å‡†å¤‡å¥½æ„å»º DeFi çš„æ ¸å¿ƒå¼•æ“äº†å—ï¼Ÿ

è®©æˆ‘ä»¬è¿›å…¥ä»£ç éƒ¨åˆ†ã€‚

---

## ğŸ› ï¸ ä»Šå¤©ä½ è¦æ„å»ºçš„å†…å®¹

ä»Šå¤©çš„é¡¹ç›®ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç©å…·åˆçº¦ã€‚

ä½ è¦æ„å»ºçš„æ˜¯é©±åŠ¨æ•°åäº¿ç¾å…ƒå»ä¸­å¿ƒåŒ–äº¤æ˜“çš„**æ ¸å¿ƒå¼•æ“**ã€‚

ä½†æœ‰ä¸ªç‰¹ç‚¹ï¼š

- **ä¸ç”¨åº“ï¼ˆlibrariesï¼‰**
- **ä¸ç”¨æ·å¾„**
- **æ²¡æœ‰å¹•åé­”æ³•**

ä½ å°†**çº¯æ‰‹å†™**è‡ªåŠ¨åŒ–åšå¸‚å•†çš„æ ¸å¿ƒ â€”â€” è¿™æ˜¯çœŸæ­£ç†è§£å®ƒçš„**æœ€ä½³æ–¹å¼**ã€‚

è®©æˆ‘ä»¬å‡†ç¡®åˆ†è§£ä¸€ä¸‹ä½ çš„æ™ºèƒ½åˆçº¦å°†åšä»€ä¹ˆï¼Œä»¥åŠåˆ†ææ¯éƒ¨åˆ†çš„é‡è¦æ€§ï¼š

---

### ğŸ” åˆ›å»ºä¸¤ä¸ª ERC-20 ä»£å¸ä¹‹é—´çš„æµåŠ¨æ€§æ± 

ä½ å°†ä»é”å®šä¸¤ä¸ª ERC-20 ä»£å¸å¼€å§‹ â€”â€” æˆ‘ä»¬ç§°å®ƒä»¬ä¸º **ä»£å¸ A** å’Œ **ä»£å¸ B** â€”â€” æ”¾å…¥æ™ºèƒ½åˆçº¦ä¸­ã€‚

è¿™äº›ä»£å¸å½¢æˆ**æµåŠ¨æ€§æ± **ã€‚

äººä»¬å°†é€šè¿‡è¿™ä¸ªæ± å­è¿›è¡Œ**ä»£å¸å…‘æ¢**æˆ–**æä¾›æµåŠ¨æ€§**ã€‚å®ƒå°±åƒå­˜æ”¾æ‰€æœ‰äº¤æ˜“èµ„äº§çš„é‡‘åº“ã€‚

---

### â• å…è®¸ç”¨æˆ·æ·»åŠ å’Œç§»é™¤æµåŠ¨æ€§

ä»»ä½•äººéƒ½å¯ä»¥å‘æ± å­å­˜å…¥ç­‰å€¼çš„ä»£å¸ A å’Œ Bã€‚

ä¸ºä»€ä¹ˆéœ€è¦ç­‰å€¼ï¼Ÿ

å› ä¸ºå®ƒä¿æŒ**ä»·æ ¼æ¯”ä¾‹**å¹³è¡¡ã€‚

å½“æœ‰äººæ·»åŠ æµåŠ¨æ€§æ—¶ï¼š

- ä½ å°†Taä»¬çš„ä»£å¸å­˜å…¥åˆçº¦
- ç„¶åä½ ç»™Taä»¬ç­¾å‘ **LP ä»£å¸**ï¼ˆliquidity provider tokens çš„ç¼©å†™ï¼‰â€”â€” å°±åƒæ•°å­—æ”¶æ®

ç¨åï¼Œå½“Taä»¬ç§»é™¤æµåŠ¨æ€§æ—¶ï¼Œå½’è¿˜ LP ä»£å¸ â€”â€” ä½ è¿”è¿˜Taä»¬å¯¹åº”ä»½é¢çš„ä¸¤ç§ä»£å¸ã€‚

è¿™æ ·ï¼Œæ¯ä¸ªäººéƒ½æœ‰æ‹¥æœ‰æ± å­ä»½é¢çš„**æ‰€æœ‰æƒè¯æ˜ï¼ˆproof of ownershipï¼‰**ã€‚

---

### ğŸ§® è·Ÿè¸ªå¹¶æ›´æ–°å†…éƒ¨å‚¨å¤‡

åˆçº¦ä¼šå§‹ç»ˆè·Ÿè¸ªè®°å½•ä¸¤ä¸ªæ•°å€¼ï¼š

- `reserveA`ï¼šæ± ä¸­ä»£å¸ A çš„æ•°é‡
- `reserveB`ï¼šæ± ä¸­ä»£å¸ B çš„æ•°é‡

æ¯æ¬¡æœ‰äººæ·»åŠ ã€ç§»é™¤ä»£å¸ï¼Œæˆ–è€…è¿›è¡Œå…‘æ¢æ—¶ï¼Œè¿™äº›å‚¨å¤‡éƒ½ä¼šæ›´æ–°ã€‚

è¿™äº›æ•°å€¼éå¸¸**å…³é”®**ï¼Œå› ä¸ºå®ƒä»¬ç”¨äºï¼š

- è®¡ç®—å…¬å¹³ä»·æ ¼
- æ‰§è¡Œæ’å®šä¹˜ç§¯å…¬å¼ï¼ˆç¨åè¯¦ç»†è¯´æ˜ï¼‰
- é˜²æ­¢æ»¥ç”¨æˆ–æ“çºµ

---

### ğŸ” å…è®¸ä»»ä½•äººä»¥ä»£å¸ A å…‘æ¢ä»£å¸ Bï¼ˆåä¹‹äº¦ç„¶ï¼‰

è¿™æ˜¯ AMM çš„æ ¸å¿ƒåŠŸèƒ½ã€‚

æ¯”å¦‚ Alice æƒ³ç”¨å¥¹çš„ä»£å¸ A å…‘æ¢ä»£å¸ Bã€‚

ä½ çš„åˆçº¦ä¼šï¼š

- æ¥æ”¶å¥¹çš„ä»£å¸ A
- æ ¹æ®å½“å‰æ± æ¯”ä¾‹è®¡ç®—ç»™å¥¹å¤šå°‘ä»£å¸ B
- æ›´æ–°å‚¨å¤‡
- è½¬è´¦ä»£å¸

è¿™ä¸€åˆ‡éƒ½å‘ç”Ÿåœ¨**æ— éœ€äº¤æ˜“å¯¹æ‰‹**çš„æƒ…å†µä¸‹ â€”â€” ä¸éœ€è¦å–å®¶ã€‚

åŒæ ·é€»è¾‘é€‚ç”¨äºåå‘å…‘æ¢ â€”â€” ä»£å¸ B æ¢ä»£å¸ Aã€‚

---

### ğŸ“ ä½¿ç”¨æ’å®šä¹˜ç§¯å…¬å¼

é­”æ³•å‘ç”Ÿæ—¶åˆ»ã€‚

ä½ çš„åˆçº¦å°†ä½¿ç”¨ä»¥ä¸‹å…¬å¼æ¥ç¡®å®šå…‘æ¢ç‡ï¼š

> x * y = k
> 

å…¶ä¸­ï¼š

- `x` = ä»£å¸ A çš„å‚¨å¤‡
- `y` = ä»£å¸ B çš„å‚¨å¤‡
- `k` = æ°¸è¿œä¸å˜çš„å¸¸æ•°

å½“æœ‰äººå‘æ± ä¸­æ·»åŠ ä»£å¸ A æ—¶ï¼Œä¿æŒ `k` ä¸å˜çš„å”¯ä¸€æ–¹æ³•æ˜¯**å‡å°‘ä¸€äº›ä»£å¸ B** â€”â€” åä¹‹äº¦ç„¶ã€‚

è¿™å°±æ˜¯ä»·æ ¼å‘ç°çš„æ–¹å¼ã€‚è‡ªåŠ¨ã€å…¬å¹³ï¼Œå¹¶ä¸”åŸºäºæ•°å­¦ã€‚

ä¸ºé˜²æ­¢æ»¥ç”¨ï¼Œä½ è¿˜ä¼šå¯¹æ¯ç¬”äº¤æ˜“æ”¶å–å°é¢æ‰‹ç»­è´¹ï¼ˆä¾‹å¦‚ 0.3%ï¼‰ â€”â€” å°±åƒ Uniswapä¸€æ · â€”â€” ç„¶åæ”¯ä»˜ç»™æµåŠ¨æ€§æä¾›è€…ã€‚

---

### ğŸŸï¸ å‘æ”¾è‡ªå®šä¹‰ LP ä»£å¸

è¿˜è®°å¾—ä¹‹å‰äººä»¬æ·»åŠ æµåŠ¨æ€§å¾—åˆ°çš„â€œæ”¶æ®â€å—ï¼Ÿ

è¿™äº› LP ä»£å¸ä»£è¡¨Taä»¬åœ¨æ± ä¸­çš„**æ‰€æœ‰æƒä»½é¢**ã€‚

å¦‚æœæ± å­å› äº¤æ˜“è´¹ç”¨å¢é•¿ï¼ŒLP ä¼šå—ç›Š â€”â€” å› ä¸ºTaä»¬å¯ä»¥æå–çš„èµ„äº§æ¯”æŠ•å…¥çš„**æ›´å¤š**ã€‚

ä½ å°†æ‰©å±• ERC-20 åˆçº¦æ¥è‡ªå·±å‘è¡Œå’Œç®¡ç†è¿™äº› LP ä»£å¸ã€‚

---

è¿™ä¸ªåˆçº¦è¡¨é¢çœ‹èµ·æ¥å¯èƒ½å¾ˆç®€å• â€”â€” åªæ˜¯å‡ ä¸ªå‡½æ•°ã€å‡ ä¸ªæ•°å­¦å…¬å¼â€¦â€¦

ä½†åˆçº¦èƒŒåå‘¢ï¼Ÿ

ä½ æ­£åœ¨é‡æ–°åˆ›å»º**å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€**çš„åŸºæœ¬æ„å»ºæ¨¡å— â€”â€” è¿è¡Œåœ¨ä»¥å¤ªåŠä¸Šï¼Œæ— éœ€ä»»ä½•äººã€ç»çºªäººæˆ–ä¸­é—´äººã€‚

æœ€æ£’çš„éƒ¨åˆ†æ˜¯ï¼Œ

ä½ å°†é€è¡Œç¼–å†™ â€”â€” å®Œå…¨é€æ˜ã€å®Œå…¨å»ä¸­å¿ƒåŒ–ï¼Œå¹¶ä¸”å®Œå…¨åœ¨ä½ æŒæ§ä¹‹ä¸‹ã€‚

è®©æˆ‘ä»¬å¼€å§‹æ„å»ºã€‚

---

## åˆçº¦æ‹†è§£

ç°åœ¨ä½ å·²ç»ç†è§£äº†**ä»€ä¹ˆæ˜¯è‡ªåŠ¨åŒ–åšå¸‚å•†**ä»¥åŠ**å®ƒä¸ºä»€ä¹ˆé‡è¦**ï¼Œæ˜¯æ—¶å€™è¯¥æ·±å…¥äº†è§£ã€‚

æ¥ä¸‹æ¥ä½ å°†çœ‹åˆ°çš„æ˜¯ä¸€ä¸ª**å¯è¿è¡Œ AMM çš„å®Œæ•´ä»£ç ** â€”â€” å¦‚æœä¸€å¼€å§‹çœ‹ä¸Šå»æœ‰äº›å“äººä¹Ÿä¸ç”¨æ‹…å¿ƒã€‚æˆ‘ä»¬ä¼š**é€æ­¥æ‹†è§£**ï¼Œå¹¶ç”¨é€šä¿—è¯­è¨€è§£é‡Šæ¯ä¸€éƒ¨åˆ†ã€‚

ä»å¼€å¤´çš„å¯¼å…¥â€¦â€¦

åˆ°å¦‚ä½•æ·»åŠ å’Œç§»é™¤æµåŠ¨æ€§â€¦â€¦

å†åˆ°ä»£å¸å…‘æ¢èƒŒåçš„ç²¾ç¡®æ•°å­¦â€¦â€¦

åœ¨æœ¬æ¬¡æ‹†è§£ç»“æŸæ—¶ï¼Œä½ å°†æ˜ç™½ï¼š

- ERC-20 ä»£å¸å¦‚ä½•é›†æˆåˆ°æ™ºèƒ½åˆçº¦ä¸­
- å‚¨å¤‡ä½™é¢å¦‚ä½•è¢«è·Ÿè¸ªå’Œæ›´æ–°
- `x * y = k` å…¬å¼åœ¨ä»£ç ä¸­ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ ·å­
- ä»¥åŠè‡ªå®šä¹‰ LP ä»£å¸å¦‚ä½•è¢«é“¸é€ å’Œé”€æ¯

æ‰€ä»¥å…ˆæ·±å‘¼å¸ï¼Œæ…¢æ…¢å¾€ä¸‹æ»šåŠ¨ â€”â€” è®©æˆ‘ä»¬é€è¡Œè§£ç ã€‚

è¿™æ˜¯ä¸€åˆ‡å¼€å§‹å˜å¾—æ¸…æ™°çš„åœ°æ–¹ã€‚

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/token/ERC20/ERC20.sol";

/// @title Automated Market Maker with Liquidity Token
contract AutomatedMarketMaker is ERC20 {
    IERC20 public tokenA;
    IERC20 public tokenB;

    uint256 public reserveA;
    uint256 public reserveB;

    address public owner;

    event LiquidityAdded(address indexed provider, uint256 amountA, uint256 amountB, uint256 liquidity);
    event LiquidityRemoved(address indexed provider, uint256 amountA, uint256 amountB, uint256 liquidity);
    event TokensSwapped(address indexed trader, address tokenIn, uint256 amountIn, address tokenOut, uint256 amountOut);

    constructor(address _tokenA, address _tokenB, string memory _name, string memory _symbol) ERC20(_name, _symbol) {
        tokenA = IERC20(_tokenA);
        tokenB = IERC20(_tokenB);
        owner = msg.sender;
    }

    /// @notice Add liquidity to the pool
    function addLiquidity(uint256 amountA, uint256 amountB) external {
        require(amountA > 0 && amountB > 0, "Amounts must be > 0");

        tokenA.transferFrom(msg.sender, address(this), amountA);
        tokenB.transferFrom(msg.sender, address(this), amountB);

        uint256 liquidity;
        if (totalSupply() == 0) {
            liquidity = sqrt(amountA * amountB);
        } else {
            liquidity = min(
                amountA * totalSupply() / reserveA,
                amountB * totalSupply() / reserveB
            );
        }

        _mint(msg.sender, liquidity);

        reserveA += amountA;
        reserveB += amountB;

        emit LiquidityAdded(msg.sender, amountA, amountB, liquidity);
    }

    /// @notice Remove liquidity from the pool
    function removeLiquidity(uint256 liquidityToRemove) external returns (uint256 amountAOut, uint256 amountBOut) {
        require(liquidityToRemove > 0, "Liquidity to remove must be > 0");
        require(balanceOf(msg.sender) >= liquidityToRemove, "Insufficient liquidity tokens");

        uint256 totalLiquidity = totalSupply();
        require(totalLiquidity > 0, "No liquidity in the pool");

        amountAOut = liquidityToRemove * reserveA / totalLiquidity;
        amountBOut = liquidityToRemove * reserveB / totalLiquidity;

        require(amountAOut > 0 && amountBOut > 0, "Insufficient reserves for requested liquidity");

        reserveA -= amountAOut;
        reserveB -= amountBOut;

        _burn(msg.sender, liquidityToRemove);

        tokenA.transfer(msg.sender, amountAOut);
        tokenB.transfer(msg.sender, amountBOut);

        emit LiquidityRemoved(msg.sender, amountAOut, amountBOut, liquidityToRemove);
        return (amountAOut, amountBOut);
    }

    /// @notice Swap token A for token B
    function swapAforB(uint256 amountAIn, uint256 minBOut) external {
        require(amountAIn > 0, "Amount must be > 0");
        require(reserveA > 0 && reserveB > 0, "Insufficient reserves");

        uint256 amountAInWithFee = amountAIn * 997 / 1000;
        uint256 amountBOut = reserveB * amountAInWithFee / (reserveA + amountAInWithFee);

        require(amountBOut >= minBOut, "Slippage too high");

        tokenA.transferFrom(msg.sender, address(this), amountAIn);
        tokenB.transfer(msg.sender, amountBOut);

        reserveA += amountAInWithFee;
        reserveB -= amountBOut;

        emit TokensSwapped(msg.sender, address(tokenA), amountAIn, address(tokenB), amountBOut);
    }

    /// @notice Swap token B for token A
    function swapBforA(uint256 amountBIn, uint256 minAOut) external {
        require(amountBIn > 0, "Amount must be > 0");
        require(reserveA > 0 && reserveB > 0, "Insufficient reserves");

        uint256 amountBInWithFee = amountBIn * 997 / 1000;
        uint256 amountAOut = reserveA * amountBInWithFee / (reserveB + amountBInWithFee);

        require(amountAOut >= minAOut, "Slippage too high");

        tokenB.transferFrom(msg.sender, address(this), amountBIn);
        tokenA.transfer(msg.sender, amountAOut);

        reserveB += amountBInWithFee;
        reserveA -= amountAOut;

        emit TokensSwapped(msg.sender, address(tokenB), amountBIn, address(tokenA), amountAOut);
    }

    /// @notice View the current reserves
    function getReserves() external view returns (uint256, uint256) {
        return (reserveA, reserveB);
    }

    /// @dev Utility: Return the smaller of two values
    function min(uint256 a, uint256 b) internal pure returns (uint256) {
        return a < b ? a : b;
    }

    /// @dev Utility: Babylonian square root
    function sqrt(uint256 y) internal pure returns (uint256 z) {
        if (y > 3) {
            z = y;
            uint256 x = y / 2 + 1;
            while (x < z) {
                z = x;
                x = (y / x + x) / 2;
            }
        } else if (y != 0) {
            z = 1;
        }
    }
}

```

è®©æˆ‘ä»¬ä»¥æœ€é€‚åˆåˆå­¦è€…çš„æ–¹å¼å¼€å§‹æ‹†è§£è¿™ä¸ªåˆçº¦ã€‚

---

---

## ğŸ§± 1. å¯¼å…¥ ERC20 æ ‡å‡†

```solidity
import "@openzeppelin/contracts/token/ERC20/ERC20.sol";

```

å…ˆä»è¿™ä¸€è¡Œå¼€å§‹ â€”â€” å¾ˆç®€å•ï¼Œä½†åŠŸèƒ½éå¸¸å¼ºå¤§ã€‚

è¿™é‡Œï¼Œæˆ‘ä»¬ä» **OpenZeppelin** å¯¼å…¥äº† ERC20 åˆçº¦ã€‚

> ğŸ§° ä»€ä¹ˆæ˜¯ OpenZeppelinï¼Ÿ
> 
> 
> å®ƒæ˜¯ä¸€ä¸ªç»è¿‡å®æˆ˜éªŒè¯ã€å®‰å…¨å¯é çš„æ™ºèƒ½åˆçº¦åº“ï¼Œåœ¨ä»¥å¤ªåŠç”Ÿæ€ç³»ç»Ÿä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä½ å¯ä»¥ä¿¡èµ–çš„ä¹é«˜ç§¯æœ¨ â€”â€” ä¸ç”¨ä»é›¶æ„å»ºæ¯ä¸€å—ç –ã€‚
> 

> ğŸ“¦ ä»€ä¹ˆæ˜¯ ERC20ï¼Ÿ
> 
> 
> ERC-20 æ˜¯ä»¥å¤ªåŠä¸Šåˆ›å»ºä»£å¸çš„æ ‡å‡†ã€‚å¤§å¤šæ•°ä½ å¬è¯´è¿‡çš„ä»£å¸ â€”â€” æ¯”å¦‚ DAIã€USDC æˆ– UNI â€”â€” éƒ½éµå¾ªè¿™ä¸ªæ ‡å‡†ã€‚å®ƒå®šä¹‰äº†ä»£å¸çš„è¡Œä¸ºæ–¹å¼ï¼ŒåŒ…æ‹¬ï¼š
> 
- å¦‚ä½•å‘é€å’Œæ¥æ”¶ä»£å¸ï¼ˆ`transfer`ï¼‰
- å¦‚ä½•æˆæƒTaäººä½¿ç”¨ä»£å¸ï¼ˆ`approve` + `transferFrom`ï¼‰
- å¦‚ä½•æŸ¥è¯¢ä½™é¢ï¼ˆ`balanceOf`ï¼‰
- ç”šè‡³å¦‚ä½•åˆ›å»ºæˆ–é”€æ¯ä»£å¸ï¼ˆ`mint` å’Œ `burn`ï¼‰ï¼ˆå¦‚æœå…è®¸çš„è¯ï¼‰

é€šè¿‡å¯¼å…¥ `ERC20.sol`ï¼Œæˆ‘ä»¬å¯ä»¥ç«‹å³è®¿é—®ä½¿ç”¨**æ‰€æœ‰è¿™äº›åŠŸèƒ½**ï¼Œæ— éœ€è‡ªå·±é‡æ–°ç¼–å†™ã€‚

> âœ¨ ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨è¿™é‡Œéœ€è¦å®ƒï¼Ÿ
> 
> 
> å› ä¸ºæˆ‘ä»¬çš„ AMM åˆçº¦ä¹Ÿä¼šå‘è¡Œè‡ªå·±çš„ä»£å¸ â€”â€” å½“ç”¨æˆ·æä¾›æµåŠ¨æ€§æ—¶è·å¾—çš„ LP ä»£å¸ã€‚è¿™äº› LP ä»£å¸å°±æ˜¯æ ‡å‡†çš„ ERC-20 ä»£å¸ â€”â€” é€šè¿‡ç»§æ‰¿ ERC20 åˆçº¦ï¼Œæˆ‘ä»¬å¯ä»¥åƒæ“ä½œä»»ä½•å…¶å®ƒä»£å¸ä¸€æ ·é“¸é€ å®ƒä»¬ã€‚
> 

è¿™ä¸ªå¯¼å…¥ä¸º LP ä»£å¸åŠŸèƒ½æ­å»ºäº†æ•´ä¸ªéª¨æ¶ã€‚

---

## ğŸ§¾ 2. åˆçº¦å£°æ˜

```solidity
contract AutomatedMarketMaker is ERC20 {

```

è¿™ä¸€è¡Œå¼€å§‹äº†æˆ‘ä»¬çš„ä¸»è¦æ™ºèƒ½åˆçº¦ã€‚

æˆ‘ä»¬æ¥æ‹†è§£ä¸€ä¸‹ï¼š

- `contract AutomatedMarketMaker`ï¼š
    
    å®šä¹‰äº†ä¸€ä¸ªåä¸º `AutomatedMarketMaker` çš„æ–°åˆçº¦ã€‚è¿™å°†æ˜¯æˆ‘ä»¬çš„ AMM çš„**å¤§è„‘**ï¼Œè´Ÿè´£æŒæœ‰ä»£å¸ã€è®¡ç®—å…‘æ¢ã€è·Ÿè¸ªæµåŠ¨æ€§ã€‚
    
- `is ERC20`ï¼š
    
    è¿™æ„å‘³ç€æˆ‘ä»¬çš„åˆçº¦**ç»§æ‰¿è‡ªæˆ‘ä»¬åˆšå¯¼å…¥çš„ ERC20 åˆçº¦**ã€‚
    

æŠŠç»§æ‰¿æƒ³è±¡æˆåœ¨è¯´ï¼š

> â€œæˆ‘çš„åˆçº¦åº”è¯¥åƒ ERC20 ä»£å¸ä¸€æ ·è¿ä½œ â€”â€” åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘è¿˜ä¼šæ·»åŠ ä¸€äº› AMM ä¸“å±é€»è¾‘ã€‚â€
> 

å› ä¸ºæœ‰äº†ç»§æ‰¿ï¼Œæˆ‘ä»¬æ— éœ€æ‰‹åŠ¨ç¼–ç  ERC-20 çš„è¡Œä¸º â€”â€” å®ƒå·²ç»å†…ç½®å¥½äº†ã€‚éœ€è¦å‘è¡Œæˆ–é”€æ¯ LP ä»£å¸æ—¶ï¼Œæˆ‘ä»¬åªéœ€è°ƒç”¨ `_mint()` å’Œ `_burn()`ã€‚

> ğŸŸï¸ ä¸ºä»€ä¹ˆ AMM éœ€è¦è‡ªå·±çš„ä»£å¸ï¼Ÿ
> 
> 
> æ¯å½“æœ‰äººæä¾›æµåŠ¨æ€§æ—¶ï¼Œæˆ‘ä»¬ä¼šç»™Taä»¬ä¸€ä¸ªä»£å¸ï¼Œä»£è¡¨Taä»¬åœ¨**æµåŠ¨æ€§æ± ä¸­çš„ä»½é¢è¯æ˜**ã€‚è¿™å°±æ˜¯ LP ä»£å¸ã€‚å®ƒåƒä»»ä½•å…¶å®ƒ ERC-20 ä»£å¸ä¸€æ · â€”â€” å¯ä»¥è½¬ç§»ã€è·Ÿè¸ªï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¹‹åèµå›æ± ä¸­å¯¹åº”ä»½é¢ã€‚
> 

æ‰€ä»¥è¿™ä¸€è¡Œä¸ä»…ä»…æ˜¯å£°æ˜ â€”â€” å®ƒæ˜¯è®©æˆ‘ä»¬çš„ AMM åŒæ—¶æ‰®æ¼”ä»£å¸å‘è¡Œè€…å’Œå»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€çš„å¼€å§‹ã€‚

---

## ğŸ§® 3. çŠ¶æ€å˜é‡

```solidity
IERC20 public tokenA;
IERC20 public tokenB;

uint256 public reserveA;
uint256 public reserveB;

address public owner;

```

è¿™äº›æ˜¯**æ ¸å¿ƒå˜é‡**ï¼Œå­˜å‚¨ AMM çš„é‡è¦çŠ¶æ€ã€‚

å¯ä»¥æŠŠå®ƒä»¬æƒ³è±¡æˆåˆçº¦çš„å†…éƒ¨è®°å¿† â€”â€” è®°å½•åˆçº¦å¤„ç†çš„ä»£å¸ã€æ¯ç§ä»£å¸çš„æ•°é‡ï¼Œä»¥åŠè°éƒ¨ç½²äº†åˆçº¦ã€‚

æˆ‘ä»¬é€ä¸€è§£æï¼š

---

### ğŸª™ `tokenA` å’Œ `tokenB`

```solidity
IERC20 public tokenA;
IERC20 public tokenB;

```

- è¿™ä¸¤ä¸ªå˜é‡å­˜å‚¨ AMM å°†ç®¡ç†çš„ ERC-20 ä»£å¸çš„**åœ°å€**ã€‚
- å®ƒä»¬çš„ç±»å‹æ˜¯ `IERC20`ï¼Œåªæ˜¯ä¸€ä¸ªæ¥å£ â€”â€” ç”¨æ¥è¡¨ç¤ºï¼š
    
    > â€œè¿™ä¸œè¥¿è¡¨ç°å¾—åƒ ERC-20 ä»£å¸ï¼Œæ‰€ä»¥æˆ‘çŸ¥é“å®ƒæœ‰ transferã€transferFromã€approve ç­‰å‡½æ•°ã€‚â€
    > 

å¦‚æœè¿™ä¸ª AMM ç”¨äºäº¤æ˜“ **DAI å’Œ USDC**ï¼Œé‚£ä¹ˆ `tokenA` å¯èƒ½æ˜¯ DAIï¼Œ`tokenB` æ˜¯ USDCã€‚

> âœ… ä¸ºä»€ä¹ˆæ˜¯ publicï¼Ÿ
> 
> 
> å› ä¸ºæˆ‘ä»¬å¸Œæœ›è¿™äº›å˜é‡å¯ä»¥**è¢«å¤–éƒ¨æŸ¥çœ‹** â€”â€” ä¾‹å¦‚å‰ç«¯ã€åŒºå—é“¾æµè§ˆå™¨æˆ–å…¶ä»–åˆçº¦ã€‚
> 

---

### ğŸ§¾ `reserveA` å’Œ `reserveB`

```solidity
uint256 public reserveA;
uint256 public reserveB;

```

è¿™ä¸¤ä¸ªæ•°å€¼è·Ÿè¸ªå½“å‰é”å®šåœ¨ AMM åˆçº¦ä¸­çš„æ¯ç§ä»£å¸æ•°é‡ã€‚

ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªæ•°å€¼ï¼Ÿ

å› ä¸º**æ•´ä¸ª AMM é€»è¾‘ â€”â€” å…‘æ¢ã€ä»·æ ¼ã€LP ä»½é¢ â€”â€” éƒ½ä¾èµ–äºçŸ¥é“æ± ä¸­æ¯ç§ä»£å¸çš„æ•°é‡**ã€‚

å½“æœ‰äººå…‘æ¢ä»£å¸æ—¶ï¼š

- æˆ‘ä»¬æ›´æ–°è¿™äº›å‚¨å¤‡
- å¹¶ä½¿ç”¨è¿™äº›æ•°å€¼åœ¨å…¬å¼ `x * y = k` ä¸­è®¡ç®—å…‘æ¢é‡

> ğŸ¯ é‡è¦æç¤ºï¼šè¿™äº›æ•°å€¼ä¸ä¼šè‡ªåŠ¨æ ¹æ®ä»£å¸ä½™é¢è‡ªåŠ¨æ›´æ–° â€”â€” è€Œæ˜¯æ¯æ¬¡æˆ‘ä»¬è¿›è¡Œæ“ä½œï¼ˆå¦‚å…‘æ¢æˆ–å»é™¤æµåŠ¨æ€§ï¼‰æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨æ›´æ–°ã€‚
> 

---

### ğŸ§‘â€ğŸ’¼ `owner`

```solidity
address public owner;

```

å­˜å‚¨**éƒ¨ç½²**åˆçº¦çš„åœ°å€ã€‚

ç›®å‰ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰ä½¿ç”¨å®ƒæ¥åšä»»ä½•ä»…é™ç®¡ç†å‘˜çš„æ“ä½œâ€¦â€¦ä½†è¿™æ˜¯ä¸€ä¸ªå¥½çš„æ¨¡å¼ï¼Œå¦‚æœæœªæ¥æˆ‘ä»¬æƒ³è¦åšä»¥ä¸‹æ“ä½œå¯ä»¥è€ƒè™‘è¯¥æ¨¡å¼ï¼š

- æ·»åŠ æ²»ç†
- åœ¨ç´§æ€¥æƒ…å†µä¸‹è®©æ‹¥æœ‰è€…æš‚åœäº¤æ˜“
- æˆ–è€…ä¹‹åå¼•å…¥è´¹ç”¨è½¬æ¢

> ğŸ” ç°åœ¨çš„æ¡ˆä¾‹åªæ˜¯ç®€å•è¿½è¸ªè°æ§åˆ¶åˆçº¦ â€”â€” æˆ–è€…åªæ˜¯æ ‡è®°è°æœ€åˆéƒ¨ç½²äº†åˆçº¦ã€‚
> 

---

è¿™äº›å˜é‡ä¸€èµ·å®šä¹‰äº† AMM çš„ **æ ¸å¿ƒèº«ä»½å’ŒçŠ¶æ€**ï¼š

- æ”¯æŒå“ªäº›ä»£å¸
- æ‹¥æœ‰å¤šå°‘æµåŠ¨æ€§
- è°æ‹¥æœ‰æˆ–ç®¡ç†å®ƒ

---

## ğŸ”” 4. Eventï¼ˆäº‹ä»¶ï¼‰

```solidity
event LiquidityAdded(address indexed provider, uint256 amountA, uint256 amountB, uint256 liquidity);
event LiquidityRemoved(address indexed provider, uint256 amountA, uint256 amountB, uint256 liquidity);
event TokensSwapped(address indexed trader, address tokenIn, uint256 amountIn, address tokenOut, uint256 amountOut);

```

è¿™äº›æ˜¯ **eventï¼ˆäº‹ä»¶ï¼‰**ï¼Œè™½ç„¶å®ƒä»¬ä¸ä¼šå½±å“åˆçº¦çš„åº•å±‚è¿ä½œï¼Œä½†åœ¨åº”ç”¨ä¸ç”¨æˆ·äº¤äº’ä¸­èµ·åˆ°**é‡è¦ä½œç”¨**ã€‚

æŠŠäº‹ä»¶æƒ³è±¡æˆ**é“¾ä¸Šé€šçŸ¥**æˆ–**åŒºå—é“¾çš„æ§åˆ¶å°æ—¥å¿—**ã€‚

æ¯å½“å‘ç”Ÿå…³é”®æ“ä½œ â€”â€” æ·»åŠ æµåŠ¨æ€§ã€ç§»é™¤æµåŠ¨æ€§æˆ–å…‘æ¢ä»£å¸ â€”â€” æˆ‘ä»¬å°±ä¼šè§¦å‘ä¸€ä¸ªäº‹ä»¶ã€‚

è®©æˆ‘ä»¬é€ä¸€è§£æï¼š

---

### ğŸ’§ `LiquidityAdded`

```solidity
event LiquidityAdded(address indexed provider, uint256 amountA, uint256 amountB, uint256 liquidity);

```

- è¯¥äº‹ä»¶åœ¨æœ‰äºº**æ·»åŠ ä»£å¸**åˆ°æ± å­æ—¶è§¦å‘ã€‚
- è®°å½•ï¼š
    - è°æ·»åŠ äº†æµåŠ¨æ€§ (`provider`)
    - æ·»åŠ äº†å¤šå°‘ tokenA å’Œ tokenB
    - è·å¾—äº†å¤šå°‘ **LP ä»£å¸**

> ğŸ§  ä¸ºä»€ä¹ˆè®°å½•äº‹ä»¶æœ‰ç”¨ï¼Ÿ
> 
> 
> å› ä¸ºdappså¯ä»¥**ç›‘å¬è¿™ä¸ªäº‹ä»¶** å¹¶åœ¨ UI æ˜¾ç¤ºã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç½‘ç«™å¯èƒ½æ˜¾ç¤ºï¼š
> 
> â€œä½ å‘æ± ä¸­æ·»åŠ äº† 100 DAI å’Œ 100 USDCï¼Œè·å¾—äº† 99 ä¸ª LP ä»£å¸ã€‚â€
> 

---

### ğŸ’¸ `LiquidityRemoved`

```solidity
event LiquidityRemoved(address indexed provider, uint256 amountA, uint256 amountB, uint256 liquidity);

```

- è¯¥äº‹ä»¶åœ¨æœ‰äºº **ç§»é™¤æ± ä¸­æµåŠ¨æ€§** æ—¶è®°å½•ã€‚
- æ˜¾ç¤ºï¼š
    - è°è¿›è¡Œäº†æ“ä½œ
    - å–å›äº†æ¯ç§ä»£å¸çš„å¤šå°‘
    - é”€æ¯äº†å¤šå°‘ LP ä»£å¸

> ğŸ” å‰ç«¯å¯ä»¥ç”¨è¯¥äº‹ä»¶æ¥æ›´æ–°ä½ çš„æ± å­æŒä»“æˆ–å†å²è®°å½•ã€‚
> 

---

### ğŸ”„ `TokensSwapped`

```solidity
event TokensSwapped(address indexed trader, address tokenIn, uint256 amountIn, address tokenOut, uint256 amountOut);

```

- å½“æœ‰äºº**å…‘æ¢** ä¸€ç§ä»£å¸æ¢å¦ä¸€ç§ä»£å¸æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚
- å‘Šè¯‰æˆ‘ä»¬ï¼š
    - è°è¿›è¡Œäº†å…‘æ¢ (`trader`)
    - å…‘æ¢è¿›æ¥çš„ä»£å¸ç§ç±» (`tokenIn`)
    - ç»™è¿›çš„ä»£å¸æ•°é‡
    - å…‘æ¢å‡ºå»çš„ä»£å¸ç§ç±» (`tokenOut`)
    - æ”¯å‡ºçš„ä»£å¸æ•°é‡

> ğŸ–¥ï¸ æœ‰äº†è¿™ä¸ªï¼Œdapps å¯ä»¥ç«‹å³æ˜¾ç¤ºå…‘æ¢ç¡®è®¤ï¼Œä¾‹å¦‚ï¼š
> 
> 
> â€œä½ ç”¨ 10 DAI æ¢äº† 9.87 USDCã€‚â€
> 

---

## ğŸš€ 5. æ„é€ å‡½æ•° â€“ åˆå§‹åŒ–è®¾ç½®

```solidity
constructor(address _tokenA, address _tokenB, string memory _name, string memory _symbol) ERC20(_name, _symbol) {
  tokenA = IERC20(_tokenA);
  tokenB = IERC20(_tokenB);
  owner = msg.sender;
}

```

è¿™ä¸ªå‡½æ•°å¯èƒ½çœ‹èµ·æ¥å¾ˆå°ï¼Œä½†**è‡³å…³é‡è¦**ã€‚

è¿™æ˜¯**æ„é€ å‡½æ•°**ï¼Œåœ¨åˆçº¦éƒ¨ç½²åˆ°åŒºå—é“¾æ—¶**åªä¼šè¿è¡Œä¸€æ¬¡**ã€‚

æˆ‘ä»¬é€æ­¥è§£æã€‚

---

### ğŸ”§ æ„é€ å‡½æ•°çš„ä½œç”¨

å°±åƒåœ¨æœºå™¨é¦–æ¬¡ä½¿ç”¨å‰è¿›è¡Œåˆå§‹é…ç½®ã€‚ä½ å®šä¹‰ï¼š

- AMM æ”¯æŒå“ªäº›ä»£å¸
- LP ä»£å¸çš„åç§°
- è°éƒ¨ç½²äº†åˆçº¦ï¼ˆä»¥åå¯èƒ½æ§åˆ¶å‡çº§æˆ–ç‰¹æ®Šæ“ä½œï¼‰

---

### ğŸ“¬ å‚æ•°

```solidity
constructor(address _tokenA, address _tokenB, string memory _name, string memory _symbol)

```

æ„é€ å‡½æ•°æ¥å— **å››ä¸ªè¾“å…¥**ï¼š

1. `_tokenA`ï¼šç¬¬ä¸€ç§ ERC-20 ä»£å¸çš„åœ°å€ï¼ˆä¾‹å¦‚ DAIï¼‰
2. `_tokenB`ï¼šç¬¬äºŒç§ ERC-20 ä»£å¸çš„åœ°å€ï¼ˆä¾‹å¦‚ USDCï¼‰
3. `_name`ï¼šLP ä»£å¸åç§°ï¼ˆä¾‹å¦‚ â€œDAI-USDC LP Tokenâ€ï¼‰
4. `_symbol`ï¼šLP ä»£å¸ç¬¦å·ï¼ˆä¾‹å¦‚ â€œDAIUSDC-LPâ€ï¼‰

> ğŸ“ string memory ç±»å‹åªæ˜¯åœ¨ Solidityä¸­ è¡¨ç¤ºç€ï¼š
> 
> 
> â€œæˆ‘ä»¬ä¸´æ—¶ä¼ é€’è¿™ä¸ªå­—ç¬¦ä¸² â€”â€” ä¸æ˜¯å­˜å‚¨åœ¨å›ºå®šé•¿åº¦çš„ä½ç½®ã€‚â€
> 

---

### ğŸŸï¸ `ERC20(_name, _symbol)`

```solidity
ERC20(_name, _symbol)

```

è¿™éƒ¨åˆ†è™½ç„¶éšè”½ï¼Œä½†å¾ˆé‡è¦ã€‚

å› ä¸ºæˆ‘ä»¬çš„ AMM åˆçº¦ç»§æ‰¿è‡ª `ERC20`ï¼Œè¿™é‡Œè°ƒç”¨å®ƒçš„æ„é€ å‡½æ•°è®¾ç½® **LP ä»£å¸çš„åç§°å’Œç¬¦å·**ã€‚

æ‰€ä»¥æœ‰äººæ·»åŠ æµåŠ¨æ€§åï¼Œå¯èƒ½ä¼šå¾—åˆ°è¿™ä¸ªä»£å¸ï¼Œåä¸ºï¼š

> â€œDAI-USDC LP Token (DAIUSDC-LP)â€
> 

å°±åƒ USDC æœ‰è‡ªå·±çš„åç§°å’Œç¬¦å·ä¸€æ · â€”â€” ä½ çš„ LP ä»£å¸ä¹Ÿä¼šæœ‰ã€‚

---

### ğŸª™ ä»£å¸è®¾ç½®

```solidity
tokenA = IERC20(_tokenA);
tokenB = IERC20(_tokenB);

```

è¿™ä¸€éƒ¨åˆ†æŠŠå®é™…ä»£å¸åˆçº¦èµ‹å€¼ç»™çŠ¶æ€å˜é‡ã€‚

æˆ‘ä»¬å°†ä¼ å…¥çš„ä¸¤ä¸ªåœ°å€ (`_tokenA` å’Œ `_tokenB`) å¹¶å°†å…¶è§†ä½œ ERC-20 ä»£å¸ï¼Œé€šè¿‡ `IERC20` æ¥å£ä½¿ç”¨ã€‚è¿™è®©æˆ‘ä»¬å¯ä»¥è®¿é—®ï¼š

- `transfer()`
- `transferFrom()`
- `balanceOf()`
- ä»¥åŠå…¶å®ƒä¸ä»£å¸ç›¸å…³çš„å‡½æ•°

è¿™æ · AMM å°±çŸ¥é“**å®ƒæ­£åœ¨å¤„ç†å“ªäº›ä»£å¸**ã€‚

---

### ğŸ‘‘ æ‰€æœ‰æƒ

```solidity
owner = msg.sender;

```

è¿™ä¸€è¡ŒæŠŠ `owner` å˜é‡è®¾ç½®ä¸ºéƒ¨ç½²åˆçº¦çš„äººã€‚

`msg.sender` æ˜¯ Solidity ä¸­çš„å…¨å±€å˜é‡ â€”â€” æ€»æ˜¯æŒ‡å½“å‰è°ƒç”¨å‡½æ•°çš„åœ°å€ã€‚

åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œå®ƒå°±æ˜¯åˆçº¦éƒ¨ç½²è€…çš„åœ°å€ã€‚

æˆ‘ä»¬ç›®å‰è¿˜æ²¡æœ‰ç”¨ `owner` åšä»»ä½•ç®¡ç†å‘˜ç›¸å…³æ“ä½œï¼Œä½†è®°å½•éƒ¨ç½²è€…æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ â€”â€” ä»¥é˜²ä»¥åæƒ³å¼•å…¥æ²»ç†æˆ–è´¹ç”¨åˆ†é…æœºåˆ¶ã€‚

---

## 6.ğŸ§° è¾…åŠ©å‡½æ•° â€“ å°å·¥å…·ï¼Œå¤§ç”¨é€”

```solidity
function min(uint256 a, uint256 b) internal pure returns (uint256) {
    return a < b ? a : b;
}

function sqrt(uint256 y) internal pure returns (uint256 z) {
    if (y > 3) {
        z = y;
        uint256 x = y / 2 + 1;
        while (x < z) {
            z = x;
            x = (y / x + x) / 2;
        }
    } else if (y != 0) {
        z = 1;
    }
}

```

---

### ğŸ”½ min(): è¿”å›è¾ƒå°çš„æ•°

```solidity
function min(uint256 a, uint256 b) internal pure returns (uint256) {
    return a < b ? a : b;
}

```

è¿™ä¸ªå‡½æ•°ç”¨æ¥é€‰æ‹©ä¸¤ä¸ªæ•°å­—ä¸­è¾ƒå°çš„ä¸€ä¸ªã€‚

æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªå‡½æ•°ï¼Ÿ

ğŸ‘‰ åœ¨ `addLiquidity()` ä¸­ï¼Œå½“æœ‰äººå‘å·²æœ‰æµåŠ¨æ€§æ± æ·»åŠ ä»£å¸æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›æ ¹æ®**å“ªä¸ªä»£å¸è´¡çŒ®è¾ƒå°‘**æ¥é“¸é€  LP ä»£å¸ â€”â€” è¿™æ ·å¯ä»¥ä¿æŒæ¯”ä¾‹ç¨³å®šï¼Œé˜²æ­¢é“¸é€ è¿‡å¤šã€‚

ä¸¾ä¾‹ï¼šå¦‚æœç”¨æˆ·å‘é€ 100 ä¸ª A å’Œ 150 ä¸ª Bï¼Œæˆ‘ä»¬åªä¼šç”¨ 100 ä¸ª A å’Œ 100 ä¸ª B æ¥é“¸é€  LP ä»£å¸ â€”â€” å¤šä½™çš„ 50 ä¸ª B ä¼šè¿”è¿˜ç»™æ± å­ã€‚

è¿™ä¸ª `min()` å‡½æ•°ç¡®ä¿äº†æ± å­çš„**å¹³è¡¡**ä¸**å…¬å¹³**ã€‚

---

### ğŸ§® sqrt(): å·´æ¯”ä¼¦å¹³æ–¹æ ¹ç®—æ³•

```solidity
function sqrt(uint256 y) internal pure returns (uint256 z) {
    if (y > 3) {
        z = y;
        uint256 x = y / 2 + 1;
        while (x < z) {
            z = x;
            x = (y / x + x) / 2;
        }
    } else if (y != 0) {
        z = 1;
    }
}

```

è¿™æ˜¯ä¸€ç§ç»å…¸çš„**å·´æ¯”ä¼¦ç®—æ³•** ï¼Œç”¨äºåœ¨ Solidity ä¸­è®¡ç®—æ•°å­—çš„å¹³æ–¹æ ¹â€”â€”å› ä¸º Solidity ä¸åƒå…¶å®ƒä¸€äº›ç¼–ç¨‹è¯­è¨€é‚£æ ·å†…ç½® sqrtï¼ˆï¼‰ å‡½æ•°ã€‚

å®ƒåªç”¨åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œä½†ç”¨é€”éå¸¸é‡è¦ï¼š

ğŸ¯ ä½¿ç”¨åœºæ™¯ï¼š

åœ¨ `addLiquidity()` ä¸­ï¼Œ**ç¬¬ä¸€ä¸ªæä¾›æµåŠ¨æ€§çš„äºº**è·å¾—çš„ LP ä»£å¸æ•°é‡ä¸ºï¼š

```
sqrt(amountA * amountB)

```

è¿™ä¿è¯äº†ï¼š

- LP ä»£å¸ä¾›åº”ä»ä¸€ä¸ªå¹³è¡¡å€¼å¼€å§‹
- ç»“æœåæ˜ äº†ä¸¤ä¸ªä»£å¸æ·»åŠ é‡çš„å‡ ä½•å¹³å‡å€¼
- ä¾‹å¦‚ä½ æ·»åŠ äº† 100 A å’Œ 400 Bï¼Œä½ çš„ LP ä»£å¸å°†åŸºäº âˆš(100Ã—400) = âˆš40000 = 200ï¼Œè€Œä¸æ˜¯ç®€å•çš„æ€»å’Œ

è¿™æ˜¯ä¸€ä¸ªå…¬å¹³ä¸”æ•°å­¦é©±åŠ¨çš„æ–¹å¼æ¥åˆå§‹åŒ–æ± å­ã€‚

---

ğŸ§  ä¸ºä»€ä¹ˆæŠŠè¿™äº›å‡½æ•°æ”¾åœ¨åˆçº¦é‡Œï¼Ÿ

- å®ƒä»¬éƒ½æ˜¯å°å‹**çº¯å‡½æ•°**ï¼ˆä¸è¯»/å†™å­˜å‚¨ï¼‰
- å†…éƒ¨ä½¿ç”¨å¯ä»¥ä¿æŒé€»è¾‘æ•´æ´
- ç‰¹åˆ«æ˜¯åœ¨å¤„ç†éœ€è¦ä¿è¯é‡è¦å…¬å¹³çš„ä»£å¸æ•°å­¦æ—¶ï¼Œå®ƒä»¬æœ‰åŠ©äºé¿å…å‡ºé”™

æˆ‘ä»¬å°†åœ¨åç»­å‡½æ•°ä¸­ä½¿ç”¨è¿™äº›è¾…åŠ©å‡½æ•°ã€‚

---

## ğŸ’§ 7. æ·»åŠ æµåŠ¨æ€§ â€“ å–‚å…¥æ± å­

```solidity
function addLiquidity(uint256 amountA, uint256 amountB) external {
    require(amountA > 0 && amountB > 0, "Amounts must be > 0");

    tokenA.transferFrom(msg.sender, address(this), amountA);
    tokenB.transferFrom(msg.sender, address(this), amountB);

    uint256 liquidity;
    if (totalSupply() == 0) {
        liquidity = sqrt(amountA * amountB);
    } else {
        liquidity = min(
            amountA * totalSupply() / reserveA,
            amountB * totalSupply() / reserveB
        );
    }

    _mint(msg.sender, liquidity);

    reserveA += amountA;
    reserveB += amountB;

    emit LiquidityAdded(msg.sender, amountA, amountB, liquidity);
}

```

---

ğŸ§  æ€»ä½“æ€è·¯ï¼š

è¿™ä¸ªå‡½æ•°å…è®¸ç”¨æˆ·é€šè¿‡å­˜å…¥ç­‰å€¼é‡‘é¢çš„ Token A å’Œ Token B æ¥å‘æ± å­æ·»åŠ æµåŠ¨æ€§ã€‚

ä½œä¸ºå›æŠ¥ï¼Œç”¨æˆ·ä¼šè·å¾— LP ä»£å¸ï¼ˆæµåŠ¨æ€§æä¾›è€…ä»£å¸ï¼‰ï¼Œä»£è¡¨Taä»¬åœ¨æ± å­ä¸­çš„ä»½é¢ã€‚

> è¿™äº› LP ä»£å¸å°±åƒä¸€å¼ è¯æ˜ä½ ä¸ºæ± å­åšå‡ºäº†è´¡çŒ®çš„â€œæ”¶æ®â€ï¼Œä¹Ÿæ˜¯ä½ åœ¨æ± å­é‡Œçš„ä»£å¸ä»½é¢çš„å£°æ˜ã€‚
> 

ç¬¬ä¸€ä¸ªæ·»åŠ æµåŠ¨æ€§çš„äººä¼šè®¾å®šåˆå§‹ä»·æ ¼ã€‚

ä¹‹åçš„æ¯ä¸ªäººå¿…é¡»**æŒ‰ç…§å½“å‰æ± å­çš„æ¯”ä¾‹**å­˜å…¥ä»£å¸ â€”â€” ä»¥ä¿æŒä»·æ ¼å…¬å¹³ã€‚

---

ğŸ§© é€è¡Œè§£æï¼š

### âœ… è¾“å…¥æ£€æŸ¥

```solidity
require(amountA > 0 && amountB > 0, "Amounts must be > 0");

```

å…ˆåšä¸€ä¸ªåŸºæœ¬çš„åˆç†æ€§æ£€æŸ¥ã€‚

- ä¸å…è®¸æœ‰äººå­˜å…¥é›¶ä¸ªä»£å¸ã€‚
- è¿™æ ·å¯ä»¥ä¿æŠ¤åˆçº¦å…å—å¥‡æ€ªæ“ä½œå½±å“æˆ–é¿å…gasæµªè´¹ã€‚

---

### ğŸ’¸ å°†ä»£å¸è½¬å…¥æ± å­

```solidity
tokenA.transferFrom(msg.sender, address(this), amountA);
tokenB.transferFrom(msg.sender, address(this), amountB);

```

ç”¨æˆ·å°†Taä»¬çš„ä»£å¸å®é™…å‘é€åˆ°åˆçº¦ã€‚

- æˆ‘ä»¬ä½¿ç”¨ `transferFrom()`ï¼Œå› ä¸ºç”¨æˆ·éœ€è¦å…ˆæ‰¹å‡†åˆçº¦å¯ä»¥æ‹¿èµ°Taä»¬çš„ä»£å¸ã€‚
- è¿™æ˜¯æ ‡å‡†ERC-20 è¡Œä¸ºæ“ä½œ â€”â€” ç”¨æˆ·å¿…é¡»å…ˆè°ƒç”¨ `approve()`ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·æŠŠ `amountA` çš„ä»£å¸A å’Œ`amountB` çš„ä»£å¸Bç»™äº†åˆçº¦ã€‚

---

### ğŸ“ è®¡ç®—è¦é“¸é€ çš„ LP ä»£å¸

```solidity
uint256 liquidity;
if (totalSupply() == 0) {
    liquidity = sqrt(amountA * amountB);
} else {
    liquidity = min(
        amountA * totalSupply() / reserveA,
        amountB * totalSupply() / reserveB
    );
}

```

è¿™ä¸€éƒ¨åˆ†å†³å®šäº†**è¦ç»™ç”¨æˆ·å¤šå°‘ LP ä»£å¸**ã€‚

- å¦‚æœç”¨æˆ·æ˜¯**ç¬¬ä¸€ä¸ªæ·»åŠ æµåŠ¨æ€§çš„äºº**ï¼Œæ± å­ä¸­è¿˜æ²¡æœ‰ LP ä»£å¸ï¼š
    - é‚£ä¹ˆæˆ‘ä»¬ç»™Taä»¬ï¼š`sqrt(amountA * amountB)`
    - è¿™æ˜¯ Uniswapå¸¸ç”¨çš„æ ‡å‡†å…¬å¼ï¼Œç”¨äºå…¬å¹³åœ°è®¾å®šåˆå§‹ LP ä»£å¸æ•°é‡ã€‚
- å¦‚æœæ± å­å·²ç»æœ‰æµåŠ¨æ€§ï¼š
    - æˆ‘ä»¬æ ¹æ®**æ¯”ä¾‹è´¡çŒ®**æ¥è®¡ç®—ç”¨æˆ·åº”è·å¾—çš„ LP ä»£å¸æ•°é‡ã€‚
    - ç¡®ä¿ç”¨æˆ·æŒ‰**æ­£ç¡®æ¯”ä¾‹**æ·»åŠ æµåŠ¨æ€§ã€‚
    - ä½¿ç”¨ `min()` å‡½æ•°é¿å…å½“ç”¨æˆ·è¾“å…¥çš„ä»£å¸æ•°é‡ç¨æœ‰åå·®æ—¶é“¸é€ è¿‡å¤š LP ä»£å¸ã€‚

> è¿™ä¿è¯äº†æ¯ä¸ªäººåœ¨æ± å­ä¸­çš„ä»½é¢éƒ½æ˜¯å…¬å¹³çš„ã€‚
> 

---

### ğŸ–¨ï¸ é“¸é€  LP ä»£å¸

```solidity
_mint(msg.sender, liquidity);

```

ç°åœ¨æˆ‘ä»¬æŠŠ LP ä»£å¸å®é™…å‘ç»™ç”¨æˆ·ã€‚

å› ä¸ºæˆ‘ä»¬çš„åˆçº¦ç»§æ‰¿è‡ª `ERC20`ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ `_mint()` æ¥ç»™ç”¨æˆ·é“¸é€ æ–°ä»£å¸ã€‚

---

### ğŸ“Š æ›´æ–°å‚¨å¤‡é‡

```solidity
reserveA += amountA;
reserveB += amountB;

```

æ›´æ–°åˆçº¦å†…éƒ¨çŠ¶æ€ï¼Œåæ˜ æ–°åŠ å…¥çš„ä»£å¸æ•°é‡ã€‚

è¿™æ˜¯**éå¸¸é‡è¦çš„**ï¼Œå› ä¸ºå…‘æ¢çš„æ•°å­¦å…¬å¼ä¾èµ–äºå‚¨å¤‡é‡ä¿æŒå‡†ç¡®ã€‚

---

### ğŸ”” å‘å‡ºäº‹ä»¶

```solidity
emit LiquidityAdded(msg.sender, amountA, amountB, liquidity);

```

è®°å½•è¿™ä¸€æ“ä½œï¼Œå‰ç«¯å’Œ DAppå¯ä»¥æ˜¾ç¤ºç”¨æˆ·åˆšåˆšåšäº†ä»€ä¹ˆã€‚

åŒ…æ‹¬ä¿¡æ¯ï¼š

- è°æ·»åŠ äº†æµåŠ¨æ€§
- æ·»åŠ äº†å¤šå°‘ä»£å¸
- è·å¾—äº†å¤šå°‘ LP ä»£å¸

---

## ğŸ§¯ 8. ç§»é™¤æµåŠ¨æ€§ â€“ æå–ä½ çš„ä»½é¢

```solidity
function removeLiquidity(uint256 liquidityToRemove) external returns (uint256 amountAOut, uint256 amountBOut) {
    require(liquidityToRemove > 0, "Liquidity to remove must be > 0");
    require(balanceOf(msg.sender) >= liquidityToRemove, "Insufficient liquidity tokens");

    uint256 totalLiquidity = totalSupply();
    require(totalLiquidity > 0, "No liquidity in the pool");

    amountAOut = liquidityToRemove * reserveA / totalLiquidity;
    amountBOut = liquidityToRemove * reserveB / totalLiquidity;

    require(amountAOut > 0 && amountBOut > 0, "Insufficient reserves for requested liquidity");

    reserveA -= amountAOut;
    reserveB -= amountBOut;

    _burn(msg.sender, liquidityToRemove);

    tokenA.transfer(msg.sender, amountAOut);
    tokenB.transfer(msg.sender, amountBOut);

    emit LiquidityRemoved(msg.sender, amountAOut, amountBOut, liquidityToRemove);
    return (amountAOut, amountBOut);
}

```

---

### ğŸ§  æ€»ä½“æ€è·¯

è¿™ä¸ªå‡½æ•°å…è®¸ç”¨æˆ·**æå–è‡ªå·±ä¹‹å‰æ·»åŠ çš„ä»£å¸ä»½é¢**ã€‚

ç”¨æˆ·éœ€è¦å½’è¿˜ï¼ˆé”€æ¯ï¼‰Taä»¬çš„ **LP ä»£å¸**ï¼Œåˆçº¦ä¼šæŒ‰æ¯”ä¾‹è¿”å›ï¼š

- å¯¹åº”æ¯”ä¾‹çš„ Token A
- å¯¹åº”æ¯”ä¾‹çš„ Token B

æ‰€æœ‰è®¡ç®—éƒ½æ˜¯åŸºäºTaä»¬åœ¨æ€»æµåŠ¨æ€§æ± ä¸­çš„ä»½é¢ã€‚

ä¾‹å¦‚ï¼šå¦‚æœç”¨æˆ·æŒæœ‰ 10% çš„ LP ä»£å¸ï¼ŒTaä»¬å°†å¾—åˆ°æ± å­ä¸­æ¯ç§ä»£å¸çš„ 10%ã€‚

ä¸‹é¢é€è¡Œè§£æï¼š

---

### ğŸ§© é€è¡Œè§£æ

---

### âœ… è¾“å…¥æ£€æŸ¥

```solidity
require(liquidityToRemove > 0, "Liquidity to remove must be > 0");
require(balanceOf(msg.sender) >= liquidityToRemove, "Insufficient liquidity tokens");

```

- é¦–å…ˆç¡®ä¿ç”¨æˆ·æƒ³ç§»é™¤çš„ LP ä»£å¸æ•°é‡ä¸ºæ­£
- ç„¶åç¡®è®¤ç”¨æˆ·**æ‹¥æœ‰**è¶³å¤Ÿçš„ LP ä»£å¸
- `balanceOf(msg.sender)` ç”¨äºæ£€æŸ¥ç”¨æˆ·æŒæœ‰çš„ LP ä»£å¸æ•°é‡

è¿™æ ·å¯ä»¥ä¿æŠ¤åˆçº¦å…å—æ— æ•ˆæˆ–æ¶æ„è¾“å…¥çš„å½±å“ã€‚

---

### ğŸ“Š è·å– LP ä»£å¸æ€»é‡

```solidity
uint256 totalLiquidity = totalSupply();
require(totalLiquidity > 0, "No liquidity in the pool");

```

- è·å– LP ä»£å¸ **æ€»ä¾›åº”é‡**ï¼Œè¿™ä»£è¡¨æ± å­ 100% çš„æ‰€æœ‰æƒ
- å¦‚æœæ€»ä¾›åº”é‡ä¸ºé›¶ï¼Œé˜»æ­¢äº¤æ˜“ â€”â€” å› ä¸ºæ²¡æœ‰æµåŠ¨æ€§å¯æå–

---

### ğŸ§® è®¡ç®—è¦è¿”å›çš„ä»£å¸æ•°é‡

```solidity
amountAOut = liquidityToRemove * reserveA / totalLiquidity;
amountBOut = liquidityToRemove * reserveB / totalLiquidity;

```

è¿™é‡Œæ˜¯é­”æ³•å‘ç”Ÿä¹‹å¤„ã€‚

ä½¿ç”¨ç®€å•çš„æ¯”ä¾‹è®¡ç®—ç”¨æˆ·åº”è·å¾—å¤šå°‘ä»£å¸ï¼š

> ç”¨æˆ·çš„ LP ä»½é¢ Ã— ä»£å¸æ€»å‚¨å¤‡ = æå–æ•°é‡
> 

ä¾‹å¦‚ï¼šå¦‚æœç”¨æˆ·æŒæœ‰ 25% çš„ LP ä»£å¸ï¼ŒTaä»¬å°†è·å¾—æ± ä¸­ 25% çš„ Token A å’Œ Token Bã€‚

---

### â›” æœ€ç»ˆåˆç†æ€§æ£€æŸ¥

```solidity
require(amountAOut > 0 && amountBOut > 0, "Insufficient reserves for requested liquidity");

```

é˜²æ­¢è®¡ç®—å› å››èˆäº”å…¥å‡ºç°ç°å°˜å€¼ï¼Œå¦‚æœä»»ä½•è¾“å‡ºä¸º 0ï¼Œåˆ™æ‹’ç»äº¤æ˜“ â€”â€” é¿å…å‡ºé”™æˆ–æµªè´¹ææ¬¾ã€‚

---

### ğŸ§¾ æ›´æ–°å†…éƒ¨å‚¨å¤‡é‡

```solidity
reserveA -= amountAOut;
reserveB -= amountBOut;

```

ä»å†…éƒ¨å‚¨å¤‡ä¸­æ‰£é™¤æå–çš„ä»£å¸æ•°é‡ã€‚

è¿™æ ·ä½¿å…‘æ¢æ•°å­¦å…¬å¼ä¿æŒæ­£ç¡®ï¼Œå› ä¸ºæ¯ç¬”äº¤æ˜“éƒ½ä¾èµ–å‚¨å¤‡é‡çš„å‡†ç¡®æ€§ã€‚

---

### ğŸ”¥ é”€æ¯ LP ä»£å¸

```solidity
_burn(msg.sender, liquidityToRemove);

```

ç”±äºç”¨æˆ·å½’è¿˜ LP ä»£å¸ä»¥æ¢å–å®é™…ä»£å¸ï¼Œæˆ‘ä»¬ä¼š**é”€æ¯**è¿™äº› LP ä»£å¸ â€”â€” å®é™…ä¸Šæ˜¯åˆ é™¤å®ƒä»¬çš„å­˜åœ¨ã€‚

---

### ğŸ’¸ å°†ä»£å¸è½¬å›ç»™ç”¨æˆ·

```solidity
tokenA.transfer(msg.sender, amountAOut);
tokenB.transfer(msg.sender, amountBOut);

```

è¿™äº›æ“ä½œå°†ä»£å¸å®é™…å‘é€ç»™ç”¨æˆ·ï¼š

- ç”¨æˆ·è·å¾—`amountAOut` ä¸ªä»£å¸A
- ç”¨æˆ·è·å¾—`amountBOut` ä¸ª ä»£å¸B

æ‰€æœ‰è¿™äº›æ“ä½œç”±åˆçº¦è‡ªåŠ¨å¤„ç†ã€‚

---

### ğŸ”” å‘å‡ºäº‹ä»¶

```solidity
emit LiquidityRemoved(msg.sender, amountAOut, amountBOut, liquidityToRemove);

```

è®°å½•æ“ä½œåˆ°åŒºå—é“¾ä¸Šï¼Œæ–¹ä¾¿ DAppã€æµè§ˆå™¨æˆ–ç´¢å¼•å™¨ç›‘å¬æ•è·ã€‚

åŒ…æ‹¬ä¿¡æ¯ï¼š

- è°æå–äº†æµåŠ¨æ€§
- æå–äº†å¤šå°‘ä»£å¸
- é”€æ¯äº†å¤šå°‘ LP ä»£å¸

---

### ğŸ“¤ è¿”å›è¾“å‡º

```solidity
return (amountAOut, amountBOut);

```

è¿”å›ä»£å¸æ•°é‡ï¼Œæ–¹ä¾¿è°ƒç”¨è€…ï¼ˆå¯èƒ½æ˜¯åˆçº¦æˆ–å‰ç«¯ï¼‰æ˜¾ç¤ºç»“æœã€‚

---

## ğŸ”„ 9. ç”¨ A äº¤æ¢ B

```solidity
function swapAforB(uint256 amountAIn, uint256 minBOut) external {
    require(amountAIn > 0, "Amount must be > 0");
    require(reserveA > 0 && reserveB > 0, "Insufficient reserves");

    uint256 amountAInWithFee = amountAIn * 997 / 1000;
    uint256 amountBOut = reserveB * amountAInWithFee / (reserveA + amountAInWithFee);

    require(amountBOut >= minBOut, "Slippage too high");

    tokenA.transferFrom(msg.sender, address(this), amountAIn);
    tokenB.transfer(msg.sender, amountBOut);

    reserveA += amountAInWithFee;
    reserveB -= amountBOut;

    emit TokensSwapped(msg.sender, address(tokenA), amountAIn, address(tokenB), amountBOut);
}

```

å‡è®¾ä½ åœ¨ DEX ä¸Šæƒ³ç”¨ ä»£å¸**A** æ¢ ä»£å¸**B** â€”â€” å°±åƒç”¨ ETH æ¢ DAIã€‚

åœ¨ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼Œä¼šæœ‰åŒ¹é…å¼•æ“å¸®ä½ é…å¯¹å”®å– DAI çš„ç”¨æˆ·ã€‚

è€Œåœ¨è¿™é‡Œæ²¡æœ‰å–å®¶ï¼Œå‡­å€Ÿç€æ•°å­¦å…¬å¼è®¡ç®—ï¼Œä½ ç›´æ¥å’Œ**æ™ºèƒ½åˆçº¦**äº¤æ˜“ã€‚

æ­¤å‡½æ•°å…è®¸ç”¨æˆ·ï¼š

- å‘é€ä¸€äº› `Token A` ç»™åˆçº¦
- è‡ªåŠ¨è·å¾—å¯¹åº”æ•°é‡çš„ `Token B`
- åˆçº¦æ›´æ–°å†…éƒ¨å‚¨å¤‡é‡ä»¥åæ˜ äº¤æ¢

ä½†å¦‚ä½•è®¡ç®—å‡ºæ­£ç¡®ä»·æ ¼å‘¢ï¼Ÿ

---

### âš™ï¸ æ ¸å¿ƒæ€æƒ³ï¼šæ’å®šä¹˜ç§¯å…¬å¼

> x * y = k
> 

è¿™æ˜¯æ¯ä¸ª Uniswap v2 é£æ ¼çš„AMM çš„å…¬å¼ã€‚

- `x`ï¼šåˆçº¦ä¸­ Token A çš„æ•°é‡
- `y`ï¼šåˆçº¦ä¸­ Token B çš„æ•°é‡
- `k`ï¼šå¸¸æ•° â€”â€” ä¸¤è€…çš„ä¹˜ç§¯

å½“æœ‰äººå‘æ± å­æ·»åŠ  Token Aï¼Œæ± å­å¿…é¡»è¿”è¿˜**æ°å¥½æ•°é‡çš„ Token B**ï¼Œä¿æŒ `x * y` æ’å®šï¼ˆè€ƒè™‘åˆ°æ»‘ç‚¹å’Œæ‰‹ç»­è´¹ç°è±¡ï¼Œä¹Ÿå¯ä»¥éå¸¸æ¥è¿‘æ’å®šï¼‰ã€‚

è¿™æ„å‘³ç€ï¼š**ä½ å°è¯•äº¤æ¢çš„æ¬¡æ•°è¶Šå¤šï¼Œä½ çš„å…‘æ¢ç‡è¶Šå·®** â€”â€” å› ä¸ºä½ æ¨åŠ¨äº†ä»·æ ¼æ›²çº¿ã€‚

è¿™ç§è®¾è®¡ä¿æŒæ± å­å¹³è¡¡ï¼Œé˜²æ­¢äººä¸ºæ“çºµï¼Œå¹¶æ ¹æ®ä¾›éœ€è‡ªåŠ¨è°ƒæ•´ä»·æ ¼ã€‚

---

### ğŸ§© é€è¡Œè§£æ

---

### âœ… ç¬¬ 1 æ­¥ï¼šåˆç†æ€§æ£€æŸ¥

```solidity
require(amountAIn > 0, "Amount must be > 0");
require(reserveA > 0 && reserveB > 0, "Insufficient reserves");

```

- ç¡®ä¿ç”¨æˆ·è¾“å…¥æ•°é‡å¤§äº 0
- ç¡®ä¿æ± å­æœ‰è¶³å¤ŸæµåŠ¨æ€§ï¼Œä¸¤ç§ä»£å¸éƒ½å¿…é¡»æœ‰å­˜é‡

è‹¥ä¸æ»¡è¶³å…¶ä¸€ï¼Œåˆ™æå‰åœæ­¢äº¤æ˜“å¹¶**èŠ‚çœ gas**ã€‚

---

### ğŸ§® ç¬¬ 2 æ­¥ï¼šæ”¶å– 0.3% æ‰‹ç»­è´¹

```solidity
uint256 amountAInWithFee = amountAIn * 997 / 1000;

```

ä»è¾“å…¥ä»£å¸ä¸­æ‰£é™¤ **0.3% æ‰‹ç»­è´¹ã€‚**

- æ¯”å¦‚è¾“å…¥ 100 Token Aï¼Œåªç”¨ 99.7 å‚ä¸äº¤æ¢
- å‰©ä½™çš„ 0.3 ä¿ç•™åœ¨æ± å­é‡Œï¼Œå¥–åŠ±æµåŠ¨æ€§æä¾›è€…

è¿™ä¸ªå°é¢æ‰‹ç»­è´¹å¯ä»¥é˜²æ­¢æ»¥ç”¨ï¼ˆå¦‚æ‰æœŸåˆçº¦ï¼‰ï¼Œå¹¶è®©æ± å­éšæ—¶é—´å¢é•¿ï¼Œè¿™æœ‰åˆ©äº LPã€‚

---

### ğŸ”¢ ç¬¬ 3 æ­¥ï¼šè®¡ç®—è·å¾—å¤šå°‘ Token B

```solidity
uint256 amountBOut = reserveB * amountAInWithFee / (reserveA + amountAInWithFee);

```

- è®¡ç®—ç”¨æˆ·æŠ•å…¥**ä»£å¸A**åº”è·å¾—çš„**ä»£å¸B**æ•°é‡
- `reserveA`ï¼šäº¤æ¢å‰æ± ä¸­ Token A æ•°é‡
- `amountAInWithFee`ï¼šæ‰£é™¤æ‰‹ç»­è´¹åçš„æ–°å¢ Token Aæ•°é‡
- ä»£ç ä¸­çš„å…¬å¼ç¡®ä¿**äº¤æ˜“å** `x * y = k` å¤§è‡´ä¿æŒä¸å˜

ä½ æŠ•å…¥è¶Šå¤šï¼Œ**ä½ æ¯å•ä½è·å¾—è¶Šå°‘**ï¼Œå› ä¸ºè¿™æ¨åŠ¨äº†ä»·æ ¼æ›²çº¿ï¼Œè¿™å°±æ˜¯**ä»·æ ¼æ»‘ç‚¹**ã€‚

æ‰€ä»¥è¿™å¾ˆå…¬å¹³ã€‚å®ƒæ˜¯è‡ªåŠ¨çš„ï¼Œæ— éœ€äººå·¥å®šä»·ã€‚

---

### ğŸ›¡ï¸ ç¬¬ 4 æ­¥ï¼šæ»‘ç‚¹ä¿æŠ¤

```solidity
require(amountBOut >= minBOut, "Slippage too high");

```

å†ç»§ç»­æ·±å…¥ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ£€æŸ¥**å®é™…è¾“å‡º**æ˜¯å¦ç¬¦åˆç”¨æˆ·æœŸæœ›ã€‚

- `minBOut` æ˜¯ç”¨æˆ·è®¾ç½®çš„æœ€å°å¯æ¥å— Token B æ•°é‡ï¼ŒTaä»¬æƒ³è¡¨è¾¾çš„æ˜¯ï¼š

> â€œåªæœ‰å½“æˆ‘è‡³å°‘è·å¾—xä¸ªä»£å¸Bæ—¶ï¼Œæˆ‘æ‰ä¼šè¿›è¡Œäº¤æ¢ã€‚â€
> 

è‹¥è®¡ç®—ç»“æœä½äºxå€¼ï¼Œåˆ™äº¤æ˜“å›æ»šï¼Œé˜²æ­¢**æ„å¤–ä»·æ ¼æ³¢åŠ¨çš„å½±å“**

---

### ğŸ”„ ç¬¬ 5 æ­¥ï¼šè½¬è´¦ä»£å¸

```solidity
tokenA.transferFrom(msg.sender, address(this), amountAIn);
tokenB.transfer(msg.sender, amountBOut);

```

- åˆçº¦ä»ç”¨æˆ·é’±åŒ…**æ”¶å–**Token Aã€‚ï¼ˆå‰ææ˜¯ç”¨æˆ·`approve()` æ‰¹å‡†äº†åˆçº¦è¿™æ ·åšï¼‰
- ç„¶ååˆçº¦å‘é€å¯¹åº”æ•°é‡çš„ Token B ç»™ç”¨æˆ·ã€‚

æ— éœ€è®¢å•ç°¿ï¼Œæ— éœ€äº¤æ˜“å¯¹æ‰‹ï¼Œåªé æ•°å­¦è®¡ç®—ã€‚

---

### ğŸ“Š ç¬¬ 6 æ­¥ï¼šæ›´æ–°å‚¨å¤‡é‡

```solidity
reserveA += amountAInWithFee;
reserveB -= amountBOut;

```

æ›´æ–°åˆçº¦æŒæœ‰ä»£å¸æ•°é‡çš„è®°å½•ï¼Œè®°å½•æ¯ç§ä»£å¸è¿˜æœ‰å¤šå°‘ã€‚

> ä¸ºä»€ä¹ˆåªåŠ  amountAInWithFee åˆ° reserveAï¼Ÿ
> 
> 
> å› ä¸ºæ‰‹ç»­è´¹éƒ¨åˆ†ä¸å‚ä¸ä¸‹ä¸€ç¬”äº¤æ˜“çš„é€»è¾‘ â€”â€” å®ƒç•™ä½œå¥–åŠ±ã€‚
> 

---

### ğŸ”” ç¬¬ 7 æ­¥ï¼šå‘å‡ºäº‹ä»¶

```solidity
emit TokensSwapped(msg.sender, address(tokenA), amountAIn, address(tokenB), amountBOut);

```

è®°å½•äº¤æ˜“ä¿¡æ¯ï¼Œè®© DApp æˆ–å‰ç«¯æ˜¾ç¤ºç»™ç”¨æˆ·ï¼š

- è°è¿›è¡Œäº†äº¤æ¢
- æ¶‰åŠå“ªäº›ä»£å¸
- äº¤æ¢æ•°é‡

---

## ğŸ” 10. ç”¨ B äº¤æ¢ A â€”â€” åå‘äº¤æ˜“

```solidity
function swapBforA(uint256 amountBIn, uint256 minAOut) external {
    require(amountBIn > 0, "Amount must be > 0");
    require(reserveA > 0 && reserveB > 0, "Insufficient reserves");

    uint256 amountBInWithFee = amountBIn * 997 / 1000;
    uint256 amountAOut = reserveA * amountBInWithFee / (reserveB + amountBInWithFee);

    require(amountAOut >= minAOut, "Slippage too high");

    tokenB.transferFrom(msg.sender, address(this), amountBIn);
    tokenA.transfer(msg.sender, amountAOut);

    reserveB += amountBInWithFee;
    reserveA -= amountAOut;

    emit TokensSwapped(msg.sender, address(tokenB), amountBIn, address(tokenA), amountAOut);
}

```

---

### ğŸ§  ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

è¿™ä¸ªå‡½æ•°æ˜¯ `swapAforB()` çš„ **é•œåƒç‰ˆæœ¬**ã€‚

å®ƒå…è®¸ç”¨æˆ·å°† **Token B** äº¤æ¢è¿›æ± å­ï¼Œå¹¶è·å¾— **Token A** â€” éµå¾ª**ç›¸åŒçš„å®šä»·é€»è¾‘**ã€åŒæ ·çš„**å¸¸æ•°ä¹˜ç§¯å…¬å¼** å’Œ **0.3% æ‰‹ç»­è´¹**ã€‚

ä¸€åˆ‡éƒ½åªæ˜¯â€œç¿»è½¬â€è€Œå·²ã€‚

å¦‚æœä½ æŠŠ `Token A` çœ‹ä½œ ETHï¼ŒæŠŠ `Token B` çœ‹ä½œ DAIï¼Œè¿™å°±æ˜¯ä¸€ä¸ªç”¨ DAI **è´­ä¹° ETH** çš„è·¯å¾„ã€‚

---

### ğŸ§© é€è¡Œè§£æ

---

### âœ… æ­¥éª¤ 1ï¼šè¾“å…¥æ£€æŸ¥

```solidity
require(amountBIn > 0, "Amount must be > 0");
require(reserveA > 0 && reserveB > 0, "Insufficient reserves");

```

å’Œä¹‹å‰ä¸€æ ·ï¼š

- ç¡®ä¿è¾“å…¥ä¸ä¸ºé›¶ã€‚
- ç¡®ä¿æ± å­ä¸­ä¸¤ç§ä»£å¸éƒ½æœ‰è¶³å¤Ÿçš„æµåŠ¨æ€§ä»¥å®Œæˆäº¤æ¢ã€‚

---

### ğŸ’¸ æ­¥éª¤ 2ï¼šåº”ç”¨ 0.3% æ‰‹ç»­è´¹

```solidity
uint256 amountBInWithFee = amountBIn * 997 / 1000;

```

åŒæ ·åœ°ï¼Œæˆ‘ä»¬åœ¨è®¡ç®—è¾“å‡ºä¹‹å‰ï¼Œä»è¾“å…¥ä¸­å‡å» **0.3% çš„æ‰‹ç»­è´¹**ã€‚

è¿™ä¿è¯äº†äº¤æ˜“å…¬å¹³ï¼Œå¹¶éšç€æ—¶é—´æ¨ç§»**ä¸ºæµåŠ¨æ€§æä¾›è€…äº§ç”Ÿå¥–åŠ±**ã€‚

---

### ğŸ“ æ­¥éª¤ 3ï¼šå¸¸æ•°ä¹˜ç§¯è®¡ç®—ï¼ˆB âœ Aï¼‰

```solidity
uint256 amountAOut = reserveA * amountBInWithFee / (reserveB + amountBInWithFee);

```

ä½¿ç”¨ç›¸åŒçš„å¸¸æ•°ä¹˜ç§¯å…¬å¼ï¼š

> x * y = k å¿…é¡»ä¿æŒï¼ˆå¤§è‡´ï¼‰ä¸å˜ã€‚
> 

ä½†ç°åœ¨ï¼š

- `reserveB` æ˜¯å½“å‰çš„ Token B æ•°é‡
- `amountBInWithFee` æ˜¯æˆ‘ä»¬åŠ å…¥çš„é‡
- `reserveA` ç”¨äºè®¡ç®—éœ€è¦å‘æ”¾å¤šå°‘ Token A

è¿™ä¸ªè®¡ç®—**è‡ªåŠ¨æ ¹æ®æ± å­ä½™é¢è°ƒæ•´æ±‡ç‡**ã€‚äº¤æ˜“é‡è¶Šå¤§ï¼Œä»·æ ¼å˜åŒ–è¶Šæ˜æ˜¾ â€” è¿™å«åš**ä»·æ ¼å½±å“ï¼ˆprice impactï¼‰** æˆ– **æ»‘ç‚¹ï¼ˆslippageï¼‰**ã€‚

---

### ğŸ›¡ï¸ æ­¥éª¤ 4ï¼šæ»‘ç‚¹æ£€æŸ¥

```solidity
require(amountAOut >= minAOut, "Slippage too high");

```

è¿™ä¸€è¡Œä»£ç **ä¿æŠ¤ç”¨æˆ·**ã€‚

ç”¨æˆ·æŒ‡å®šäº† `minAOut` â€” Taä»¬æœŸæœ›æ”¶åˆ°çš„æœ€å°‘ Token A æ•°é‡ã€‚

å¦‚æœæ± å­çŠ¶æ€å˜åŒ–å¤ªå¤§ï¼Œå¯¼è‡´å®é™…è¾“å‡ºä½äºé¢„æœŸï¼Œäº¤æ˜“ä¼šè¢«å–æ¶ˆã€‚

é¿å…æ„å¤–æ”¯ä»˜å’ŒæŸå¤±ã€‚

---

### ğŸ” æ­¥éª¤ 5ï¼šæ‰§è¡Œäº¤æ¢

```solidity
tokenB.transferFrom(msg.sender, address(this), amountBIn);
tokenA.transfer(msg.sender, amountAOut);

```

- åˆçº¦**æ”¶å–**ç”¨æˆ·çš„ Token Bã€‚
- ç„¶å**å‘é€**è®¡ç®—å¥½çš„ Token A ç»™ç”¨æˆ·ã€‚

äº¤æ¢å®Œæˆ â€” å®Œå…¨æ— éœ€è®¸å¯ã€‚

---

### ğŸ“Š æ­¥éª¤ 6ï¼šæ›´æ–°å‚¨å¤‡

```solidity
reserveB += amountBInWithFee;
reserveA -= amountAOut;

```

æ›´æ–°æˆ‘ä»¬å¯¹æ± å­å†…ä»£å¸æ•°é‡çš„å†…éƒ¨è®°å½•ã€‚

æ³¨æ„ï¼š

- åªæœ‰ **æ‰£é™¤æ‰‹ç»­è´¹åçš„é‡‘é¢** è®¡å…¥å‚¨å¤‡é‡ï¼ˆä»£å¸Bï¼‰ã€‚
- ç”¨æˆ·æ”¶åˆ°çš„ç¡®åˆ‡é‡‘é¢ä»è¦æ¢å–çš„ä»£å¸å‚¨å¤‡é‡ï¼ˆä»£å¸Aï¼‰ä¸­å‡å»ã€‚

è¿™å¾ˆé‡è¦ â€” æœªæ¥çš„äº¤æ˜“éƒ½ä¾èµ–è¿™äº›å‚¨å¤‡æ•°é‡ **100% å‡†ç¡®**ã€‚

---

### ğŸ”” æ­¥éª¤ 7ï¼šè§¦å‘äº‹ä»¶

```solidity
emit TokensSwapped(msg.sender, address(tokenB), amountBIn, address(tokenA), amountAOut);

```

è®°å½•å®Œæ•´çš„äº¤æ˜“äº‹ä»¶ï¼š

- è°äº¤æ˜“äº†
- å“ªäº›ä»£å¸å‚ä¸
- è¾“å…¥è¾“å‡ºæ•°é‡

å‰ç«¯å¯ä»¥ä½¿ç”¨è¿™äº›ä¿¡æ¯å³æ—¶æ˜¾ç¤ºç»™ç”¨æˆ·ï¼Œä¾‹å¦‚ï¼š

> â€œä½ ç”¨ 50 DAI æ¢å–äº† 0.027 ETHã€‚â€
> 

---

### ğŸ§  è¿™äº›æ“ä½œä¸ºä»€ä¹ˆé‡è¦

`swapAforB()` å’Œ `swapBforA()` æ­é…ï¼Œä½¿ AMM æˆä¸º **åŠŸèƒ½å®Œæ•´çš„å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€**ã€‚

- æ— éœ€åŒ¹é…å¼•æ“
- æ— éœ€å¸‚åœºåšå¸‚å•†
- æ— éœ€å®ˆé—¨äºº

åªæ˜¯ä¾é å­˜ç²¹å’Œå¼€æ”¾çš„æ•°å­¦ã€‚

---

## ğŸ§ 11. æŸ¥çœ‹å‚¨å¤‡ â€“ å…¬å¼€æ± å­çŠ¶æ€

```solidity
function getReserves() external view returns (uint256, uint256) {
    return (reserveA, reserveB);
}

```

---

### ğŸ§  è¿™ä¸ªå‡½æ•°çš„æ„ä¹‰

å®ƒç”¨äº**å…¬å¼€æ± å­çš„å½“å‰çŠ¶æ€** â€” å…·ä½“æ¥è¯´ï¼Œåˆçº¦å½“å‰æŒæœ‰å¤šå°‘ **Token A** å’Œ **Token B**ï¼ˆå³æµåŠ¨æ€§å‚¨å¤‡ï¼‰ã€‚

- ä¸ä¼šä¿®æ”¹ä»»ä½•æ•°æ®
- å¤–éƒ¨è°ƒç”¨ä¸æ¶ˆè€— gas
- ä»…è¿”å›**ä¸¤ä¸ªæ•°å€¼**ï¼šæ¯ä¸ªä»£å¸çš„å½“å‰å‚¨å¤‡

è¿™äº›æ•°å­—å¯¹äºï¼š

- å‰ç«¯åº”ç”¨ï¼ˆå¦‚ DEX UIï¼‰
- é’±åŒ…é›†æˆ
- æ•°æ®åˆ†æä»ªè¡¨æ¿
- ä»»ä½•æƒ³æ˜¾ç¤ºä»·æ ¼æˆ–æµåŠ¨æ€§ä¿¡æ¯çš„äºº

éƒ½**éå¸¸é‡è¦**ã€‚

---

### ğŸ” é€è¡Œè§£æ

### å£°æ˜ï¼š

```solidity
function getReserves() external view returns (uint256, uint256)

```

- `external`ï¼šå‡½æ•°**ä¾›åˆçº¦å¤–éƒ¨è°ƒç”¨**ï¼Œå¦‚å‰ç«¯
- `view`ï¼šå‘Šè¯‰ Solidity**æˆ‘ä»¬ä¸ä¿®æ”¹ä»»ä½•çŠ¶æ€**ï¼Œä»…è¯»å–
- `returns (uint256, uint256)`ï¼šè¿”å›ä¸¤ä¸ªå€¼ â€” åˆ†åˆ«å¯¹åº” Token A å’Œ Token B

---

### è¿”å›è¯­å¥ï¼š

```solidity
return (reserveA, reserveB);

```

- `reserveA` æ˜¯æ± å­å†… Token A çš„æ•°é‡
- `reserveB` æ˜¯æ± å­å†… Token B çš„æ•°é‡

ç®€å•ã€æ¸…æ™°ã€ä¸€ç›®äº†ç„¶ã€‚

---

### ğŸ–¥ï¸ å‰ç«¯ä¸ºä½•å–œæ¬¢è¿™ä¸ªå‡½æ•°

æƒ³è±¡ä½ åœ¨ DEX ç½‘ç«™ä¸Šå‡†å¤‡äº¤æ˜“ã€‚

å‰ç«¯éœ€è¦æ˜¾ç¤ºï¼š

- å¯ç”¨æµåŠ¨æ€§
- å½“å‰ä»·æ ¼æ¯”ç‡
- ä½ çš„äº¤æ˜“é‡ç›¸å¯¹äºæ± å­çš„æ¯”ä¾‹ï¼ˆç”¨ä»¥ä¼°ç®—æ»‘ç‚¹ï¼‰

è¦åšåˆ°è¿™äº›ï¼Œå‰ç«¯å¿…é¡»è¯»å–**å½“å‰å‚¨å¤‡** â€” è¿™ä¸ªå‡½æ•°è®©æ“ä½œå˜å¾—ç®€å•ã€‚

æ²¡æœ‰å®ƒï¼Œå‰ç«¯éœ€è¦æ‰‹åŠ¨è¿½è¸ªæ¯ä¸ªäº‹ä»¶å¹¶å°è¯•æ¨æµ‹çŠ¶æ€ â€” å®¹æ˜“å‡ºé”™ä¸”æ•ˆç‡ä½ã€‚

---

è¿™å°±æ˜¯å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€çš„æ ¸å¿ƒé€»è¾‘ã€‚

ä½ ç°åœ¨ç†è§£äº†ï¼š

- äº¤æ˜“å¦‚ä½•è®¡ç®—
- æµåŠ¨æ€§å¦‚ä½•è¿ä½œ
- LP ä»£å¸å¦‚ä½•ä»£è¡¨æ‰€æœ‰æƒ

æ¥ä¸‹æ¥ï¼šæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œæ·»åŠ ä»£å¸ï¼Œå¹¶è¿›è¡Œç¬¬ä¸€æ¬¡äº¤æ˜“ã€‚

---

## ğŸ§ª åœ¨ Remix ä¸Šæµ‹è¯•ä½ çš„ AMM åˆçº¦

ä½ å·²ç»æ„å»ºäº†ä¸€ä¸ªå¼ºå¤§çš„ AMM åˆçº¦ â€” ç°åœ¨æ¥çœ‹çœ‹å®ƒçš„è¿è¡Œæ•ˆæœã€‚

è¦æ­£ç¡®æµ‹è¯•ï¼Œä½ éœ€è¦ï¼š

1. ä¸¤ä¸ªåŸºç¡€ ERC-20 ä»£å¸åˆçº¦ï¼ˆToken A å’Œ Token Bï¼‰
2. ä½ çš„ `AutomatedMarketMaker` åˆçº¦
3. ä¸€äº›ç®€å•çš„æ‰¹å‡†å’Œäº¤æ˜“æ“ä½œ

---

### ğŸ§± æ­¥éª¤ 1ï¼šåˆ›å»ºä¸¤ä¸ª ERC-20 ä»£å¸

åœ¨ [Remix](https://remix.ethereum.org/) åˆ›å»ºä¸€ä¸ªåä¸ºï¼š

**`TokenA.sol`** çš„æ–°æ–‡ä»¶ï¼Œåœ¨é‡Œé¢ç²˜è´´è¿™ä¸ªç®€å• ERC-20 åˆçº¦ï¼š

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/token/ERC20/ERC20.sol";

contract TokenA is ERC20 {
    constructor() ERC20("Token A", "TKA") {
        _mint(msg.sender, 1000000 * 10 ** decimals()); // é“¸é€  100 ä¸‡ä»£å¸ç»™ä½ 
    }
}

```

ç„¶ååˆ›å»ºç¬¬äºŒä¸ªæ–‡ä»¶ï¼š

**`TokenB.sol`**

ç²˜è´´ï¼š

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/token/ERC20/ERC20.sol";

contract TokenB is ERC20 {
    constructor() ERC20("Token B", "TKB") {
        _mint(msg.sender, 1000000 * 10 ** decimals());
    }
}

```

âœ… **ä½¿ç”¨ Solidity ç¼–è¯‘å™¨ç¼–è¯‘ä¸¤ä¸ªåˆçº¦**ã€‚

---

### ğŸ§  æ­¥éª¤ 2ï¼šéƒ¨ç½²ä¸¤ä¸ªä»£å¸

åˆ‡æ¢åˆ° **Deploy & Run** æ ‡ç­¾é¡µï¼š

- ç¯å¢ƒï¼š`Remix VM (London)`
- éƒ¨ç½² `TokenA`
- éƒ¨ç½² `TokenB`

ç°åœ¨ä½ æœ‰ä¸¤ä¸ªä»£å¸ï¼Œæ¯ä¸ªä»£å¸ä¾›åº”é‡ä¸º 100 ä¸‡ã€‚

---

### ğŸ’§ æ­¥éª¤ 3ï¼šéƒ¨ç½²ä½ çš„ AMM åˆçº¦

æ–°å»ºæ–‡ä»¶ **`AutomatedMarketMaker.sol`**ï¼Œ

ç²˜è´´ä½ å®Œæ•´çš„ AMM åˆçº¦ã€‚

ç„¶ååœ¨ Deploy é€‰é¡¹å¡è¾“å…¥ï¼š

- `_tokenA`ï¼šå¡«å…¥éƒ¨ç½²çš„ `TokenA` åœ°å€
- `_tokenB`ï¼šå¡«å…¥éƒ¨ç½²çš„ `TokenB` åœ°å€
- `_name`ï¼šä¾‹å¦‚ `"Liquidity Pool Token"`
- `_symbol`ï¼šä¾‹å¦‚ `"LPT"`

ğŸ‘‰ ç‚¹å‡» **Deploy** â€” AMM åˆçº¦å·²ä¸Šçº¿ã€‚

---

### âœ… æ­¥éª¤ 4ï¼šæ‰¹å‡†ä»£å¸è½¬ç§»

åœ¨ AMM æŒªåŠ¨ä½ çš„ä»£å¸å‰ï¼Œä½ å¿…é¡»æˆäºˆ**æƒé™**ã€‚

ERC-20 ä»£å¸ä¸ä¼šå…è®¸ä»»ä½•äººéšæ„è½¬ç§»ä½ çš„ä»£å¸ â€” ä½ å¿…é¡»è°ƒç”¨ `approve()` æˆæƒ AMMã€‚

### å¯¹äºToken Aï¼š

1. å¤åˆ¶ AMM åˆçº¦åœ°å€
2. æ‰“å¼€å·²éƒ¨ç½²çš„ `TokenA` åˆçº¦
3. è°ƒç”¨ `approve(address spender, uint amount)`
    - `spender`ï¼šç²˜è´´ AMM åˆçº¦åœ°å€
    - `amount`ï¼šå¤§ä¸€ç‚¹ï¼Œä¾‹å¦‚ `1000000000000000000000`ï¼ˆ1000 ä»£å¸ï¼Œ18 ä½å°æ•°ï¼‰

### å¯¹äºToken Bï¼š

å¯¹ `TokenB` åˆçº¦åšä¸ä¸Šé¢åŒæ ·çš„æ“ä½œã€‚

âœ… ç°åœ¨ AMM åˆçº¦è¢«æˆæƒä»£è¡¨ä½ æŒªåŠ¨ä½ çš„ä»£å¸äº†ã€‚

---

### ğŸ’§ æ­¥éª¤ 5ï¼šæ·»åŠ æµåŠ¨æ€§

ç°åœ¨å°†ä»£å¸æ·»åŠ è¿›æ± ä¸­ã€‚

1. æ‰“å¼€å·²éƒ¨ç½²çš„ AMM åˆçº¦
2. è°ƒç”¨ `addLiquidity(uint256 amountA, uint256 amountB)`
    - ä»£å¸ä½¿ç”¨ 18 ä½å°æ•°ï¼š
        - 100 ä»£å¸ = `100000000000000000000`ï¼ˆåœ¨åŸæ¥åŸºç¡€ä¸Šæ·»åŠ 18ä¸ª0ï¼‰
    - ä¸ºä¸¤ç§ä»£å¸è¯•è¯• `100 * 10^18` è¿™ç§è¡¨ç¤ºå½¢å¼

å®Œæˆåï¼š

- ä½ æ­£å¼æ·»åŠ äº†æµåŠ¨æ€§
- LP ä»£å¸ä¼šé“¸é€ åˆ°ä½ çš„åœ°å€
- ä¼šè§¦å‘ä¸€ä¸ªäº‹ä»¶

---

### ğŸ” æ­¥éª¤ 6ï¼šå°è¯•ä»£å¸äº¤æ¢

å‡è®¾ä½ æƒ³ç”¨ 10 Token A æ¢ Token Bï¼š

1. å†æ¬¡æ‰¹å‡† AMM ä½¿ç”¨ 10 Token Aï¼ˆå¦‚æœä¹‹å‰æ²¡æ‰¹å‡†ï¼‰
2. è°ƒç”¨ `swapAforB(uint256 amountAIn, uint256 minBOut)`
    - `amountAIn`ï¼š`10000000000000000000`ï¼ˆ10 ä»£å¸Aï¼‰
    - `minBOut`ï¼šå…ˆå¡«ç±»ä¼¼ `1` çš„é€‰æ‹©ï¼Œé¿å…äº¤æ˜“å¤±è´¥

è°ƒç”¨åï¼š

- ä½ ä¼šæ”¶åˆ° Token B
- AMM å†…éƒ¨å‚¨å¤‡æ›´æ–°

---

### ğŸ” åå‘äº¤æ¢ï¼šToken B â†’ Token A

åŒç†ï¼Œæ“ä½œåå‘ï¼š

1. æ‰¹å‡† AMM ä½¿ç”¨ä¸€å®šæ•°é‡çš„ Token B
2. è°ƒç”¨ `swapBforA(amountBIn, minAOut)`

âœ… æˆåŠŸ â€” ä½ ç”¨è‡ªå·±å†™çš„ AMM å®Œæˆäº†äº¤æ˜“ã€‚

---

### ğŸ”™ æ­¥éª¤ 7ï¼šç§»é™¤æµåŠ¨æ€§

1. ä½¿ç”¨ `balanceOf(ä½ çš„åœ°å€)` æŸ¥çœ‹ LP ä»£å¸ä½™é¢
2. è°ƒç”¨ `removeLiquidity(uint liquidityToRemove)`
3. ä½ å°†æ”¶å›ç›¸åº”ä»½é¢çš„ Token A å’Œ B

---

### ğŸ§ª å°æŠ€å·§ï¼šè§‚å¯Ÿäº‹ä»¶

ä¼šçœ‹åˆ°ç±»ä¼¼æ—¥å¿—ï¼š

- `LiquidityAdded`
- `TokensSwapped`
- `LiquidityRemoved`

å¸®åŠ©ä½ éªŒè¯æ“ä½œ â€” ä¹Ÿæ˜¯å‰ç«¯ç”¨æ¥æ›´æ–° UI çš„ä¾æ®ã€‚

---

### âœ… ä½ åšåˆ°äº†

ä½ ç°åœ¨å·²ç»ï¼š

- éƒ¨ç½²äº†ä¸¤ä¸ª ERC-20 ä»£å¸
- æ„å»ºå¹¶æµ‹è¯•äº†è‡ªå·±çš„ AMM
- ä½¿ç”¨æ•°å­¦é€»è¾‘å®Œæˆä»£å¸äº¤æ¢ï¼Œè€Œéä¾èµ–åšå¸‚å•†
- æˆä¸ºè‡ªå·± DEX çš„é¦–ä½æµåŠ¨æ€§æä¾›è€…

---

## ğŸ‰ æ€»ç»“ â€” ä½ åˆšåˆšæ„å»ºäº†ä¸€ä¸ªDEX å¼•æ“

ç¨å¾®åœä¸€ä¸‹ï¼Œæ„Ÿå—ä¸€ä¸‹ä½ çš„æˆå°±ã€‚

ä½ ä¸ä»…å†™äº†ä¸€ä¸ª Solidity åˆçº¦ â€”

ä½ æ„å»ºäº†**é©±åŠ¨ Uniswapã€SushiSwap ç­‰ DeFi å¹³å°çš„æ ¸å¿ƒå¼•æ“**ã€‚

å›é¡¾ä½ å®Œæˆçš„å†…å®¹ï¼š

---

### âœ… å­¦åˆ°äº† AMM æ ¸å¿ƒ

- ä¸ºä»€ä¹ˆä¼ ç»Ÿäº¤æ˜“æ–¹å¼ï¼ˆè®¢å•ç°¿ï¼‰æ— æ³•é“¾ä¸Šä½¿ç”¨
- AMM å¦‚ä½•é€šè¿‡ç®€å•æ•°å­¦å…¬å¼ `x * y = k` æ”¹å˜æ¸¸æˆè§„åˆ™
- æµåŠ¨æ€§æ± å¦‚ä½•è¿ä½œä»¥åŠ LP ä»£å¸çš„é‡è¦æ€§
- ä»·æ ¼å‘ç°ã€æ»‘ç‚¹å’Œæ‰‹ç»­è´¹å¦‚ä½•å†…ç½®åœ¨æ•°å­¦é€»è¾‘ä¸­

---

### âœï¸ ç¼–å†™äº†å®Œæ•´æ™ºèƒ½åˆçº¦é€»è¾‘

- ä»é›¶åˆ›å»ºåŸºäº ERC-20 çš„ AMM
- æ”¯æŒ **äº¤æ¢**ã€**æ·»åŠ **ã€**ç§»é™¤æµåŠ¨æ€§**
- å¤„ç† LP ä»£å¸é“¸é€ ã€æ‰‹ç»­è´¹é€»è¾‘å’Œå‚¨å¤‡è¿½è¸ª
- ä½¿ç”¨ `sqrt()` å’Œ `min()` ç­‰**å·¥å…·å‡½æ•°**ä¿è¯å…¬å¹³å’ŒèŠ‚çœ gas

---

### ğŸ§ª åœ¨ Remix ä¸Šè¿è¡Œ

- éƒ¨ç½²ä¸¤ä¸ªä»£å¸
- å¯åŠ¨ AMM
- æ‰¹å‡†ä»£å¸è½¬ç§»
- æ·»åŠ æµåŠ¨æ€§
- æ‰§è¡ŒçœŸå®ä»£å¸äº¤æ˜“
- å®æ—¶è§‚å¯Ÿæ‰€æœ‰å˜åŒ–æ›´æ–°

---

### ğŸ¯ ä½ æ„å»ºäº†ä»€ä¹ˆ

ä½ ä¸ä»…ç†è§£äº†**AMM å¦‚ä½•è¿ä½œ**â€¦â€¦

è¿˜çœŸæ­£**äº²æ‰‹æ„å»ºäº†ä¸€ä¸ªAMM** â€” è¿™ç§æŠ€èƒ½åœ¨ Web3 ä¸–ç•Œä¸­éå¸¸æŠ¢çœ¼ã€‚

ä½ å†™äº†ä¸€ä¸ªè‡ªåŒ…å«ã€è‡ªç»´æŒçš„æ™ºèƒ½åˆçº¦ï¼Œå®ƒå¯ä»¥ï¼š

- ç®¡ç†æµåŠ¨æ€§
- è®¡ç®—å…¬å¹³äº¤æ¢ä»·æ ¼
- ä¿æŒæ± å­å¹³è¡¡
- æ°¸ä¹…åœ¨é“¾ä¸Šè¿è¡Œ

æ— éœ€ä¸­é—´äººã€æ— éœ€æƒé™æ§åˆ¶ã€‚çº¯ç²¹ä»£ç  + æ•°å­¦ã€‚