# 点击计数器

Day: Day 1
ID: 1
原文: https://builder-hub.notion.site/ClickCounter-Contract-1c15720a23ef8001ac8fd21470d611c5
状态: 完成
译者: 雷雷
难度等级: 初级

[🧭 首页](https://www.notion.so/5-5-HerSolidity-28e06421268880e4b645d9458179e231?pvs=21) ｜ [🎓 30天课程日历](https://www.notion.so/28e0642126888002b26be4b2e9841ce0?pvs=21) ｜[](https://www.notion.so/28e06421268881e59a00e854a7444215?pvs=21) ｜[FAQ-Solidity答疑问题库](https://www.notion.so/2910642126888046a897d75705d86a58?pvs=21) ｜ [👩🏻‍💻 关于我们](https://www.notion.so/344d3328efef4b3ab742f92b61533ce8?pvs=21)

# 学习内容

在本教程中，我们将逐步介绍一个名为 ClickCounter 的简单 Solidity 智能合约。该合约跟踪函数被调用的次数，类似于数字计数器。每次有人与它互动时，计数器都会增加一个。这似乎是一个简单的程序，但它在 Solidity 中引入了一些重要的基本概念，包括许可、Solidity 版本控制、状态变量和函数。

**学习目标**：理解智能合约的基本结构和组成部分

**核心技能**：掌握状态变量和函数的基本用法

**完整代码**：https://github.com/snehasharma76/30daysSolidity_Web3Compass/blob/master/ClickCounter.sol

# 1、产品需求书

### **a.用户路径图**

1. **入口**：用户通过钱包（如MetaMask）连接到DApp界面
2. **初始状态**：界面显示当前`counter`的数值（初始为0）
3. **交互动作**：用户点击"Click"按钮触发交互
4. **区块链交易**：
    - 调用`click()`函数
    - 用户确认交易支付Gas费
    - 交易上链等待确认
5. **状态更新**：交易确认后，`counter`值自动+1
6. **界面刷新**：DApp界面更新显示新的计数器数值
7. **循环**：用户可以重复点击，计数器持续累加

![image.png](%E7%82%B9%E5%87%BB%E8%AE%A1%E6%95%B0%E5%99%A8%2028c06421268880e49614d1890d806944/image.png)

### **b.数据库结构**

| **Contract / 合约** | **Type / 类型** | **Bases / 基础合约** |  | **含义 / Description**|
| --- | --- | --- | --- | --- |
| ClickCounter |  Implementation - 实现合约（非接口或抽象合约） | 无继承合约 |  |  一个简单的区块链点击计数器应用 |

| **Function Name / 函数名** | **Visibility / 可见性** | **Mutability / 可变性** | **Modifiers / 修饰器** | **含义 / Description** |
| --- | --- | --- | --- | --- |
| counter | Public / 公开 | view / 只读，不修改状态，无需Gas费 | NO / 无 | 获取当前点击计数器数值，任何人都可以免费调用 |
| click | Public / 公开 | 状态修改操作（需要Gas费用） | NO / 无 | 增加点击计数，每次调用使计数器值+1 |

# 2、细节解说

## 分解代码

### **📝（1）SPDX许可证标识符**

每个Solidity文件合同的第一行是许可证标识符。这是指定与代码关联的法律权限和限制的标准方法。

```solidity
// SPDX-License-Identifier: MIT
```

**为什么重要?**

- 告诉他人你的代码可以如何使用和分发
- MIT是最宽松的开源许可证之一,允许商业使用
- 避免编译器警告

大多数智能合约一旦部署，都是公开的，任何人都可以查看。因此，最好声明许可证以阐明其他人如何使用代码。

`SPDX`代表软件包数据交换，这只是在代码中指示许可证的正式方式。
`“MIT”` 是指麻省理工学院许可证，这是最宽松的开源许可证之一。这意味着：任何人都可以使用、修改和共享合同。代码的使用方式没有限制。如果出现问题，作者不承担任何责任。

如果没有这一行，Solidity 可能仍会编译合约，但您可能会看到警告。某些平台（例如 Etherscan）在验证合约时需要许可证标识符。

可以把它想象成 GitHub 上的开源项目。如果您想分享您的作品，最好指定其他人如何使用它。

### **🔧 （2）Pragma 指令 - 设置 Solidity 版本**

```solidity
pragma solidity ^0.8.0;
```

在 Solidity 开始读取合约之前，我们需要告诉它应该使用**哪个编译器版本**。这就是这条线的作用。

- `pragma`: 编译器指令关键字
- `^0.8.0`: 表示使用0.8.0或更高版本,但低于0.9.0
- 不同版本的编译器可能有不同的特性和行为
- 0.8.0版本开始,自动检查整数溢出,更安全!

**详细解释:**

**我们为什么需要这个？**

Solidity 不断发展，新版本引入了更改，其中一些可能与旧代码**不兼容**。

`编译指示`确保合约使用**特定版本**的 Solidity 编译，从而降低出错风险。

`^`符号表示“使用此版本或任何次要更新”。`^0.8.0` 允许使用 0.8.1、0.8.2 **等编译合约**，**但不能使用** 0.9.0 编译。

通过指定版本，我们确保即使将来 Solidity 更新，合约也能**保持稳定**。这类似于在项目中指定软件依赖项。如果您构建 Web 应用程序并依赖于特定版本的库，则需要确保将来的更新不会破坏您的代码。

### **📦（3） 定义智能合约**

```solidity
contract ClickCounter {
    // 合约内容在这里
}
```

这是我们声明智能合约的地方。

**我们为什么需要这个？**

**智能合约**是在**区块链**上运行的自动执行程序。

`{}`括号内的所有内容都属于此合约。

一旦部署，该合约将**永久存在于区块链上**。它不能更改或删除，但任何人都可以根据其函数中定义的规则与之交互。

智能合约类似于自动售货机。设置完成后，它会遵循其逻辑并自动运行，无需人工干预。

**关键点:**

- `contract`关键字类似于其他语言中的`class`
- 合约是Solidity代码的基本单位
- 合约名称应该使用大驼峰命名法(PascalCase)
- 一个文件可以有多个合约,但通常一个文件一个主合约

### **💾 （4）声明状态变量**

```solidity
uint256 public counter;
```

此行创建名为 `counter` 的**状态变量** 。

**这有什么作用？**

`uint256` 是一种表示**无符号整数**的数据**类型**，这意味着它只能存储正数（0 及以上）。

`public` 使**任何人都可以访问**该变量。Solidity 自动创建一个 **getter 函数**，允许用户检查`计数器`的当前值，而无需单独的函数。

由于这是一个**状态变量**，因此它永久存储在**区块链**上。与函数内的临时变量不同，状态变量即使在事务结束后仍会保留其值。

如果您想到体育场的数字记分牌，这个变量的功能是一样的。它跟踪分数，任何人都可以看到它。

**深入理解:**

- `uint256`: 无符号整数类型,256位(可以存储非常大的数字!)
- `public`: 自动创建getter函数,任何人都可以读取
- `counter`: 变量名,存储在区块链上
- 状态变量默认初始化为0
- 存储在区块链上是永久的,修改需要花费gas

### **⚙️ （5）点击功能-增加计数器**

```solidity
function click() public {
    counter++;
}
```

这个功能是**我们合约的核心**。每当有人调用`click()`时，计数器就会增加1。

**我们为什么需要这个？**

`public`表示任何人都可以调用此函数。

`counter++`每次函数运行时将计数器增加**一个单位**。

由于该函数**修改了状态变量**，因此它执行了**状态更改操作**，这意味着它需要**Gas费用**才能执行。

像这样的功能允许用户与合约**进行交互**。由于智能合约在**去中心化的区块链**上运行，因此它们依赖于用户触发函数来执行操作。

这类似于单击帖子上的“赞”按钮。每次按下，点赞数都会上升。

**函数解析:**

- `function`: 函数关键字
- `click`: 函数名称(建议使用小驼峰命名)
- `public`: 任何人(包括其他合约)都可以调用这个函数
- `counter++`: 将计数器的值加1
- 调用这个函数会改变状态,需要发送交易并花费gas

## 完整代码详解

### 📄 完整合约代码

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract ClickCounter {
    // 状态变量 - 存储点击次数
    uint256 public counter;

    // 函数 - 增加计数器
    function click() public {
        counter++;
    }
}
```

**✅ 这个合约做什么?**

这是一个超级简单的计数器!每次有人调用`click()`函数,计数器就会增加1。所有的点击都永久记录在区块链上,任何人都可以通过`counter`变量查看当前的点击次数。

### 🔍 逐行详细讲解

### 第1行: 许可证声明

```solidity
// SPDX-License-Identifier: MIT
```

告诉编译器和用户,这个代码使用MIT开源许可证。这是注释,不会被编译。

### 第2行: 编译器版本

```solidity
pragma solidity ^0.8.0;
```

指定使用0.8.x版本的Solidity编译器。`^`符号表示兼容0.8.0到0.8.99之间的任何版本,但不包括0.9.0。

### 第4行: 合约声明

```solidity
contract ClickCounter {
```

定义一个名为`ClickCounter`的智能合约。大括号`{`标志着合约代码的开始。

### 第6行: 状态变量声明

```solidity
    uint256 public counter;
```

声明一个公开的无符号256位整数变量`counter`。初始值自动为0。因为是`public`,编译器会自动生成一个getter函数,让外部可以读取这个值。

### 第9-11行: click函数

```solidity
    function click() public {
        counter++;
    }
```

定义一个公共函数`click()`。每次调用时,将`counter`的值加1。`++`是递增运算符,等同于`counter = counter + 1`。

### 该合同的运作方式：

（1）将合约部署到区块链。

（2）默认情况下，计数器**从 0 开始**。

（3）每当有人调用 `click()` 时，计数器就会增加 1。

（4）`计数器`变量永久存储其值，因此即使您刷新或关闭合约，数字也保持不变。

（5）任何人都可以检查计数器的值，因为它是**公开**的。

由于该合约在区块链上运行，因此每一次更改都会被永久记录。即使有一千人调用 click()，区块链也会将每个增量存储为新交易。

# 3、下一步

现在你已经了解了该合约的基础知识，以下是一些扩展其功能的方法：

1. 添加一个`reset()`函数,将计数器重置为0
2. 添加一个`decrease()`函数,使计数器减1(提示:注意不要让它变成负数!)
3. 添加一个`getCounter()`函数,明确返回当前计数(提示:使用`view`修饰符)
4. 添加一个`clickMultiple(uint256 times)`函数,一次增加多次

这个简单的合约引入了关键的 Solidity 概念，**如状态变量、函数和区块链存储**。这些概念构成了构建更复杂的去中心化应用程序的基础。

**扩展知识点：**

1. **数据类型**

除了`uint256`,还有`int`、`bool`、`address`、`string`等类型

1. **可见性修饰符**

`public`、`private`、`internal`、`external`控制访问权限

1. **函数修饰符**

`view`(只读)、`pure`(不读不写)、`payable`(接收ETH)