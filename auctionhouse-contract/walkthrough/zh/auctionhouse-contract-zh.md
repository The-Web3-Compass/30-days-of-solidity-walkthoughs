# æ‹å–è¡Œåˆçº¦

Day: Day 4
ID: 4
åŸæ–‡: https://www.notion.so/AuctionHouse-Contract-1c35720a23ef80198952efbbe2554608?source=copy_link
çŠ¶æ€: å®Œæˆ
è¯‘è€…: ç¦¾
éš¾åº¦ç­‰çº§: åˆçº§

[ğŸ§­ é¦–é¡µ](https://www.notion.so/5-5-HerSolidity-28e06421268880e4b645d9458179e231?pvs=21) ï½œ [ğŸ“ 30å¤©è¯¾ç¨‹æ—¥å†](https://www.notion.so/28e0642126888002b26be4b2e9841ce0?pvs=21) ï½œ[](https://www.notion.so/28e06421268881e59a00e854a7444215?pvs=21) ï½œ[FAQ-Solidityç­”ç–‘é—®é¢˜åº“](https://www.notion.so/2910642126888046a897d75705d86a58?pvs=21) ï½œ [ğŸ‘©ğŸ»â€ğŸ’» å…³äºæˆ‘ä»¬](https://www.notion.so/344d3328efef4b3ab742f92b61533ce8?pvs=21)

# ä»Šæ—¥å­¦ä¹ å†…å®¹ï¼š

æˆ‘ä»¬å·²ç»ä½¿ç”¨è¿‡åƒ`string`, `uint`, `mapping`, å’Œ`array`è¿™æ ·çš„æ•°æ®ç±»å‹ã€‚ä½ å·²ç»äº†è§£å¦‚ä½•å­˜å‚¨å’Œæ£€ç´¢æ•°æ®ï¼Œç”šè‡³çŸ¥é“å¦‚ä½•ç”¨  `require()`å®ç°ä¸€äº›é€»è¾‘ã€‚

ä½†æ˜¯è®²å®è¯â€”â€”åªå¤„ç†å­¤ç«‹çš„éƒ¨åˆ†å¯¹äºç»ƒä¹ æ¥è¯´è¿˜è¡Œ...

ç°åœ¨åˆ°äº†æ•´åˆæ‰€æœ‰å†…å®¹ã€æ„å»ºä¸€ä¸ªå®Œæ•´ã€çœŸå®çš„åˆçº¦çš„æ—¶å€™äº†ã€‚
åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªæ‹å–ç³»ç»Ÿ ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªåœ¨çº¿ç«ä»·å¹³å°ï¼Œç”¨æˆ·å¯ä»¥å¯¹ç‰©å“è¿›è¡Œå‡ºä»·ï¼Œæœ€ç»ˆå‡ºä»·æœ€é«˜è€…è·èƒœã€‚

<aside>
ğŸ’»

ä»¥ä¸‹æ˜¯å®Œæ•´ä»£ç ğŸ‘‡ğŸ¼ï¼š

[https://github.com/snehasharma76/30daysSolidity_Web3Compass/blob/master/AuctionHouse.sol](https://github.com/snehasharma76/30daysSolidity_Web3Compass/blob/master/AuctionHouse.sol)

</aside>

# 1. äº§å“éœ€æ±‚ä¹¦

1. ç”¨æˆ·è·¯å¾„å›¾

```mermaid
flowchart TD
    A[æ‹å–åˆçº¦éƒ¨ç½²] --> B[è®¾ç½®æ‹å–ç‰©å“å’Œæˆªæ­¢æ—¶é—´]
    B --> C{æ‹å–è¿›è¡Œä¸­?}
    C -- æ˜¯ --> D([<span style="color:red;font-weight:bold">ç”¨æˆ·è¾“å…¥ï¼šå‡ºä»·é‡‘é¢</span>])
    D --> E[åˆ¤æ–­å‡ºä»·æ˜¯å¦é«˜äºå½“å‰æœ€é«˜ä»·]
    E -- æ˜¯ --> F[æ›´æ–°æœ€é«˜ä»·å’Œæœ€é«˜å‡ºä»·äºº]
    E -- å¦ --> G[æ‹’ç»å‡ºä»·]
    D --> H[è®°å½•å‡ºä»·äººå’Œå‡ºä»·é‡‘é¢]
    C -- å¦ --> I([<span style="color:red;font-weight:bold">åˆçº¦æ‰€æœ‰è€…è¾“å…¥ï¼šè°ƒç”¨ç»“æŸå‡½æ•°</span>])
    I --> J[ç¡®å®šæœ€ç»ˆèµ¢å®¶]
    J --> K[å…¬å¸ƒèµ¢å®¶å’Œæœ€é«˜å‡ºä»·]
    
    
    

```

b. æ•°æ®åº“ç»“æ„è¡¨

|  contact |  function name |  visibility | mutability |  modifiers | notes |
| --- | --- | --- | --- | --- | --- |
| **AuctionHouse** | Implementation |  |  |  |  |
| â”” | <Constructor> | Public â—ï¸ | ğŸ›‘ | NOâ—ï¸ |  |
| â”” | bid | External â—ï¸ | ğŸ›‘ | NOâ—ï¸ |  |
| â”” | endAuction | External â—ï¸ | ğŸ›‘ | NOâ—ï¸ |  |
| â”” | getAllBidders | External â—ï¸ |  | NOâ—ï¸ |  |
| â”” | getWinner | External â—ï¸ |  | NOâ—ï¸ |  |
|  |  |  |  |  |  |

# 2. ç»†èŠ‚è§£è¯´

åœ¨æ·±å…¥ä»£ç ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆé—®è‡ªå·±ä¸€ä¸ªé—®é¢˜ï¼š

# æˆ‘ä»¬å®é™…éœ€è¦å“ªäº›æ•°æ®æ¥è¿è¡Œæ‹å–ï¼Ÿ

è®©æˆ‘ä»¬ä»”ç»†æ€è€ƒä¸€ä¸‹ã€‚

## 1.è°åˆ›å»ºäº†æ‹å–ï¼Ÿ

æˆ‘ä»¬éœ€è¦è¿½è¸ªè´Ÿè´£æ“ä½œçš„äººâ€”â€”å³éƒ¨ç½²åˆçº¦çš„äººã€‚æˆ‘ä»¬ç§°ä»–ä»¬ä¸ºæ‰€æœ‰è€… ã€‚

```solidity
address public owner;
```

æˆ‘ä»¬å°†åœ¨åˆçº¦éƒ¨ç½²æ—¶è®¾ç½®æ­¤é¡¹ï¼Œå¹¶å°†å…¶è®¾ä¸º`public` ï¼Œä»¥ä¾¿ä»»ä½•äººéƒ½å¯ä»¥éªŒè¯ç«æ‹çš„æ‰€æœ‰è€…ã€‚

## 2. æˆ‘ä»¬åœ¨æ‹å–ä»€ä¹ˆï¼Ÿ

ä¸€å®šæœ‰ç‰©å“ï¼Œå¯¹å§ï¼Ÿä¸€å¹…ç”»ã€ä¸€éƒ¨æ‰‹æœºã€ä¸€ä»¶ç¨€æœ‰æ•°å­—æ”¶è—å“â€”â€”æˆ‘ä»¬å¸Œæœ›æ‹å–åˆ›å»ºè€…æè¿°å³å°†è¢«ç«æ‹çš„ä¸œè¥¿ã€‚

```solidity
string public item;
```

è¿™å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿â€”â€”åœ¨éƒ¨ç½²åˆåŒæ—¶ï¼Œæˆ‘ä»¬å°†è®©æ‰€æœ‰è€…æä¾›ç‰©å“åç§°ã€‚

## 3. æ‹å–ä½•æ—¶ç»“æŸï¼Ÿ

æˆ‘ä»¬ä¸æƒ³è®©æ‹å–æ°¸è¿œæŒç»­ä¸‹å»ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†å®šä¹‰å®ƒçš„æŒç»­æ—¶é—´â€”â€”å¹¶ä½¿ç”¨æ—¶é—´æˆ³è·Ÿè¸ªæ‹å–ç»“æŸçš„æ—¶é—´ã€‚

```solidity
uint public auctionEndTime;
```

æˆ‘ä»¬å°†ä½¿ç”¨å½“å‰æ—¶é—´åŠ ä¸Šæ‹å–åº”è¿è¡Œçš„æ—¶é—´æ¥è®¡ç®—è¿™ä¸€ç‚¹ã€‚æ›´å¤šå†…å®¹å°†åœ¨æˆ‘ä»¬åˆ°è¾¾æ„é€ å‡½æ•°æ—¶ä»‹ç»ã€‚

## 4. ç›®å‰è°åœ¨é¢†å…ˆï¼Ÿ

è¿™æœ‰ç‚¹é‡è¦ã€‚æˆ‘ä»¬éœ€è¦å­˜å‚¨ï¼š

- è¿„ä»Šä¸ºæ­¢çš„æœ€é«˜å‡ºä»·
- ä»¥åŠå‡ºä»·äººçš„åœ°å€

```solidity
address private highestBidder;
uint private highestBid;
```

æˆ‘ä»¬å°†è¿™äº›æ ‡è®°ä¸º`private` ï¼Œè¿™æ ·æ²¡æœ‰äººå¯ä»¥ç›´æ¥è®¿é—®å®ƒä»¬å¹¶æ¬ºéª—ç³»ç»Ÿã€‚ä½†æˆ‘ä»¬ä»ç„¶ä¼šè®©äººçœ‹åˆ°å®ƒä»¬â€”â€”åªæ˜¯æ‹å–ç»“æŸå ã€‚

## 5. æ‹å–å·²ç»ç»“æŸäº†å—ï¼Ÿ

æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ ‡å¿—æ¥æ ‡è®°æ‹å–æ˜¯å¦å®Œæˆâ€”â€”ä»¥ç¡®ä¿å®ƒä¸ä¼šè¢«ç»“æŸä¸¤æ¬¡ï¼Œæˆ–è€…æœ‰äººè¿‡æ—©åœ°æŸ¥çœ‹è·èƒœè€…ã€‚

```solidity
bool public ended;
```

è¿™æœ€åˆæ˜¯ `false`ï¼Œä¸€æ—¦æœ‰äººæ­£å¼ç»“æŸæ‹å–ï¼Œå°±ä¼šåˆ‡æ¢ä¸º`true`ã€‚

## 6. è°å‡ºä»·äº†ï¼Œå‡ºä»·å¤šå°‘ï¼Ÿ

æˆ‘ä»¬æƒ³è¦è®°å½•æ¯ä¸ªç”¨æˆ·çš„å‡ºä»·ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½ç¡®ä¿äººä»¬ä¸ä¼šå†æ¬¡å‡ºç›¸åŒé‡‘é¢çš„ä»·ï¼Œå¹¶ä¸”çŸ¥é“è°å‚ä¸äº†ç«æ ‡ã€‚

```solidity
mapping(address => uint) public bids;
```

ä¹Ÿè®¸æˆ‘ä»¬è¿˜æƒ³è¦ä¸€ä¸ªå®Œæ•´åˆ—å‡ºæ‰€æœ‰è‡³å°‘å‡ºä»·ä¸€æ¬¡çš„äººçš„åå•â€”â€”ä¸åªæ˜¯ä»–ä»¬çš„å‡ºä»·é‡‘é¢ï¼š

```solidity
address[] public bidders;
```

å¦‚æœä½ æƒ³è¦å±•ç¤ºæ’è¡Œæ¦œæˆ–è€…åªæ˜¯ä¿æŒäº‹æƒ…é€æ˜ï¼Œè¿™ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚

# é‚£ä¹ˆï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è®¾ç½®è¿™ä¸€åˆ‡å‘¢ï¼Ÿ

è®©æˆ‘ä»¬ä»æ„é€ å‡½æ•°å¼€å§‹â€”â€”è¿™æ˜¯åˆçº¦éƒ¨ç½²æ—¶ä»…æ‰§è¡Œä¸€æ¬¡çš„éƒ¨åˆ†ã€‚

```solidity
constructor(string memory _item, uint _biddingTime) {
    owner = msg.sender;
    item = _item;
    auctionEndTime = block.timestamp + _biddingTime;
}
```

è¿™æ˜¯å‘ç”Ÿçš„äº‹æƒ…ï¼š

- `msg.sender`  æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡â€”â€”å®ƒç»™æˆ‘ä»¬æä¾›**éƒ¨ç½²åˆçº¦çš„æ“ä½œè€…åœ°å€** ã€‚æˆ‘ä»¬å°†å…¶ä¿å­˜ä¸ºæ‰€æœ‰è€…ã€‚
- `_item` æ˜¯è¢«æ‹å–ç‰©å“çš„åç§°â€”â€”æˆ‘ä»¬å°†å…¶å­˜å‚¨åœ¨ `item` å˜é‡ä¸­ã€‚
- `_biddingTime` è¡¨ç¤ºæ‹å–åº”æŒç»­çš„æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚æˆ‘ä»¬å°†å®ƒåŠ åˆ°å½“å‰æ—¶é—´ï¼ˆ`block.timestamp`ï¼‰ä¸Šï¼Œä»¥ç¡®å®šæ‹å–ä½•æ—¶ç»“æŸã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæœ‰äººä½¿ç”¨`"Digital Art"`å’Œ  `300`éƒ¨ç½²è¿™ä¸ªï¼Œæ‹å–å°†åœ¨ 5 åˆ†é’Ÿåç»“æŸã€‚

# ç°åœ¨æˆ‘ä»¬æ¥è°ˆè°ˆå‡ºä»·ã€‚

è¿™æ˜¯ç”¨æˆ·ä¸»è¦æ‰§è¡Œçš„æ“ä½œã€‚ä»¥ä¸‹æ˜¯è¯¥å‡½æ•°çš„æ ·å¼ï¼š

```solidity
function bid(uint amount) external {
    require(block.timestamp < auctionEndTime, "Auction has already ended.");
    require(amount > 0, "Bid amount must be greater than zero.");
    require(amount > bids[msg.sender], "New bid must be higher than your current bid.");

    if (bids[msg.sender] == 0) {
        bidders.push(msg.sender);
    }

    bids[msg.sender] = amount;

    if (amount > highestBid) {
        highestBid = amount;
        highestBidder = msg.sender;
    }
}
```

è®©æˆ‘ä»¬æ…¢æ…¢æ¥ã€‚

## é¦–å…ˆï¼šè¿™ä¸ªå‡ºä»·å¯èƒ½å‘ç”Ÿå—ï¼Ÿ

æˆ‘ä»¬ä½¿ç”¨ `require()` æ¥è®¾ç½®è§„åˆ™â€”â€”å¦‚æœè§„åˆ™å¤±è´¥ï¼Œå‡½æ•°ä¼šç«‹å³åœæ­¢ã€‚

1. æ‹å–å·²ç»ç»“æŸäº†å—ï¼Ÿ
    
    
    ```solidity
    require(block.timestamp < auctionEndTime, "Auction has already ended.");
    ```
    
    å¦‚æœå½“å‰æ—¶é—´å·²è¿‡æ‹å–æˆªæ­¢æ—¶é—´ï¼Œå°†ä¸å†æ¥å—æ›´å¤šå‡ºä»·ã€‚
    
2. å‡ºä»·é‡‘é¢æ˜¯å¦æœ‰æ•ˆï¼Ÿ
    
    
    ```solidity
    require(amount > 0, "Bid amount must be greater than zero.");
    ```
    
    æˆ‘ä»¬ä¸å¸Œæœ›æœ‰äººå‡ºä»·é›¶æˆ–è´Ÿæ•°ã€‚
    
3. è¿™æ¬¡å‡ºä»·æ˜¯å¦é«˜äºè¯¥ç”¨æˆ·çš„ä¸Šæ¬¡å‡ºä»·ï¼Ÿ
    
    
    ```solidity
    require(amount > bids[msg.sender], "New bid must be higher than your current bid.");
    ```
    
    è¿™ç¡®ä¿äº†äººä»¬åªä¼šæé«˜ä»–ä»¬çš„å‡ºä»·â€”â€”ä¸ä¼šè¿›è¡Œåƒåœ¾ä¿¡æ¯å‘é€æˆ–é™ä½å‡ºä»·ã€‚
    

## æ¥ä¸‹æ¥ï¼šè¿™æ˜¯æ–°çš„ç«æ ‡è€…å—ï¼Ÿ

```solidity
if (bids[msg.sender] == 0) {
    bidders.push(msg.sender);
}
```

å¦‚æœè¿™æ˜¯ç”¨æˆ·çš„é¦–æ¬¡å‡ºä»· ï¼Œæˆ‘ä»¬å°†ä»–ä»¬æ·»åŠ åˆ°`bidders`æ•°ç»„ä¸­ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°ä¸€ä¸ªå®Œæ•´çš„å‚ä¸äººå‘˜åå•ã€‚

## ç„¶åï¼šä¿å­˜å‡ºä»·

```solidity
bids[msg.sender] = amount;
```

æˆ‘ä»¬åœ¨  `bids`  æ˜ å°„ä¸­æ›´æ–°ä»–ä»¬çš„å‡ºä»·é‡‘é¢ã€‚

## æœ€åï¼šä»–ä»¬æ˜¯ä¸æ˜¯æ–°çš„æœ€é«˜ä»·è€…ï¼Ÿ

```solidity
if (amount > highestBid) {
    highestBid = amount;
    highestBidder = msg.sender;
}
```

å¦‚æœè¿™æ˜¯ç›®å‰ä¸ºæ­¢æˆ‘ä»¬çœ‹åˆ°çš„æœ€å¤§å‡ºä»·ï¼Œæˆ‘ä»¬ä¼šåŒæ—¶æ›´æ–°å‡ºä»·å’Œå‡ºä»·è€…ã€‚

# æ‹å–ç»“æŸ

æŸä¸ªæ—¶åˆ»ï¼Œæ‹å–å¿…é¡»åœæ­¢ã€‚è¿™å°±æ˜¯è¿™ä¸ªåŠŸèƒ½å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ï¼š

```solidity
function endAuction() external {
    require(block.timestamp >= auctionEndTime, "Auction hasn't ended yet.");
    require(!ended, "Auction end already called.");
    ended = true;
}
```

æˆ‘ä»¬æ¥é€æ­¥è§£æå®ƒã€‚

1. é¦–å…ˆï¼Œæˆ‘ä»¬æ£€æŸ¥æ‹å–æ—¶é—´æ˜¯å¦å·²è¿‡ï¼š
    
    ```solidity
    require(block.timestamp >= auctionEndTime, "Auction hasn't ended yet.");
    ```
    
2. ç„¶åï¼Œæˆ‘ä»¬ç¡®ä¿æ²¡æœ‰äººå·²ç»ç»“æŸå®ƒï¼š
    
    ```solidity
    require(!ended, "Auction end already called.");
    ```
    
3. å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæˆ‘ä»¬ç¿»è½¬ `ended` æ ‡å¿—ï¼š
    
    ```solidity
    ended = true;
    ```
    

è¿™æ˜¯ä¸€ç§  **å¸¸è§çš„ Solidity æ¨¡å¼**  â€” ä½¿ç”¨ `bool` æ¥ç¡®ä¿æŸäº‹åªå‘ç”Ÿä¸€æ¬¡ã€‚

# æ‹å–ç»“æŸåæŸ¥çœ‹ä¿¡æ¯

æˆ‘ä»¬ä¸æƒ³åœ¨æ‹å–ç»“æŸå‰æš´éœ²è·èƒœè€…ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ `highestBidder` å’Œ `highestBid` ç§æœ‰çš„ã€‚ä½†æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·æ­ç¤ºå®ƒä»¬ï¼š

```solidity
function getWinner() external view returns (address, uint) {
    require(ended, "Auction has not ended yet.");
    return (highestBidder, highestBid);
}
```

æˆ‘ä»¬æ£€æŸ¥æ‹å–æ˜¯å¦å·²ç»“æŸã€‚å¦‚æœå·²ç»“æŸï¼Œæˆ‘ä»¬è¿”å›è·èƒœè€…çš„åœ°å€å’Œä»–ä»¬çš„å‡ºä»·ã€‚

# æƒ³æŸ¥çœ‹æ‰€æœ‰å‡ºä»·è€…å—ï¼Ÿ

å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰è¿™ä¸ªåŠŸèƒ½ï¼š

```solidity

function getAllBidders() external view returns (address[] memory) {
    return bidders;
}
```

è¿™ä»…è¿”å›`bidders`æ•°ç»„ï¼Œæ‰€ä»¥ä»»ä½•äººéƒ½å¯ä»¥çœ‹åˆ°å‚ä¸æƒ…å†µã€‚

# å¿«é€Ÿå›é¡¾

è¿™ä»½åˆåŒå¼•å…¥äº†ä¸€äº›é‡è¦æ¦‚å¿µï¼š

- **å…¨å±€å˜é‡** ï¼š
`msg.sender` å‘Šè¯‰æˆ‘ä»¬è°åœ¨è°ƒç”¨ä¸€ä¸ªå‡½æ•°
`block.timestamp` ç»™æˆ‘ä»¬æä¾›å½“å‰æ—¶é—´
- **require()** å¸®åŠ©æˆ‘ä»¬æ‰§è¡Œè§„åˆ™å¹¶æ§åˆ¶å…è®¸çš„æ“ä½œ
- **æ„é€ å‡½æ•°Constructor**  è¿è¡Œä¸€æ¬¡å¹¶è®¾ç½®åˆçº¦çš„åˆå§‹çŠ¶æ€
- **å¯è§æ€§ å…³é”®å­—** å¦‚ `public`, `private`, å’Œ `external` æ§åˆ¶å“ªäº›å†…å®¹å¯ä»¥è¢«è®¿é—®ä»¥åŠè¢«è°è®¿é—®
- **æ˜ å°„**å’Œ**æ•°ç»„**å¸®åŠ©æˆ‘ä»¬è¿½è¸ªç”¨æˆ·æ•°æ®ä¸å‚ä¸æƒ…å†µ

# ä½ åç»­å¯ä»¥åœ¨ä»£ç ä¹‹ä¸Šæ„å»ºä»€ä¹ˆï¼Ÿ

è¿™æ¬¡æ‹å–æœ‰æ•ˆâ€”â€”ä½†ä½ å¯ä»¥éšæ—¶æ·»åŠ æ›´å¤šã€‚

è¿™é‡Œæœ‰ä¸€äº›ä½ å¯ä»¥å°è¯•çš„äº‹æƒ…ï¼š

- æ·»åŠ ä¸€ä¸ª**æœ€ä½åŠ ä»·è§„åˆ™** ï¼ˆä¾‹å¦‚æ¯ä¸ªæ–°å‡ºä»·å¿…é¡»è‡³å°‘é«˜ 5%ï¼‰
- å…è®¸æœªä¸­å¥–è€…**æ’¤å›ä»–ä»¬çš„å‡ºä»·**
- æ·»åŠ ä¸€ä¸ª**èµ·æ‹ä»·**