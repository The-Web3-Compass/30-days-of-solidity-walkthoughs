# ç­¾åéªŒè¯

Day: Day 19
ID: 19
åŸæ–‡: https://builder-hub.notion.site/SignThis-Contract-1da5720a23ef80d69ae9c1559ba48a82?pvs=25
çŠ¶æ€: å®Œæˆ
è¯‘è€…: é›·é›·
éš¾åº¦ç­‰çº§: ä¸­çº§

# å­¦ä¹ å†…å®¹

å¥½å§â€”â€”åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åœ¨ Solidity ä¹‹æ—…ä¸­å–å¾—äº†ä¸€äº›é‡å¤§è¿›å±•ã€‚
æˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•ï¼š
      

- åˆ†é…**æ‰€æœ‰æƒ**
- ä½¿ç”¨**ä¿®é¥°ç¬¦**ä¿æŠ¤å‡½æ•°
- ä½¿ç”¨**æ˜ å°„**æ¥å­˜å‚¨ç”¨æˆ·æ•°æ®
- è¿›è¡Œå…¨é¢çš„**ä»£å¸é”€å”®**
- ä½¿ç”¨**å§”æ‰˜è°ƒç”¨**æ„å»ºåŸºäºæ’ä»¶çš„æ¨¡å—åŒ–ç³»ç»Ÿ

ä½†ç°åœ¨ï¼Œæ˜¯æ—¶å€™å°†**æ‰€æœ‰è¿™äº›æŠ€èƒ½ä»˜è¯¸è¡ŒåŠ¨**å¹¶è§£å†³ç°å®ä¸–ç•Œçš„é—®é¢˜äº†â€”â€”è¿™æ˜¯æ¯ä¸ª Web3 æ„å»ºè€…éƒ½èƒ½ä¸ä¹‹ç›¸å…³çš„ã€‚

**åœºæ™¯  ï¼šç§äºº Web3 äº‹ä»¶**
ä½ æ­£åœ¨ç»„ç»‡ä»£å¸**é—¨æ§ä¼šè®®**ã€**åˆ›å§‹äººèšä¼š**æˆ–**é“¾ä¸Šç ”è®¨ä¼š**ã€‚åªæœ‰é€‰å®šçš„å®¢äººæ‰èƒ½è¿›å…¥ã€‚
ç°åœ¨æŒ‘æˆ˜æ¥äº†......

**ä¼ ç»Ÿæ–¹æ³•ï¼š**
ä½ å°†æ¯ä¸ªä¸ä¼šè€…çš„åœ°å€å­˜å‚¨åœ¨é“¾ä¸Šã€‚
ä½ å¯ä»¥åœ¨åŠç†ç™»æœºæ‰‹ç»­æ—¶æ‰‹åŠ¨æ£€æŸ¥æ¯ä¸€é¡¹ã€‚
æ¯æ¬¡åœ°å€æ›´æ–°æˆ–æ‹¼å†™é”™è¯¯éƒ½ä¼šæ¶ˆè€— gasã€‚
ğŸ’¢è¿™å¾ˆç¬¨æ‹™ã€‚å¤ªè´µäº†ã€‚é‚£ä¸æ˜¯ Web3ã€‚

**âœ…æ›´æ™ºèƒ½çš„æ–¹å¼ï¼šé“¾ä¸‹ç­¾å**
è€Œä¸æ˜¯ä¸Šä¼ ä¸€å¤§å †åœ°å€......
å¦‚æœï¼š

- æ´»åŠ¨ç»„ç»‡è€…ä¸ºæ¯ä½è·æ‰¹çš„æ¥å®¾ç­¾ç½²ä¸€æ¡æ¶ˆæ¯
- å®¢äººæºå¸¦å·²ç­¾åçš„é‚€è¯·å‡½
- åˆçº¦åªæ˜¯åœ¨ç­¾åˆ°æ—¶éªŒè¯ç­¾å
- æ— éœ€åœ¨é“¾ä¸Šå­˜å‚¨ä»»ä½•ç™½åå•

æ˜¯çš„ï¼Œè¿™ä¸€åˆ‡éƒ½æ˜¯ä½¿ç”¨ä»¥å¤ªåŠå†…ç½®çš„ `ecrecover` åŠŸèƒ½å®‰å…¨åœ°å®Œæˆçš„ã€‚

**æˆ‘ä»¬çš„æ¸¸æˆè®¡åˆ’ğŸŒŒ**
 ä»¥ä¸‹æ˜¯æˆ‘ä»¬å°†è¦æ„å»ºçš„å†…å®¹ï¼Œä»¥åŠæˆ‘ä»¬å°†å¦‚ä½•åˆ†è§£å®ƒï¼š
        **1. æ´»åŠ¨è®¾ç½®**
        ç»„ç»‡è€…å®šä¹‰å§“åã€æ—¥æœŸå’Œæœ€å¤§ä¸ä¼šè€…äººæ•°ã€‚
       **2.åŠ å¯†é‚€è¯·**
       åç«¯ä¸æ˜¯å­˜å‚¨åœ°å€ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸ªå·²æ‰¹å‡†çš„æ¥å®¾ç­¾ç½²ä¸€æ¡æ¶ˆæ¯ã€‚
       **3.ç­¾åˆ°æµç¨‹**
       æ¥å®¾æäº¤ä»–ä»¬ç­¾åçš„æ¶ˆæ¯ã€‚
       è¯¥åˆåŒä½¿ç”¨ `ecrecover` æ¥éªŒè¯å®ƒæ˜¯å¦ç”±ç»„ç»‡è€…ç­¾ç½²ã€‚
      **4.å®‰å…¨æ€§å’Œçµæ´»æ€§**
        é“¾ä¸Šæ²¡æœ‰åœ°å€åˆ—è¡¨ã€‚æ²¡æœ‰é¢„åŠ è½½çš„ç™½åå•ã€‚æ²¡æœ‰æµªè´¹çš„æ°”ä½“ã€‚
         åªæœ‰æœ‰æ•ˆçš„ã€ç­¾åçš„ä¸ä¼šè€…æ‰èƒ½è¿›å…¥â€”â€”è€Œä¸”è¿™ä¸€åˆ‡éƒ½å¯ä»¥åœ¨é“¾ä¸Šå®Œå…¨éªŒè¯ã€‚

**æ‚¨å°†å­¦åˆ°ä»€ä¹ˆ**
å¦‚ä½•å¯¹ç»“æ„åŒ–æ•°æ®è¿›è¡Œå“ˆå¸Œå¤„ç†  ï¼ˆ`abi.encodePacked`ï¼‰
ä¸ºä»€ä¹ˆä»¥å¤ªåŠä½¿ç”¨ç­¾åæ¶ˆæ¯å‰ç¼€
`ecrecoverï¼ˆï¼‰` å¦‚ä½•è®©ä½ åœ¨é“¾ä¸ŠéªŒè¯é“¾ä¸‹æ‰¹å‡†
å¦‚ä½•å®æ–½å½“ä»Šç”Ÿäº§ä¸­å®é™…ä½¿ç”¨çš„è½»é‡çº§ã€èŠ‚èƒ½çš„è®¿é—®ç³»ç»Ÿ

ç”±æ­¤å¯è§ï¼Œåœ¨ä¼ ç»Ÿçš„æ´»åŠ¨ç®¡ç†ç³»ç»Ÿä¸­ï¼Œèº«ä»½éªŒè¯å¾€å¾€ä¾èµ–äºä¸­å¿ƒåŒ–çš„æ•°æ®åº“å’Œå¤æ‚çš„æƒé™æ§åˆ¶æœºåˆ¶ã€‚å‚ä¸è€…éœ€è¦æ³¨å†Œè´¦æˆ·ã€è®°ä½å¯†ç ï¼Œç»„ç»‡è€…éœ€è¦ç»´æŠ¤ç”¨æˆ·åˆ—è¡¨ã€å¤„ç†å¿˜è®°å¯†ç ç­‰ç¹çäº‹åŠ¡ã€‚è¿™ç§æ¨¡å¼ä¸ä»…ç”¨æˆ·ä½“éªŒå¤æ‚ï¼Œè¿˜å­˜åœ¨å•ç‚¹æ•…éšœå’Œæ•°æ®æ³„éœ²çš„é£é™©ã€‚

**åŒºå—é“¾æŠ€æœ¯ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§å…¨æ–°çš„æ€è·¯**ï¼šé€šè¿‡å¯†ç å­¦è¯æ˜è€Œéä¸­å¿ƒåŒ–æˆæƒæ¥éªŒè¯èº«ä»½ã€‚æœ¬ã€Œç­¾åéªŒè¯æ´»åŠ¨åˆçº¦ã€æ­£æ˜¯è¿™ä¸€ç†å¿µçš„å®è·µâ€”â€”åˆ©ç”¨æ•°å­—ç­¾åæŠ€æœ¯ï¼Œæ„å»ºäº†ä¸€ä¸ªå»ä¸­å¿ƒåŒ–ã€å®‰å…¨é«˜æ•ˆçš„æ´»åŠ¨ç®¡ç†ç³»ç»Ÿã€‚

### **ğŸ¯ è®¾è®¡å“²å­¦**

æœ¬åˆçº¦çš„æ ¸å¿ƒåˆ›æ–°åœ¨äºÂ **"é“¾ä¸‹ç­¾åï¼Œé“¾ä¸ŠéªŒè¯"**Â çš„æ¨¡å¼ï¼š

- **ç»„ç»‡è€…**åœ¨é“¾ä¸‹ä¸ºåˆæ³•å‚ä¸è€…ç”Ÿæˆæ•°å­—ç­¾å
- **å‚ä¸è€…**æäº¤ç­¾ååˆ°åŒºå—é“¾åˆçº¦è¿›è¡ŒéªŒè¯
- **æ™ºèƒ½åˆçº¦**é€šè¿‡`ecrecover`å‡½æ•°æ¢å¤ç­¾åè€…åœ°å€ï¼Œç¡®è®¤èº«ä»½æœ‰æ•ˆæ€§

è¿™ç§æ–¹æ³•å¸¦æ¥äº†å¤šé‡ä¼˜åŠ¿ï¼š

- **é›¶Gasé¢„æ³¨å†Œ**ï¼šå‚ä¸è€…æ— éœ€é¢„å…ˆæ”¯ä»˜Gasè´¹æ³¨å†Œ
- **æ— é™æ‰©å±•æ€§**ï¼šç­¾åç”Ÿæˆä¸å—åŒºå—é“¾ååé‡é™åˆ¶
- **éšç§ä¿æŠ¤**ï¼šå‚ä¸è€…åå•ä¸ä¼šå…¨éƒ¨æš´éœ²åœ¨é“¾ä¸Š
- **æˆæœ¬ä¼˜åŒ–**ï¼šæ‰¹é‡ç­¾åˆ°å¤§å¹…é™ä½Gasæ¶ˆè€—

**å­¦ä¹ ç›®æ ‡**ï¼šæŒæ¡æ•°å­—ç­¾åéªŒè¯å’Œé“¾ä¸‹è®¤è¯

**æ ¸å¿ƒæŠ€èƒ½**ï¼šecrecoverã€æ¶ˆæ¯å“ˆå¸Œã€ç­¾åç”Ÿæˆ

**å®Œæ•´ä»£ç **ï¼šâ€£ 

# 1ã€äº§å“éœ€æ±‚ä¹¦

### **a.ç”¨æˆ·è·¯å¾„å›¾**

**ç»„ç»‡è€…è·¯å¾„organizer**

1. **åˆçº¦éƒ¨ç½²**
    - è°ƒç”¨æ„é€ å‡½æ•°ï¼Œä¼ å…¥æ´»åŠ¨å‚æ•°
    - è‡ªåŠ¨æˆä¸ºorganizerï¼Œè·å¾—ç®¡ç†æƒé™
2. **ç­¾åç”Ÿæˆ**
    - è·å–å‚ä¸è€…é’±åŒ…åœ°å€
    - è°ƒç”¨getMessageHashè·å–æ¶ˆæ¯å“ˆå¸Œ
    - ä½¿ç”¨ç§é’¥å¯¹å“ˆå¸Œè¿›è¡Œç­¾å
    - åˆ†ç¦»ç­¾åä¸ºv, r, sç»„ä»¶
3. **æ‰¹é‡ç®¡ç†**
    - ä¸ºå¤šä¸ªå‚ä¸è€…ç”Ÿæˆç­¾å
    - ä½¿ç”¨batchCheckInè¿›è¡Œæ‰¹é‡ç­¾åˆ°
    - ç›‘æ§æ´»åŠ¨çŠ¶æ€å’Œå‚ä¸äººæ•°
    

**å‚ä¸è€…è·¯å¾„Attendee**

1. **æ´»åŠ¨å‘ç°**
    - æŸ¥çœ‹æ´»åŠ¨åŸºæœ¬ä¿¡æ¯
    - ç¡®è®¤æ´»åŠ¨çŠ¶æ€(isEventActive)
2. **ç­¾åˆ°æµç¨‹**
    - ä»ç»„ç»‡è€…è·å–ç­¾åæ•°æ®
    - æäº¤v, r, så‚æ•°åˆ°åˆçº¦
    - ç­‰å¾…ç­¾åéªŒè¯å’ŒçŠ¶æ€æ›´æ–°
3. **çŠ¶æ€ç¡®è®¤**
    - éªŒè¯hasAttendedçŠ¶æ€
    - æŸ¥çœ‹ç­¾åˆ°å†å²è®°å½•

![image.png](%E7%AD%BE%E5%90%8D%E9%AA%8C%E8%AF%81%2028c06421268880a1a3b5d1d75cf53398/image.png)

### **b.æ•°æ®åº“ç»“æ„**

**1.åˆçº¦åŸºæœ¬ä¿¡æ¯ï¼ˆContract Basic Informationï¼‰**

| **Contract / åˆçº¦** | **Type / ç±»å‹** | **Bases / åŸºç¡€åˆçº¦** | **å«ä¹‰ / Description** |
| --- | --- | --- | --- |
| SignThis | Implementation / å®ç°åˆçº¦ | None / æ—  | ç­¾åéªŒè¯æ´»åŠ¨åˆçº¦ / Signature Verification Event Contract |

**2.çŠ¶æ€å˜é‡è¡¨ (State Variables Table)**

| **L** | **Field Name / å­—æ®µå** | **Visibility / å¯è§æ€§** | **Mutability / å¯å˜æ€§** | **Data Type / æ•°æ®ç±»å‹** | **Description / æè¿°** |
| --- | --- | --- | --- | --- | --- |
| L | eventName | Public / å…¬å¼€ | view / åªè¯» | string / å­—ç¬¦ä¸² | æ´»åŠ¨åç§° / Event Name |
| L | organizer | Public / å…¬å¼€ | view / åªè¯» | address / åœ°å€ | ç»„ç»‡è€…é’±åŒ…åœ°å€ / Organizer Wallet Address |
| L | eventDate | Public / å…¬å¼€ | view / åªè¯» | uint256 / æ— ç¬¦å·æ•´æ•° | æ´»åŠ¨æ—¥æœŸæ—¶é—´æˆ³ / Event Date Timestamp |
| L | maxAttendees | Public / å…¬å¼€ | view / åªè¯» | uint256 / æ— ç¬¦å·æ•´æ•° | æœ€å¤§å‚ä¸äººæ•° / Maximum Attendee Capacity |
| L | attendeeCount | Public / å…¬å¼€ | view / åªè¯» | uint256 / æ— ç¬¦å·æ•´æ•° | å½“å‰å‚ä¸äººæ•° / Current Attendee Count |
| L | isEventActive | Public / å…¬å¼€ | view / åªè¯» | bool / å¸ƒå°”å€¼ | æ´»åŠ¨æ˜¯å¦æ¿€æ´» / Whether Event is Active |
| L | hasAttended | Public / å…¬å¼€ | view / åªè¯» | mapping(address â‡’ bool) / æ˜ å°„ | å‚ä¸è®°å½•æ˜ å°„è¡¨ / Attendance Record Mapping |

### **3. å‡½æ•°æ¥å£è¡¨ (Function Interfaces Table)**

| **L** | **Function Name / å‡½æ•°å** | **Visibility / å¯è§æ€§** | **Mutability / å¯å˜æ€§** | **Modifiers / ä¿®é¥°å™¨** | **Description / æè¿°** |
| --- | --- | --- | --- | --- | --- |
| L | constructor | Internal / å†…éƒ¨ | state-changing / çŠ¶æ€ä¿®æ”¹ | NO / æ—  | åˆçº¦æ„é€ å‡½æ•° / Contract Constructor |
| L | checkInWithSignature | Public / å…¬å¼€ | state-changing / çŠ¶æ€ä¿®æ”¹ | eventActive | å•ç”¨æˆ·ç­¾åéªŒè¯ç­¾åˆ° / Single User Signature Check-in |
| L | batchCheckIn | Public / å…¬å¼€ | state-changing / çŠ¶æ€ä¿®æ”¹ | eventActive | æ‰¹é‡ç­¾åéªŒè¯ç­¾åˆ° / Batch Signature Check-in |
| L | verifySignature | Public / å…¬å¼€ | view / åªè¯» | NO / æ—  | éªŒè¯ç­¾åæœ‰æ•ˆæ€§ / Verify Signature Validity |
| L | getMessageHash | Public / å…¬å¼€ | view / åªè¯» | NO / æ—  | è·å–æ¶ˆæ¯å“ˆå¸Œå€¼ / Get Message Hash for Signing |
| L | toggleEventStatus | Public / å…¬å¼€ | state-changing / çŠ¶æ€ä¿®æ”¹ | onlyOrganizer | åˆ‡æ¢æ´»åŠ¨çŠ¶æ€ / Toggle Event Status |
| L | getEventInfo | Public / å…¬å¼€ | view / åªè¯» | NO / æ—  | è·å–æ´»åŠ¨å®Œæ•´ä¿¡æ¯ / Get Complete Event Information |

**è¡¥å……è¯´æ˜ï¼š**

**ä¿®é¥°å™¨è¡¨ (Modifiers Table)**

| **L** | **Modifier Name / ä¿®é¥°å™¨å** | **Description / æè¿°** |
| --- | --- | --- |
| L | onlyOrganizer | ä»…ç»„ç»‡è€…å¯è°ƒç”¨ / Only Organizer Can Call |
| L | eventActive | ä»…æ´»åŠ¨æ¿€æ´»çŠ¶æ€å¯è°ƒç”¨ / Only When Event is Active |

**äº‹ä»¶æ—¥å¿—è¡¨ (Event Logs Table)**

| **L** | **Event Name / äº‹ä»¶å** | **Parameters / å‚æ•°** | **Description / æè¿°** |
| --- | --- | --- | --- |
| L | EventCreated | (string name, uint256 date, uint256 maxAttendees) | æ´»åŠ¨åˆ›å»ºäº‹ä»¶ / Event Created |
| L | AttendeeCheckedIn | (address attendee, uint256 timestamp) | å‚ä¸è€…ç­¾åˆ°äº‹ä»¶ / Attendee Checked In |
| L | EventStatusChanged | (bool isActive) | æ´»åŠ¨çŠ¶æ€å˜æ›´äº‹ä»¶ / Event Status Changed |

**å…³é”®æœ¯è¯­è¯´æ˜ (Key Terminology Explanation)**

| **Term / æœ¯è¯­** | **Meaning / å«ä¹‰** | **Description / æè¿°** |
| --- | --- | --- |
| **Visibility / å¯è§æ€§** | è®¿é—®æƒé™æ§åˆ¶ | å®šä¹‰è°å¯ä»¥è°ƒç”¨å‡½æ•°æˆ–è®¿é—®å˜é‡ / Defines who can call functions or access variables |
| **Mutability / å¯å˜æ€§** | çŠ¶æ€ä¿®æ”¹èƒ½åŠ› | view: åªè¯»ä¸ä¿®æ”¹çŠ¶æ€; state-changing: ä¿®æ”¹çŠ¶æ€éœ€è¦Gasè´¹ / view: read-only; state-changing: modifies state and requires Gas |
| **Modifiers / ä¿®é¥°å™¨** | å‡½æ•°ä¿®é¥°æ¡ä»¶ | åœ¨å‡½æ•°æ‰§è¡Œå‰æ£€æŸ¥çš„æ¡ä»¶ / Conditions checked before function execution |
| **Public / å…¬å¼€** | å®Œå…¨å…¬å¼€è®¿é—® | ä»»ä½•è´¦æˆ·éƒ½å¯ä»¥è°ƒç”¨ / Can be called by any account |
| **Internal / å†…éƒ¨** | å†…éƒ¨è®¿é—® | ä»…åˆçº¦å†…éƒ¨æˆ–å…¶ä»–ç»§æ‰¿åˆçº¦å¯è°ƒç”¨ / Only within contract or inherited contracts |
| **State-changing / çŠ¶æ€ä¿®æ”¹** | ä¿®æ”¹åŒºå—é“¾çŠ¶æ€ | éœ€è¦æ”¯ä»˜Gasè´¹ç”¨ï¼Œä¼šäº§ç”Ÿäº¤æ˜“ / Requires Gas fee and creates a transaction |
| **View / åªè¯»** | ä»…è¯»å–çŠ¶æ€ | å…è´¹è°ƒç”¨ï¼Œä¸ä¿®æ”¹çŠ¶æ€ / Free to call, does not modify state |

**æ•°æ®ç±»å‹è¯´æ˜ (Data Types Explanation)**

| **Data Type / æ•°æ®ç±»å‹** | **Description / æè¿°** | **Example / ç¤ºä¾‹** |
| --- | --- | --- |
| string / å­—ç¬¦ä¸² | æ–‡æœ¬æ•°æ®ç±»å‹ / Text data type | "Web3 Conference 2024" |
| address / åœ°å€ | ä»¥å¤ªåŠè´¦æˆ·åœ°å€ / Ethereum account address | 0x742d35Cc6634C0532925a3b8D0C9964E5Bd4f071 |
| uint256 / æ— ç¬¦å·æ•´æ•° | 256ä½æ­£æ•´æ•° / 256-bit positive integer | 1735660800 (æ—¶é—´æˆ³) |
| bool / å¸ƒå°”å€¼ | çœŸ/å‡å€¼ / True/False value | true / false |
| mapping / æ˜ å°„ | é”®å€¼å¯¹å­˜å‚¨ / Key-value storage | address â†’ bool (åœ°å€åˆ°å¸ƒå°”å€¼çš„æ˜ å°„) |

# 2ã€ç»†èŠ‚è¯¦è§£

### **æ ¸å¿ƒæ¦‚å¿µ**

**ï¼ˆ1ï¼‰æ•°å­—ç­¾ååŸç†**ï¼šæ•°å­—ç­¾ååŸºäºæ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼Œæä¾›èº«ä»½éªŒè¯å’Œæ¶ˆæ¯å®Œæ•´æ€§ï¼š

**ğŸ”¹ ç­¾åè¿‡ç¨‹**

1. ç”¨æˆ·ä½¿ç”¨ç§é’¥å¯¹æ¶ˆæ¯å“ˆå¸Œè¿›è¡Œç­¾å
2. ç”Ÿæˆç­¾å (r, s, v) ä¸‰ä¸ªå‚æ•°
3. å°†ç­¾åå’Œæ¶ˆæ¯ä¸€èµ·å‘é€

**ğŸ”¹ éªŒè¯è¿‡ç¨‹**

1. åˆçº¦æ¥æ”¶æ¶ˆæ¯å’Œç­¾å
2. ä½¿ç”¨ecrecoveræ¢å¤ç­¾åè€…åœ°å€
3. éªŒè¯åœ°å€æ˜¯å¦æœ‰æƒé™

**ä¼˜åŠ¿ï¼š**æ— éœ€åœ¨é“¾ä¸Šå­˜å‚¨ç™½åå•ï¼ŒèŠ‚çœGasè´¹ç”¨

**ğŸ”ï¼ˆ2ï¼‰ ecrecover å‡½æ•°**

`ecrecover`æ˜¯Solidityå†…ç½®å‡½æ•°ï¼Œç”¨äºä»ç­¾åæ¢å¤ç­¾åè€…åœ°å€ï¼š

```solidity
function ecrecover(bytes32 hash, uint8 v, bytes32 r, bytes32 s)
    returns (address signer)
```

**å‚æ•°è¯´æ˜ï¼š**

- `hash`: æ¶ˆæ¯çš„keccak256å“ˆå¸Œ
- `v`: æ¢å¤ID (é€šå¸¸æ˜¯27æˆ–28)
- `r, s`: ç­¾åçš„ä¸¤ä¸ªç»„æˆéƒ¨åˆ†

```solidity
// ä½¿ç”¨ç¤ºä¾‹
bytes32 messageHash = keccak256(abi.encodePacked(user, eventId));
bytes32 ethSignedMessageHash = keccak256(abi.encodePacked("\x19Ethereum Signed Message:\n32", messageHash));
address signer = ecrecover(ethSignedMessageHash, v, r, s);
```

ğŸ“ ï¼ˆ3ï¼‰**ä»¥å¤ªåŠç­¾åæ¶ˆæ¯æ ¼å¼**

ä»¥å¤ªåŠé’±åŒ…ç­¾åæ—¶ä¼šè‡ªåŠ¨æ·»åŠ å‰ç¼€ï¼Œé˜²æ­¢ç­¾åé‡æ”¾æ”»å‡»ï¼š

```solidity
// åŸå§‹æ¶ˆæ¯å“ˆå¸Œ
bytes32 messageHash = keccak256(abi.encodePacked(data));

// ä»¥å¤ªåŠç­¾åæ¶ˆæ¯å“ˆå¸Œ
bytes32 ethSignedMessageHash = keccak256(abi.encodePacked(
    "\x19Ethereum Signed Message:\n32",
    messageHash
));
```

**å‰ç¼€ä½œç”¨ï¼š**

- é˜²æ­¢ç”¨æˆ·è¯¯ç­¾äº¤æ˜“æ•°æ®
- åŒºåˆ†ä¸åŒç±»å‹çš„ç­¾å
- æé«˜å®‰å…¨æ€§

âš¡ Gasä¼˜åŒ–ç­–ç•¥

åŸºäºç­¾åçš„è®¿é—®æ§åˆ¶ç›¸æ¯”ä¼ ç»Ÿç™½åå•æœ‰æ˜¾è‘—çš„Gasä¼˜åŠ¿ï¼š

**âœ… ç­¾åæ–¹å¼**

- æ— éœ€å­˜å‚¨ç”¨æˆ·åˆ—è¡¨
- éªŒè¯æˆæœ¬å›ºå®š (~3000 gas)
- æ”¯æŒæ— é™ç”¨æˆ·
- åŠ¨æ€æƒé™ç®¡ç†

**âŒ ä¼ ç»Ÿç™½åå•**

- æ¯ä¸ªç”¨æˆ·éœ€è¦å­˜å‚¨ (~20000 gas)
- æŸ¥è¯¢æˆæœ¬éšç”¨æˆ·å¢åŠ 
- ä¿®æ”¹ç™½åå•éœ€è¦äº¤æ˜“
- å­˜å‚¨æˆæœ¬é«˜

### **åˆ†è§£ä»£ç **

### **æ‹†è§£çš„åˆçº¦ï¼š`EventEntry.sol`**

```jsx
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract EventEntry {
    string public eventName;
    address public organizer;
    uint256 public eventDate;
    uint256 public maxAttendees;
    uint256 public attendeeCount;
    bool public isEventActive;

    mapping(address => bool) public hasAttended;

    event EventCreated(string name, uint256 date, uint256 maxAttendees);
    event AttendeeCheckedIn(address attendee, uint256 timestamp);
    event EventStatusChanged(bool isActive);

    constructor(string memory _eventName, uint256 _eventDate_unix, uint256 _maxAttendees) {
        eventName = _eventName;
        eventDate = _eventDate_unix;
        maxAttendees = _maxAttendees;
        organizer = msg.sender;
        isEventActive = true;

        emit EventCreated(_eventName, _eventDate_unix, _maxAttendees);
    }

    modifier onlyOrganizer() {
        require(msg.sender == organizer, "Only the event organizer can call this function");
        _;
    }

    function setEventStatus(bool _isActive) external onlyOrganizer {
        isEventActive = _isActive;
        emit EventStatusChanged(_isActive);
    }

    function getMessageHash(address _attendee) public view returns (bytes32) {
        return keccak256(abi.encodePacked(address(this), eventName, _attendee));
    }

    function getEthSignedMessageHash(bytes32 _messageHash) public pure returns (bytes32) {
        return keccak256(abi.encodePacked("\x19Ethereum Signed Message:\n32", _messageHash));
    }

    function verifySignature(address _attendee, bytes memory _signature) public view returns (bool) {
        bytes32 messageHash = getMessageHash(_attendee);
        bytes32 ethSignedMessageHash = getEthSignedMessageHash(messageHash);
        return recoverSigner(ethSignedMessageHash, _signature) == organizer;
    }

    function recoverSigner(bytes32 _ethSignedMessageHash, bytes memory _signature)
        public
        pure
        returns (address)
    {
        require(_signature.length == 65, "Invalid signature length");

        bytes32 r;
        bytes32 s;
        uint8 v;

        assembly {
            r := mload(add(_signature, 32))
            s := mload(add(_signature, 64))
            v := byte(0, mload(add(_signature, 96)))
        }

        if (v < 27) {
            v += 27;
        }

        require(v == 27 || v == 28, "Invalid signature 'v' value");

        return ecrecover(_ethSignedMessageHash, v, r, s);
    }

    function checkIn(bytes memory _signature) external {
        require(isEventActive, "Event is not active");
        require(block.timestamp <= eventDate + 1 days, "Event has ended");
        require(!hasAttended[msg.sender], "Attendee has already checked in");
        require(attendeeCount < maxAttendees, "Maximum attendees reached");
        require(verifySignature(msg.sender, _signature), "Invalid signature");

        hasAttended[msg.sender] = true;
        attendeeCount++;

        emit AttendeeCheckedIn(msg.sender, block.timestamp);
    }
}
```

è¯¥åˆåŒä¸“ä¸ºä¼šè®®ã€ç ”è®¨ä¼šæˆ–ç§äººèšä¼šç­‰ Web3 æ´»åŠ¨è€Œè®¾è®¡ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬æ²¡æœ‰åœ¨é“¾ä¸Šå­˜å‚¨ä¸€é•¿ä¸²ç™½åå•åœ°å€ï¼ˆè¿™éœ€è¦ Gas ä¸”ä¸å¯æ‰©å±•ï¼‰ï¼Œè€Œæ˜¯åšä¸€äº›æ›´èªæ˜çš„äº‹æƒ…ã€‚

è¯€çªå¦‚ä¸‹ï¼š

 æ´»åŠ¨ç»„ç»‡è€…ä¸ºæ¯ä¸ªæ‰¹å‡†çš„ä¸ä¼šè€…ç­¾ç½²é“¾ä¸‹æ¶ˆæ¯ã€‚

 ç„¶åï¼Œä¸ä¼šè€…å°†ç­¾åæ¶ˆæ¯å¸¦åˆ°é“¾ä¸Šä»¥**è¯æ˜**ä»–ä»¬å·²è¢«é‚€è¯·ã€‚

æ— éœ€é¢„å…ˆå­˜å‚¨ä»»ä½•ä¸œè¥¿ã€‚æ™ºèƒ½åˆçº¦ä½¿ç”¨ `ecrecover` éªŒè¯ç­¾åã€‚

è¿™æ˜¯é«˜æ•ˆã€å®‰å…¨çš„ï¼Œå¹¶ä¸”åæ˜ äº† IRL é—¨ç¥¨æˆ–äºŒç»´ç çš„å·¥ä½œæ–¹å¼â€”â€”ä½†åœ¨é“¾ä¸Šã€‚

### **ï¼ˆ1ï¼‰åˆåŒå£°æ˜Contract Declaration**

```jsx
pragma solidity ^0.8.17;

contract EventEntry {
```

æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ Solidity ç‰ˆæœ¬ 0.8.17 å¹¶åˆ›å»ºä¸€ä¸ªåä¸º EventEntry çš„åˆçº¦ã€‚ç®€å•çš„å¼€å§‹ã€‚

### **ï¼ˆ2ï¼‰äº‹ä»¶è¯¦ç»†ä¿¡æ¯å’ŒçŠ¶æ€å˜é‡Event Details & State Variables**

åœ¨æˆ‘ä»¬æ·±å…¥äº†è§£æ™ºèƒ½åˆçº¦çš„æ ¸å¿ƒé€»è¾‘ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é€€åä¸€æ­¥é—®ä¸€ä¸ªç®€å•çš„é—®é¢˜ï¼š

Web3 äº‹ä»¶å®é™…ä¸Šéœ€è¦åœ¨é“¾ä¸Šç®¡ç†ä»€ä¹ˆï¼Ÿ

æˆ‘ä»¬ä¸ä»…ä»…æ˜¯åœ¨ç¼–å†™ä¸€ä¸ªé€šç”¨çš„å‡ºå¸­è·Ÿè¸ªå™¨â€”â€”æˆ‘ä»¬æ­£åœ¨ä¸ºæ´»åŠ¨æ„å»ºä¸€ä¸ª**åŸºäºç­¾åã€Gas ä¼˜åŒ–çš„ç§äººè®¿é—®ç³»ç»Ÿ** ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦è·Ÿè¸ªä»¥ä¸‹å†…å®¹ï¼š

- æ´»åŠ¨å†…å®¹
- è°è´Ÿè´£
- å½“å®ƒå‘ç”Ÿæ—¶
- å¯å‚åŠ äººæ•°
- è°å·²ç»ç­¾åˆ°äº†
- å¤§é—¨æ˜¯å¦è¿˜å¼€ç€

è®©æˆ‘ä»¬çœ‹çœ‹æ‰€æœ‰è¿™äº›æ˜¯å¦‚ä½•å­˜å‚¨åœ¨åˆçº¦ä¸­çš„ã€‚

```jsx
string public eventName;
address public organizer;
uint256 public eventDate;
uint256 public maxAttendees;
uint256 public attendeeCount;
bool public isEventActive;
```

è¿™å…­ä¸ªå˜é‡å®šä¹‰**äº†æ´»åŠ¨çš„ä¸€åˆ‡** â€”â€”ä»è°è´Ÿè´£åˆ°æœ‰å¤šå°‘äººå¯ä»¥å‚åŠ ã€‚è®©æˆ‘ä»¬é€è¡Œé€å¥åœ°æµè§ˆä¸€ä¸‹ï¼š

```jsx
string public eventName;
```

è¿™æ˜¯ä½ æ´»åŠ¨çš„**äººç±»å¯è¯»åç§°human-readable name** â€”â€”ä¾‹å¦‚ `â€œEthConf 2025â€` æˆ– `â€œToken-Gated Summitâ€`ã€‚

ç”±äºå®ƒè¢«æ ‡è®°ä¸º**å…¬å…±public** ï¼ŒSolidity ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª getter å‡½æ•°ã€‚

ä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨ `eventNameï¼ˆï¼‰` æ¥è·å–æ­¤å€¼â€”â€”éå¸¸é€‚åˆå‰ç«¯æˆ–æµè§ˆå™¨æ˜¾ç¤ºäº‹ä»¶çš„æ ‡é¢˜ã€‚

```jsx
address public organizer;
```

è¿™æ˜¯**äº‹ä»¶ç»„ç»‡è€…ï¼ˆ** éƒ¨ç½²åˆçº¦çš„ä¸ªäººæˆ–å®ä½“ï¼‰çš„ä»¥å¤ªåŠåœ°å€ã€‚

åªæœ‰è¿™ä¸ªåœ°å€æ‰èƒ½**ç­¾ç½²ä¸ä¼šè€…æ‰¹å‡†** ï¼ˆé“¾ä¸‹ï¼‰ã€‚

åªæœ‰æ­¤åœ°å€å¯ä»¥**æ›´æ”¹äº‹ä»¶çŠ¶æ€**  ï¼ˆ`setEventStatusï¼ˆï¼‰`ï¼‰ã€‚

è¿™ä½¿å¾—ç»„ç»‡è€…æˆä¸ºæ•´ä¸ªç³»ç»Ÿçš„çœ‹é—¨äººã€‚

```jsx
uint256 public eventDate;
```

è¿™ä¿å­˜äº†**äº‹ä»¶çš„è®¡åˆ’æ—¥æœŸevent's scheduled date** ï¼Œä»¥ **Unix æ—¶é—´æˆ³**è¡¨ç¤ºã€‚

ç¤ºä¾‹ï¼š`1714569600` â†’ 2024 å¹´ 4 æœˆ 30 æ—¥ 00ï¼š00ï¼š00 UTC

å®ƒç”¨äº `checkInï¼ˆï¼‰` å‡½æ•°ï¼Œä»¥ç¡®ä¿äººä»¬ä¸ä¼šç­¾åˆ°å¤ªæ™šã€‚

è¯¥åˆåŒå…è®¸åœ¨ `eventDate + 1 å¤©`ä¹‹å‰ç­¾åˆ°ï¼Œä»¥å…è®¸æ—¶åŒºå’Œå»¶è¿Ÿçµæ´»æ€§ã€‚

å› æ­¤ï¼Œåœ¨å®è·µä¸­ï¼Œäº‹ä»¶åœ¨æ­¤æ—¶é—´æˆ³åä¸€å¤©**å…³é—­** ã€‚

```jsx
uint256 public maxAttendees;
```

è¿™å¯¹å¯ä»¥ç­¾åˆ°çš„äººæ•°è®¾å®šäº†**ç¡¬æ€§ä¸Šé™hard cap** ã€‚

å¦‚æœè®¾ç½®ä¸º `100`ï¼Œåˆ™åªæœ‰ 100 ä¸ªå”¯ä¸€åœ°å€å¯ä»¥æˆåŠŸç­¾å…¥ã€‚

å¯¹äºç®¡ç†ç§äººæ´»åŠ¨ä¸­çš„æœ‰é™åº§ä½ã€ç‰©ç†é™åˆ¶æˆ–è®¿é—®æ§åˆ¶éå¸¸æœ‰ç”¨ã€‚

```jsx
uint256 public attendeeCount;
```

è¿™ä¼šä¿ç•™å·²ç»ç­¾åˆ°çš„äººæ•°çš„**è¿è¡Œæ€»æ•°**  **running total**ã€‚

ä» `0` å¼€å§‹

æ¯æ¬¡æ–°ç”¨æˆ·æˆåŠŸç­¾å…¥æ—¶é€’å¢ 1

ç”¨äºå¼ºåˆ¶å®æ–½ `maxAttendees` è§„åˆ™

```jsx
bool public isEventActive;
```

æ­¤å˜é‡ç¡®å®šäº‹ä»¶**å½“å‰æ˜¯å¦æ¥å—ç­¾å…¥** ã€‚

éƒ¨ç½²åˆçº¦æ—¶è®¾ç½®ä¸º `true`

å¯ä»¥ç”±ç»„ç»‡è€…ä½¿ç”¨ `setEventStatusï¼ˆboolï¼‰` æ‰“å¼€/å…³é—­

åœ¨äº‹ä»¶å¤„äºéæ´»åŠ¨çŠ¶æ€æ—¶é˜»æ­¢ç­¾å…¥

### **(3)è€ƒå‹¤è·Ÿè¸ªAttendance Tracking**

```jsx
mapping(address => bool) public hasAttended;
```

æˆ‘ä»¬ä½¿ç”¨æ­¤æ˜ å°„æ¥**è·Ÿè¸ªè°å·²ç»ç­¾åˆ°** ï¼Œå› æ­¤æ²¡æœ‰äººå¯ä»¥ç­¾åˆ°ä¸¤æ¬¡ã€‚

### ****

### **(4)äº‹ä»¶Events**

[ğŸ“¢](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

```jsx
event EventCreated(string name, uint256 date, uint256 maxAttendees);
event AttendeeCheckedIn(address attendee, uint256 timestamp);
event EventStatusChanged(bool isActive);
```

æˆ‘ä»¬å‘å‡ºä»¥ä¸‹äº‹ä»¶æ˜¯ä¸ºäº†æé«˜é€æ˜åº¦å’Œå‰ç«¯é›†æˆï¼š

`EventCreated`ï¼šåœ¨éƒ¨ç½²æœŸé—´å‘å‡ºä¸€æ¬¡ã€‚

`AttendeeCheckedIn`ï¼šæ¯æ¬¡æœ‰äººæˆåŠŸç­¾åˆ°æ—¶è§¦å‘ã€‚

`EventStatusChanged`ï¼šå…è®¸ç»„ç»‡è€…æš‚åœ/æ¢å¤äº‹ä»¶ã€‚

### ****

### **(5)æ„é€ å‡½æ•°ï¼šéƒ¨ç½²æ—¶è®¾ç½® Constructor: Setup at Deployment**

[ğŸ—ï¸](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

```jsx
constructor(string memory _eventName, uint256 _eventDate_unix, uint256 _maxAttendees) {
    eventName = _eventName;
    eventDate = _eventDate_unix;
    maxAttendees = _maxAttendees;
    organizer = msg.sender;
    isEventActive = true;

    emit EventCreated(_eventName, _eventDate_unix, _maxAttendees);
}
```

`æ„é€ å‡½æ•°`å°±åƒå®‰è£…å‘å¯¼ï¼Œåœ¨éƒ¨ç½²åˆçº¦æ—¶è¿è¡Œä¸€æ¬¡â€”â€”è€Œä¸”åªè¿è¡Œä¸€æ¬¡ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ¯è¡Œçš„ä½œç”¨ä»¥åŠä¸ºä»€ä¹ˆå®ƒå¾ˆé‡è¦ï¼š

```jsx
eventName = _eventName;
```

è¿™ä¼šå­˜å‚¨æ‚¨çš„æ´»åŠ¨çš„äººç±»å¯è¯»åç§°ï¼ˆä¾‹å¦‚ï¼Œâ€œ`Web3Conf 2025`â€ï¼‰ã€‚å®ƒä½œä¸ºæ„é€ å‡½æ•°å‚æ•°ä¼ å…¥å¹¶ä¿å­˜åœ¨é“¾ä¸Šï¼Œä»¥ä¾¿ä»»ä½•äººéƒ½å¯ä»¥ç¨åä½¿ç”¨ `eventNameï¼ˆï¼‰` å‡½æ•°æŸ¥è¯¢å®ƒã€‚

```jsx
eventDate = _eventDate_unix;
```

è¿™è®¾ç½®äº†å®˜æ–¹æ´»åŠ¨æ—¥æœŸâ€”â€”ä½†å®ƒä¸æ˜¯åƒâ€œ2025 å¹´ 4 æœˆ 21 æ—¥â€ è¿™æ ·çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚å®ƒæ˜¯ä¸€ä¸ª **Unix æ—¶é—´æˆ³** ï¼ˆå¦‚ `1745251200`ï¼‰ï¼Œè¿™ä½¿å¾—åœ¨ Solidity ä¸­è¿›è¡Œæ—¶é—´æ¯”è¾ƒå˜å¾—æ›´åŠ å®¹æ˜“ã€‚

ç¨åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥æ£€æŸ¥äº‹ä»¶æ˜¯å¦ä»åœ¨è¿›è¡Œæˆ–å·²ç»ç»“æŸã€‚

```jsx
maxAttendees = _maxAttendees;
```

è¿™ä¸ºå¯ä»¥å‚åŠ çš„äººæ•°è®¾å®šäº†ä¸Šé™ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ€å¤§å€¼ä¸º 150ï¼Œåˆ™ç¬¬ 151 äººå°†åœ¨å…¥ä½æ—¶è¢«æ‹’ç»ã€‚

æ‹¥æœ‰æ­¤å†…ç½®é™åˆ¶æœ‰åŠ©äºé˜²æ­¢è¿‡åº¦æ‹¥æŒ¤ã€åƒåœ¾é‚®ä»¶æˆ–æ»¥ç”¨ã€‚

```jsx
organizer = msg.sender;
```

è¿™ä¼šå°†éƒ¨ç½²åˆåŒçš„äººå‘˜è®¾ç½®ä¸º**äº‹ä»¶ç»„ç»‡è€…** ã€‚

`msg.sender` æ˜¯æŒ‡éƒ¨ç½²åˆçº¦çš„åœ°å€ã€‚

è¯¥åœ°å€å…·æœ‰ç‰¹æ®Šèƒ½åŠ›ï¼Œä¾‹å¦‚æ¿€æ´»/åœç”¨äº‹ä»¶ã€‚

å®ƒä¹Ÿæ˜¯**å”¯ä¸€**åº”è¯¥å…è®¸ç­¾ç½²é‚€è¯·ç­¾åçš„åœ°å€ï¼Œæˆ‘ä»¬ç¨åä¼šéªŒè¯ã€‚

```jsx
isEventActive = true;
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ´»åŠ¨ä»¥æ´»åŠ¨çŠ¶æ€å¼€å§‹ï¼Œè¿™æ„å‘³ç€é™¤éç»„ç»‡è€…æ‰‹åŠ¨ç¦ç”¨å®ƒï¼Œå¦åˆ™å…è®¸ç­¾åˆ°ã€‚

ç¨åæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåä¸º `setEventStatusï¼ˆï¼‰` çš„å‡½æ•°ï¼Œè®©ç»„ç»‡è€…åˆ‡æ¢æ­¤æ ‡å¿—ã€‚

`emit EventCreated(...)`

è¿™è¡Œå‘åŒºå—é“¾å¹¿æ’­äº‹ä»¶ï¼Œè¡¨æ˜è¯¥äº‹ä»¶å·²åˆ›å»ºã€‚

ä¸ºä»€ä¹ˆè¦å‘å‡ºäº‹ä»¶ï¼Ÿ

å®ƒå¯ä»¥å¸®åŠ©é“¾ä¸‹åº”ç”¨ç¨‹åºï¼ˆå¦‚å‰ç«¯æˆ–æµè§ˆå™¨ï¼‰çŸ¥é“å·²ç»æ³¨å†Œäº†æ–°äº‹ä»¶ã€‚

å®ƒè®°å½•æœ‰ç”¨çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚åç§°ã€æ—¥æœŸå’Œæœ€å¤§å®¹é‡ã€‚

### **ï¼ˆ6ï¼‰å­˜å–æ§åˆ¶Access Control**

```jsx
modifier onlyOrganizer() {
    require(msg.sender == organizer, "Only the event organizer can call this function");
    _;
}
```

ä¿æŠ¤æŸäº›åŠŸèƒ½çš„ä¾¿æ·**ä¿®é¥°ç¬¦** ã€‚åªæœ‰ç»„ç»‡è€…å¯ä»¥å‘¼å«ä»–ä»¬ã€‚

### **ï¼ˆ7ï¼‰ åˆ‡æ¢äº‹ä»¶çŠ¶æ€Toggle Event Status**

[ğŸ”](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

```jsx
function setEventStatus(bool _isActive) external onlyOrganizer {
    isEventActive = _isActive;
    emit EventStatusChanged(_isActive);
}
```

ä½¿ç”¨æ­¤é€‰é¡¹å¯ä»¥**æš‚åœæˆ–æ¢å¤**ç­¾å…¥ã€‚æ‚¨å¯èƒ½å¸Œæœ›åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¹‹åå†»ç»“ç­¾åˆ°ã€‚

### ****

### **ï¼ˆ8ï¼‰æ¶ˆæ¯æ•£åˆ— â€” ç­¾åçš„å…³é”®Message Hashing â€” Key to Signatures**

[ğŸ”](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

```jsx
function getMessageHash(address _attendee) public view returns (bytes32) {
    return keccak256(abi.encodePacked(address(this), eventName, _attendee));
}
```

æ­¤åŠŸèƒ½ä½¿**ç»„ç»‡è€…**èƒ½å¤Ÿæ§åˆ¶æ´»åŠ¨å½“å‰æ˜¯å¦æ¥å—ç­¾åˆ°ã€‚

**å®ƒèƒ½åšä»€ä¹ˆï¼š**

[ğŸ§±](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

     **`onlyOrganizer` ä¿®é¥°ç¬¦ï¼š**

      ç¡®ä¿åªæœ‰éƒ¨ç½²åˆåŒçš„äººå‘˜ï¼ˆ **ç»„ç»‡è€…** ï¼‰æ‰èƒ½æ›´æ”¹æ­¤è®¾ç½®ã€‚è¿™å¯ä»¥é˜²æ­¢éšæœºç”¨æˆ·æš‚åœæˆ–æ¢å¤äº‹ä»¶ã€‚

**`isEventActive = _isActive;`**

            æ ¹æ®ä¼ é€’çš„å‚æ•°æ›´æ–°äº‹ä»¶çš„æ´»åŠ¨çŠ¶æ€ï¼š

            å¦‚æœ `_isActive` ä¸º `true`ï¼Œåˆ™äº‹ä»¶ä¸ºæ‰“å¼€ã€‚

            å¦‚æœ `_isActive` ä¸º `false`ï¼Œåˆ™ç­¾å…¥å°†æš‚æ—¶æš‚åœã€‚

**`emit EventStatusChangedï¼ˆ_isActiveï¼‰`;**

 æ¯æ¬¡çŠ¶æ€å˜åŒ–æ—¶éƒ½ä¼šå‘å‡ºé“¾ä¸Šäº‹ä»¶â€”â€”å¯¹äºå‰ç«¯ä»ªè¡¨æ¿æˆ–åŒºå—é“¾æµè§ˆå™¨ç«‹å³åæ˜ å˜åŒ–å¾ˆæœ‰ç”¨ã€‚

### **ï¼ˆ9ï¼‰ä»¥å¤ªåŠç­¾åæ¶ˆæ¯å“ˆå¸ŒEthereum Signed Message Hash**

[âœï¸](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

```jsx
function getEthSignedMessageHash(bytes32 _messageHash) public pure returns (bytes32) {
    return keccak256(abi.encodePacked("\x19Ethereum Signed Message:\n32", _messageHash));
}
```

æ­¤åŠŸèƒ½æ˜¯ä»¥å¤ªåŠç­¾åéªŒè¯ç³»ç»Ÿ**çš„é‡è¦ç»„æˆéƒ¨åˆ†** â€”â€”è¿™å°±æ˜¯å®ƒå­˜åœ¨çš„åŸå› ã€‚

 ****

**ä¸ºä»€ä¹ˆå­˜åœ¨è¿™ä¸ªå‡½æ•°**

[ğŸ§ ](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

     å½“ç”¨æˆ·åœ¨é“¾ä¸‹ç­¾ç½²æ•°æ®ï¼ˆå¦‚æ¶ˆæ¯çš„å“ˆå¸Œï¼‰æ—¶ï¼Œä»æŠ€æœ¯ä¸Šè®²ï¼Œä»–ä»¬æ­£åœ¨ç­¾ç½²**ä»»ä½•éšæœºçš„ 32 å­—èŠ‚** ã€‚è¿™å¯èƒ½åŒ…æ‹¬äº¤æ˜“çš„å“ˆå¸Œå€¼ã€åˆçº¦çš„å“ˆå¸Œå€¼æˆ–ä¸€äº›å®Œå…¨ä¸ç›¸å…³çš„æ•°æ®ã€‚

è¿™å¸¦æ¥äº†é£é™©ï¼š

     å¦‚æœæœ‰äººè¯±éª—ç”¨æˆ·åœ¨é“¾ä¸‹ç­¾ç½²æŸäº›å†…å®¹ï¼Œç„¶ååœ¨é“¾ä¸Šé‡å¤ä½¿ç”¨è¯¥ç­¾åæ¥åšä¸€äº›æ¶æ„çš„äº‹æƒ…æ€ä¹ˆåŠï¼Ÿ

ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œä»¥å¤ªåŠå¼•å…¥äº†ä¸€ä¸ª**ä¿æŠ¤æ€§å‰ç¼€** ã€‚

### ****

### **ï¼ˆ10ï¼‰å‡½æ•°çš„ä½œç”¨**

[ğŸ”](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

è¿™è¡Œï¼š

```jsx
keccak256(abi.encodePacked("\x19Ethereum Signed Message:\n32", _messageHash));
```

è·å–åŸå§‹æ¶ˆæ¯å“ˆå¸Œå¹¶**ç”¨å‰ç¼€åŒ…è£…å®ƒ** ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```jsx
"\x19Ethereum Signed Message:\n32" + original_hash
```

ç„¶åå®ƒä½¿ç”¨ `keccak256` å†æ¬¡å¯¹æ•´ä¸ªäº‹æƒ…è¿›è¡Œå“ˆå¸Œå¤„ç†ã€‚

è¿™è¢«ç§°ä¸º**ä»¥å¤ªåŠç­¾åæ¶ˆæ¯å“ˆå¸Œ** ï¼Œå®ƒæ˜¯åƒ MetaMask è¿™æ ·çš„é’±åŒ…åœ¨ä½ è°ƒç”¨ `eth_sign` æ—¶ä½¿ç”¨çš„**ç¡®åˆ‡æ ¼å¼** ã€‚

 **ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦ï¼Ÿ**

[ğŸ”„](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

å› ä¸ºå½“æˆ‘ä»¬ç¨åä½¿ç”¨ `ecrecoverï¼ˆï¼‰` æ¢å¤**ç­¾åè€…çš„åœ°å€**æ—¶ï¼Œæˆ‘ä»¬å°†ä»è¿™ä¸ª**å‰ç¼€åŒ…è£…çš„å“ˆå¸Œä¸­**æ¢å¤å®ƒï¼Œè€Œä¸æ˜¯åŸå§‹å“ˆå¸Œã€‚

å¦‚æœæ‚¨æ²¡æœ‰æ­£ç¡®åŒ…è£…å®ƒï¼ŒéªŒè¯æ­¥éª¤å°†å¤±è´¥ - å³ä½¿ç”¨æˆ·æ­£ç¡®ç­¾åï¼

### 

### **ï¼ˆ11ï¼‰ ç­¾åéªŒè¯Signature Verification**

[ğŸ•µï¸â€â™‚ï¸](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

```jsx
function verifySignature(address _attendee, bytes memory _signature) public view returns (bool) {
    bytes32 messageHash = getMessageHash(_attendee);
    bytes32 ethSignedMessageHash = getEthSignedMessageHash(messageHash);
    return recoverSigner(ethSignedMessageHash, _signature) == organizer;
}
```

æ­¤åŠŸèƒ½æ˜¯æˆ‘ä»¬**é‚€è¯·éªŒè¯ç³»ç»Ÿ**çš„æ ¸å¿ƒã€‚å®ƒå›ç­”äº†ä¸€ä¸ªç®€å•ä½†æœ‰åŠ›çš„é—®é¢˜ï¼š

â€œè¿™ä¸ªç­¾åçœŸçš„æ˜¯ç”±ç»„ç»‡è€…åˆ›å»ºçš„å—â€”â€”å®ƒæ˜¯ä¸ºè¿™ä½ä¸ä¼šè€…å‡†å¤‡çš„å—ï¼Ÿâ€

è®©æˆ‘ä»¬é€è¡Œåˆ†è§£ã€‚

 **ç¬¬ 1 æ­¥ï¼šç”ŸæˆåŸºæœ¬æ¶ˆæ¯å“ˆå¸Œ**

[âœ…](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

```jsx
bytes32 messageHash = getMessageHash(_attendee);
```

è¿™ä¼šé‡æ–°åˆ›å»º**ç»„ç»‡è€…**ä¸ºç‰¹å®šä¸ä¼šè€…åœ¨é“¾ä¸‹ç­¾åçš„ç¡®åˆ‡å“ˆå¸Œå€¼ã€‚

è¯¥å“ˆå¸Œå€¼é€šå¸¸ç±»ä¼¼äºï¼š

```jsx
keccak256(contract address + event name + attendee address)
```

è¿™ç¡®ä¿äº†ï¼š

ç­¾åä¸**æ­¤ç‰¹å®šåˆçº¦ç›¸å…³è”**

ä»…å¯¹**æ­¤æ´»åŠ¨**æœ‰æ•ˆ

å®ƒå±äº**è¿™ä¸ªç¡®åˆ‡çš„ç”¨æˆ·**

å¦‚æœæœ‰ä»€ä¹ˆä¸åŒâ€”â€”ä¸åŒçš„ä¸ä¼šè€…ã€ä¸åŒçš„æ´»åŠ¨â€”â€”å“ˆå¸Œå€¼å°±ä¼šå‘ç”Ÿå˜åŒ–ã€‚

 **ç¬¬ 2 æ­¥ï¼šè½¬æ¢ä¸ºä»¥å¤ªåŠç­¾åæ ¼å¼**

[âœ…](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

```jsx
bytes32 ethSignedMessageHash = getEthSignedMessageHash(messageHash);
```

æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€è§£é‡Šçš„ï¼Œè¿™ç”¨ä»¥å¤ªåŠçš„æ ‡å‡†å‰ç¼€åŒ…è£…äº†æ¶ˆæ¯å“ˆå¸Œï¼š

```jsx
"\x19Ethereum Signed Message:\n32" + messageHash
```

ä¸ºä»€ä¹ˆï¼Ÿ

å› ä¸ºåƒ MetaMask è¿™æ ·çš„é’±åŒ…åœ¨ç­¾åæ—¶ä¼šè‡ªåŠ¨æ·»åŠ è¯¥å‰ç¼€â€”â€”æ‰€ä»¥æˆ‘ä»¬åœ¨éªŒè¯æ—¶ä¹Ÿéœ€è¦åŒ…å«å®ƒï¼Œå¦åˆ™æ£€æŸ¥å°†å¤±è´¥ã€‚

 **ç¬¬ 3 æ­¥ï¼šæ¢å¤ç­¾åè€…**

[âœ…](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

```jsx
return recoverSigner(ethSignedMessageHash, _signature) == organizer;
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ï¼š

ä½¿ç”¨ `ecrecoverï¼ˆï¼‰`ï¼ˆ é€šè¿‡è¾…åŠ©å‡½æ•° `recoverSigner`ï¼‰æå–ç­¾å**æ¶ˆæ¯çš„åœ°å€** ã€‚

å°†è¯¥åœ°å€ä¸`ç»„ç»‡è€…` ï¼ˆéƒ¨ç½²æ­¤åˆçº¦çš„åœ°å€ï¼‰è¿›è¡Œæ¯”è¾ƒã€‚

å¦‚æœåŒ¹é…ï¼š  ç­¾åæœ‰æ•ˆ

å¦‚æœæ²¡æœ‰ï¼š  æœ‰äººä¼ªé€ æˆ–ç”±å…¶ä»–äººç­¾å

[âœ…](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

[âŒ](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

### **ï¼ˆ12ï¼‰recoverSigner â€“ å¯†ç ä¾¦æ¢ The Cryptographic Detective**

[ğŸ”](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

è¿™æ˜¯åˆçº¦ä¸­çš„å®é™…å‡½æ•°ï¼š

```jsx
function recoverSigner(bytes32 _ethSignedMessageHash, bytes memory _signature)
    public
    pure
    returns (address)
{
    require(_signature.length == 65, "Invalid signature length");

    bytes32 r;
    bytes32 s;
    uint8 v;

    assembly {
        r := mload(add(_signature, 32))
        s := mload(add(_signature, 64))
        v := byte(0, mload(add(_signature, 96)))
    }

    if (v < 27) {
        v += 27;
    }

    require(v == 27 || v == 28, "Invalid signature 'v' value");

    return ecrecover(_ethSignedMessageHash, v, r, s);
}
```

æ­¤åŠŸèƒ½æ˜¯æˆ‘ä»¬åŸºäºç­¾åçš„è¾“å…¥ç³»ç»Ÿä¸­çš„**æœ€åä¸€ä¸ªä¾¦æ¢æ­¥éª¤** ã€‚å®ƒæŸ¥çœ‹ç­¾åå¹¶æ‰¾å‡º**å“ªä¸ªä»¥å¤ªåŠåœ°å€ç­¾ç½²äº†å®ƒ** ã€‚

å‡è®¾æœ‰äººç»™äº†æˆ‘ä»¬ä¸€ä¸ªç­¾åå¹¶å£°ç§°ï¼š

â€œè¿™æ˜¯ç”±æ´»åŠ¨ç»„ç»‡è€…ç­¾ç½²çš„ã€‚è¿™æ„å‘³ç€æˆ‘è¢«å…è®¸å‚åŠ æ´»åŠ¨ã€‚

ä½†æˆ‘ä»¬ä¸èƒ½ç›²ç›®ç›¸ä¿¡ä»–ä»¬ã€‚æˆ‘ä»¬éœ€è¦**éªŒè¯**æ˜¯å¦ï¼š

è¯¥ç­¾åæ˜¯æœ‰æ•ˆçš„ã€‚

å®ƒçœŸçš„æ¥è‡ª**ç»„ç»‡è€…çš„é’±åŒ…** ã€‚

è¿™ä¸ªå‡½æ•°å¯ä»¥å¸®åŠ©æˆ‘ä»¬åšåˆ°è¿™ä¸€ç‚¹ã€‚

 **ç¬¬ 1 æ­¥ï¼šæ£€æŸ¥ç­¾åé•¿åº¦**

[ğŸ“](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

```jsx
require(_signature.length == 65, "Invalid signature length");
```

æ‰€æœ‰ä»¥å¤ªåŠç­¾åçš„**é•¿åº¦éƒ½æ˜¯ 65 å­—èŠ‚** â€”â€”ä¸å¤šä¹Ÿä¸å°‘ã€‚

å¦‚æœå®ƒæ›´çŸ­æˆ–æ›´é•¿ï¼Œåˆ™å¯èƒ½æ˜¯æŸåçš„ã€ä¸å®Œæ•´çš„æˆ–å‡çš„ã€‚

æ‰€ä»¥å¦‚æœé•¿åº¦ä¸å¯¹ï¼Œæˆ‘ä»¬ä¼šç«‹å³åœæ­¢ã€‚

 **ç¬¬ 2 æ­¥ï¼šå°†ç­¾ååˆ†æˆ 3 ä¸ªéƒ¨åˆ†**

[ğŸ“¦](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

ä»¥å¤ªåŠç­¾åä¸ä»…ä»…æ˜¯ä¸€å¤§å—â€”â€”å®ƒä»¬ç”± 3 ä¸ªéƒ¨åˆ†ç»„æˆï¼Œç§°ä¸ºï¼š

`r`ï¼ˆ32 å­—èŠ‚ï¼‰

`s`ï¼ˆ32 å­—èŠ‚ï¼‰

`v`ï¼ˆ1 å­—èŠ‚ï¼‰

è¿™ä¸‰ä¸ªå€¼ååŒå·¥ä½œï¼Œä»¥**æ•°å­¦æ–¹å¼è¯æ˜è°ç­¾ç½²äº†é‚®ä»¶** ã€‚

ç°åœ¨ï¼Œäº‹æƒ…å˜å¾—æœ‰ç‚¹æŠ€æœ¯æ€§äº†......

 **ç¬¬ 3æ­¥ï¼šä½¿ç”¨ç¨‹åºé›†æå–è¿™äº›å€¼**

[ğŸ§™](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

```jsx
assembly {
    r := mload(add(_signature, 32))
    s := mload(add(_signature, 64))
    v := byte(0, mload(add(_signature, 96)))
}
```

æ±‡ç¼–æ˜¯ä¸€ç§ç›´æ¥ä»å†…å­˜è®¿é—®æ•°æ®çš„ä½çº§æ–¹æ³•ã€‚

å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆæŒ–ä¸€ä¸ªç›’å­ï¼Œå‡†ç¡®åœ°æ‹¿å‡ºæˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿ã€‚

æˆ‘ä»¬è¯´ï¼š

â€œå˜¿ä»¥å¤ªåŠï¼Œç»™æˆ‘ä»ä½ç½® 32 å¼€å§‹çš„å‰ 32 ä¸ªå­—èŠ‚ã€‚é‚£æ˜¯ `r`ã€‚

â€œç°åœ¨ç»™æˆ‘æ¥ä¸‹æ¥çš„ 32 å­—èŠ‚ï¼Œä» 64 å¼€å§‹ã€‚é‚£æ˜¯`s` ã€‚

â€œæœ€åç»™æˆ‘ä½ç½® 96 çš„ 1 å­—èŠ‚ã€‚é‚£æ˜¯ `v`ã€‚

æˆ‘ä»¬ç°åœ¨å·²ç»æœ‰äº†æ ‡å¿—æ€§æ‹¼å›¾çš„æ‰€æœ‰éƒ¨åˆ†ã€‚

 **ç¬¬ 4 æ­¥ï¼šæ ¹æ®éœ€è¦ä¿®å¤ `V` å€¼**

[ğŸ§ª](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

```jsx
if (v < 27) {
    v += 27;
}
```

æœ‰æ—¶ï¼Œä¸åŒçš„é’±åŒ…æˆ–ç³»ç»Ÿä¼šç»™ä½ ä¸€ä¸ª `v` å€¼ï¼Œå³ 0 æˆ– 1ã€‚

ä½†ä»¥å¤ªåŠé¢„è®¡æ˜¯ 27 æˆ– 28ã€‚

æ‰€ä»¥æˆ‘ä»¬åªæ˜¯åœ¨éœ€è¦æ—¶è¿›è¡Œè°ƒæ•´ã€‚

 **ç¬¬ 5 æ­¥ï¼šéªŒè¯ v ç°åœ¨æ˜¯å¦æ­£ç¡®**

[ğŸš¨](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

```jsx
require(v == 27 || v == 28, "Invalid signature 'v' value");
```

ä¿®å¤åï¼Œæˆ‘ä»¬ç¡®ä¿ v æ˜¯ 27 æˆ– 28 - å…¶ä»–ä»»ä½•ä¸œè¥¿éƒ½æ˜¯ä¸å¯æ¥å—çš„ã€‚

å¦‚æœæ˜¯å…¶ä»–ä»»ä½•ä¸œè¥¿ï¼Œæˆ‘ä»¬ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› ä¸ºæˆ‘ä»¬ä¸èƒ½ä¿¡ä»»ç­¾åã€‚

 **ç¬¬ 6 æ­¥ï¼šæ¢å¤ç­¾åè€…çš„åœ°å€**

[ğŸ”](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

```jsx
return ecrecover(_ethSignedMessageHash, v, r, s);
```

è¿™æ˜¯æœ€åçš„æ—¶åˆ»ã€‚

æˆ‘ä»¬ç§°ä¹‹ä¸º `ecrecover`â€”â€”ä¸€ä¸ªå†…ç½®çš„ä»¥å¤ªåŠå‡½æ•°ï¼Œå®ƒé‡‡ç”¨ï¼š

ç­¾åæ¶ˆæ¯å“ˆå¸Œ

ç­¾åå€¼ ï¼ˆ`vã€rã€s`ï¼‰

å®ƒè¿”å›**ç­¾åè€…çš„åœ°å€** ã€‚

yeahï¼æˆ‘ä»¬ç°åœ¨çŸ¥é“æ˜¯è°ç­¾ç½²äº†è¿™æ¡æ¶ˆæ¯ã€‚

### **(13)checkIn â€“ Web3 æ´»åŠ¨çš„å‰é—¨ The Front Gate of the Web3 Event**

[ğŸŸï¸](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

è¿™æ˜¯ä¸ä¼šè€…åˆ°è¾¾æ‚¨çš„æ´»åŠ¨æ—¶å°†è°ƒç”¨çš„ä¸»è¦åŠŸèƒ½â€”â€” **æ— è®ºæ˜¯ä»£å¸é—¨æ§èšä¼šã€ç ”è®¨ä¼šè¿˜æ˜¯ç§äººå‘å¸ƒæ´¾å¯¹** ã€‚

è®©æˆ‘ä»¬å…ˆé‡æ–°å®¡è§†ä¸€ä¸‹å‡½æ•°ï¼š

```jsx
function checkIn(bytes memory _signature) external {
    require(isEventActive, "Event is not active");
    require(block.timestamp <= eventDate + 1 days, "Event has ended");
    require(!hasAttended[msg.sender], "Attendee has already checked in");
    require(attendeeCount < maxAttendees, "Maximum attendees reached");
    require(verifySignature(msg.sender, _signature), "Invalid signature");

    hasAttended[msg.sender] = true;
    attendeeCount++;

    emit AttendeeCheckedIn(msg.sender, block.timestamp);
}
```

### **è¿™ä¸ªå‡½æ•°åœ¨åšä»€ä¹ˆï¼Ÿ**

[ğŸ§©](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

      æ­¤åŠŸèƒ½æ˜¯**æ‚¨çš„æ•°å­—çœ‹é—¨äºº** ã€‚

 æ¯æ¬¡æœ‰äººæƒ³è¦ç­¾åˆ°æ—¶ï¼Œä»–ä»¬å¿…é¡»è¯æ˜ï¼š

 ä»–ä»¬è¢«é‚€è¯·ï¼ˆé€šè¿‡æä¾›æœ‰æ•ˆç­¾åï¼‰

 ä»–ä»¬åœ¨å…è®¸çš„çª—å£å†…ç­¾åˆ°

 æ´»åŠ¨ä»åœ¨è¿›è¡Œä¸­

 ä»–ä»¬å°šæœªç­¾åˆ°ã€‚

       è¿˜æœ‰ç©ºä½™ï¼

å¦‚æœä»–ä»¬é€šè¿‡äº†æ‰€æœ‰è¿™äº›æ£€æŸ¥ï¼Œä»–ä»¬å°±å¯ä»¥é€šè¿‡å¤§é—¨ã€‚

ç°åœ¨è®©æˆ‘ä»¬é€è¡Œåˆ†è§£è¿™ä¸ªå‡½æ•°ï¼š

```jsx
require(isEventActive, "Event is not active");
```

åœ¨æˆ‘ä»¬æ£€æŸ¥å…¶ä»–ä»»ä½•äº‹æƒ…ä¹‹å‰â€”â€”è¯¥æ´»åŠ¨æ˜¯å¦æ­£åœ¨ç›´æ’­ï¼Ÿ

ç»„ç»‡è€…å¯èƒ½å·²æš‚åœæˆ–å–æ¶ˆæ´»åŠ¨ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œ **åˆ™ä¸å…è®¸ä»»ä½•äººç­¾åˆ°** ã€‚

æ­¤æ ‡å¿— ï¼ˆ`isEventActive`ï¼‰ ç”±ç»„ç»‡è€…ä½¿ç”¨ `setEventStatusï¼ˆï¼‰` å‡½æ•°è¿›è¡Œæ§åˆ¶ã€‚

```jsx
require(block.timestamp <= eventDate + 1 days, "Event has ended");
```

æ­¤æ£€æŸ¥ä¸Šå†™ç€ï¼šâ€œ **æ‚¨åªèƒ½åœ¨æ´»åŠ¨æ—¥æœŸå 24 å°æ—¶ä¹‹å‰ç­¾åˆ°ã€‚**

ä¸ºä»€ä¹ˆï¼Ÿ

å› ä¸ºäº‹ä»¶ä¸ä¼šæ°¸è¿œæŒç»­ä¸‹å»ã€‚æ‚¨ä¸å¸Œæœ›æœ‰äººåœ¨ 5 å¤©åå°è¯•åŠç†ç™»check inæ‰‹ç»­ã€‚

é€šè¿‡å¢åŠ ä¸€å¤©ï¼Œæˆ‘ä»¬ç»™äºˆäº†è½»å¾®çš„å®½é™æœŸï¼ŒåŒæ—¶ä»ç„¶ä¿æŒç°å®ã€‚

```jsx
require(!hasAttended[msg.sender], "Attendee has already checked in");
```

æˆ‘ä»¬ä¸å…è®¸é‡å¤ç­¾åˆ°ã€‚

æ­¤è¡Œç¡®ä¿**æ¯ä¸ªåœ°å€åªèƒ½ç­¾åˆ°ä¸€æ¬¡** ã€‚å¦‚æœä»–ä»¬å·²è¢«æ ‡è®°ä¸ºæœ‰äººå€¼å®ˆï¼Œåˆ™ä»–ä»¬å°†è¢«é˜»æ­¢å†æ¬¡ç­¾åˆ°ã€‚

è¿™æ˜¯ä½¿ç”¨ `hasAttended` æ˜ å°„è¿›è¡Œè·Ÿè¸ªçš„ã€‚

```jsx
require(attendeeCount < maxAttendees, "Maximum attendees reached");
```

è¿™æ˜¯ä½ **æ´»åŠ¨ä¸Šé™** ã€‚

å¦‚æœä½ æœ€å¤šä¸ä¼šè€…äººæ•°ä¸º 100 äººï¼Œå¹¶ä¸”å·²ç»æœ‰ 100 äººç­¾åˆ°ï¼Œé‚£ä¹ˆæ— è®ºè°è¯•å›¾è¿›å…¥ï¼Œé—¨éƒ½ä¼šå…³é—­ã€‚

å³ä½¿ä»–ä»¬æœ‰æœ‰æ•ˆçš„ç­¾åï¼Œä¸€æ—¦è¾¾åˆ°ä¸Šé™ï¼Œä»–ä»¬ä¹Ÿæ— æ³•è¿›å…¥ã€‚

```jsx
require(verifySignature(msg.sender, _signature), "Invalid signature");
```

è¿™æ˜¯çœŸæ­£çš„é­”åŠ›ã€‚

æ­¤è¡ŒéªŒè¯ï¼š

ä¸ä¼šè€… ï¼ˆ`msg.sender`ï¼‰  **å®é™…ä¸Šè¢«é‚€è¯·äº†**

ä»–ä»¬çš„ç­¾åç”±**æ´»åŠ¨ç»„ç»‡è€…ç­¾å**

å®ƒæ˜¯ä¸“é—¨**ä¸ºè¿™æ¬¡æ´»åŠ¨ç­¾å**çš„

è¿™ä½¿ç”¨äº†æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„æ‰€æœ‰åŠ å¯†é€»è¾‘ï¼ˆæ¶ˆæ¯å“ˆå¸Œã€ä»¥å¤ªåŠå‰ç¼€ã€`ecrecover`ï¼‰â€”â€”æ•´é½åœ°åŒ…è£…åœ¨ `verifySignatureï¼ˆï¼‰` å¸®åŠ©ç¨‹åºä¸­ã€‚

å¦‚æœç­¾åæ˜¯å‡çš„æˆ–æ— æ•ˆçš„ï¼Œåˆ™æ‹’ç»è®¿é—®ã€‚

### ****

**é€šè¿‡æ‰€æœ‰æ£€æŸ¥ï¼Ÿå¤ªæ£’å•¦ï¼**

[âœ…](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

å¦‚æœä¸ä¼šè€…é€šè¿‡äº†æ‰€æœ‰è¦æ±‚ï¼Œæˆ‘ä»¬å°†è®°å½•ä»–ä»¬çš„ç­¾åˆ°ï¼š

```jsx
hasAttended[msg.sender] = true;
```

æˆ‘ä»¬å°†å‘¼å«è€…æ ‡è®°ä¸ºç°åœ¨å·²ç­¾åˆ°çš„äººã€‚

è¿™å¯ä»¥é˜²æ­¢é‡å¤ç­¾å…¥ã€‚

```jsx
attendeeCount++;
```

æˆ‘ä»¬é€’å¢æ€»ä¸ä¼šè€…è®¡æ•°ã€‚

è¿™æœ‰åŠ©äºæˆ‘ä»¬ä¸ºä¸‹ä¸€ä¸ªå°è¯•è¿›å…¥çš„äººå¼ºåˆ¶æ‰§è¡Œ maxAttendees é™åˆ¶ã€‚

```jsx
emit AttendeeCheckedIn(msg.sender, block.timestamp);
```

æˆ‘ä»¬è§¦å‘ä¸€ä¸ªäº‹ä»¶æ¥è®°å½•æ­¤äººå·²ç­¾åˆ°ä»¥åŠç­¾åˆ°çš„æ—¶é—´ã€‚

è¿™å¯¹ä»¥ä¸‹æƒ…å†µå¾ˆæœ‰ç”¨ï¼š

å‰ç«¯ UI

åŒºå—æµè§ˆå™¨

é“¾ä¸‹æ•°æ®ç´¢å¼•ï¼ˆå¦‚ The Graphï¼‰

### å®Œæ•´ä»£ç è¯¦è§£

### ğŸ“„ ç­¾åéªŒè¯æ´»åŠ¨åˆçº¦

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract SignThis {
    string public eventName;
    address public organizer;
    uint256 public eventDate;
    uint256 public maxAttendees;
    uint256 public attendeeCount;
    bool public isEventActive;

    mapping(address => bool) public hasAttended;

    event EventCreated(string name, uint256 date, uint256 maxAttendees);
    event AttendeeCheckedIn(address attendee, uint256 timestamp);
    event EventStatusChanged(bool isActive);

    constructor(string memory _eventName, uint256 _eventDate, uint256 _maxAttendees) {
        eventName = _eventName;
        organizer = msg.sender;
        eventDate = _eventDate;
        maxAttendees = _maxAttendees;
        isEventActive = true;

        emit EventCreated(_eventName, _eventDate, _maxAttendees);
    }

    modifier onlyOrganizer() {
        require(msg.sender == organizer, "Only organizer");
        _;
    }

    modifier eventActive() {
        require(isEventActive, "Event not active");
        _;
    }

    // ä½¿ç”¨ç­¾åéªŒè¯å‚ä¸è€…èº«ä»½
    function checkInWithSignature(
        address attendee,
        uint8 v,
        bytes32 r,
        bytes32 s
    ) external eventActive {
        require(attendeeCount < maxAttendees, "Event full");
        require(!hasAttended[attendee], "Already checked in");

        // æ„é€ æ¶ˆæ¯å“ˆå¸Œ
        bytes32 messageHash = keccak256(abi.encodePacked(
            attendee,
            address(this),  // åˆçº¦åœ°å€
            eventName
        ));

        // ä»¥å¤ªåŠç­¾åæ¶ˆæ¯å“ˆå¸Œ
        bytes32 ethSignedMessageHash = keccak256(abi.encodePacked(
            "\x19Ethereum Signed Message:\n32",
            messageHash
        ));

        // æ¢å¤ç­¾åè€…åœ°å€
        address signer = ecrecover(ethSignedMessageHash, v, r, s);

        // éªŒè¯ç­¾åè€…æ˜¯ç»„ç»‡è€…
        require(signer == organizer, "Invalid signature");

        // è®°å½•å‚ä¸
        hasAttended[attendee] = true;
        attendeeCount++;

        emit AttendeeCheckedIn(attendee, block.timestamp);
    }

    // æ‰¹é‡ç­¾åˆ° (Gasä¼˜åŒ–)
    function batchCheckIn(
        address[] calldata attendees,
        uint8[] calldata v,
        bytes32[] calldata r,
        bytes32[] calldata s
    ) external eventActive {
        require(attendees.length == v.length, "Array length mismatch");
        require(attendees.length == r.length, "Array length mismatch");
        require(attendees.length == s.length, "Array length mismatch");
        require(attendeeCount + attendees.length <= maxAttendees, "Would exceed capacity");

        for (uint256 i = 0; i < attendees.length; i++) {
            address attendee = attendees[i];

            if (hasAttended[attendee]) continue;  // è·³è¿‡å·²ç­¾åˆ°çš„

            bytes32 messageHash = keccak256(abi.encodePacked(
                attendee,
                address(this),
                eventName
            ));

            bytes32 ethSignedMessageHash = keccak256(abi.encodePacked(
                "\x19Ethereum Signed Message:\n32",
                messageHash
            ));

            address signer = ecrecover(ethSignedMessageHash, v[i], r[i], s[i]);

            if (signer == organizer) {
                hasAttended[attendee] = true;
                attendeeCount++;
                emit AttendeeCheckedIn(attendee, block.timestamp);
            }
        }
    }

    // éªŒè¯ç­¾åæœ‰æ•ˆæ€§ (ä¸æ‰§è¡Œç­¾åˆ°)
    function verifySignature(
        address attendee,
        uint8 v,
        bytes32 r,
        bytes32 s
    ) external view returns (bool) {
        bytes32 messageHash = keccak256(abi.encodePacked(
            attendee,
            address(this),
            eventName
        ));

        bytes32 ethSignedMessageHash = keccak256(abi.encodePacked(
            "\x19Ethereum Signed Message:\n32",
            messageHash
        ));

        address signer = ecrecover(ethSignedMessageHash, v, r, s);
        return signer == organizer;
    }

    // è·å–æ¶ˆæ¯å“ˆå¸Œ (ç”¨äºå‰ç«¯ç­¾å)
    function getMessageHash(address attendee) external view returns (bytes32) {
        return keccak256(abi.encodePacked(
            attendee,
            address(this),
            eventName
        ));
    }

    // ç®¡ç†å‘˜åŠŸèƒ½
    function toggleEventStatus() external onlyOrganizer {
        isEventActive = !isEventActive;
        emit EventStatusChanged(isEventActive);
    }

    function getEventInfo() external view returns (
        string memory name,
        uint256 date,
        uint256 maxCapacity,
        uint256 currentCount,
        bool active
    ) {
        return (eventName, eventDate, maxAttendees, attendeeCount, isEventActive);
    }
}
```

**âœ… ç­¾åéªŒè¯æµç¨‹**

1. ç»„ç»‡è€…é“¾ä¸‹ç”Ÿæˆå‚ä¸è€…ç­¾å â†’ 2. å‚ä¸è€…æäº¤ç­¾ååˆ°åˆçº¦ â†’ 3. åˆçº¦ä½¿ç”¨ecrecoveréªŒè¯ç­¾å â†’ 4. éªŒè¯é€šè¿‡åˆ™å…è®¸ç­¾åˆ°ã€‚æ•´ä¸ªè¿‡ç¨‹æ— éœ€é¢„å…ˆå­˜å‚¨ç™½åå•ï¼

### ğŸ” å‰ç«¯ç­¾åç”Ÿæˆç¤ºä¾‹

```jsx
// JavaScript å‰ç«¯ä»£ç async function generateSignature(attendeeAddress, contractAddress, eventName) {
// 1. æ„é€ æ¶ˆæ¯const messageHash = ethers.utils.solidityKeccak256(
        ['address', 'address', 'string'],
        [attendeeAddress, contractAddress, eventName]
    );

// 2. ç»„ç»‡è€…ç­¾åconst signature = await organizerWallet.signMessage(
        ethers.utils.arrayify(messageHash)
    );

// 3. åˆ†ç¦»ç­¾åç»„ä»¶const { v, r, s } = ethers.utils.splitSignature(signature);

    return { v, r, s };
}

// ä½¿ç”¨ç¤ºä¾‹const signature = await generateSignature(
    "0x742d35Cc6634C0532925a3b8D0C9964E5Bd4f071",// å‚ä¸è€…åœ°å€
    contractAddress,
    "Web3 Conference 2024"
);

// è°ƒç”¨åˆçº¦ç­¾åˆ°await contract.checkInWithSignature(
    attendeeAddress,
    signature.v,
    signature.r,
    signature.s
);
```

**âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹**

- ç­¾åå¯èƒ½è¢«é‡æ”¾ï¼Œéœ€è¦æ·»åŠ nonceæˆ–æ—¶é—´æˆ³
- ç¡®ä¿æ¶ˆæ¯å“ˆå¸ŒåŒ…å«è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯
- éªŒè¯ç­¾åè€…èº«ä»½çš„æƒå¨æ€§
- è€ƒè™‘ç­¾åçš„æœ‰æ•ˆæœŸé™åˆ¶
- é˜²æ­¢ç­¾åè¢«ç”¨äºå…¶ä»–åˆçº¦

### ğŸ“ Remixå®æˆ˜æ­¥éª¤

### æ­¥éª¤1: éƒ¨ç½²åˆçº¦

1. éƒ¨ç½²SignThisåˆçº¦ï¼Œè®¾ç½®æ´»åŠ¨ä¿¡æ¯
2. è®°å½•åˆçº¦åœ°å€å’Œç»„ç»‡è€…åœ°å€

### æ­¥éª¤2: ç”Ÿæˆç­¾å (ä½¿ç”¨MetaMask)

1. è°ƒç”¨`getMessageHash(å‚ä¸è€…åœ°å€)`è·å–æ¶ˆæ¯å“ˆå¸Œ
2. åœ¨æµè§ˆå™¨æ§åˆ¶å°ä½¿ç”¨MetaMaskç­¾åï¼š

```jsx
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œconst messageHash = "0x...";// ä»åˆçº¦è·å–çš„å“ˆå¸Œconst signature = await ethereum.request({
    method: "personal_sign",
    params: [messageHash, ethereum.selectedAddress]
});
```

### æ­¥éª¤3: åˆ†ç¦»ç­¾åå¹¶éªŒè¯

1. ä½¿ç”¨åœ¨çº¿å·¥å…·æˆ–è„šæœ¬åˆ†ç¦»ç­¾åçš„v, r, s
2. è°ƒç”¨`verifySignature`éªŒè¯ç­¾åæœ‰æ•ˆæ€§
3. è°ƒç”¨`checkInWithSignature`å®Œæˆç­¾åˆ°

### æ­¥éª¤4: æµ‹è¯•æ‰¹é‡ç­¾åˆ°

1. ä¸ºå¤šä¸ªåœ°å€ç”Ÿæˆç­¾å
2. è°ƒç”¨`batchCheckIn`æ‰¹é‡å¤„ç†
3. è§‚å¯ŸGasæ¶ˆè€—å¯¹æ¯”

### **ğŸ˜å¦‚ä½•åœ¨ Remix ä¸­è¿è¡ŒåŸºäºç­¾åçš„äº‹ä»¶è¾“å…¥ç³»ç»Ÿ**

å¥½å§ï¼Œæ˜¯æ—¶å€™è®©æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦å˜ä¸ºç°å®äº†ã€‚

ä½ æ˜¯ç»„ç»‡è€…ã€‚iä½ å³å°†ä¸¾åŠ **Web3 å³°ä¼š** ã€‚è®©æˆ‘ä»¬ä»å¤´åˆ°å°¾æ¥äº†è§£ä¸€ä¸‹â€”â€”åŒ…æ‹¬ç­¾ç½²é‚€è¯·å’Œç­¾åˆ°äººä»¬ï¼

### **ç¬¬ 1 æ­¥ï¼šéƒ¨ç½²åˆçº¦**

[ğŸ”¨](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

1.å‰å¾€ Remixã€‚

å°†ä½ çš„ `EventEntry åˆçº¦`ç²˜è´´åˆ°ä¸€ä¸ªæ–°æ–‡ä»¶ä¸­ - å°†å…¶å‘½åä¸º `EventEntry.sol`ã€‚

ä½¿ç”¨ **Solidity Compiler** é€‰é¡¹å¡è¿›è¡Œç¼–è¯‘ã€‚

è½¬åˆ° **â€œDeploy & Run Transactions** â€é€‰é¡¹å¡ã€‚

ç°åœ¨æ˜¯æ—¶å€™å¡«å†™æ„é€ å‡½æ•°äº†ï¼š

`eventName`ï¼šâ€œ`Web3 å³°ä¼š`â€

`eventDate`ï¼šä½¿ç”¨**future Unix timestamp**

â†’ æ‚¨å¯ä»¥ä½¿ç”¨ç±»ä¼¼ `Math.floorï¼ˆDate.nowï¼ˆï¼‰ / 1000ï¼‰ + 86400`ï¼ˆç°åœ¨ + 1 å¤©ï¼‰ä¹‹ç±»çš„ä¸œè¥¿

â†’ æˆ–è€…åªæ˜¯ç²˜è´´ä¸€ä¸ªç¡¬ç¼–ç çš„æœªæ¥æ—¶é—´æˆ³ï¼Œæ¯”å¦‚ `1714000000`

`æœ€å¤§ä¸ä¼šè€…äººæ•° ï¼š100`

ç‚¹å‡»**Deployã€‚**

æ­å–œï¼æ‚¨ç°åœ¨å·²ç»å¯åŠ¨äº†æ™ºèƒ½æ´»åŠ¨ã€‚

### **ç¬¬ 2 æ­¥ï¼šç”Ÿæˆæ¶ˆæ¯å“ˆå¸Œ**

[ğŸ”‘](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

è¦é‚€è¯·å®¢äººï¼Œæˆ‘ä»¬éœ€è¦ç”Ÿæˆä¸€ä¸ªä¸ä»–ä»¬çš„é’±åŒ…ç»‘å®šçš„å”¯ä¸€**å“ˆå¸Œå€¼** ã€‚

åœ¨å·²éƒ¨ç½²çš„åˆçº¦å®ä¾‹ä¸­ï¼š

å«ï¼š

```jsx
getMessageHash("0xAttendeeAddressHere")
```

 å°† `â€œ0xAttendeeAddressHereâ€` æ›¿æ¢ä¸ºè®¿å®¢çš„é’±åŒ…åœ°å€ã€‚

[ğŸ§ ](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

å¤åˆ¶è¿”å›çš„å“ˆå¸Œå€¼ â€” æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€æ­¥ä¸­ä½¿ç”¨å®ƒã€‚

### **ç¬¬ 3 æ­¥ï¼šåœ¨ Remix ä¸­ç­¾ç½²æ¶ˆæ¯**

[âœï¸](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

æ˜¯æ—¶å€™å……å½“**æ´»åŠ¨ç»„ç»‡è€…**å¹¶ç­¾ç½²å®¢äººçš„å“ˆå¸Œäº†ã€‚

**åˆ›å»ºä¸€ä¸ª JavaScript æ–‡ä»¶ï¼š**

åœ¨**æ–‡ä»¶èµ„æºç®¡ç†å™¨**ä¸­ï¼Œå³é”®å•å‡»å¹¶é€‰æ‹©**æ–°å»ºæ–‡ä»¶**

å‘½å `sign.js`

ç²˜è´´æ­¤è„šæœ¬ï¼š

```jsx
(async () => {
  const messageHash = "<paste-your-hash-here>";
  const accounts = await web3.eth.getAccounts();
  const organizer = accounts[0]; // first account in Remix
  const signature = await web3.eth.sign(messageHash, organizer);
  console.log("Signature:", signature);
})();
```

å°† `â€œ<paste-your-hash-here>â€` æ›¿æ¢ä¸ºæ‚¨åˆšåˆšå¤åˆ¶çš„å“ˆå¸Œå€¼ã€‚

**ç°åœ¨è¿è¡Œå®ƒï¼š**

å³é”®å•å‡» `sign.js` å¹¶é€‰æ‹©**è¿è¡Œ** ã€‚

 Remix ä¼šè‡ªåŠ¨åŒ…å« **web3.js**ï¼Œå› æ­¤æ‚¨æ— éœ€å®‰è£…ä»»ä½•ä¸œè¥¿ã€‚

[âœ…](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

æ‚¨å°†åœ¨ Remix ç»ˆç«¯ä¸­çœ‹åˆ°æ‰“å°çš„ç­¾åã€‚

**è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ**

[ğŸ§ ](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

æˆ‘ä»¬ä½¿ç”¨éƒ¨ç½²è€…ï¼ˆå³ç»„ç»‡è€…ï¼‰çš„**ç§é’¥**åœ¨é“¾ä¸‹**å¯¹æ¶ˆæ¯å“ˆå¸Œè¿›è¡Œç­¾å** ã€‚è¿™æ¨¡æ‹Ÿäº†æ‚¨çš„åç«¯æœåŠ¡å™¨åœ¨ç°å®ç”Ÿæ´»ä¸­ä¼šåšä»€ä¹ˆã€‚

### **ç¬¬ 4 æ­¥ï¼šä»¥ä¸ä¼šè€…èº«ä»½ç­¾åˆ°**

[ğŸªª](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

ç°åœ¨è®©æˆ‘ä»¬åˆ‡æ¢è§’è‰² - æ‚¨æ˜¯åˆ°è¾¾æ´»åŠ¨çš„ä¸ä¼šè€…ï¼Œå› æ­¤åˆ‡æ¢åˆ°ä¸ä¼šè€…åœ°å€

```jsx
checkIn("<paste-signature-here>")
```

 ç²˜è´´æ‚¨ä»ä¸Šä¸€æ­¥è·å¾—çš„ç¡®åˆ‡ç­¾åã€‚

[ğŸ“Œ](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼š

ç³»ç»Ÿå°†æ ‡è®°ä¸ºå·²ç­¾åˆ°ã€‚

æ´»åŠ¨çš„ä¸ä¼šäººæ•°å°†å¢åŠ 

åå®šå°†å‘å‡º `AttendeeCheckedIn` äº‹ä»¶ 

[ğŸ‰](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)

å°±è¿™æ ·ï¼Œæˆ‘ä»¬å»ºç«‹äº†è‡ªå·±çš„ Web3 è®¿å®¢åå•â€”â€”æ— éœ€åœ¨é“¾ä¸Šå­˜å‚¨ä»»ä½•åœ°å€ã€‚æˆ‘ä»¬æ²¡æœ‰å¼„ä¹±å­˜å‚¨ç©ºé—´æˆ–æ”¯ä»˜æ±½æ²¹æ¥æ›´æ–°ç™½åå•ï¼Œè€Œæ˜¯ä½¿ç”¨åŠ å¯†ç­¾åè®©ä¸ä¼šè€…è¯æ˜ä»–ä»¬æ˜¯è¢«é‚€è¯·çš„ã€‚æ´»åŠ¨ç»„ç»‡è€…å°±åƒä¸€ä¸ªæ•°å­—ä¿é•–ï¼Œåœ¨å¹•åç­¾ç½²æ‰¹å‡†ï¼Œè€Œæ™ºèƒ½åˆçº¦åˆ™åœ¨é—¨å£æ£€æŸ¥è¿™äº›ç­¾åã€‚å®ƒå¹²å‡€ã€é«˜æ•ˆä¸”æ›´åŠ çµæ´»â€”â€”è¿™æ˜¯çœŸå®äº‹ä»¶å¯ä»¥å®é™…ä½¿ç”¨çš„é‚£ç§ç³»ç»Ÿã€‚æ— è®ºæ‚¨æ˜¯ä¸¾åŠä»£å¸é—¨æ§æ´¾å¯¹è¿˜æ˜¯å¼€å‘è€…èšä¼šï¼Œè¿™ç§æ¨¡å¼éƒ½èƒ½ä¸ºæ‚¨æä¾›æ‰€æœ‰å®‰å…¨æ€§ï¼Œè€Œæ— éœ€é“¾ä¸ŠåŒ…è¢±ã€‚

# 3ã€ä¸‹ä¸€æ­¥

**å°è¯•ä»¥ä¸‹æ”¹è¿›:**

1. æ·»åŠ nonceé˜²æ­¢ç­¾åé‡æ”¾æ”»å‡»
2. å®ç°ç­¾åæœ‰æ•ˆæœŸæœºåˆ¶
3. åˆ›å»ºå¤šçº§æƒé™ç³»ç»Ÿ (ç»„ç»‡è€…ã€å¿—æ„¿è€…ã€å‚ä¸è€…)
4. å®ç°ç­¾åæ’¤é”€åŠŸèƒ½
5. æ·»åŠ ç­¾åä½¿ç”¨æ¬¡æ•°é™åˆ¶
6. åˆ›å»ºåŸºäºç­¾åçš„æŠ•ç¥¨ç³»ç»Ÿ

**æ‰©å±•çŸ¥è¯†**

**EIP-712 ç»“æ„åŒ–ç­¾å**

```solidity
// EIP-712 æä¾›æ›´å®‰å…¨çš„ç»“æ„åŒ–ç­¾å
struct Permit {
    address owner;
    address spender;
    uint256 value;
    uint256 nonce;
    uint256 deadline;
}

bytes32 constant PERMIT_TYPEHASH = keccak256(
    "Permit(address owner,address spender,uint256 value,uint256 nonce,uint256 deadline)"
);
```

EIP-712æä¾›äº†æ›´å®‰å…¨ã€ç”¨æˆ·å‹å¥½çš„ç­¾åæ–¹å¼ï¼Œè¢«å¹¿æ³›ç”¨äºDeFiåè®®ã€‚

**ç­¾ååº”ç”¨åœºæ™¯å¯¹æ¯”**

| åº”ç”¨ | ä¼˜åŠ¿ | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- |
| ç™½åå•éªŒè¯ | Gasé«˜æ•ˆ | NFTé“¸é€ ã€æ´»åŠ¨ç­¾åˆ° |
| å…ƒäº¤æ˜“ | ç”¨æˆ·æ— éœ€ETH | DAppç”¨æˆ·ä½“éªŒ |
| Permitæˆæƒ | ä¸€æ­¥å®Œæˆæˆæƒ | DeFiåè®®é›†æˆ |