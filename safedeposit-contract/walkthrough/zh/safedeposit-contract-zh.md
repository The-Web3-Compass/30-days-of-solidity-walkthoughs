# æ¨¡å—åŒ–é‡‘åº“ç³»ç»Ÿ SafeDeposit åˆçº¦

Day: Day 14
ID: 14
åŸæ–‡: https://builder-hub.notion.site/SafeDeposit-contract-1d55720a23ef80c1b2d0ebccd0fd594d?pvs=25
çŠ¶æ€: å®Œæˆ
è¯‘è€…: He Shadow
éš¾åº¦ç­‰çº§: ä¸­çº§

[ğŸ§­ é¦–é¡µ](https://www.notion.so/5-5-HerSolidity-28e06421268880e4b645d9458179e231?pvs=21) ï½œ [ğŸ“ 30å¤©è¯¾ç¨‹æ—¥å†](https://www.notion.so/28e0642126888002b26be4b2e9841ce0?pvs=21) ï½œ[](https://www.notion.so/28e06421268881e59a00e854a7444215?pvs=21) ï½œ[FAQ-Solidityç­”ç–‘é—®é¢˜åº“](https://www.notion.so/2910642126888046a897d75705d86a58?pvs=21) ï½œ [ğŸ‘©ğŸ»â€ğŸ’» å…³äºæˆ‘ä»¬](https://www.notion.so/344d3328efef4b3ab742f92b61533ce8?pvs=21)

# **å®‰å…¨æ‰˜ç®¡åˆçº¦**

å¥½çš„â€”â€”åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ç¼–å†™äº†åŸºç¡€ç‰ˆå’Œé«˜çº§ç‰ˆçš„ ERC-20 ä»£å¸ï¼Œå®Œæˆäº†å®Œæ•´çš„ä»£å¸å‘å”®ï¼Œå¹¶æ¢è®¨äº†**ç»§æ‰¿**å¦‚ä½•å¸®åŠ©æˆ‘ä»¬é‡ç”¨å’Œç»„ç»‡ä»£ç ã€‚å›æƒ³ä¸€ä¸‹æˆ‘ä»¬çš„ TokenSale åˆçº¦æ˜¯å¦‚ä½•æ‰©å±• ERC-20 ä»£å¸ä»¥æ·»åŠ æ–°é€»è¾‘ï¼Œè€Œæ— éœ€é‡å†™æ‰€æœ‰å†…å®¹çš„ã€‚

ç°åœ¨æˆ‘ä»¬è¦å†æ¬¡å‡çº§â€”â€”è¿™æ¬¡æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ª**æ¨¡å—åŒ–é‡‘åº“ç³»ç»Ÿ** ï¼Œè®©ç”¨æˆ·å¯ä»¥å°†æ•æ„Ÿæœºå¯†å­˜å‚¨åœ¨ä¸åŒç±»å‹çš„å­˜æ¬¾ç®±ä¸­ã€‚

---

## **ğŸ§  æ ¸å¿ƒç†å¿µ**

æƒ³è±¡ä¸€ä¸‹ï¼š

ä½ æœ‰å¾ˆå¤šç”¨æˆ·ï¼Œæ¯ä¸ªäººéƒ½æƒ³æŠŠä¸€ä¸ªç§˜å¯†æ”¾è¿›è‡ªå·±çš„é‡‘åº“ã€‚ä¸è¿‡ï¼Œæ¯ä¸ªé‡‘åº“éƒ½ä¸ä¸€æ ·ï¼š

- æœ‰äº›æ˜¯**åŸºç¡€å‹**ï¼Œé€‚åˆæ—¥å¸¸ä½¿ç”¨ã€‚
- æœ‰äº›æ˜¯**é«˜çº§å‹**ï¼Œèƒ½æä¾›é¢å¤–çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å…ƒæ•°æ®ã€‚
- æœ‰äº›æ˜¯**æ—¶é—´é”å‹**ï¼Œç”¨æˆ·åœ¨ç‰¹å®šæ—¶é—´ä¹‹å‰æ— æ³•æ‰“å¼€é‡‘åº“ã€‚

æˆ‘ä»¬ä¸éœ€è¦å†™ä¸‰ä¸ªå®Œå…¨ä¸åŒçš„åˆçº¦ï¼Œè€Œæ˜¯è¦**æ™ºèƒ½åœ°æ„å»ºå®ƒä»¬**â€”â€”ä½¿ç”¨ä¸€äº›å…±åŒçš„è§„åˆ™å’Œé€»è¾‘ä»¥åŠ Solidity å¼ºå¤§çš„é¢å‘å¯¹è±¡åŠŸèƒ½ã€‚

è¿™å°±æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼Œæˆ‘ä»¬è¦å…ˆå¼„æ‡‚å†ç»§ç»­ï¼š

---

## **ğŸ“˜ Solidity ä¸­çš„æ¥å£æ˜¯ä»€ä¹ˆï¼Ÿ**

å¦‚æœè¯´ç»§æ‰¿æ˜¯ç”¨æ¥**é‡å¤åˆ©ç”¨é€šç”¨é€»è¾‘**ï¼Œé‚£ä¹ˆæ¥å£å°±æ˜¯ç”¨æ¥è§„å®š**å¼ºåˆ¶æ‰§è¡Œè§„åˆ™**ã€‚

**æ¥å£**æ˜¯ä¸€ç§åªåŒ…å«å‡½æ•°å®šä¹‰çš„åˆçº¦â€”â€”æ²¡æœ‰é€»è¾‘ï¼Œæ²¡æœ‰å­˜å‚¨ï¼Œä¹Ÿæ²¡æœ‰çŠ¶æ€å˜é‡ã€‚

ä½ å¯ä»¥æŠŠæ¥å£æƒ³è±¡æˆè“å›¾æˆ–è€…æ‰¿è¯ºï¼š

> â€œä»»ä½•å®ç°æ­¤æ¥å£çš„åˆçº¦éƒ½å¿…é¡»åŒ…å«è¿™äº›å‡½æ•°â€”â€”å¹¶ä¸”å®ƒä»¬çš„è¡Œä¸ºå¿…é¡»ç¬¦åˆé¢„æœŸã€‚â€
> 

è¿™å°±åƒå®šäº†ä¸€ä¸ªæ ‡å‡†ï¼Œè¿™æ ·åšæœ‰å¾ˆå¤šå¥½å¤„ï¼š

- âœ… å®ƒä½¿åˆçº¦äº¤äº’å¯é¢„æµ‹â€”â€”å³ä½¿ç±»å‹ä¸ä¸€æ ·ä¹Ÿèƒ½äº’é€š
- âœ… æˆ‘ä»¬å¯ä»¥åšä¸€äº›å·¥å…·ï¼ˆæ¯”å¦‚ç®¡ç†å™¨æˆ–è€…ä»ªè¡¨ç›˜ï¼‰ï¼Œåªè¦åˆçº¦ç”¨è¿™ä¸ªæ¥å£ï¼Œå°±èƒ½å’Œå®ƒæ²Ÿé€šï¼Œä¸ç”¨ç®¡é‡Œé¢å…·ä½“æ€ä¹ˆå†™çš„
- âœ… è¿™æ ·æˆ‘ä»¬çš„ç³»ç»Ÿå°±èƒ½åƒæ­ç§¯æœ¨ä¸€æ ·çµæ´»ç»„åˆ

æˆ‘ä»¬ä¼šç”¨ä¸€ä¸ªæ¥å£æ¥è§„å®šæ¯ä¸ªé‡‘åº“å¿…é¡»è¦æœ‰çš„åŠŸèƒ½ï¼š

- è°æ‹¥æœ‰è¿™ä¸ªé‡‘åº“ï¼Ÿ
- é‡‘åº“èƒ½å¦å­˜å‚¨å’Œæ£€ç´¢ç§˜å¯†ï¼Ÿ
- è¿™æ˜¯ä»€ä¹ˆç±»å‹çš„é‡‘åº“ï¼Ÿ
- é‡‘åº“æ˜¯ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„ï¼Ÿ

æ¯ç§é‡‘åº“éƒ½ä¼šç”¨è‡ªå·±çš„æ–¹å¼å®ç°è¿™ä¸ªæ¥å£ã€‚

---

## **ğŸ§± ä»€ä¹ˆæ˜¯æŠ½è±¡åˆçº¦ï¼Ÿ**

é™¤äº†æ¥å£ï¼ŒSolidity è¿˜ç»™äº†æˆ‘ä»¬å¦ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼š**æŠ½è±¡åˆçº¦**ã€‚

æŠ½è±¡åˆçº¦æ˜¯ä¸€ä¸ªå¯ä»¥åŒæ—¶åŒ…å«**å·²å®ç°çš„å‡½æ•°**å’Œ**æœªå®ç°çš„ï¼ˆvirtualï¼‰å‡½æ•°**çš„åˆçº¦â€”â€”ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆæ¥å£å’ŒçœŸå®é€»è¾‘çš„æ··åˆä½“ã€‚

å½“æ‚¨æƒ³è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œæ—¶ï¼Œå®ƒå¾ˆæœ‰ç”¨ï¼š

- æä¾›é€šç”¨é€»è¾‘ï¼ˆå¦‚é€šç”¨å˜é‡æˆ–å†…éƒ¨è¾…åŠ©å‡½æ•°ï¼‰
- æœ‰äº›å…·ä½“çš„å†…å®¹ï¼Œå¯ä»¥è®©åé¢çš„â€œå­åˆçº¦â€å»è¡¥å……å®Œå–„ã€‚

å…³é”®æ€æƒ³æ˜¯ï¼š

> æˆ‘ä»¬å°†æŠ½è±¡åˆçº¦ç”¨ä½œåŸºç¡€â€”â€”ä¸èƒ½ç›´æ¥ç”¨æ¥éƒ¨ç½²ã€‚
> 

åœ¨æˆ‘ä»¬çš„é‡‘åº“ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªæŠ½è±¡åŸºç¡€åˆçº¦ï¼Œå¤„ç†é€šç”¨é€»è¾‘ï¼Œä¾‹å¦‚ï¼š

- è¿½è¸ªé‡‘åº“æ‰€æœ‰è€…
- å­˜å‚¨å’Œæ£€ç´¢ç§˜å¯†
- å¼ºåˆ¶è®¿é—®æ§åˆ¶

ç„¶åæˆ‘ä»¬çš„Â `Basic`, `Premium`, å’Œ`TimeLocked`Â é‡‘åº“å°†**æ‰©å±•**è¿™ä¸ªåŸºç¡€åˆçº¦å¹¶æ·»åŠ è‡ªå·±çš„ç‰¹è‰²â€”â€”åŒæ—¶éƒ½ç¬¦åˆæ¥å£è§„èŒƒã€‚

---

## **ğŸ› ï¸ æˆ‘ä»¬å°†è¦æ„å»ºçš„å†…å®¹**

æˆ‘ä»¬å°†é‡‡å–æ¸…æ™°æ˜“æ‡‚çš„æ­¥éª¤æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

### **1.Â `IDepositBox.sol`Â â€” æ¥å£**

æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªæ‰€éœ€å‡½æ•°çš„ç®€å•è§„åˆ™æ‰‹å†Œã€‚æ¯ä¸ªé‡‘åº“éƒ½å¿…é¡»éµå®ˆæ­¤è§„åˆ™ã€‚

### **2.Â `BaseDepositBox.sol`Â â€” æŠ½è±¡åˆçº¦**

è¿™æ˜¯æˆ‘ä»¬å…±äº«çš„åŸºç¡€ã€‚å®ƒä¼šå®ç°æ¥å£ä¸­å®šä¹‰çš„å¤§éƒ¨åˆ†é€»è¾‘ï¼Œå¦‚ç§˜å¯†å­˜å‚¨ã€æ‰€æœ‰æƒå’Œå­˜å…¥æ—¶é—´ã€‚

å®ƒè¿˜ä¼šä½¿ç”¨Â `ä¿®é¥°ç¬¦`Â æ¥é™åˆ¶è®¿é—®â€”â€”æ¯”å¦‚ï¼Œç¡®ä¿åªæœ‰æ‰€æœ‰è€…æ‰å¯ä»¥è®¿é—®æˆ–ä¿®æ”¹é‡‘åº“ã€‚

### **3.Â `BasicDepositBox.sol`Â â€” æ ‡å‡†é‡‘åº“**

è¿™ä¸ªé‡‘åº“åªæœ‰æ¥å£è§„å®šçš„åŠŸèƒ½ï¼Œå®ƒæ˜¯é»˜è®¤çš„é‡‘åº“ã€‚

### **4.Â `PremiumDepositBox.sol`Â â€” å¸¦é™„åŠ åŠŸèƒ½çš„é‡‘åº“**

è¿™ä¸ªé‡‘åº“å»ºç«‹åœ¨åŸºç¡€é‡‘åº“ä¸Šï¼Œä½†å¢åŠ äº†å¯¹è‡ªå®šä¹‰å…ƒæ•°æ®çš„æ”¯æŒã€‚å¯ä»¥å°†å…¶è§†ä¸ºå…·æœ‰æ›´å¤šåŠŸèƒ½çš„å‡çº§ç‰ˆã€‚

### **5.Â `TimeLockedDepositBox.sol`Â â€” æš‚æ—¶æ— æ³•æ‰“å¼€çš„é‡‘åº“**

è¿™ä¸ªæ˜¯æœ‰æ—¶æ•ˆæ€§çš„ã€‚åœ¨é”å®šæœŸç»“æŸä¹‹å‰ï¼Œæ— æ³•æŸ¥çœ‹ç§˜å¯†ã€‚

æˆ‘ä»¬å°†æ·»åŠ ç‰¹æ®Šçš„ä¿®é¥°ç¬¦æ¥å¼ºåˆ¶æ‰§è¡Œæ­¤è¡Œä¸ºã€‚

### **6.Â `VaultManager.sol`Â â€” æ§åˆ¶å™¨**

æœ€åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªÂ `VaultManager`Â åˆçº¦å°†æ‰€æœ‰éƒ¨åˆ†æ•´åˆã€‚

æœ¬åˆçº¦ï¼š

- å…è®¸ç”¨æˆ·åˆ›å»ºä»»ä½•ç±»å‹çš„é‡‘åº“
- è·Ÿè¸ªå“ªäº›é‡‘åº“å±äºå“ªäº›ç”¨æˆ·
- å…è®¸é‡å‘½åé‡‘åº“
- å¤„ç†æ‰€æœ‰æƒè½¬ç§»
- ä½œä¸ºæ•´ä¸ªç³»ç»Ÿçš„å•ä¸€äº¤äº’ç‚¹

---

## **ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦**

è¿™ä¸ªç³»ç»Ÿå±•ç¤ºäº†å¦‚ä½•ç¼–å†™å¯æ‰©å±•ã€æ¨¡å—åŒ–ä¸”ç»„ç»‡è‰¯å¥½çš„ Solidity ä»£ç â€”â€”å°±åƒç°å®ä¸–ç•Œä¸­çš„å¤§è§„æ¨¡åè®®ä¸€æ ·ã€‚

å®ƒè¿˜æ•™æˆäº†**æ¥å£**ã€**æŠ½è±¡åˆçº¦**å’Œ**ç»§æ‰¿**å¦‚ä½•ååŒå·¥ä½œâ€”â€”æ„æˆäº†å¤§å¤šæ•°ç”Ÿäº§çº§æ™ºèƒ½åˆçº¦çš„æ ¸å¿ƒã€‚

---

è®©æˆ‘ä»¬ä»ç¼–å†™æ¥å£Â `IDepositBox.sol`Â å¼€å§‹æ·±å…¥ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿæˆ‘ä»¬å¼€å§‹å»ºé€ é‡‘åº“å§ã€‚

## **`IDepositBox`Â â€” æˆ‘ä»¬çš„é‡‘åº“æ¥å£**

solidity

```
interface IDepositBox {
    function getOwner() external view returns (address);
    function transferOwnership(address newOwner) external;
    function storeSecret(string calldata secret) external;
    function getSecret() external view returns (string memory);
    function getBoxType() external pure returns (string memory);
    function getDepositTime() external view returns (uint256);
}

```

### **è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ**

è¿™æ˜¯æˆ‘ä»¬çš„**æ¥å£**â€”â€”åˆçº¦è“å›¾ã€‚

æˆ‘ä»¬åŸºæœ¬ä¸Šæ˜¯åœ¨è¯´ï¼šâ€œå˜¿ï¼Œä»»ä½•æƒ³è¦æˆä¸ºæˆ‘ä»¬ç³»ç»Ÿä¸€éƒ¨åˆ†çš„é‡‘åº“ï¼ˆæˆ–å­˜æ¬¾ç®±ï¼‰**å¿…é¡»**å®ç°è¿™äº›å‡½æ•°ã€‚â€

è®©æˆ‘ä»¬çœ‹çœ‹æ¯ä¸ªå‡½æ•°ä»£è¡¨ä»€ä¹ˆï¼š

- `getOwner()`Â â€” è¿”å›å­˜æ¬¾ç®±çš„å½“å‰æ‰€æœ‰è€…ã€‚
- `transferOwnership()`Â â€” å…è®¸å°†æ‰€æœ‰æƒè½¬ç§»ç»™å…¶ä»–äººã€‚
- `storeSecret()`Â â€” ä¸€ä¸ªç”¨äºå°†å­—ç¬¦ä¸²ï¼ˆæˆ‘ä»¬çš„â€œç§˜å¯†â€ï¼‰ä¿å­˜åœ¨é‡‘åº“ä¸­çš„å‡½æ•°ã€‚
- `getSecret()`Â â€” æ£€ç´¢å­˜å‚¨çš„ç§˜å¯†ã€‚
- `getBoxType()`Â â€” è®©æˆ‘ä»¬çŸ¥é“å®ƒæ˜¯å“ªç§ç±»å‹çš„å­˜æ¬¾ç®±ï¼ˆåŸºç¡€å‹ã€é«˜çº§å‹ç­‰ï¼‰ã€‚
- `getDepositTime()`Â â€” è¿”å›å­˜æ¬¾ç®±çš„åˆ›å»ºæ—¶é—´ã€‚

> è¿™äº›å°±åƒæ¸¸æˆè§„åˆ™ä¸€æ ·â€”â€”æ¯ç§ç±»å‹çš„å­˜æ¬¾ç®±éƒ½ä¼šéµå¾ªè¿™äº›è§„åˆ™ï¼Œå³ä½¿å®ƒä»¬çš„å®æ–½æ–¹å¼ä¸åŒã€‚
> 

## **`BaseDepositBox.sol`Â â€“ åŸºç¡€**å‹**æŠ½è±¡åˆçº¦**

è¿™ä¸ªåˆçº¦æ˜¯æˆ‘ä»¬å­˜æ¬¾ç®±ç³»ç»Ÿçš„**æ ¸å¿ƒ**ã€‚æ‰€æœ‰ç‰¹å®šç±»å‹çš„å­˜æ¬¾ç®±â€”â€”å¦‚åŸºç¡€å‹ã€é«˜çº§å‹å’Œæ—¶é—´é”å‹â€”â€”éƒ½å»ºç«‹åœ¨è¿™ä¸ªåˆçº¦ä¹‹ä¸Šã€‚

è®©æˆ‘ä»¬ä»ç†è§£é¡¶å±‚ç»“æ„å¼€å§‹ã€‚

json

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import "./IDepositBox.sol";

abstract contract BaseDepositBox is IDepositBox {
    address private owner;
    string private secret;
    uint256 private depositTime;

    event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);
    event SecretStored(address indexed owner);

    modifier onlyOwner() {
        require(msg.sender == owner, "Not the box owner");
        _;
    }

    constructor() {
        owner = msg.sender;
        depositTime = block.timestamp;
    }

    function getOwner() public view override returns (address) {
        return owner;
    }

    function transferOwnership(address newOwner) external virtual  override onlyOwner {
        require(newOwner != address(0), "New owner cannot be zero address");
        emit OwnershipTransferred(owner, newOwner);
        owner = newOwner;
    }

    function storeSecret(string calldata _secret) external virtual override onlyOwner {
        secret = _secret;
        emit SecretStored(msg.sender);
    }

    function getSecret() public view virtual override onlyOwner returns (string memory) {
        return secret;
    }

    function getDepositTime() external view virtual  override returns (uint256) {
        return depositTime;
    }
}

```

### **å¯¼å…¥è¯­å¥**

solidity

```
import "./IDepositBox.sol";

```

æˆ‘ä»¬æ­£åœ¨å¯¼å…¥ä¸€ä¸ªåä¸ºÂ `IDepositBox`Â çš„æ¥å£ã€‚å¯ä»¥å°†æ¥å£è§†ä¸ºä¸€ä¸ª**ä»…åŒ…å«å‡½æ•°å£°æ˜è€Œæ²¡æœ‰å®é™…å®ç°çš„åˆçº¦**ã€‚å½“æˆ‘ä»¬å¯¼å…¥å¹¶ç»§æ‰¿è¿™ä¸ªæ¥å£æ—¶ï¼Œå°±æ˜¯åœ¨è¯´ï¼š

> â€œæˆ‘æ‰¿è¯ºå®ç° IDepositBox ä¸­å£°æ˜çš„æ‰€æœ‰å‡½æ•°â€”â€”å³ä½¿ä¸æ˜¯æ‰€æœ‰å‡½æ•°éƒ½åœ¨è¿™é‡Œå®ç°ã€‚â€
> 

è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œæ¯ä¸ªå­˜æ¬¾ç®±éƒ½å¿…é¡»æŒ‰ç…§åŒæ ·çš„æ ‡å‡†æ¥å®ç°åŠŸèƒ½ï¼Œå°±åƒå¤§å®¶éƒ½åœ¨ç”¨åŒä¸€æœ¬è¯´æ˜ä¹¦ï¼Œè¿™æ ·ç»“æ„å°±ä¸ä¼šä¹±ã€‚

---

### **æŠ½è±¡åˆçº¦**

solidity

```

abstract contract BaseDepositBox is IDepositBox

```

å…³é”®å­—Â `abstract`Â è¡¨ç¤ºè¿™ä¸ªåˆçº¦**ä¸èƒ½ç›´æ¥éƒ¨ç½²**ã€‚å®ƒæ˜¯å……å½“å…¶ä»–åˆçº¦æ„å»ºçš„**æ¨¡æ¿**æˆ–**åœ°åŸº**ã€‚

ä¸ºä»€ä¹ˆå®ƒæ˜¯æŠ½è±¡çš„ï¼Ÿ

å› ä¸ºå®ƒæ²¡æœ‰æŠŠæ¥å£é‡Œè§„å®šçš„æ‰€æœ‰åŠŸèƒ½éƒ½å†™å®Œæ•´ã€‚ä¾‹å¦‚ï¼Œå®ƒ**æ²¡æœ‰å®šä¹‰**Â `getBoxType()`Â å‡½æ•°â€”â€”æ¯ä¸ªåé¢çš„å­åˆçº¦ä¼šæœ‰è‡ªå·±çš„ç‰ˆæœ¬ï¼ˆå¦‚â€œåŸºç¡€å‹â€ã€â€œé«˜çº§å‹â€ç­‰ï¼‰ã€‚

æ‰€ä»¥è¿™ä¸ªåŸºç¡€åˆçº¦åªå¤„ç†**é€šç”¨é€»è¾‘**ï¼Œå‰©ä¸‹çš„ç»†èŠ‚ç”±æ¯ä¸ªå…·ä½“çš„é‡‘åº“è‡ªå·±è¡¥å……ã€‚

---

## **ğŸ§± çŠ¶æ€å˜é‡**

solidity

```
address private owner;
string private secret;
uint256 private depositTime;

```

è®©æˆ‘ä»¬åˆ†è§£ä¸€ä¸‹ï¼š

- `owner`ï¼šå­˜å‚¨æ‹¥æœ‰æ­¤å­˜æ¬¾ç®±äººå‘˜çš„åœ°å€ã€‚åªæœ‰æ­¤äººè¢«å…è®¸å­˜å‚¨æˆ–æ£€ç´¢ç§˜å¯†ã€‚
- `secret`ï¼šç”¨æˆ·å¯ä»¥å®‰å…¨åœ°å­˜å‚¨åœ¨è¯¥å­˜æ¬¾ç®±ä¸­çš„ç§æœ‰å­—ç¬¦ä¸²ã€‚
- `depositTime`ï¼šè®°å½•å­˜æ¬¾ç®±éƒ¨ç½²çš„å‡†ç¡®æ—¶é—´ï¼ˆUnix æ—¶é—´æˆ³ï¼‰ã€‚è¿™å¯¹äºåŸºäºæ—¶é—´çš„é€»è¾‘ï¼ˆä¾‹å¦‚ï¼Œé”å®šï¼‰å¾ˆæœ‰ç”¨ã€‚

è¿™äº›å˜é‡éƒ½æ˜¯Â `private`ï¼Œè¡¨ç¤ºå®ƒä»¬åªèƒ½åœ¨å†…éƒ¨è®¿é—®ã€‚å¦‚æœæœ‰äººæƒ³è¯»å–å®ƒä»¬ï¼Œå¿…é¡»é€šè¿‡æˆ‘ä»¬æä¾›çš„**å…¬å…±getter å‡½æ•°**æ¥æŸ¥ã€‚

---

## **ğŸ“£ äº‹ä»¶**

solidity

```
event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);
event SecretStored(address indexed owner);

```

äº‹ä»¶æœ‰åŠ©äºè®°å½•é‡è¦çš„é“¾ä¸Šæ´»åŠ¨ã€‚è¿™äº›å¯¹äºå‰ç«¯å’Œåƒ Etherscan æˆ– TheGraph ç­‰å·¥å…·æœ‰ç”¨ã€‚

- `OwnershipTransferred`ï¼šå½“æœ‰äººè½¬ç§»å­˜æ¬¾ç®±çš„æ‰€æœ‰æƒæ—¶è§¦å‘ã€‚
- `SecretStored`ï¼šå½“å­˜å‚¨æ–°ç§˜å¯†æ—¶è§¦å‘ã€‚

å…³é”®è¯Â `indexed`Â åœ¨æŸ¥è¯¢é“¾ä¸Šæ•°æ®æ—¶ï¼Œå¯ä»¥æ›´è½»æ¾åœ°æŒ‰è¿™äº›å­—æ®µè¿‡æ»¤æ—¥å¿—ã€‚

---

## **ğŸ” ä¿®é¥°ç¬¦ï¼š`onlyOwner`**

solidity

```
modifier onlyOwner() {
    require(msg.sender == owner, "Not the box owner");
    _;
}

```

æ­¤ä¿®é¥°ç¬¦é™åˆ¶å¯¹æŸäº›å‡½æ•°çš„è®¿é—®ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°æ ‡è®°ä¸ºÂ `onlyOwner`ï¼Œé‚£ä¹ˆåªæœ‰å½“å‰æ‰€æœ‰è€…å¯ä»¥è¿è¡Œå®ƒã€‚

å¦åˆ™ï¼Œå‡½æ•°è°ƒç”¨ä¼šå›æ»šï¼Œå¹¶æ˜¾ç¤ºæ¶ˆæ¯Â `"Not the box owner"`ã€‚

æˆ‘ä»¬åœ¨æ¯ä¸ªé‡è¦å‡½æ•°ä¸­ä½¿ç”¨è¿™ä¸ªä¿®é¥°ç¬¦â€”â€”æ¯”å¦‚å­˜å‚¨æœºå¯†æˆ–è½¬ç§»æ‰€æœ‰æƒã€‚

---

## **ğŸ§° å»ºé€ è€…**

solidity

```
constructor() {
    owner = msg.sender;
    depositTime = block.timestamp;
}

```

è¯¥å‡½æ•°åªè¿è¡Œä¸€æ¬¡â€”â€”åœ¨é‡‘åº“éƒ¨ç½²æ—¶ã€‚

- `msg.sender`ï¼šéƒ¨ç½²åˆçº¦çš„äººæˆä¸ºÂ `owner`ã€‚
- `block.timestamp`ï¼šå½“å‰æ—¶é—´ï¼ˆè‡ª Unix çºªå…ƒä»¥æ¥çš„ç§’æ•°ï¼‰è¢«è®°å½•ä¸ºå­˜å…¥æ—¶é—´ã€‚

æ‰€ä»¥ï¼Œè¯¥é‡‘åº“åœ¨åˆ›å»ºæ—¶è‡ªåŠ¨è®¾ç½®æ‰€æœ‰æƒå’Œæ—¶é—´è·Ÿè¸ªã€‚

---

## **ğŸ‘¤Â `getOwner()`**

solidity

```
function getOwner() public view override returns (address) {
    return owner;
}

```

è¿”å›é‡‘åº“çš„å½“å‰æ‰€æœ‰è€…ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ getter å‡½æ•°â€”â€”å¹¶ä¸”æ˜¯Â `IDepositBox`Â æ¥å£æ‰€è¦æ±‚çš„ã€‚

---

## **ğŸ”„Â `transferOwnership()`**

solidity

```
function transferOwnership(address newOwner) external virtual override onlyOwner {
    require(newOwner != address(0), "New owner cannot be zero address");
    emit OwnershipTransferred(owner, newOwner);
    owner = newOwner;
}

```

å…è®¸å½“å‰æ‰€æœ‰è€…å°†æ‰€æœ‰æƒç§»äº¤ç»™å…¶ä»–äººã€‚

- æ£€æŸ¥æ–°çš„æ‰€æœ‰è€…åœ°å€ä¸æ˜¯é›¶åœ°å€ï¼ˆ`0x000...0`ï¼‰â€”â€”å¦åˆ™å°†æ°¸è¿œé”å®šé‡‘åº“ã€‚
- è§¦å‘äº‹ä»¶æ¥è¡¨ç¤ºæ‰€æœ‰æƒå˜æ›´ã€‚

`onlyOwner`Â ä¿®é¥°ç¬¦ç¡®ä¿**åªæœ‰å½“å‰æ‰€æœ‰è€…**å¯ä»¥è½¬ç§»æ‰€æœ‰æƒã€‚

---

## **ğŸ§³Â `storeSecret()`**

solidity

```
function storeSecret(string calldata _secret) external virtual override onlyOwner {
    secret = _secret;
    emit SecretStored(msg.sender);
}

```

è¿™æ˜¯æ‰€æœ‰è€…å°†å­—ç¬¦ä¸²å­˜å‚¨åœ¨é‡‘åº“ä¸­çš„æ–¹å¼ã€‚

- å®ƒåªæ¥å—æ¥è‡ªå½“å‰æ‰€æœ‰è€…ï¼ˆ`onlyOwner`ï¼‰çš„è°ƒç”¨ã€‚
- å°†ç§˜å¯†å­—ç¬¦ä¸²å­˜å‚¨åœ¨ç§æœ‰å˜é‡Â `secret`Â ä¸­ã€‚
- å­˜å‚¨åè§¦å‘ä¸€ä¸ªäº‹ä»¶ã€‚

æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨Â `calldata`ï¼Œå› ä¸ºåœ¨ä¼ é€’å­—ç¬¦ä¸²å‚æ•°æ—¶ï¼Œå®ƒåœ¨ gas ä¸Šæ›´ä¾¿å®œã€‚

---

## **ğŸ”Â `getSecret()`**

solidity

```
function getSecret() public view virtual override onlyOwner returns (string memory) {
    return secret;
}

```

æ­¤å‡½æ•°å…è®¸æ‰€æœ‰è€…æ£€ç´¢å­˜å‚¨çš„ç§˜å¯†ã€‚

- è¿™æ˜¯ä¸€ä¸ªÂ `view`Â å‡½æ•°ï¼Œå› æ­¤å¦‚æœä»å¤–éƒ¨ï¼ˆä¾‹å¦‚ä»å‰ç«¯ï¼‰è°ƒç”¨ï¼Œä¸ä¼šæ¶ˆè€— gasã€‚
- æ ‡è®°ä¸ºÂ `onlyOwner`Â ä»¥ç¡®ä¿éšç§â€”â€”å…¶ä»–ä»»ä½•äººéƒ½æ— æ³•çœ‹åˆ°ç§˜å¯†ã€‚

---

## **ğŸ•’Â `getDepositTime()`**

solidity

```
function getDepositTime() external view virtual override returns (uint256) {
    return depositTime;
}

```

è¿”å›é‡‘åº“éƒ¨ç½²çš„æ—¶é—´ã€‚å¯¹äºåŸºäºæ—¶é—´çš„åŠŸèƒ½å¾ˆæœ‰ç”¨â€”â€”ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªç§˜å¯†åªåœ¨è‹¥å¹²å¤©åæ‰èƒ½è¢«æŸ¥çœ‹ã€‚

## **ğŸ§±Â `BasicDepositBox.sol`Â â€” æœ€ç®€å•çš„æ‰©å±•**

å¥½çš„ï¼Œæ—¢ç„¶æˆ‘ä»¬å·²ç»ç”¨Â `BaseDepositBox`Â åˆçº¦æ„å»ºäº†åšå®çš„åŸºç¡€ï¼Œæ˜¯æ—¶å€™å¼€å§‹åˆ›å»ºç‰¹å®šç±»å‹çš„å­˜æ¬¾ç®±äº†ã€‚

æˆ‘ä»¬ä»æœ€ç®€å•çš„å¼€å§‹ï¼š`BasicDepositBox`ã€‚

æˆ‘ä»¬å…ˆæ¥çœ‹å®Œæ•´çš„ä»£ç ï¼š

solidity

```
// SPDX-License-Identifier: MITpragma solidity ^0.8.0;

import "./BaseDepositBox.sol";

contract BasicDepositBox is BaseDepositBox {
    function getBoxType() external pure override returns (string memory) {
        return "Basic";
    }
}

```

ä¹ä¸€çœ‹ï¼Œè¿™ä¸ªåˆçº¦çœ‹èµ·æ¥éå¸¸çŸ­â€”â€”ç¡®å®å¦‚æ­¤ã€‚ä½†åœ¨åå°ï¼Œå®ƒéå¸¸å¼ºå¤§ï¼Œå› ä¸ºå®ƒç»§æ‰¿äº†Â `BaseDepositBox`Â çš„æ‰€æœ‰å†…å®¹ã€‚

---

## **ğŸ”„ ç»§æ‰¿è‡ªÂ `BaseDepositBox`**

solidity

```
import "./BaseDepositBox.sol";

```

æˆ‘ä»¬é¦–å…ˆå¯¼å…¥åŸºç¡€åˆçº¦ã€‚è¿™ä½¿Â `BasicDepositBox`Â èƒ½å¤Ÿè®¿é—®åŸºç¡€åˆçº¦ä¸­å®šä¹‰çš„**æ‰€æœ‰å†…å®¹**ï¼š

- æ‰€æœ‰æƒç®¡ç†
- ç§˜å¯†å­˜å‚¨å’Œæ£€ç´¢
- å­˜å…¥æ—¶é—´è·Ÿè¸ª
- è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦
- äº‹ä»¶

ç„¶åæˆ‘ä»¬åƒè¿™æ ·å®šä¹‰æ–°åˆçº¦ï¼š

solidity

```
contract BasicDepositBox is BaseDepositBox

```

è¿™æ„å‘³ç€ï¼šâ€œåˆ›å»ºä¸€ä¸ªæ–°åˆçº¦ï¼Œ**ç»§æ‰¿**Â `BaseDepositBox`Â çš„æ‰€æœ‰é€»è¾‘ã€‚â€ æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦é‡å†™æ‰€æœ‰é‚£äº›é€»è¾‘â€”â€”æˆ‘ä»¬åªéœ€é‡å¤ä½¿ç”¨å®ƒã€‚

è¿™å°±æ˜¯ Solidity ä¸­ç»§æ‰¿çš„åŠ›é‡ï¼šä½ å°†æ ¸å¿ƒåŠŸèƒ½åœ¨çˆ¶åˆçº¦ä¸­ç¼–å†™ä¸€æ¬¡ï¼Œç„¶ååœ¨å­åˆçº¦ä¸­æ ¹æ®éœ€è¦æ‰©å±•å®ƒä»¬ã€‚

---

## **ğŸ·ï¸Â `getBoxType()`Â â€” è¯†åˆ«é‡‘åº“ç±»å‹**

solidity

```
function getBoxType() external pure override returns (string memory) {
    return "Basic";
}

```

æ­¤åˆçº¦å®šä¹‰çš„å”¯ä¸€å‡½æ•°ï¼Œå®ƒæ˜¯ä¸ºäº†å±¥è¡Œå¯¹Â `IDepositBox`Â æ¥å£çš„æ‰¿è¯ºã€‚

è®©æˆ‘ä»¬åˆ†è§£ä¸€ä¸‹ï¼š

- `external`ï¼šæ­¤å‡½æ•°ä»…ç”¨äºä»åˆçº¦å¤–éƒ¨è°ƒç”¨ï¼ˆä¾‹å¦‚ï¼Œä»å¦ä¸€ä¸ªåˆçº¦æˆ–å‰ç«¯ï¼‰ã€‚
- `pure`ï¼šå®ƒä¸è¯»å–æˆ–å†™å…¥ä»»ä½•å­˜å‚¨â€”â€”å®ƒåªæ˜¯è¿”å›ä¸€ä¸ªç¡¬ç¼–ç çš„å­—ç¬¦ä¸²ã€‚
- `override`ï¼šå®ƒï¼ˆå½“å‰å‡½æ•°ï¼‰æ­£åœ¨é‡å†™åœ¨Â `IDepositBox`Â ä¸­å£°æ˜çš„**æŠ½è±¡**Â `getBoxType()`Â å‡½æ•°ï¼ˆå¹¶ä¸”è¯¥å‡½æ•°åœ¨Â `BaseDepositBox`Â ä¸­æœªè¢«å®ç°ï¼‰ã€‚
- `returns (string memory)`ï¼šå®ƒè¿”å›é‡‘åº“ç±»å‹â€”â€”åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯Â `"Basic"`ã€‚

ä¸ºä»€ä¹ˆæœ‰ç”¨ï¼Ÿ

å‡è®¾ä½ éƒ¨ç½²äº†è®¸å¤šé‡‘åº“â€”â€”åŸºç¡€å‹ã€é«˜çº§å‹å’Œæ—¶é—´é”å‹â€”â€”å¹¶ä¸”ä½ æƒ³çŸ¥é“æ¯ä¸ªé‡‘åº“æ˜¯ä»€ä¹ˆç±»å‹ã€‚ä½ å¯ä»¥ç®€å•åœ°è°ƒç”¨Â `getBoxType()`Â å¹¶è·å–ä¸€ä¸ªäººå¯è¯»çš„æ ‡ç­¾ã€‚

è¿™åœ¨æ„å»ºä»¥ä¸‹å†…å®¹æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼š

- æ˜¾ç¤ºä½ é‡‘åº“çš„å‰ç«¯ä»ªè¡¨æ¿
- `VaultManager`Â åˆçº¦ä¸­çš„æ’åºé€»è¾‘
- é“¾ä¸Šåˆ†æ

---

## **ğŸ§  è¿™ä¸ªåˆçº¦å®é™…åšä»€ä¹ˆ**

è™½ç„¶åªæœ‰å‡ è¡Œä»£ç ï¼Œ`BasicDepositBox`Â ä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåŠŸèƒ½é½å…¨ã€å®‰å…¨ã€ç”±æ‰€æœ‰è€…æ§åˆ¶çš„å­˜æ¬¾ç®±ã€‚

å®ƒå¯ä»¥ï¼š

- å­˜å‚¨ä¸€ä¸ªç§˜å¯†å­—ç¬¦ä¸²ï¼ˆåªæœ‰æ‰€æœ‰è€…å¯ä»¥è®¾ç½®æˆ–æ£€ç´¢å®ƒï¼‰
- å°†æ‰€æœ‰æƒè½¬ç§»ç»™å…¶ä»–äºº
- åœ¨å­˜å‚¨ç§˜å¯†æˆ–æ›´æ”¹æ‰€æœ‰è€…æ—¶è§¦å‘äº‹ä»¶
- å°†å…¶è‡ªèº«é‡‘åº“ç±»å‹æŠ¥å‘Šä¸ºÂ `"Basic"`

æ‰€æœ‰è¿™äº›èƒ½åŠ›éƒ½æ¥è‡ª**åŸºç¡€åˆçº¦**â€”â€”æˆ‘ä»¬åªæ˜¯æ·»åŠ äº†ä¸€ä¸ªç‰¹å®šçš„æ ‡ç­¾æ¥è¯†åˆ«è¿™ç§ç±»å‹çš„é‡‘åº“ã€‚

## **ğŸ’Â `PremiumDepositBox.sol`Â â€” å…·å¤‡é¢å¤–çš„å…ƒæ•°æ®èƒ½åŠ›**

è¿™æ¬¡ï¼Œæˆ‘ä»¬å†æ¬¡æ„å»ºåœ¨Â `BaseDepositBox`Â ä¹‹ä¸Šâ€”â€”ä½†ç°åœ¨æˆ‘ä»¬ç»™å­˜æ¬¾ç®±**ä¸€äº›é¢å¤–çš„ä¸œè¥¿**ï¼šä¸€ä¸ªå«åšÂ `metadata`Â çš„æ•°æ®ç‰‡æ®µã€‚

å¯ä»¥å°†å…¶è§†ä¸ºä¸€ä¸ªä¸ªæ€§åŒ–çš„æ ‡ç­¾ã€æ ‡è®°æˆ–ä¿¡æ¯å­—æ®µï¼Œæ‰€æœ‰è€…å¯ä»¥è®¾ç½®å®ƒã€‚å®ƒå¯ä»¥æè¿°ç§˜å¯†çš„å†…å®¹ã€åº”è¯¥åœ¨ä½•æ—¶è®¿é—®ï¼Œæˆ–è€…ä»»ä½•ä½ æƒ³è¦é™„åŠ çš„æ³¨é‡Šã€‚

è¿™æ˜¯å®Œæ•´çš„åˆçº¦ï¼š

solidity

```
// SPDX-License-Identifier: MITpragma solidity ^0.8.0;

import "./BaseDepositBox.sol";

contract PremiumDepositBox is BaseDepositBox {
    string private metadata;

    event MetadataUpdated(address indexed owner);

    function getBoxType() external pure override returns (string memory) {
        return "Premium";
    }

    function setMetadata(string calldata _metadata) external onlyOwner {
        metadata = _metadata;
        emit MetadataUpdated(msg.sender);
    }

    function getMetadata() external view onlyOwner returns (string memory) {
        return metadata;
    }
}

```

ç°åœ¨è®©æˆ‘ä»¬é€æ­¥è®²è§£æ¯ä¸ªéƒ¨åˆ†ã€‚

---

## **âœ… ç»§æ‰¿å’Œå¯¼å…¥**

solidity

```
import "./BaseDepositBox.sol";

contract PremiumDepositBox is BaseDepositBox {

```

å’Œä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬ä»Â `BaseDepositBox`Â å¯¼å…¥åŸºç¡€é€»è¾‘ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿè®¿é—®ï¼š

- æ‰€æœ‰æƒæ£€æŸ¥
- ç§˜å¯†å­˜å‚¨
- äº‹ä»¶è®°å½•
- å­˜å…¥æ—¶é—´æˆ³

æˆ‘ä»¬é€šè¿‡å£°æ˜Â `PremiumDepositBox`Â ä¸ºÂ `BaseDepositBox`Â çš„å­ç±»æ¥**æ‰©å±•**å®ƒã€‚

è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥**é‡ç”¨æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½**ï¼Œå¹¶åªå…³æ³¨è¿™ä¸ªç‰ˆæœ¬çš„ä¸åŒä¹‹å¤„â€”â€”å³å…ƒæ•°æ®ã€‚

---

## **ğŸ§¾Â `metadata`Â â€” ä¸€ä¸ªæ–°çš„ç§æœ‰å­—æ®µ**

solidity

```
string private metadata;

```

æˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªæ–°çš„çŠ¶æ€å˜é‡ï¼Œç§°ä¸ºÂ `metadata`ã€‚

å®ƒè¢«æ ‡è®°ä¸ºÂ `private`ï¼Œè¿™æ„å‘³ç€åªæœ‰**æ­¤åˆçº¦å†…**çš„å‡½æ•°å¯ä»¥è¯»å–æˆ–ä¿®æ”¹å®ƒã€‚ï¼ˆæˆ‘ä»¬å°†ä¸ºæ‰€æœ‰è€…åˆ›å»ºå¤–éƒ¨è®¿é—®å‡½æ•°ã€‚ï¼‰

è¿™å¯ä»¥ç”¨äºä»»ä½•ä¸œè¥¿â€”â€”æ¯”å¦‚ä¸€ä¸ªæ ‡ç­¾å¦‚â€œå¤‡ä»½å¯†é’¥â€ï¼Œæˆ–è€…ä¸€ä¸ªæ³¨é‡Šå¦‚â€œé€€ä¼‘åè®¿é—®â€ï¼Œç­‰ç­‰ã€‚

---

## **ğŸ“¢Â `MetadataUpdated`Â äº‹ä»¶**

solidity

```
event MetadataUpdated(address indexed owner);

```

å°±åƒå½“æœ‰äººå­˜å‚¨ç§˜å¯†æˆ–è½¬ç§»æ‰€æœ‰æƒæ—¶æˆ‘ä»¬ä¼šå‘å‡ºäº‹ä»¶ä¸€æ ·ï¼Œå½“æœ‰äººæ›´æ–°å…ƒæ•°æ®æ—¶æˆ‘ä»¬ä¹Ÿä¼šæ‰§è¡ŒåŒæ ·çš„äº‹æƒ…ã€‚

å› ä¸ºï¼š

- å®ƒæœ‰åŠ©äºé“¾ä¸‹ç³»ç»Ÿï¼ˆå‰ç«¯ã€æµè§ˆå™¨ï¼‰è·Ÿè¸ªå˜åŒ–
- å®ƒæé«˜äº†é€æ˜åº¦
- å®ƒä½¿è°ƒè¯•æ›´å®¹æ˜“

æˆ‘ä»¬è¿˜å°†Â `owner`Â æ ‡è®°ä¸ºÂ `indexed`ï¼Œä»¥ä¾¿åœ¨æ—¥å¿—ä¸­ä¾¿äºè¿‡æ»¤æˆ–æœç´¢ã€‚

---

## **ğŸ·ï¸Â `getBoxType()`Â â€” è¯†åˆ«é‡‘åº“ç±»å‹**

solidity

```
function getBoxType() external pure override returns (string memory) {
    return "Premium";
}

```

å’Œä¹‹å‰ä¸€æ ·â€”â€”è¿™å‘Šè¯‰æˆ‘ä»¬è¿™æ˜¯ä»€ä¹ˆç±»å‹çš„å­˜æ¬¾ç®±ã€‚

å®ƒè¿”å›Â `"Premium"`ï¼Œè¿™æœ‰åŠ©äºå…¶ä»–åˆçº¦æˆ–å‰ç«¯æ­£ç¡®è¯†åˆ«å’Œæ ‡è®°å®ƒã€‚

è¿™æ˜¯Â `IDepositBox`Â æ¥å£æ‰€è¦æ±‚çš„ï¼Œå¹¶å¸®åŠ©æˆ‘ä»¬åŒºåˆ†ä¸åŒçš„é‡‘åº“ç±»å‹ï¼ˆåŸºç¡€å‹ã€é«˜çº§å‹ã€æ—¶é—´é”å‹ï¼‰ã€‚

---

## **âœï¸Â `setMetadata()`Â â€” æ‰€æœ‰è€…å¯ä»¥è¯»å–**

solidity

```
function setMetadata(string calldata _metadata) external onlyOwner {
    metadata = _metadata;
    emit MetadataUpdated(msg.sender);
}

```

è®©æˆ‘ä»¬è§£æä¸€ä¸‹ï¼š

- `external`ï¼šåªèƒ½ä»åˆçº¦å¤–éƒ¨è°ƒç”¨ï¼ˆä¸èƒ½ä»å†…éƒ¨è°ƒç”¨ï¼‰
- `onlyOwner`ï¼šä½¿ç”¨æˆ‘ä»¬ä»Â `BaseDepositBox`Â ç»§æ‰¿çš„ä¿®é¥°ç¬¦æ¥é™åˆ¶è®¿é—®â€”â€”åªæœ‰é‡‘åº“æ‰€æœ‰è€…å¯ä»¥æ›´æ–°å…ƒæ•°æ®
- `string calldata _metadata`ï¼šæ–°çš„å…ƒæ•°æ®å€¼ä½œä¸ºå‚æ•°ä¼ å…¥
- `metadata = _metadata`ï¼šæˆ‘ä»¬æ›´æ–°å­˜å‚¨çš„å€¼
- `emit MetadataUpdated(msg.sender)`ï¼šæˆ‘ä»¬è®°å½•å˜æ›´ä»¥ç¡®ä¿é€æ˜åº¦

è¿™ä¸ºæ‰€æœ‰è€…æä¾›äº†ä¸€ç§å¯ä»¥å°†æ³¨é‡Šã€ç±»åˆ«æˆ–æ ‡ç­¾é™„åŠ åˆ°ä»–ä»¬çš„é‡‘åº“ä¸Šçš„æ–¹æ³•ã€‚

---

## **ğŸ“¬Â `getMetadata()`Â â€” æ‰€æœ‰è€…å¯ä»¥è¯»å–å®ƒ**

solidity

```
function getMetadata() external view onlyOwner returns (string memory) {
    return metadata;
}

```

æ­¤å‡½æ•°å…è®¸æ‰€æœ‰è€…**æ£€ç´¢**ä»–ä»¬ä¹‹å‰å­˜å‚¨çš„å…ƒæ•°æ®ã€‚

å®ƒæ˜¯Â `view`ï¼Œå› ä¸ºå®ƒåªæ˜¯ä»å­˜å‚¨ä¸­è¯»å–è€Œä¸æ”¹å˜ä»»ä½•ä¸œè¥¿ã€‚

åŒæ ·ï¼Œå®ƒå—åˆ°Â `onlyOwner`Â çš„ä¿æŠ¤â€”â€”å…¶ä»–ä»»ä½•äººéƒ½çœ‹ä¸åˆ°ä½ å†™çš„å†…å®¹ã€‚

## **â³Â `TimeLockedDepositBox.sol`Â â€” æš‚æ—¶æ— æ³•æ‰“å¼€çš„é‡‘åº“**

è¿™ä¸ªåˆçº¦å¼•å…¥äº†ä¸€ä¸ªè½¬æŠ˜ï¼š**ä½ å¯ä»¥å­˜å‚¨ä¸€ä¸ªç§˜å¯†ï¼Œä½†åœ¨ç‰¹å®šæ—¶é—´è¿‡å»ä¹‹å‰ä½ æ— æ³•æ£€ç´¢å®ƒ**ã€‚

è¿™å°±åƒä¸€ä¸ªæ•°å­—é‡‘åº“ï¼Œåœ¨ä¸€æ®µè®¾å®šçš„æ—¶é—´å†…ä¿æŒé”å®šâ€”â€”æ— è®ºä½ å¤šä¹ˆæƒ³æ‰“å¼€å®ƒï¼Œä½ éƒ½å¿…é¡»ç­‰å¾…ã€‚

æˆ‘ä»¬å†æ¬¡ä»æˆ‘ä»¬ä¿¡ä»»çš„Â `BaseDepositBox`Â ç»§æ‰¿ï¼Œä½†è¿™æ¬¡æˆ‘ä»¬æ·»åŠ äº†**å®šæ—¶é€»è¾‘**æ¥æ§åˆ¶ç§˜å¯†ä½•æ—¶å˜å¾—å¯è®¿é—®ã€‚

è®©æˆ‘ä»¬å…ˆé€šè¯»å®Œæ•´çš„åˆçº¦ï¼Œç„¶åé€è¡Œè§£é‡Šã€‚

### **âœ… å®Œæ•´åˆçº¦**

solidity

```
// SPDX-License-Identifier: MITpragma solidity ^0.8.0;

import "./BaseDepositBox.sol";

contract TimeLockedDepositBox is BaseDepositBox {
    uint256 private unlockTime;

    constructor(uint256 lockDuration) {
        unlockTime = block.timestamp + lockDuration;
    }

    modifier timeUnlocked() {
        require(block.timestamp >= unlockTime, "Box is still time-locked");
        _;
    }

    function getBoxType() external pure override returns (string memory) {
        return "TimeLocked";
    }

    function getSecret() public view override onlyOwner timeUnlocked returns (string memory) {
        return super.getSecret();
    }

    function getUnlockTime() external view returns (uint256) {
        return unlockTime;
    }

    function getRemainingLockTime() external view returns (uint256) {
        if (block.timestamp >= unlockTime) return 0;
        return unlockTime - block.timestamp;
    }
}

```

---

## **ğŸ”„ ç»§æ‰¿å’Œå¯¼å…¥**

solidity

```
import "./BaseDepositBox.sol";

contract TimeLockedDepositBox is BaseDepositBox {

```

å°±åƒÂ `BasicDepositBox`Â å’ŒÂ `PremiumDepositBox`Â ä¸€æ ·ï¼Œæˆ‘ä»¬ä»Â `BaseDepositBox`Â å¯¼å…¥å…±äº«åŸºç¡€é€»è¾‘ã€‚

æˆ‘ä»¬ç»§æ‰¿äº†æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼š

- æ‰€æœ‰è€…è·Ÿè¸ª
- ç§˜å¯†å­˜å‚¨
- å­˜å…¥æ—¶é—´
- äº‹ä»¶æ—¥å¿—è®°å½•

æˆ‘ä»¬è¿˜ä¼šåœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ æ—¶é—´é”åŠŸèƒ½ã€‚

---

## **ğŸ§­Â `unlockTime`Â â€” é”å®šè®¡æ—¶å™¨**

solidity

```
uint256 private unlockTime;

```

æ­¤å˜é‡å­˜å‚¨äº†ç§˜å¯†å¯è®¿é—®æ—¶çš„**æ—¶é—´æˆ³**ã€‚

å®ƒæ˜¯Â `private`ï¼Œæ„å‘³ç€æ²¡æœ‰äººå¯ä»¥ç›´æ¥è®¿é—®å®ƒâ€”â€”ä½†æˆ‘ä»¬ä¼šé€šè¿‡ getter å‡½æ•°å…¬å¼€å®ƒã€‚

---

## **ğŸ—ï¸ æ„é€ å‡½æ•° â€” é”å®šäº‹åŠ¡**

solidity

```
constructor(uint256 lockDuration) {
    unlockTime = block.timestamp + lockDuration;
}

```

ä»¥ä¸‹æ˜¯å‘ç”Ÿçš„äº‹æƒ…ï¼š

- å½“åˆçº¦éƒ¨ç½²æ—¶ï¼Œæ„é€ å‡½æ•°ä¼šé‡‡ç”¨ä¸€ä¸ªæ•°å­—ï¼š`lockDuration`ï¼Œä»¥**ç§’**ä¸ºå•ä½ã€‚
- å®ƒå°†è¿™ä¸ªæŒç»­æ—¶é—´åŠ åˆ°å½“å‰æ—¶é—´æˆ³ï¼ˆ`block.timestamp`ï¼‰ä¸Šï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºÂ `unlockTime`ã€‚

æ‰€ä»¥å¦‚æœä½ ä¼ å…¥Â `3600`ï¼ˆ1 å°æ—¶ï¼‰ï¼Œç§˜å¯†å°†ä»éƒ¨ç½²èµ·é”å®š 1 å°æ—¶ã€‚

è¿™ä½¿å¾—åˆçº¦éå¸¸çµæ´»â€”â€”ä½ å¯ä»¥å°†ç§˜å¯†é”å®šå‡ åˆ†é’Ÿã€å‡ å°æ—¶ã€å‡ å¤©æˆ–å‡ å¹´ã€‚

---

## **ğŸ”Â `timeUnlocked`Â ä¿®é¥°ç¬¦ â€” è®¿é—®å®ˆé—¨å‘˜**

solidity

```
modifier timeUnlocked() {
    require(block.timestamp >= unlockTime, "Box is still time-locked");
    _;
}

```

è¿™æ˜¯ä¸€ä¸ª**è‡ªå®šä¹‰ä¿®é¥°ç¬¦**â€”â€”å°±åƒÂ `onlyOwner`Â ä¸€æ ·â€”â€”ä½†å®ƒä¼šæ£€æŸ¥å½“å‰æ—¶é—´æ˜¯å¦å·²è¶…è¿‡è§£é”æ—¶é—´ã€‚

å¦‚æœæ²¡æœ‰ï¼Œå‡½æ•°è°ƒç”¨å°†è¢«æ‹’ç»å¹¶æŠ¥é”™ã€‚

æˆ‘ä»¬ä¼šåœ¨ä»»ä½•åº”å—æ—¶é—´é”ä¿æŠ¤çš„å‡½æ•°ä¸Šä½¿ç”¨è¿™ä¸ªä¿®é¥°ç¬¦ã€‚

---

## **ğŸ“¦Â `getBoxType()`**

solidity

```
function getBoxType() external pure override returns (string memory) {
    return "TimeLocked";
}

```

å°±åƒå…¶ä»–å­˜æ¬¾ç®±ç±»å‹ä¸€æ ·ï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬è¯†åˆ«è¿™æ˜¯å“ªç§å­˜æ¬¾ç®±ã€‚

å®ƒè¿”å›å­—ç¬¦ä¸²Â `"TimeLocked"`Â å¹¶å®ç°Â `IDepositBox`Â æ¥å£ã€‚

---

## **ğŸ”Â `getSecret()`Â â€” ä½†ä»…åœ¨é”å®šä¹‹å**

solidity

```
function getSecret() public view override onlyOwner timeUnlocked returns (string memory) {
    return super.getSecret();
}

```

è¿™ä¸ªå‡½æ•°é‡å†™äº†Â `BaseDepositBox`Â ä¸­çš„å¸¸è§„å‡½æ•°Â `getSecret()`Â ã€‚

ä½†ç°åœ¨ï¼Œå®ƒå¢åŠ äº†**ä¸¤ä¸ª**è®¿é—®æ£€æŸ¥ï¼š

1. `onlyOwner`ï¼šåªæœ‰é‡‘åº“æ‰€æœ‰è€…å¯ä»¥æŸ¥çœ‹ç§˜å¯†ã€‚
2. `timeUnlocked`ï¼šåªæœ‰åœ¨è§£é”æ—¶é—´è¿‡å»åã€‚

ç„¶åå®ƒè°ƒç”¨Â `super.getSecret()`Â ä»åŸºç¡€åˆçº¦ä¸­æ£€ç´¢å®é™…ç§˜å¯†ã€‚

è¿™ç§åˆ†å±‚ä¿æŒäº†ä»£ç çš„æ•´æ´ï¼Œå¹¶é¿å…äº†é€»è¾‘é‡å¤ã€‚

---

## **ğŸ“…Â `getUnlockTime()`Â â€” ä½•æ—¶è§£é”ï¼Ÿ**

solidity

```
function getUnlockTime() external view returns (uint256) {
    return unlockTime;
}

```

è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ getter å‡½æ•°ï¼Œå®ƒå¯ä»¥å‘Šè¯‰æ‚¨ç›’å­è§£é”çš„**ç¡®åˆ‡æ—¶é—´æˆ³** ã€‚

å¯¹äºå‰ç«¯å’Œæ˜¾ç¤ºç›®çš„å¾ˆæœ‰ç”¨ã€‚

---

## **â±ï¸Â `getRemainingLockTime()`Â â€” å€’è®¡æ—¶åŠ©æ‰‹**

solidity

```
function getRemainingLockTime() external view returns (uint256) {
    if (block.timestamp >= unlockTime) return 0;
    return unlockTime - block.timestamp;
}

```

è¿™æ˜¯å¦ä¸€ä¸ªå¯¹å‰ç«¯å‹å¥½çš„åŠ©æ‰‹ã€‚

- å¦‚æœå½“å‰æ—¶é—´å·²ç»è¶…è¿‡äº†è§£é”æ—¶é—´ï¼Œæˆ‘ä»¬è¿”å›Â `0`ã€‚
- å¦åˆ™ï¼Œæˆ‘ä»¬ä»Â `unlockTime`Â ä¸­å‡å»Â `now`Â çš„æ—¶é—´ï¼Œå¹¶è¿”å›é‡‘åº“å¯æ‰“å¼€æ‰€éœ€çš„**å‰©ä½™ç§’æ•°**ã€‚

å¯¹äºåœ¨ä½ çš„ UI ä¸­åˆ›å»ºå€’è®¡æ—¶ã€è®¡æ—¶å™¨æˆ–å¯è§†åŒ–è¿›åº¦æ¡éå¸¸æœ‰ç”¨ã€‚

## **ğŸ§± VaultManager â€” ä½ çš„é‡‘åº“ä»ªè¡¨æ¿**

è¿™ä¸ªåˆçº¦å……å½“**æ§åˆ¶ä¸­å¿ƒ**ï¼Œä¾›ç”¨æˆ·åˆ›å»ºã€å‘½åã€ç®¡ç†å’Œä¸ä»–ä»¬çš„å­˜æ¬¾ç®±äº¤äº’ã€‚

å¯ä»¥å°†å…¶è§†ä¸ºä½ çš„**é‡‘åº“åº”ç”¨åç«¯**ï¼š

- å®ƒå…è®¸ç”¨æˆ·åˆ›å»ºä¸åŒç±»å‹çš„å­˜æ¬¾ç®±ï¼ˆåŸºç¡€å‹ã€é«˜çº§å‹ã€æ—¶é—´é”å‹ï¼‰ã€‚
- å®ƒè·Ÿè¸ªå“ªä¸ªç”¨æˆ·æ‹¥æœ‰å“ªä¸ªå­˜æ¬¾ç®±ã€‚
- å®ƒå¼ºåˆ¶æ‰§è¡Œæ‰€æœ‰æƒè§„åˆ™ã€‚
- å®ƒæä¾›å‘½åå’Œæ£€ç´¢å­˜æ¬¾ç®±ä¿¡æ¯çš„è¾…åŠ©å‡½æ•°ã€‚

---

## **âœ… å®Œæ•´åˆçº¦ä»£ç ï¼ˆä¾›å‚è€ƒï¼‰**

solidity

```
// SPDX-License-Identifier: MITpragma solidity ^0.8.0;

import "./IDepositBox.sol";
import "./BasicDepositBox.sol";
import "./PremiumDepositBox.sol";
import "./TimeLockedDepositBox.sol";

contract VaultManager {
    mapping(address => address[]) private userDepositBoxes;
    mapping(address => string) private boxNames;

    event BoxCreated(address indexed owner, address indexed boxAddress, string boxType);
    event BoxNamed(address indexed boxAddress, string name);

    function createBasicBox() external returns (address) {
        BasicDepositBox box = new BasicDepositBox();
        userDepositBoxes[msg.sender].push(address(box));
        emit BoxCreated(msg.sender, address(box), "Basic");
        return address(box);
    }

    function createPremiumBox() external returns (address) {
        PremiumDepositBox box = new PremiumDepositBox();
        userDepositBoxes[msg.sender].push(address(box));
        emit BoxCreated(msg.sender, address(box), "Premium");
        return address(box);
    }

    function createTimeLockedBox(uint256 lockDuration) external returns (address) {
        TimeLockedDepositBox box = new TimeLockedDepositBox(lockDuration);
        userDepositBoxes[msg.sender].push(address(box));
        emit BoxCreated(msg.sender, address(box), "TimeLocked");
        return address(box);
    }

    function nameBox(address boxAddress, string calldata name) external {
        IDepositBox box = IDepositBox(boxAddress);
        require(box.getOwner() == msg.sender, "Not the box owner");

        boxNames[boxAddress] = name;
        emit BoxNamed(boxAddress, name);
    }

    function storeSecret(address boxAddress, string calldata secret) external {
        IDepositBox box = IDepositBox(boxAddress);
        require(box.getOwner() == msg.sender, "Not the box owner");

        box.storeSecret(secret);
    }

    function transferBoxOwnership(address boxAddress, address newOwner) external {
        IDepositBox box = IDepositBox(boxAddress);
        require(box.getOwner() == msg.sender, "Not the box owner");

        box.transferOwnership(newOwner);

        address[] storage boxes = userDepositBoxes[msg.sender];
        for (uint i = 0; i < boxes.length; i++) {
            if (boxes[i] == boxAddress) {
                boxes[i] = boxes[boxes.length - 1];
                boxes.pop();
                break;
            }
        }

        userDepositBoxes[newOwner].push(boxAddress);
    }

    function getUserBoxes(address user) external view returns (address[] memory) {
        return userDepositBoxes[user];
    }

    function getBoxName(address boxAddress) external view returns (string memory) {
        return boxNames[boxAddress];
    }

    function getBoxInfo(address boxAddress) external view returns (
        string memory boxType,
        address owner,
        uint256 depositTime,
        string memory name
    ) {
        IDepositBox box = IDepositBox(boxAddress);
        return (
            box.getBoxType(),
            box.getOwner(),
            box.getDepositTime(),
            boxNames[boxAddress]
        );
    }
}

```

## **ğŸ§© å¯¼å…¥**

solidity

```
import "./IDepositBox.sol";
import "./BasicDepositBox.sol";
import "./PremiumDepositBox.sol";
import "./TimeLockedDepositBox.sol";

```

- `IDepositBox`ï¼šæˆ‘ä»¬ç”¨æ¥ä»¥ç»Ÿä¸€æ–¹å¼ä¸æ‰€æœ‰ç±»å‹å­˜æ¬¾ç®±äº¤äº’çš„æ¥å£ã€‚
- å…¶ä»–ä¸‰ä¸ªæ˜¯å…·ä½“å®ç°ï¼ˆå®é™…å¯éƒ¨ç½²çš„åˆçº¦ï¼‰ã€‚

**ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ¥å£ï¼Ÿ**

å› ä¸ºå®ƒè®©æˆ‘ä»¬ä»¥ç›¸åŒçš„æ–¹å¼å¤„ç†æ¯ä¸ªå­˜æ¬¾ç®±ï¼Œæ— è®ºå…¶å…·ä½“ç±»å‹å¦‚ä½•ã€‚æ‰€æœ‰å­˜æ¬¾ç®±éƒ½éµå¾ªç›¸åŒçš„è§„åˆ™ï¼ˆ`getOwner()`ã€`storeSecret()`Â ç­‰ï¼‰ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è°ƒç”¨è¿™äº›å…±äº«å‡½æ•°æ—¶ï¼Œä¸éœ€è¦åœ¨æ„å­˜æ¬¾ç®±æ˜¯ä»€ä¹ˆç±»å‹ã€‚

---

## **ğŸ§  çŠ¶æ€å˜é‡**

solidity

```
mapping(address => address[]) private userDepositBoxes;
mapping(address => string) private boxNames;

```

- `userDepositBoxes`ï¼šå°†ç”¨æˆ·çš„åœ°å€æ˜ å°„åˆ°å…¶æ‹¥æœ‰çš„æ‰€æœ‰å­˜æ¬¾ç®±ï¼ˆä½œä¸ºåˆçº¦åœ°å€ï¼‰ã€‚
- `boxNames`ï¼šå…è®¸ç”¨æˆ·ä¸ºæ¯ä¸ªé‚®ç®±åˆ†é…è‡ªå®šä¹‰åç§°ã€‚æŒ‰é‚®ç®±åœ°å€å­˜å‚¨ã€‚

---

## **ğŸ”” äº‹ä»¶**

solidity

```
event BoxCreated(address indexed owner, address indexed boxAddress, string boxType);
event BoxNamed(address indexed boxAddress, string name);

```

- `BoxCreated`ï¼šæ¯æ¬¡ç”¨æˆ·åˆ›å»ºæ–°å­˜æ¬¾ç®±æ—¶è§¦å‘ã€‚
- `BoxNamed`ï¼šå½“ç”¨æˆ·ç»™ä»–ä»¬çš„å­˜æ¬¾ç®±è‡ªå®šä¹‰åç§°æ—¶è§¦å‘ã€‚

è¿™äº›æœ‰åŠ©äºå‰ç«¯å’Œæµè§ˆå™¨æ˜¾ç¤ºå‘ç”Ÿçš„æ“ä½œã€‚

---

## **ğŸ—ï¸ createBasicBox åˆ›å»ºåŸºç¡€**å­˜æ¬¾ç®±

solidity

```
function createBasicBox() external returns (address) {
    BasicDepositBox box = new BasicDepositBox();
    userDepositBoxes[msg.sender].push(address(box));
    emit BoxCreated(msg.sender, address(box), "Basic");
    return address(box);
}

```

### **åˆ†è§£ï¼š**

- `BasicDepositBox box = new BasicDepositBox();`ï¼šè¿™è¡Œä»£ç **éƒ¨ç½²ä¸€ä¸ªæ–°çš„ BasicDepositBox åˆçº¦**å¹¶å°†å…¶åœ°å€å­˜å‚¨åœ¨å˜é‡Â `box`Â ä¸­ã€‚
- `userDepositBoxes[msg.sender].push(...)`ï¼šå°†æ–°å­˜æ¬¾ç®±æ·»åŠ åˆ°å‘é€è€…æ‹¥æœ‰çš„å­˜æ¬¾ç®±åˆ—è¡¨ä¸­ã€‚
- è§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œä»¥ä¾¿ UI å¯ä»¥è·Ÿè¸ªæ­¤åˆ›å»ºã€‚
- è¿”å›æ–°å­˜æ¬¾ç®±çš„åœ°å€ä»¥ä¾¿äºè®¿é—®ã€‚

ğŸ§ Â *è¿™å°±æ˜¯ç”¨æˆ·ä¸ºè‡ªå·±â€œé“¸é€ â€ä¸€ä¸ªæ–°æ•°å­—*å­˜æ¬¾ç®±*çš„æ–¹å¼ã€‚*

---

## **ğŸ—ï¸Â `createPremiumBox()`Â â€” é€‚ç”¨äºæƒ³è¦å­˜å‚¨é¢å¤–å…ƒæ•°æ®çš„ç”¨æˆ·**

solidity

```
function createPremiumBox() external returns (address) {
    PremiumDepositBox box = new PremiumDepositBox();
    userDepositBoxes[msg.sender].push(address(box));
    emit BoxCreated(msg.sender, address(box), "Premium");
    return address(box);
}

```

### **è¿™ä¸ªå‡½æ•°èµ·ä»€ä¹ˆä½œç”¨ï¼Ÿ**

å…è®¸ç”¨æˆ·åˆ›å»ºä¸€ä¸ªæ–°çš„Â **PremiumDepositBox**Â â€”â€” ä¸€ç§ç‰¹æ®Šç±»å‹çš„å­˜æ¬¾ç®±ï¼Œé€šè¿‡Â `setMetadata()`Â å‡½æ•°æ”¯æŒé¢å¤–æ•°æ®ã€‚

è®©æˆ‘ä»¬é€è¡Œè®²è§£ï¼š

---

### **1. éƒ¨ç½²æ–°çš„ PremiumDepositBox**

solidity

```

PremiumDepositBox box = new PremiumDepositBox();

```

è¿™è¡Œä»£ç **åˆ›å»ºäº†ä¸€ä¸ªå…¨æ–°çš„åˆçº¦**Â `PremiumDepositBox`Â ã€‚åå°æ˜¯è¿™æ ·çš„ï¼š

- ç»§æ‰¿è‡ªÂ `BaseDepositBox`ï¼Œä»è€Œè·å¾—è·å¾—æ‰€æœ‰æƒã€ç§˜å¯†å­˜å‚¨ã€å­˜å…¥æ—¶é—´ç­‰ä¿¡æ¯ã€‚
- æ·»åŠ ä¸€ä¸ªåä¸ºÂ `metadata`Â çš„æ–°çŠ¶æ€å˜é‡ä»¥ä¾¿æ›´æ–°/æ£€ç´¢ã€‚

å½“è¿™è¡Œä»£ç è¿è¡Œæ—¶ï¼Œåˆçº¦è¢«**éƒ¨ç½²åœ¨é“¾ä¸Š**ï¼Œè°ƒç”¨Â `createPremiumBox()`Â çš„ç”¨æˆ·æˆä¸ºè¯¥å­˜æ¬¾ç®±çš„æ‰€æœ‰è€…ï¼ˆæ„Ÿè°¢æ„é€ å‡½æ•°Â `BaseDepositBox`Â ï¼‰ã€‚

---

### **2. å°†**å­˜æ¬¾ç®±**ä¿å­˜åœ¨ç”¨æˆ·çš„**å­˜æ¬¾ç®±**åˆ—è¡¨ä¸­**

solidity

```

userDepositBoxes[msg.sender].push(address(box));

```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ï¼š

- ä½¿ç”¨Â `address(box)`Â å°†åˆçº¦è½¬æ¢ä¸ºå…¶åœ°å€
- å°†è¯¥åœ°å€æ·»åŠ åˆ°åˆ›å»ºå®ƒçš„ç”¨æˆ·çš„Â `userDepositBoxes`Â æ˜ å°„ä¸­

è¿™ç¡®ä¿äº†å½“ç”¨æˆ·ç¨åæƒ³æ£€ç´¢ä»–ä»¬å…¨éƒ¨å­˜æ¬¾ç®±æ—¶ï¼Œè¿™ä¸ªå­˜æ¬¾ç®±ä¼šå‡ºç°ã€‚

---

### **3. ä¸ºå‰ç«¯å’Œè·Ÿè¸ªè§¦å‘äº‹ä»¶**

solidity

```
emit BoxCreated(msg.sender, address(box), "Premium");

```

è¿™ä¼šè§¦å‘ä¸€ä¸ªÂ `BoxCreated`Â äº‹ä»¶ï¼Œè®°å½•ï¼š

- åˆ›å»ºå­˜æ¬¾ç®±çš„ç”¨æˆ·
- æ–°åˆçº¦çš„åœ°å€
- å­—ç¬¦ä¸²Â `"Premium"`ï¼Œä¾¿äº UI çŸ¥é“å®ƒæ˜¯å“ªç§ç±»å‹çš„å­˜æ¬¾ç®±

è¿™æœ‰åŠ©äºé’±åŒ…ã€ä»ªè¡¨ç›˜å’ŒåŒºå—é“¾æµè§ˆå™¨å±•ç¤ºç›¸å…³æ´»åŠ¨ï¼Œè€Œæ— éœ€æ‰‹åŠ¨ç´¢å¼•é“¾ä¸Šæ•°æ®ã€‚

---

### **4. è¿”å›**å­˜æ¬¾ç®±**åœ°å€**

solidity

```
return address(box);

```

æœ€åï¼Œæˆ‘ä»¬è¿”å›æ–°åˆ›å»ºçš„å­˜æ¬¾ç®±çš„åœ°å€ï¼Œä»¥ä¾¿å‰ç«¯ï¼ˆæˆ–è°ƒç”¨ä»£ç ï¼‰å¯ä»¥ç«‹å³ä¸å…¶äº¤äº’ã€‚

---

## **â³Â `createTimeLockedBox()`Â â€” é€‚ç”¨äºä½ ä¸æƒ³ç«‹å³æ‰“å¼€çš„é‡‘åº“**

solidity

```
function createTimeLockedBox(uint256 lockDuration) external returns (address) {
    TimeLockedDepositBox box = new TimeLockedDepositBox(lockDuration);
    userDepositBoxes[msg.sender].push(address(box));
    emit BoxCreated(msg.sender, address(box), "TimeLocked");
    return address(box);
}

```

è¿™ä¸ªå‡½æ•°å…è®¸ç”¨æˆ·åˆ›å»ºä¸€ä¸ª**æ—¶é—´é”å­˜æ¬¾ç®±**Â â€”â€” ä¸€ä¸ªè¡Œä¸ºå°±åŸºç¡€é‡‘åº“ä¸€æ ·çš„æ™ºèƒ½åˆçº¦ï¼Œ**ä½†æœ‰ä¸€ä¸ªå…³é”®çš„åŒºåˆ«**ï¼šå­˜å‚¨åœ¨é‡Œé¢çš„ç§˜å¯†åªæœ‰åœ¨ç»è¿‡ä¸€å®šæ—¶é—´åæ‰èƒ½è¢«è®¿é—®ã€‚

---

### **è®©æˆ‘ä»¬é€æ­¥æ¥çœ‹ï¼š**

---

### **1. æ¥å—é”å®šæŒç»­æ—¶é—´**

solidity

```
function createTimeLockedBox(uint256 lockDuration)

```

è¿™ä¸ªå‡½æ•°è®¾å®šä¸€ä¸ªæ•°å­—ï¼š`lockDuration`Â â€”â€” ä»£è¡¨é‡‘åº“åº”è¯¥è¢«é”å®šçš„**ç§’æ•°**ã€‚

- ä¾‹å¦‚ï¼Œå¦‚æœÂ `lockDuration = 3600`ï¼Œé‡‘åº“å°†è¢«é”å®šÂ **1 å°æ—¶**ã€‚
- åœ¨æ­¤æœŸé—´ï¼Œæ‰€æœ‰è€…å¯ä»¥**å­˜å‚¨ç§˜å¯†**ï¼Œä½†ä»–ä»¬åœ¨é”å®šåˆ°æœŸ**ä¹‹å‰æ— æ³•æŸ¥çœ‹å®ƒ**ã€‚

è¿™éå¸¸é€‚åˆä»¥ä¸‹æƒ…å†µï¼š

- æ—¶é—´èƒ¶å›Š
- å»¶è¿Ÿæ˜¾ç¤ºæ¶ˆæ¯
- æœªæ¥çš„ç¤¼ç‰©æˆ–æ‰¿è¯º

---

### **2. éƒ¨ç½² TimeLockedDepositBox**

solidity

```

TimeLockedDepositBox box = new TimeLockedDepositBox(lockDuration);

```

è¿™è¡Œä»£ç åˆ›å»ºäº†ä¸€ä¸ªæ–°å®ä¾‹Â `TimeLockedDepositBox`Â ï¼Œä¼ é€’Â `lockDuration`ã€‚

åœ¨Â `TimeLockedDepositBox`Â æ„é€ å‡½æ•°å†…éƒ¨ï¼Œè¿™ä¸ªé”å®šæŒç»­æ—¶é—´è¢«åŠ åˆ°å½“å‰åŒºå—æ—¶é—´æˆ³ä¸Šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

solidity

```

unlockTime = block.timestamp + lockDuration;

```

å› æ­¤å­˜æ¬¾ç®±ä¼šæ ¹æ®åŒºå—é“¾æ—¶é—´è·Ÿè¸ª**ä½•æ—¶å¯ä»¥å®‰å…¨è§£é”**ã€‚

éƒ¨ç½²è€…ï¼ˆ`msg.sender`ï¼‰è‡ªåŠ¨æˆä¸ºæ‰€æœ‰è€…â€”â€”å¾—ç›Šäºç»§æ‰¿è‡ªÂ `BaseDepositBox`Â ã€‚

---

### **3. å°†å­˜æ¬¾ç®±ä¿å­˜åœ¨ç”¨æˆ·è´¦æˆ·ä¸‹**

solidity

```

userDepositBoxes[msg.sender].push(address(box));

```

å°†æ–°å­˜æ¬¾ç®±çš„åœ°å€æ·»åŠ åˆ°è°ƒç”¨è€…åœ¨Â `userDepositBoxes`Â æ˜ å°„ä¸­å­˜å‚¨çš„å­˜æ¬¾ç®±åˆ—è¡¨ä¸­ã€‚

- è¿™ä½¿å¾—æ¯ä¸ªç”¨æˆ·éƒ½å¯ä»¥ç»´æŠ¤ä¸€ä¸ªç”±å¤šä¸ªå­˜æ¬¾ç®±ç»„æˆçš„ä¸ªäººâ€œé‡‘åº“â€**ã€‚**
- åˆçº¦è·Ÿè¸ªè°æ‹¥æœ‰å“ªä¸ªå­˜æ¬¾ç®±ï¼Œä½†ä¸ä¼šåœ¨é“¾ä¸Šå­˜å‚¨å®Œæ•´çš„ç”¨æˆ·æ•°æ®ã€‚

---

### **4. è§¦å‘Â `BoxCreated`Â äº‹ä»¶**

solidity

```
emit BoxCreated(msg.sender, address(box), "TimeLocked");

```

äº‹ä»¶æ˜¯ dApp åœ¨ä¸æŒç»­æŸ¥è¯¢æ™ºèƒ½åˆçº¦çŠ¶æ€çš„æƒ…å†µä¸‹è·Ÿè¸ªé“¾ä¸Šæ“ä½œçš„å…³é”®éƒ¨åˆ†ã€‚

è¿™å°†è®°å½•æ–°å­˜æ¬¾ç®±çš„åˆ›å»ºï¼ŒåŒ…æ‹¬ï¼š

- è°åˆ›å»ºäº†å®ƒ
- å®ƒçš„åˆçº¦åœ°å€
- å­˜æ¬¾ç®±ç±»å‹ï¼š`"TimeLocked"`

å‰ç«¯å¯ä»¥ä½¿ç”¨å®ƒåœ¨ UI ä¸­æ˜¾ç¤ºâ€œæ–°çš„æ—¶é—´é”é‡‘åº“å·²åˆ›å»ºâ€æˆ–å°†å…¶æ˜¾ç¤ºåœ¨ç”¨æˆ·æ´»åŠ¨åé¦ˆä¸­ã€‚

---

### **5. è¿”å›åœ°å€**

solidity

```
return address(box);

```

æœ€åï¼Œå‡½æ•°è¿”å›æ–°éƒ¨ç½²åˆçº¦çš„åœ°å€ï¼Œä»¥ä¾¿è°ƒç”¨è€…ï¼ˆæˆ–å‰ç«¯ï¼‰å¯ä»¥ç«‹å³å¼€å§‹ä¸å…¶äº¤äº’ã€‚

---

## **ğŸ·ï¸ nameBox**

solidity

```
function nameBox(address boxAddress, string calldata name) external {
    IDepositBox box = IDepositBox(boxAddress);
    require(box.getOwner() == msg.sender, "Not the box owner");

    boxNames[boxAddress] = name;
    emit BoxNamed(boxAddress, name);
}

```

### **è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ**

- é¦–å…ˆï¼Œæˆ‘ä»¬**å°†é€šç”¨åœ°å€è½¬æ¢ä¸ºæ¥å£**ï¼š
    
    solidity
    
    ```
    
    IDepositBox box = IDepositBox(boxAddress);
    
    ```
    
    è¿™è®©æˆ‘ä»¬å¯ä»¥åœ¨å­˜æ¬¾ç®±ä¸Šè°ƒç”¨Â `getOwner()`ï¼Œè€Œæ— éœ€çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆç±»å‹ã€‚
    
- ç„¶åæˆ‘ä»¬**æ£€æŸ¥æ‰€æœ‰æƒ**ï¼š
    
    solidity
    
    ```
    require(box.getOwner() == msg.sender, "Not the box owner");
    
    ```
    
    è¿™ç¡®ä¿åªæœ‰åˆæ³•çš„æ‰€æœ‰è€…å¯ä»¥é‡å‘½åå­˜æ¬¾ç®±ã€‚
    
- æœ€åï¼Œæˆ‘ä»¬ä¿å­˜æ–°åç§°å¹¶è§¦å‘ä¸€ä¸ªäº‹ä»¶ã€‚

---

## **ğŸ“ storeSecret**

solidity

```
function storeSecret(address boxAddress, string calldata secret) external {
    IDepositBox box = IDepositBox(boxAddress);
    require(box.getOwner() == msg.sender, "Not the box owner");

    box.storeSecret(secret);
}

```

- ç›¸åŒçš„æ‰€æœ‰æƒæ¨¡å¼ã€‚
- è°ƒç”¨æ¥å£ä¸­çš„Â `storeSecret()`Â å‡½æ•°ï¼Œæ­¤å‡½æ•°çš„å…·ä½“é€»è¾‘ç”±æ¯ç±»å­˜æ¬¾ç®±è‡ªè¡Œå®ç°ã€‚
- è¿™é‡Œæ²¡æœ‰è§¦å‘äº‹ä»¶ï¼Œå› ä¸ºå­˜æ¬¾ç®±æœ¬èº«ä¼šè§¦å‘ä¸€ä¸ªï¼ˆ`SecretStored`ï¼‰ã€‚

---

## **ğŸ”„Â `transferBoxOwnership()`Â â€” ç§»äº¤å­˜æ¬¾ç®±**

solidity

```
function transferBoxOwnership(address boxAddress, address newOwner) external {
    IDepositBox box = IDepositBox(boxAddress);
    require(box.getOwner() == msg.sender, "Not the box owner");

    box.transferOwnership(newOwner);

// ä»æ—§æ‰€æœ‰è€…å¤„ç§»é™¤é‡‘åº“address[] storage boxes = userDepositBoxes[msg.sender];
    for (uint i = 0; i < boxes.length; i++) {
        if (boxes[i] == boxAddress) {
            boxes[i] = boxes[boxes.length - 1];
            boxes.pop();
            break;
        }
    }

// å°†é‡‘åº“æ·»åŠ åˆ°æ–°æ‰€æœ‰è€…
    userDepositBoxes[newOwner].push(boxAddress);
}

```

è¿™ä¸ªå‡½æ•°å…è®¸å­˜æ¬¾ç®±çš„å½“å‰æ‰€æœ‰è€…**å°†æ‰€æœ‰æƒè½¬ç§»ç»™å…¶ä»–äºº**â€”â€”å°±åƒæŠŠå­˜æ¬¾ç®±çš„é’¥åŒ™äº¤ç»™æŸäººä¸€æ ·ã€‚

å®ƒè¿˜ç¡®ä¿Â `VaultManager`Â æ›´æ–°è‡ªå·±çš„è®°å½•ä»¥åæ˜ è¿™ä¸€å˜åŒ–ã€‚

è®©æˆ‘ä»¬é€æ­¥æ¥çœ‹ï¼š

---

### **1. æ¥å£è½¬æ¢å’Œæ‰€æœ‰æƒæ£€æŸ¥**

solidity

```

IDepositBox box = IDepositBox(boxAddress);
require(box.getOwner() == msg.sender, "Not the box owner");

```

- é¦–å…ˆï¼Œæˆ‘ä»¬è·å–Â `boxAddress`ï¼ˆè¿™åªæ˜¯åŒºå—é“¾ä¸Šçš„ä¸€ä¸ªå¸¸è§„åœ°å€ï¼‰ï¼Œå¹¶å°†å…¶**è½¬æ¢**ä¸ºÂ `IDepositBox`Â æ¥å£ç±»å‹ã€‚
    
    è¿™å°±æ˜¯è¿™è¡Œä»£ç çš„ä½œç”¨ï¼š
    
    solidity
    
    ```
    
    IDepositBox box = IDepositBox(boxAddress);
    
    ```
    
    ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨åƒÂ `getOwner()`Â æˆ–Â `transferOwnership()`Â è¿™æ ·çš„å‡½æ•°â€”â€”å› ä¸ºæˆ‘ä»¬å·²ç»å‘Šè¯‰ Solidityï¼Œ*â€œå˜¿ï¼Œç›¸ä¿¡æˆ‘ï¼Œè¿™ä¸ªåˆçº¦å®ç°äº†Â `IDepositBox`Â æ¥å£ã€‚â€*
    
- æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éªŒè¯è°ƒç”¨æ­¤å‡½æ•°çš„äººæ˜¯å¦æ˜¯è¯¥å­˜æ¬¾ç®±çš„**å½“å‰æ‰€æœ‰è€…**ï¼š
    
    solidity
    
    ```
    require(box.getOwner() == msg.sender, "Not the box owner");
    
    ```
    

å¦‚æœä»–ä»¬ä¸æ˜¯æ‰€æœ‰è€…ï¼Œå‡½æ•°å°†å›æ»šã€‚ç¦æ­¢æœªç»æˆæƒçš„è½¬ç§»ã€‚

---

### **2. è°ƒç”¨å­˜æ¬¾ç®±çš„Â `transferOwnership()`Â æ–¹æ³•**

solidity

```

box.transferOwnership(newOwner);

```

è¿™è¡Œä»£ç ä¼šå‘ŠçŸ¥å­˜å‚¨ç®±åˆçº¦ï¼Œè®©å…¶æ›´æ–°è‡ªå·±çš„å†…éƒ¨Â `owner`Â çŠ¶æ€ã€‚

è¿™å¾ˆé‡è¦ï¼š

çœŸæ­£çš„æ•°æ®æ‰€æœ‰æƒå’Œä¸šåŠ¡é€»è¾‘å½’å±äºå­˜å‚¨ç®±åˆçº¦â€”**VaultManager ä¸æ˜¯å…¶æ‰€æœ‰è€…**â€”å› æ­¤ï¼Œè¿™ä¸€æ­¥ç¡®ä¿äº†æƒé™å˜æ›´åœ¨å­˜å‚¨ç®±å†…éƒ¨è‡ªä¸»å®Œæˆã€‚

---

### **3. æ›´æ–° VaultManager çš„æ˜ å°„**

åœ¨**å­˜å‚¨ç®±åˆçº¦å†…éƒ¨**æ›´æ”¹æ‰€æœ‰æƒä¹‹åï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿Â `VaultManager`Â çš„Â `userDepositBoxes`Â æ˜ å°„ä¹Ÿåæ˜ è¿™ä¸€ç‚¹ã€‚

å¦‚æœæˆ‘ä»¬ä¸æ›´æ–°æ­¤åˆ—è¡¨ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿå°†åœ¨å‰ç«¯æˆ– API ä¸­æ˜¾ç¤ºé”™è¯¯çš„æ‰€æœ‰è€…ã€‚

---

### **3.1 ä»å‘é€è€…åˆ—è¡¨ä¸­ç§»é™¤**å­˜å‚¨ç®±

solidity

```
address[] storage boxes = userDepositBoxes[msg.sender];
for (uint i = 0; i < boxes.length; i++) {
    if (boxes[i] == boxAddress) {
        boxes[i] = boxes[boxes.length - 1];
        boxes.pop();
        break;
    }
}

```

- æˆ‘ä»¬è·å–å‘é€è€…çš„å­˜å‚¨ç®±åˆ—è¡¨ã€‚
- æˆ‘ä»¬å¾ªç¯æŸ¥æ‰¾æ­£åœ¨è¢«è½¬ç§»çš„é‚£ä¸ªã€‚
- ä¸€æ—¦æ‰¾åˆ°ï¼š
    - æˆ‘ä»¬**å°†å®ƒä¸æ•°ç»„ä¸­çš„æœ€åä¸€é¡¹äº¤æ¢** ã€‚
    - ç„¶åè°ƒç”¨Â `.pop()`Â æ¥åˆ é™¤æœ€åä¸€é¡¹ã€‚
- è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„ Solidity æŠ€å·§ï¼Œç”¨äºä»æ•°ç»„ä¸­ç§»é™¤é¡¹ç›®è€Œä¸ç•™ç©ºä½ï¼ˆå› ä¸º Solidity æ•°ç»„ä¸æ”¯æŒÂ `.remove(index)`ï¼‰ã€‚

---

### **3.2 å°†**å­˜å‚¨ç®±**æ·»åŠ åˆ°æ–°æ‰€æœ‰è€…çš„åˆ—è¡¨**

solidity

```

userDepositBoxes[newOwner].push(boxAddress);

```

éšåï¼Œæˆ‘ä»¬å°†è¯¥å­˜å‚¨ç®±å­˜å…¥æ–°æ‰€æœ‰è€…çš„ä¸ªäººå­˜å‚¨ç®±æ•°ç»„ä¸­â€”â€”è¿™æ­¥æ“ä½œåœ¨æˆ‘ä»¬çš„æ³¨å†Œè¡¨å†…å®Œæˆäº†æ‰€æœ‰æƒçš„è½¬ç§»ã€‚

---

## **ğŸ“¬Â `getUserBoxes()`Â â€” æŸ¥çœ‹ç”¨æˆ·æ‹¥æœ‰çš„æ‰€æœ‰**å­˜å‚¨ç®±

solidity

```
function getUserBoxes(address user) external view returns (address[] memory) {
    return userDepositBoxes[user];
}

```

### **å®ƒçš„ä½œç”¨ï¼š**

è¿™ä¸ªå‡½æ•°ä»…è¿”å›å±äºç‰¹å®šç”¨æˆ·çš„**å­˜æ¬¾ç®±åœ°å€åˆ—è¡¨**ã€‚

### **ä¸ºä»€ä¹ˆé‡è¦ï¼š**

- æ¯æ¬¡æœ‰äººåˆ›å»ºä¸€ä¸ªå­˜æ¬¾ç®±ï¼ˆé€šè¿‡Â `createBasicBox()`ã€`createPremiumBox()`Â æˆ–Â `createTimeLockedBox()`ï¼‰ï¼Œè¯¥æ–°åˆçº¦çš„åœ°å€å°±ä¼šå­˜å‚¨åœ¨Â `userDepositBoxes`Â æ˜ å°„ä¸­ã€‚
- è¿™ä¸ªå‡½æ•°å…è®¸ä½ æ£€ç´¢åˆ°**ä»»ä½•ç”¨æˆ·åœ°å€**æ‰€å¯¹åº”çš„å­˜å‚¨ç®±åˆ—è¡¨ã€‚

### **å®ƒå¦‚ä½•å·¥ä½œï¼š**

- `userDepositBoxes[user]`Â å­˜å‚¨çš„è¯¥ç‰¹å®šç”¨æˆ·çš„åŠ¨æ€åœ°å€æ•°ç»„ã€‚
- ç”±äºå®ƒæ ‡è®°ä¸ºÂ `view`ï¼Œå®ƒæ˜¯**åªè¯»çš„**â€”â€”è°ƒç”¨è¿™ä¸ªå‡½æ•°**ä¸æ¶ˆè€—ä»»ä½• gas**ã€‚
- å®ƒè¿”å›ä¸€ä¸ªå®Œæ•´çš„æ•°ç»„ï¼Œå¯ä»¥åœ¨å‰ç«¯ç”¨æ¥åˆ—å‡ºç”¨æˆ·çš„æ‰€æœ‰é‡‘åº“ã€‚

> ä½¿ç”¨åœºæ™¯ï¼šéå¸¸é€‚åˆåˆ›å»ºåˆ—å‡ºç”¨æˆ·å­˜æ¬¾ç®±çš„ä»ªè¡¨æ¿æˆ–ä¸ªäººèµ„æ–™é¡µé¢ã€‚
> 

---

## **ğŸ”Â `getBoxName()`Â â€” è¯»å–å­˜æ¬¾ç®±çš„è‡ªå®šä¹‰åç§°**

solidity

```
function getBoxName(address boxAddress) external view returns (string memory) {
    return boxNames[boxAddress];
}

```

### **å®ƒçš„ä½œç”¨ï¼š**

è¿”å›æ‰€æœ‰è€…ä¸ºç‰¹å®šå­˜æ¬¾ç®±æŒ‡å®šçš„**è‡ªå®šä¹‰åç§°**ã€‚

### **åç§°æ¥æºï¼š**

- æ­¤å‰ï¼Œç”¨æˆ·å¯ä»¥è°ƒç”¨Â `nameBox(address, string)`Â ç»™ä»–ä»¬çš„å­˜æ¬¾ç®±è´´ä¸Šè‡ªå®šä¹‰æ ‡ç­¾ã€‚
- è¯¥æ ‡ç­¾å­˜å‚¨åœ¨Â `boxNames`Â æ˜ å°„ä¸­ã€‚

### **é€»è¾‘ï¼š**

- éœ€è¦Â `boxAddress`Â ä½œä¸ºè¾“å…¥ã€‚
- åœ¨Â `boxNames`Â æ˜ å°„ä¸­æŸ¥æ‰¾åœ°å€ï¼Œå¹¶è¿”å›ç”¨æˆ·è®¾ç½®çš„ä»»ä½•å­—ç¬¦ä¸²ã€‚
- å¦‚æœæ²¡æœ‰ç»™å‡ºåç§°ï¼ŒSolidity åªè¿”å›**é»˜è®¤çš„ç©ºå­—ç¬¦ä¸²Â `""`**ã€‚

> ä½¿ç”¨åœºæ™¯ï¼šå¯¹äºæ”¹è¿› UI éå¸¸æœ‰ç”¨â€”â€”ä½ å¯ä»¥æ˜¾ç¤ºæœ‰æ„ä¹‰çš„åç§°ï¼Œå¦‚â€œä¸»é‡‘åº“â€æˆ–â€œçˆ¸çˆ¸çš„å‚¨ç‰©æŸœâ€ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºåŸå§‹åœ°å€ã€‚
> 

---

## **ğŸ§¾Â `getBoxInfo()`Â â€” ä¸€æ¬¡è°ƒç”¨è·å–å®Œæ•´ä¿¡æ¯**

solidity

```
function getBoxInfo(address boxAddress) external view returns (
    string memory boxType,
    address owner,
    uint256 depositTime,
    string memory name
) {
    IDepositBox box = IDepositBox(boxAddress);
    return (
        box.getBoxType(),
        box.getOwner(),
        box.getDepositTime(),
        boxNames[boxAddress]
    );
}

```

è¿™æ˜¯ç”¨äºè·å–å…³äºå­˜æ¬¾ç®±çš„æ¯ä¸ªé‡è¦å…ƒæ•°æ®çš„**ä¸€ä½“åŒ–è¾…åŠ©å‡½æ•°**ï¼Œã€‚

è®©æˆ‘ä»¬åˆ†è§£ä¸€ä¸‹ï¼š

---

### **1. æ¥å£è½¬æ¢**

solidity

```

IDepositBox box = IDepositBox(boxAddress);

```

- æˆ‘ä»¬è·å–åŸå§‹çš„å­˜æ¬¾ç®±åœ°å€ï¼Œå¹¶**å°†å…¶è½¬æ¢ä¸º IDepositBox æ¥å£**ã€‚
- è¿™è®©æˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°è°ƒç”¨`getBoxType()`ã€`getOwner()`Â å’ŒÂ `getDepositTime()`Â å‡½æ•°ï¼Œè€Œæ— éœ€ç¡®åˆ‡çŸ¥é“å®ƒæ˜¯å“ªç§ç±»å‹çš„å­˜æ¬¾ç®±ï¼ˆåŸºç¡€å‹ã€é«˜çº§å‹ã€æ—¶é—´é”å‹ç­‰ï¼‰ã€‚
- åªè¦åˆçº¦å®ç°äº†è¯¥æ¥å£ï¼Œè¿™äº›è°ƒç”¨å°±ä¼šèµ·ä½œç”¨ã€‚

---

### **2. è¿”å›æ‰€æœ‰å…³é”®ç»†èŠ‚**

solidity

```
return (
    box.getBoxType(),
    box.getOwner(),
    box.getDepositTime(),
    boxNames[boxAddress]
);

```

ä»¥ä¸‹æ˜¯æ¯ä¸ªéƒ¨åˆ†æä¾›çš„å†…å®¹ï¼š

- `box.getBoxType()`Â â€” è°ƒç”¨å­åˆçº¦çš„å®ç°ï¼Œå¹¶è¿”å›å¦‚ä¸‹å­—ç¬¦ä¸² ï¼š`"Basic"`ã€`"Premium"`Â æˆ–Â `"TimeLocked"`ã€‚
- `box.getOwner()`Â â€” è¿”å›å­˜æ¬¾ç®±çš„å½“å‰æ‰€æœ‰è€…ã€‚
- `box.getDepositTime()`Â â€” è¿”å›å­˜æ¬¾ç®±éƒ¨ç½²æ—¶çš„åŒºå—æ—¶é—´æˆ³ã€‚
- `boxNames[boxAddress]`Â â€” ä»Â `VaultManager`Â å†…éƒ¨çš„Â `boxNames`Â æ˜ å°„ä¸­æå–è‡ªå®šä¹‰åç§°ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚

---

### **ä¸ºä»€ä¹ˆè¿™ä¸ªå‡½æ•°æœ‰ç”¨ï¼š**

ä½ å¯ä»¥åœ¨**ä¸€æ¬¡**è°ƒç”¨ä¸­è·å¾—æ‰€æœ‰å†…å®¹ï¼Œè€Œä¸æ˜¯è¿›è¡Œ**å››æ¬¡å•ç‹¬è°ƒç”¨**ï¼š

- âœ… å­˜æ¬¾ç®±ç±»å‹
- âœ… æ‰€æœ‰è€…
- âœ… åˆ›å»ºæ—¶é—´
- âœ… è‡ªå®šä¹‰åç§°

> ä½¿ç”¨åœºæ™¯ï¼šæ„å»ºä¸€ä¸ªè¡¨æ ¼æˆ–å¡ç‰‡ UIï¼Œé€šè¿‡ä¸€æ¬¡è°ƒç”¨æ˜¾ç¤ºæ¯ä¸ªç”¨æˆ·å­˜æ¬¾ç®±çš„å®Œæ•´æ‘˜è¦â€”â€”å¯¹äºé«˜æ•ˆçš„å‰ç«¯æ¸²æŸ“éå¸¸æœ‰ç”¨ã€‚
> 

## **âœ… æ€»ç»“ â€” ä¸€ä¸ªæ„å»ºå¾—å½“çš„æ¨¡å—åŒ–é‡‘åº“ç³»ç»Ÿ**

è¿™å°±æ˜¯**é‡‘åº“ç³»ç»Ÿ**çš„å…¨éƒ¨å†…å®¹ã€‚

æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„æƒ³æ³•å¼€å§‹â€”â€”è®©ç”¨æˆ·åœ¨é“¾ä¸Šå®‰å…¨åœ°å­˜å‚¨ç§˜å¯†â€”â€”æœ€ç»ˆä½¿ç”¨ Solidity æœ€å¼ºå¤§çš„æ¦‚å¿µæ„å»ºäº†ä¸€ä¸ª**æ¨¡å—åŒ–**ã€**å¯æ‰©å±•**ä¸”**ç»“æ„è‰¯å¥½**çš„æ™ºèƒ½åˆçº¦ç³»ç»Ÿï¼š

- âœ…Â **æ¥å£**Â ä¸ºæ‰€æœ‰é‡‘åº“å®šä¹‰é€šç”¨æ ‡å‡†
- âœ…Â **æŠ½è±¡åˆçº¦**Â æä¾›äº†å¯å¤ç”¨çš„é€»è¾‘ï¼Œå¹¶ç¡®ä¿å®ç°çš„ä¸€è‡´æ€§
- âœ…Â **ç»§æ‰¿**Â åœ¨å…±äº«çš„åº•å±‚æ¶æ„ä¹‹ä¸Šï¼Œæ„å»ºäº†å¤šç§ç±»å‹çš„é‡‘åº“ï¼ˆåŸºç¡€å‹ã€é«˜çº§å‹ã€æ—¶é—´é”å‹ï¼‰
- âœ… **ç®¡ç†å™¨åˆçº¦**Â æ¥æ§åˆ¶é‡‘åº“çš„åˆ›å»ºã€å‘½åå’Œæ‰€æœ‰æƒ

æ‚¨åˆšåˆšæ„å»ºçš„é¡¹ç›®ï¼Œç²¾å‡†åæ˜ äº†ç°å®ä¸–ç•Œæ™ºèƒ½åˆçº¦ç³»ç»Ÿçš„æ ¸å¿ƒæ¶æ„ã€‚Compoundã€Aave å’Œ OpenZeppelin ç­‰ä¸»æµå¹³å°å‡é‡‡ç”¨ä¸æ­¤åŒæºçš„åˆ†å±‚è®¾è®¡â€”â€”é€šè¿‡**æ¥å£å®ç°æ ‡å‡†åŒ–**ï¼Œå€ŸåŠ©**æŠ½è±¡åŸºç¡€åˆçº¦è¾¾æˆä»£ç å¤ç”¨**ï¼Œå¹¶åœ¨å…¶ä¸Šæ„å»º**æ¸…æ™°æ¨¡å—åŒ–çš„ä¸šåŠ¡åˆçº¦**ã€‚

æ‰€ä»¥ç°åœ¨ï¼Œä½ ä¸ä»…ç†è§£äº†**ç»§æ‰¿çš„å·¥ä½œåŸç†**ï¼Œè¿˜çœ‹åˆ°äº†å¦‚ä½•æ„å»ºéšç€äº§å“å¢é•¿è€Œæ‰©å±•çš„å¤§å‹ç³»ç»Ÿç»“æ„ã€‚