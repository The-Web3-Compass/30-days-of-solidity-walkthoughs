# æŠ•ç¥¨ç«™åˆçº¦

Day: Day 3
ID: 3
åŸæ–‡: https://www.notion.so/PollStation-Contract-1c25720a23ef802c9d9be066debb9bbd?source=copy_link
çŠ¶æ€: å®Œæˆ
è¯‘è€…: Bala Chen
éš¾åº¦ç­‰çº§: åˆçº§

[ğŸ§­ é¦–é¡µ](https://www.notion.so/5-5-HerSolidity-28e06421268880e4b645d9458179e231?pvs=21) ï½œ [ğŸ“ 30å¤©è¯¾ç¨‹æ—¥å†](https://www.notion.so/28e0642126888002b26be4b2e9841ce0?pvs=21) ï½œ[](https://www.notion.so/28e06421268881e59a00e854a7444215?pvs=21) ï½œ[FAQ-Solidityç­”ç–‘é—®é¢˜åº“](https://www.notion.so/2910642126888046a897d75705d86a58?pvs=21) ï½œ [ğŸ‘©ğŸ»â€ğŸ’» å…³äºæˆ‘ä»¬](https://www.notion.so/344d3328efef4b3ab742f92b61533ce8?pvs=21)

ä»Šæ—¥å­¦ä¹ å†…å®¹ï¼š

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨äº†ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚æ•°å­— (`uint256`) å’Œ å­—ç¬¦ä¸² (`string`). æˆ‘ä»¬äº†è§£äº†çŠ¶æ€å˜é‡å¦‚ä½•åœ¨åŒºå—é“¾ä¸Šå­˜å‚¨å€¼ï¼Œä»¥åŠ(`functions`) æ€ä¹ˆä¿®æ”¹å’Œæ£€ç´¢å®ƒä»¬.

ä½†æ™ºèƒ½åˆçº¦ä¸ä»…å­˜å‚¨å•ä¸ªå€¼ï¼Œä¹Ÿèƒ½æœ‰æ•ˆçš„ç»„ç»‡å’Œæ„å»ºæ•°æ®ã€‚

è¿™é‡Œï¼Œsolidityæä¾›äº†æ•°ç»„ï¼ˆ`arrays` ï¼‰ï¼Œç”¨äºå­˜å‚¨æ•°æ®åˆ—è¡¨ï¼Œå’Œæ˜ å°„ï¼ˆ`mapping`ï¼‰ç”¨äºå°†å€¼ä¸å”¯ä¸€é”®ï¼ˆ`key` ï¼‰å…³è”ã€‚

ä»Šæ—¥ï¼Œæˆ‘ä»¬å°†æ¢è®¨æ•°ç»„ï¼ˆ`arrays` ï¼‰å’Œæ˜ å°„ï¼ˆ`mapping`ï¼‰å¦‚ä½•åœ¨solidityä¸­å·¥ä½œï¼ŒåŒæ—¶åˆ†è§£PollStationåˆçº¦ã€‚

<aside>
ğŸ’¬

å®Œæ•´ä»£ç åœ°å€ï¼š
https://github.com/snehasharma76/30daysSolidity_Web3Compass/blob/master/PollStation.sol

</aside>

# 1. äº§å“éœ€æ±‚ä¹¦

### ç”¨æˆ·æµç¨‹

```mermaid
graph TD
  æŠ•ç¥¨ç³»ç»Ÿ --> ç™»è®°å‚é€‰äºº --> ç”¨æˆ·[/ç”¨æˆ·å¡«å…¥åå­—/]
  æŠ•ç¥¨ç³»ç»Ÿ --> æŠ•ç¥¨ --> ç”¨[/ç”¨æˆ·å¡«å…¥æƒ³è¦æŠ•çš„å‚é€‰äººçš„åå­—ç”¨æˆ·/]-->è®¡ç¥¨ --> ç»Ÿè®¡[(ç»Ÿè®¡æ•°é‡)] 

  æŠ•ç¥¨ç³»ç»Ÿ --> å¹ç¥¨ --> æŸ¥è¯¢[/ç”¨æˆ·è¾“å…¥æŸ¥è¯¢åå­—/] --> åŒ¹é…[\è®¡ç¥¨\]
  

				  
```

### æ•°æ®åº“

| Contract | Type | Bases |  |  | å«ä¹‰ |
| --- | --- | --- | --- | --- | --- |
| â”” | **Function Name** | **Visibility** | **Mutability** | **Modifiers** |  |
|  |  |  |  |  |  |
| **PollStation** | Implementation |  |  |  |  |
| â”” | addCandidateNames | Public â—ï¸ | ğŸ›‘ | NOâ—ï¸ | ç™»è®°å‚é€‰äºº |
| â”” | getcandidateNames | Public â—ï¸ |  | NOâ—ï¸ | é€šè¿‡æ•°æ®åº“æ‰¾å‚é€‰äºº |
| â”” | vote | Public â—ï¸ | ğŸ›‘ | NOâ—ï¸ | æŠ•ç¥¨ |
| â”” | getVote | Public â—ï¸ |  | NOâ—ï¸ | å¹ç¥¨ |
|  |  |  |  |  |  |
|  |  |  |  |  |  |
|  |  |  |  |  |  |
|  |  |  |  |  |  |
|  |  |  |  |  |  |
|  |  |  |  |  |  |
|  |  |  |  |  |  |
|  |  |  |  |  |  |
|  |  |  |  |  |  |
| **AdminOnly** | Implementation |  |  |  |  |
| â”” | <Constructor> | Public â—ï¸ | ğŸ›‘ | NOâ—ï¸ |  |
| â”” | addTreasure | Public â—ï¸ | ğŸ›‘ | onlyOwner |  |
| â”” | approveWithdrawal | Public â—ï¸ | ğŸ›‘ | onlyOwner |  |
| â”” | withdrawTreasure | Public â—ï¸ | ğŸ›‘ | NOâ—ï¸ |  |
| â”” | resetWithdrawalStatus | Public â—ï¸ | ğŸ›‘ | onlyOwner |  |
| â”” | transferOwnership | Public â—ï¸ | ğŸ›‘ | onlyOwner |  |
| â”” | getTreasureDetails | Public â—ï¸ |  | onlyOwner |  |

# 2. ç»†èŠ‚è§£è¯´

## **ç†è§£æŠ•ç¥¨ç«™åˆçº¦**

è¯¥åˆçº¦å…è®¸ç”¨æˆ·ï¼š

1. **å‘æŠ•ç¥¨ä¸­æ·»åŠ å€™é€‰äºº**ã€‚
2. **æ£€ç´¢å€™é€‰äººåˆ—è¡¨**ã€‚
3. **ä¸ºå€™é€‰äººæŠ•ç¥¨**ã€‚
4. **æ£€æŸ¥å€™é€‰äººæ”¶åˆ°çš„æ€»ç¥¨æ•°**ã€‚

ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªå…³é”®ç»„ä»¶ï¼š

- **ä¸€ä¸ªæ•°ç»„**æ¥å­˜å‚¨æ‰€æœ‰å€™é€‰äººçš„å§“åã€‚
- **ä¸€ä¸ªæ˜ å°„**æ¥è·Ÿè¸ªæ¯ä¸ªå€™é€‰äººæ”¶åˆ°çš„ç¥¨æ•°ã€‚

---

## **å£°æ˜å€™é€‰äººåˆ—è¡¨å’ŒæŠ•ç¥¨è·Ÿè¸ª**

åœ¨ç¼–å†™å‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦**é«˜æ•ˆåœ°å­˜å‚¨**å€™é€‰äººåŠå…¶ç¥¨æ•°ã€‚

```solidity

string[] public candidateNames;
mapping(string => uint256) voteCount;

```

### **1ï¸âƒ£ æ•°ç»„ â€“ å­˜å‚¨å€™é€‰äººåˆ—è¡¨**

```solidity

string[] public candidateNames;

```

è¿™ä¸€è¡Œå£°æ˜äº†ä¸€ä¸ª**æ•°ç»„**æ¥å­˜å‚¨å€™é€‰äººå§“åã€‚

### **ä»€ä¹ˆæ˜¯æ•°ç»„ï¼Ÿ**

**æ•°ç»„**æ˜¯ç›¸åŒç±»å‹å…ƒç´ çš„**åˆ—è¡¨**ã€‚åœ¨ Solidity ä¸­ï¼Œæ•°ç»„å¯ä»¥ä¿å­˜æ•°å­—ã€å­—ç¬¦ä¸²ã€åœ°å€æˆ–å…¶ä»–æ•°æ®ç±»å‹ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨æ•°ç»„æ¥å­˜å‚¨**å¤šä¸ªå€™é€‰äººçš„å§“å**ã€‚

### **ä¸ºä»€ä¹ˆä½¿ç”¨æ•°ç»„ï¼Ÿ**

- **æ•°ç»„åœ¨æœ‰åºåˆ—è¡¨ä¸­å­˜å‚¨å¤šä¸ªå€¼ã€‚**
- **æˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ£€ç´¢æ‰€æœ‰å…ƒç´ **â€”â€”åœ¨æ˜¾ç¤ºæ‰€æœ‰å€™é€‰äººæ—¶å¾ˆæœ‰ç”¨ã€‚
- **æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `.push()` åŠ¨æ€æ·»åŠ æ–°å…ƒç´ **ã€‚

### **ä½¿ç”¨ç¤ºä¾‹**

å¦‚æœæˆ‘ä»¬æ·»åŠ ä¸¤ä¸ªå€™é€‰äººï¼š

```solidity

addCandidateNames("Alice");
addCandidateNames("Bob");

```

æˆ‘ä»¬çš„æ•°ç»„ç°åœ¨çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```solidity

candidateNames = ["Alice", "Bob"];

```

**æ³¨æ„ï¼š** ç”±äº `candidateNames` æ˜¯ `public` çš„ï¼ŒSolidity ä¼šè‡ªåŠ¨ä¸ºå…¶åˆ›å»ºä¸€ä¸ª**è·å–å‡½æ•°**ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·å¯ä»¥æ£€ç´¢å€™é€‰äººåˆ—è¡¨è€Œæ— éœ€ç¼–å†™å•ç‹¬çš„å‡½æ•°ã€‚

---

### **2ï¸âƒ£ æ˜ å°„ â€“ å­˜å‚¨æŠ•ç¥¨è®¡æ•°**

```solidity

mapping(string => uint256) voteCount;

```

è¿™ä¸€è¡Œåˆ›å»ºäº†ä¸€ä¸ª**æ˜ å°„**æ¥è·Ÿè¸ªæ¯ä¸ªå€™é€‰äººçš„ç¥¨æ•°ã€‚

### **ä»€ä¹ˆæ˜¯æ˜ å°„ï¼Ÿ**

**æ˜ å°„**å°±åƒä¸€ä¸ª**å­—å…¸**ï¼Œå®ƒå°†é”®ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯ä»£è¡¨å€™é€‰äººå§“åçš„ `string`ï¼‰é“¾æ¥åˆ°å€¼ï¼ˆä»£è¡¨å…¶ç¥¨æ•°çš„ `uint256`ï¼‰ã€‚

### **ä¸ºä»€ä¹ˆä½¿ç”¨æ˜ å°„è€Œä¸æ˜¯æ•°ç»„ï¼Ÿ**

æ˜ å°„å…è®¸**å³æ—¶æŸ¥æ‰¾**ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å€™é€‰äººçš„å§“åè®¿é—®å…¶ç¥¨æ•°ï¼Œè€Œä¸æ˜¯æœç´¢æ•°ç»„æ¥æŸ¥æ‰¾å€™é€‰äººçš„ç¥¨æ•°ã€‚

### **ä½¿ç”¨ç¤ºä¾‹**

å‡è®¾æˆ‘ä»¬å­˜å‚¨ä¸¤ä¸ªå€™é€‰äººåŠå…¶ç¥¨æ•°ï¼š

```solidity

voteCount["Alice"] = 3;
voteCount["Bob"] = 5;

```

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å³æ—¶æ£€ç´¢ç¥¨æ•°ï¼š

```solidity

voteCount["Alice"]; // è¿”å› 3
voteCount["Bob"];   // è¿”å› 5

```

æ˜ å°„**æå…¶é«˜æ•ˆ**ï¼Œå› ä¸ºå®ƒä»¬æä¾›å¯¹å­˜å‚¨å€¼çš„**ç›´æ¥è®¿é—®**ï¼Œè€Œæ— éœ€å¾ªç¯éå†åˆ—è¡¨ã€‚

---

## **æ·»åŠ å€™é€‰äºº â€“ `addCandidateNames()` å‡½æ•°**

```solidity

function addCandidateNames(string memory _candidateNames) public {
    candidateNames.push(_candidateNames);
    voteCount[_candidateNames] = 0;
}

```

### **è¯¦ç»†åˆ†æï¼š**

1ï¸âƒ£ **æ¥å—å€™é€‰äººå§“åä½œä¸ºè¾“å…¥ï¼ˆ`_candidateNames`ï¼‰**

- è¿™æ˜¯ä¸€ä¸ª**å‡½æ•°å‚æ•°**ï¼Œæ„å‘³ç€ç”¨æˆ·åœ¨è°ƒç”¨å‡½æ•°æ—¶æä¾›å€™é€‰äººçš„å§“åã€‚
- æˆ‘ä»¬ä½¿ç”¨ `memory`ï¼Œå› ä¸ºå­—ç¬¦ä¸²åœ¨ Solidity ä¸­æ˜¯åŠ¨æ€çš„ï¼Œå¿…é¡»åœ¨å‡½æ•°å†…éƒ¨æ˜ç¡®å­˜å‚¨åœ¨ä¸´æ—¶å†…å­˜ä¸­ã€‚

2ï¸âƒ£ **å°†å€™é€‰äººå­˜å‚¨åœ¨æ•°ç»„ä¸­**

- `candidateNames.push(_candidateNames);` å°†å§“åæ·»åŠ åˆ°æˆ‘ä»¬çš„ `candidateNames` æ•°ç»„ä¸­ã€‚

3ï¸âƒ£ **å°†å€™é€‰äººçš„ç¥¨æ•°åˆå§‹åŒ–ä¸ºé›¶**

- `voteCount[_candidateNames] = 0;` ç¡®ä¿æ¯ä¸ªå€™é€‰äººä»é›¶ç¥¨å¼€å§‹ã€‚

ç°åœ¨ï¼Œå½“æœ‰äººè°ƒç”¨ï¼š

```solidity

addCandidateNames("Alice");

```

- `"Alice"` è¢«æ·»åŠ åˆ° `candidateNames[]` ä¸­ã€‚
- `"Alice"` åœ¨ `voteCount` æ˜ å°„ä¸­è¢«åˆå§‹åŒ–ä¸º `0` ç¥¨ã€‚

---

## **æ£€ç´¢å€™é€‰äººåˆ—è¡¨ â€“ `getCandidateNames()` å‡½æ•°**

```solidity

function getcandidateNames() public view returns (string[] memory) {
    return candidateNames;
}

```

### **ç†è§£ `view` å‡½æ•°**

- `public view` â†’ ç”±äºæ­¤å‡½æ•°ä»…**è¯»å–**æ•°æ®ï¼ˆä¸ä¿®æ”¹çŠ¶æ€å˜é‡ï¼‰ï¼Œå› æ­¤**è°ƒç”¨å…è´¹**ã€‚
- `returns (string[] memory)` â†’ è¿”å›å­˜å‚¨åœ¨ `candidateNames` ä¸­çš„**å­—ç¬¦ä¸²æ•°ç»„**ã€‚
- ç”±äº `candidateNames` æ˜¯ `public` çš„ï¼ŒSolidity **è‡ªåŠ¨**æä¾›è·å–å‡½æ•°ã€‚

æ­¤å‡½æ•°å…è®¸ç”¨æˆ·æŸ¥çœ‹**è°åœ¨å‚ä¸æŠ•ç¥¨**ã€‚

---

## **ä¸ºå€™é€‰äººæŠ•ç¥¨ â€“ `vote()` å‡½æ•°**

```solidity

function vote(string memory _candidateNames) public {
    voteCount[_candidateNames] += 1;
}

```

### **å·¥ä½œåŸç†ï¼š**

- `public` â†’ å…è®¸ä»»ä½•äººè°ƒç”¨æ­¤å‡½æ•°ã€‚
- `string memory _candidateNames` â†’ å°†å€™é€‰äººçš„å§“åä½œä¸ºè¾“å…¥ã€‚
- `voteCount[_candidateNames] += 1;` â†’ å°†è¯¥å€™é€‰äººçš„ç¥¨æ•°å¢åŠ  1ã€‚

### **æ½œåœ¨é—®é¢˜**

ç›®å‰ï¼Œ**ä»»ä½•äººéƒ½å¯ä»¥æŠ•ç¥¨ä»»æ„æ¬¡æ•°**ã€‚

ç°å®ä¸–ç•Œçš„å®ç°åº”è¯¥**é˜²æ­¢é‡å¤æŠ•ç¥¨**â€”â€”ä½†ç°åœ¨ï¼Œæˆ‘ä»¬ä¿æŒç®€å•ã€‚

---

## **æ£€æŸ¥å€™é€‰äººçš„ç¥¨æ•° â€“ `getVote()` å‡½æ•°**

```solidity

function getVote(string memory _candidateNames) public view returns (uint256) {
    return voteCount[_candidateNames];
}

```

### **è¯¦ç»†åˆ†æï¼š**

- `public view` â†’ ç”±äºæ­¤å‡½æ•°**ä»…è¯»å–æ•°æ®**ï¼Œå› æ­¤ä¸æ¶ˆè€— gasã€‚
- `returns (uint256)` â†’ è¿”å›ç»™å®šå€™é€‰äººçš„ç¥¨æ•°ã€‚
- `voteCount[_candidateNames]` â†’ ä»æ˜ å°„ä¸­æ£€ç´¢å€™é€‰äººçš„ç¥¨æ•°ã€‚

---

## **è¯¥åˆçº¦çš„å®é™…è¿è¡Œæ–¹å¼**

### **åœºæ™¯ 1 â€“ è®¾ç½®æŠ•ç¥¨**

1. **å°†åˆçº¦éƒ¨ç½²**åˆ°åŒºå—é“¾ã€‚
2. è°ƒç”¨ `addCandidateNames("Alice")`ã€‚
3. è°ƒç”¨ `addCandidateNames("Bob")`ã€‚
4. ç°åœ¨ï¼Œå€™é€‰äººåˆ—è¡¨æ˜¯ï¼š`["Alice", "Bob"]`ã€‚

### **åœºæ™¯ 2 â€“ æŠ•ç¥¨**

1. è°ƒç”¨ `vote("Alice")` â†’ Alice è·å¾— 1 ç¥¨ã€‚
2. å†æ¬¡è°ƒç”¨ `vote("Alice")` â†’ Alice ç°åœ¨æœ‰ 2 ç¥¨ã€‚
3. è°ƒç”¨ `vote("Bob")` â†’ Bob è·å¾— 1 ç¥¨ã€‚

### **åœºæ™¯ 3 â€“ æ£€æŸ¥ç¥¨æ•°**

1. è°ƒç”¨ `getVote("Alice")` â†’ è¿”å› `2`ã€‚
2. è°ƒç”¨ `getVote("Bob")` â†’ è¿”å› `1`ã€‚

---

## **å…³é”®è¦ç‚¹**

1. **æ•°ç»„ï¼ˆ`string[]`ï¼‰å…è®¸æˆ‘ä»¬å­˜å‚¨å¤šä¸ªå€™é€‰äººå§“åã€‚**
2. **æ˜ å°„ï¼ˆ`mapping(string => uint256)`ï¼‰å…è®¸æˆ‘ä»¬å°†æ¯ä¸ªå€™é€‰äººä¸ç¥¨æ•°å…³è”ã€‚**
3. **`view` å…³é”®å­—ç¡®ä¿åªè¯»å‡½æ•°è°ƒç”¨å…è´¹ã€‚**
4. **å‡½æ•°æ ¹æ®çŠ¶æ€å˜é‡ä¿®æ”¹æˆ–æ£€ç´¢æ•°æ®ã€‚**
5. **æ²¡æœ‰æŠ•ç¥¨è€…é™åˆ¶ï¼Œæ­¤åˆçº¦å…è®¸æ— é™æŠ•ç¥¨â€”â€”è¿™åœ¨ç°å®ä¸–ç•Œåº”ç”¨ä¸­åº”è¯¥æ”¹è¿›ã€‚**

---

## **å¯èƒ½çš„æ”¹è¿›**

1. **é˜²æ­¢å¤šæ¬¡æŠ•ç¥¨** â€“ æ·»åŠ  `mapping(address => bool)` æ¥è·Ÿè¸ªç”¨æˆ·æ˜¯å¦å·²ç»æŠ•ç¥¨ã€‚
2. **æ£€æŸ¥å€™é€‰äººæ˜¯å¦å­˜åœ¨** â€“ ç¡®ä¿ç”¨æˆ·ä¸èƒ½ä¸ºä¸å­˜åœ¨çš„å€™é€‰äººæŠ•ç¥¨ã€‚