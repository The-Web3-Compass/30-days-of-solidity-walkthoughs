# ç¨³å®šå¸

Day: Day 29
ID: 29
åŸæ–‡: https://builder-hub.notion.site/StableCoin-Contract-1e35720a23ef809f9875e8e244964c5b
çŠ¶æ€: å®Œæˆ
è¯‘è€…: Rebecca9715
éš¾åº¦ç­‰çº§: é«˜çº§

å¥½çš„ï¼Œå»ºè®¾è€…ä»¬â€”â€”

èŠ±ä¸€ç§’é’Ÿå›é¡¾ä¸€ä¸‹ä½ èµ°äº†å¤šè¿œã€‚

ä»…ä»…å‡ å¤©æ—¶é—´ï¼Œä½ å°±ä»ç¼–å†™ç®€å•å˜é‡â€¦â€¦

åˆ°åˆ›å»º**ä½ è‡ªå·±çš„ ERC-20 ä»£å¸**ï¼Œ

**é”å®šå®è—**ï¼Œ

**è®¾ç½®è®¿é—®æ§åˆ¶**ï¼Œ

**ä¿æŠ¤åˆçº¦å…å—æ”»å‡»**ï¼Œ

ç”šè‡³**åœ¨æ™ºèƒ½åˆçº¦ä¸­å®‰å…¨åœ°å¤„ç†èµ„é‡‘**ã€‚

**ä½ ä¸ä»…ä»…æ˜¯é˜…è¯»äº† Solidityâ€”â€”ä½ *ç”¨å®ƒæ„å»º*äº†ã€‚**

ç°åœ¨ï¼Œä½ å·²ç»å‡†å¤‡å¥½è¿æ¥ä¸‹ä¸€æ­¥äº†ã€‚

ä»Šå¤©ï¼Œæˆ‘ä»¬å°†ä»"ç©å…·åˆçº¦"è½¬å‘**æ„å»ºä¸€ä¸ªçœŸå®ä¸–ç•Œçš„ã€å¿…ä¸å¯å°‘çš„å·¥å…·**ï¼Œå®ƒä¸ºåŠ å¯†ä¸–ç•Œä¸­æœ€å¤§çš„åº”ç”¨æä¾›åŠ¨åŠ›ï¼š

> ç¨³å®šå¸ã€‚
> 

---

## ğŸŒ ä¸ºä»€ä¹ˆç¨³å®šå¸å¦‚æ­¤é‡è¦

æƒ³è±¡ä¸€ä¸‹è¯•å›¾è¿‡ä½ çš„æ—¥å¸¸ç”Ÿæ´»â€”â€”

ä½†ä½ é’±åŒ…é‡Œçš„é’±çš„ä»·å€¼æ¯éš”å‡ ä¸ªå°æ—¶å°±ä¼š*è·³åŠ¨*ä¸Šä¸‹ 30%ã€‚

- æ˜¨å¤©ï¼Œä½ çš„å’–å•¡èŠ±äº† 3 ç¾å…ƒã€‚
- ä»Šå¤©ï¼Œæ˜¯ 6 ç¾å…ƒã€‚
- æ˜å¤©ï¼Œä¹Ÿè®¸æ˜¯ 1.50 ç¾å…ƒã€‚

è¿™å°±æ˜¯åƒæ¯”ç‰¹å¸å’Œä»¥å¤ªåŠè¿™æ ·çš„åŠ å¯†è´§å¸å¯èƒ½æœ‰å¤šç–¯ç‹‚ã€‚

- *å¯¹æŠ•èµ„è€…æ¥è¯´æœ‰è¶£ï¼Ÿ**ä¹Ÿè®¸å§ã€‚
- *å¯¹æ”¯ä»˜æ¥è¯´å®ç”¨ï¼Ÿ**ç»å¯¹ä¸æ˜¯ã€‚

è¿™å°±æ˜¯**ç¨³å®šå¸**çš„ç”¨æ­¦ä¹‹åœ°ã€‚

ğŸ”¹ å®ƒä»¬å°±åƒåŠ å¯†ä¸–ç•Œé£æš´æµ·æ´‹ä¸­çš„é”šã€‚

ğŸ”¹ å®ƒä»¬è¢«è®¾è®¡ä¸ºä¿æŒ*ç¨³å®š*ï¼Œé€šå¸¸ä¸ä¸»è¦è´§å¸å¦‚**ç¾å…ƒ**1:1 æŒ‚é’©ã€‚

ğŸ”¹ å®ƒä»¬æ˜¯ Web3 ä¸­**äº¤æ˜“**ã€**å‚¨è“„**ã€**å€Ÿè´·**ã€**æ”¾è´·**å’Œ**æ—¥å¸¸äº¤æ˜“**èƒŒåçš„æ²‰é»˜è‹±é›„ã€‚

äº‹å®ä¸Šï¼Œå¦‚æœä½ ä»Šå¤©ç¯é¡¾ DeFiâ€”â€”

**å‡ ä¹æ¯ä¸ª dApp**ã€æ¯ä¸ª NFT å¸‚åœºã€æ¯ä¸ªå€Ÿè´·æ± ã€æ¯ä¸ª DEXâ€”â€”

å®ƒä»¬åœ¨å¹•åéƒ½ä¸¥é‡ä¾èµ–ç¨³å®šå¸ã€‚

æ²¡æœ‰ç¨³å®šå¸ï¼Ÿ

æ•´ä¸ª DeFi ä¸–ç•Œå°±ä¼šæ„Ÿè§‰åƒæ˜¯è¯•å›¾åœ¨ä»·æ ¼æ¯äº”ç§’é’Ÿå˜åŒ–ä¸€æ¬¡çš„å¸‚åœºä¸Šè´­ç‰©ã€‚

---

## ğŸ› ï¸ ä½†çœŸæ­£çš„ç¨³å®šå¸ä¸æ˜¯è¶…çº§å¤æ‚å—ï¼Ÿ

æ˜¯çš„â€”â€”ç»å¯¹æ˜¯ã€‚

åƒ USDCã€DAI å’Œ USDT è¿™æ ·çš„ç°å®ä¸–ç•Œç¨³å®šå¸æ˜¯**æå…¶å¤æ‚çš„ç³»ç»Ÿ**ã€‚

å®ƒä»¬æ¶‰åŠï¼š

- æŠµæŠ¼å‚¨å¤‡
- é“¾ä¸Šå’Œé“¾ä¸‹é¢„è¨€æœº
- åŠ¨æ€ä¾›åº”è°ƒæ•´
- æ²»ç†æŠ•ç¥¨
- å…¨é¢å®¡è®¡å’Œæ³•å¾‹åˆè§„

è¿™åªæ˜¯å†°å±±ä¸€è§’ï¼

**ä½†äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼š**

ä½ ä¸éœ€è¦æ·±å…¥é‚£ç§å¤æ‚æ€§æ¥*ç†è§£*æ ¸å¿ƒæ€æƒ³æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚

---

## ğŸš€ æˆ‘ä»¬ä»Šå¤©è¦æ„å»ºä»€ä¹ˆ

ä»Šå¤©ï¼Œæˆ‘ä»¬æ­£åœ¨æ„å»ºä½ è‡ªå·±çš„**SimpleStablecoin**ã€‚

ä¸€ä¸ª**åˆå­¦è€…å‹å¥½**çš„ç‰ˆæœ¬ã€‚

**ç²¾å¿ƒè®¾è®¡**ä»¥å‰¥ç¦»æ‰€æœ‰ä»¤äººä¸çŸ¥æ‰€æªçš„å¤æ‚æ€§â€”â€”

å¹¶**æ”¾å¤§**çœŸæ­£é‡è¦çš„ä¸œè¥¿ï¼š

- ä½ å¦‚ä½•**é“¸é€ **ç¨³å®šå¸ï¼Ÿ
- ä½ å¦‚ä½•**èµå›**å®ƒä»¬ï¼Ÿ
- ä½ å¦‚ä½•ç”¨**çœŸå®æŠµæŠ¼å“****æ”¯æŒ**å®ƒä»¬ï¼Ÿ
- ä½ å¦‚ä½•**è®¡ç®—**å®‰å…¨è¾¹é™…å¹¶ä¿æŠ¤ç³»ç»Ÿï¼Ÿ

ğŸ‘‰ è¿™ä¸æ˜¯ç”Ÿäº§çº§ç¨³å®šå¸ã€‚

ğŸ‘‰ è¿™æ˜¯**ä½ çš„è®­ç»ƒåœº**â€”â€”

ä¸€ä¸ªå¹²å‡€ã€æ˜“äºç†è§£çš„æ¸¸ä¹åœºï¼Œä½ å°†åœ¨è¿™é‡Œå­¦ä¹ é©±åŠ¨ä¸–ç•Œä¸Šæœ€å¤§ç¨³å®šå¸çš„*æœºåˆ¶*ã€‚

å½“æˆ‘ä»¬å®Œæˆæ—¶ï¼Œä½ ä¸ä»…ä¼šçŸ¥é“ç¨³å®šå¸åˆçº¦æ˜¯å¦‚ä½•æ„å»ºçš„â€”â€”

ä½ å°†ç¼–å†™ä½ **è‡ªå·±çš„**ã€‚

ç›¸ä¿¡æˆ‘â€”â€”

**è¿™æ˜¯æˆä¸ºçœŸæ­£çš„ Web3 å¼€å‘è€…çš„ä¸€å¤§é£è·ƒã€‚**

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿ**

è®©æˆ‘ä»¬æ·±å…¥åˆçº¦â€”â€”å¹¶å¼€å§‹è§£å¼€ä½ çš„ SimpleStablecoin å®é™…ä¸Šæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼

---

# ğŸ§  å¿«é€Ÿæ¦‚è§ˆï¼šæˆ‘ä»¬çš„ SimpleStablecoin å¦‚ä½•å·¥ä½œ

åœ¨æˆ‘ä»¬æ·±å…¥ä»£ç ä¹‹å‰ï¼Œè¿™é‡Œå¿«é€Ÿæ¦‚è§ˆä¸€ä¸‹å¹•åå‘ç”Ÿçš„äº‹æƒ…ï¼š

ç”¨æˆ·å°†å­˜å…¥ä¸€ä¸ªå—ä¿¡ä»»çš„æŠµæŠ¼ä»£å¸ï¼ˆå¦‚ ETHã€USDC æˆ–æˆ‘ä»¬å†³å®šçš„ä»»ä½• ERC-20 ä»£å¸ï¼‰ï¼Œå¹¶æ ¹æ®ä»ä»·æ ¼æºè·å–çš„æœ€æ–°ä»·æ ¼ï¼Œåˆçº¦è®¡ç®—ä»–ä»¬å¯ä»¥é“¸é€ å¤šå°‘ç¨³å®šå¸ã€‚ä¸ºäº†ä¿æŒç³»ç»Ÿå®‰å…¨ï¼Œæˆ‘ä»¬ç¡®ä¿ç”¨æˆ·å§‹ç»ˆå­˜å…¥*å¤šäº*ä»–ä»¬è·å¾—çš„ç¨³å®šå¸ä»·å€¼çš„æŠµæŠ¼å“â€”â€”è¿™è¦å½’åŠŸäº 150% çš„æŠµæŠ¼ç‡ã€‚ç¨åï¼Œå½“æœ‰äººæƒ³è¦ä»–ä»¬çš„æŠµæŠ¼å“å›æ¥æ—¶ï¼Œä»–ä»¬å¯ä»¥é€šè¿‡é”€æ¯å®ƒä»¬æ¥èµå›ä»–ä»¬çš„ç¨³å®šå¸ã€‚è¯¥åˆçº¦è¿˜åŒ…æ‹¬åŸºæœ¬çš„æ‰€æœ‰è€…æ§åˆ¶ï¼ˆå¦‚æ›´æ–°ä»·æ ¼æºæˆ–æŠµæŠ¼è®¾ç½®ï¼‰å¹¶é˜²æ­¢åƒé‡å…¥æ”»å‡»è¿™æ ·çš„å¸¸è§æ¼æ´ã€‚

è¿™æ˜¯ä¸€ä¸ª**åˆå­¦è€…å‹å¥½**çš„ç‰ˆæœ¬â€”â€”ä¸“é—¨å…³æ³¨**é“¸é€ **ã€**èµå›**å’Œ**æŠµæŠ¼ç®¡ç†**ç­‰æ ¸å¿ƒæœºåˆ¶ï¼Œè¿™æ ·ä½ å°±å¯ä»¥çœŸæ­£ç†è§£ç¨³å®šå¸åœ¨å¹•åæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè€Œä¸ä¼šè¢«ç”Ÿäº§çº§çš„å¤æ‚æ€§æ‰€æ·¹æ²¡ã€‚

---

# ğŸ“ è¿™æ˜¯å®Œæ•´çš„åˆçº¦

ç°åœ¨ä½ çŸ¥é“äº†é«˜å±‚æ¬¡çš„æƒ³æ³•ï¼Œ

è®©æˆ‘ä»¬è·³è¿›ä»£ç ï¼Œçœ‹çœ‹ä¸€åˆ‡æ˜¯å¦‚ä½•ç»„åˆåœ¨ä¸€èµ·çš„ï¼

ğŸ‘‡

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
import "@openzeppelin/contracts/access/AccessControl.sol";
import "@openzeppelin/contracts/interfaces/IERC20Metadata.sol";
import "@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol";

contract SimpleStablecoin is ERC20, Ownable, ReentrancyGuard, AccessControl {
    using SafeERC20 for IERC20;

    bytes32 public constant PRICE_FEED_MANAGER_ROLE = keccak256("PRICE_FEED_MANAGER_ROLE");
    IERC20 public immutable collateralToken;
    uint8 public immutable collateralDecimals;
    AggregatorV3Interface public priceFeed;
    uint256 public collateralizationRatio = 150; // ä»¥ç™¾åˆ†æ¯”è¡¨ç¤ºï¼ˆ150 = 150%ï¼‰

    event Minted(address indexed user, uint256 amount, uint256 collateralDeposited);
    event Redeemed(address indexed user, uint256 amount, uint256 collateralReturned);
    event PriceFeedUpdated(address newPriceFeed);
    event CollateralizationRatioUpdated(uint256 newRatio);

    error InvalidCollateralTokenAddress();
    error InvalidPriceFeedAddress();
    error MintAmountIsZero();
    error InsufficientStablecoinBalance();
    error CollateralizationRatioTooLow();

    constructor(
        address _collateralToken,
        address _initialOwner,
        address _priceFeed
    ) ERC20("Simple USD Stablecoin", "sUSD") Ownable(_initialOwner) {
        if (_collateralToken == address(0)) revert InvalidCollateralTokenAddress();
        if (_priceFeed == address(0)) revert InvalidPriceFeedAddress();

        collateralToken = IERC20(_collateralToken);
        collateralDecimals = IERC20Metadata(_collateralToken).decimals();
        priceFeed = AggregatorV3Interface(_priceFeed);

        _grantRole(DEFAULT_ADMIN_ROLE, _initialOwner);
        _grantRole(PRICE_FEED_MANAGER_ROLE, _initialOwner);
    }

    function getCurrentPrice() public view returns (uint256) {
        (, int256 price, , , ) = priceFeed.latestRoundData();
        require(price > 0, "Invalid price feed response");
        return uint256(price);
    }

    function mint(uint256 amount) external nonReentrant {
        if (amount == 0) revert MintAmountIsZero();

        uint256 collateralPrice = getCurrentPrice();
        uint256 requiredCollateralValueUSD = amount * (10 ** decimals()); // å‡è®¾ sUSD ä¸º 18 ä½å°æ•°
        uint256 requiredCollateral = (requiredCollateralValueUSD * collateralizationRatio) / (100 * collateralPrice);
        uint256 adjustedRequiredCollateral = (requiredCollateral * (10 ** collateralDecimals)) / (10 ** priceFeed.decimals());

        collateralToken.safeTransferFrom(msg.sender, address(this), adjustedRequiredCollateral);
        _mint(msg.sender, amount);

        emit Minted(msg.sender, amount, adjustedRequiredCollateral);
    }

    function redeem(uint256 amount) external nonReentrant {
        if (amount == 0) revert MintAmountIsZero();
        if (balanceOf(msg.sender) < amount) revert InsufficientStablecoinBalance();

        uint256 collateralPrice = getCurrentPrice();
        uint256 stablecoinValueUSD = amount * (10 ** decimals());
        uint256 collateralToReturn = (stablecoinValueUSD * 100) / (collateralizationRatio * collateralPrice);
        uint256 adjustedCollateralToReturn = (collateralToReturn * (10 ** collateralDecimals)) / (10 ** priceFeed.decimals());

        _burn(msg.sender, amount);
        collateralToken.safeTransfer(msg.sender, adjustedCollateralToReturn);

        emit Redeemed(msg.sender, amount, adjustedCollateralToReturn);
    }

    function setCollateralizationRatio(uint256 newRatio) external onlyOwner {
        if (newRatio < 100) revert CollateralizationRatioTooLow();
        collateralizationRatio = newRatio;
        emit CollateralizationRatioUpdated(newRatio);
    }

    function setPriceFeedContract(address _newPriceFeed) external onlyRole(PRICE_FEED_MANAGER_ROLE) {
        if (_newPriceFeed == address(0)) revert InvalidPriceFeedAddress();
        priceFeed = AggregatorV3Interface(_newPriceFeed);
        emit PriceFeedUpdated(_newPriceFeed);
    }

    function getRequiredCollateralForMint(uint256 amount) public view returns (uint256) {
        if (amount == 0) return 0;

        uint256 collateralPrice = getCurrentPrice();
        uint256 requiredCollateralValueUSD = amount * (10 ** decimals());
        uint256 requiredCollateral = (requiredCollateralValueUSD * collateralizationRatio) / (100 * collateralPrice);
        uint256 adjustedRequiredCollateral = (requiredCollateral * (10 ** collateralDecimals)) / (10 ** priceFeed.decimals());

        return adjustedRequiredCollateral;
    }

    function getCollateralForRedeem(uint256 amount) public view returns (uint256) {
        if (amount == 0) return 0;

        uint256 collateralPrice = getCurrentPrice();
        uint256 stablecoinValueUSD = amount * (10 ** decimals());
        uint256 collateralToReturn = (stablecoinValueUSD * 100) / (collateralizationRatio * collateralPrice);
        uint256 adjustedCollateralToReturn = (collateralToReturn * (10 ** collateralDecimals)) / (10 ** priceFeed.decimals());

        return adjustedCollateralToReturn;
    }

}

```

---

# 1. äº§å“éœ€æ±‚ä¹¦

### ç”¨æˆ·æµç¨‹

```mermaid
graph TD
  ç¨³å®šå¸ç³»ç»Ÿ --> é“¸é€ æµç¨‹ --> ç”¨æˆ·è¾“å…¥é“¸é€ æ•°é‡[ç”¨æˆ·è¾“å…¥é“¸é€ æ•°é‡]
  é“¸é€ æµç¨‹ --> è·å–ä»·æ ¼[ä» Chainlink è·å–æŠµæŠ¼å“ä»·æ ¼]
  è·å–ä»·æ ¼ --> è®¡ç®—æŠµæŠ¼[è®¡ç®—æ‰€éœ€æŠµæŠ¼æ•°é‡]
  è®¡ç®—æŠµæŠ¼ --> åˆ¤æ–­æŠµæŠ¼{æŠµæŠ¼æ˜¯å¦è¶³å¤Ÿ?}
  åˆ¤æ–­æŠµæŠ¼ -- å¦ --> æ‹’ç»äº¤æ˜“[äº¤æ˜“å›é€€ âŒ]
  åˆ¤æ–­æŠµæŠ¼ -- æ˜¯ --> è½¬å…¥æŠµæŠ¼[è½¬å…¥æŠµæŠ¼å“ SafeERC20.transferFrom]
  è½¬å…¥æŠµæŠ¼ --> ç”Ÿæˆç¨³å®šå¸[é“¸é€  sUSD ç¨³å®šå¸]
  ç”Ÿæˆç¨³å®šå¸ --> è®°å½•äº‹ä»¶[è®°å½• Minted äº‹ä»¶]
  è®°å½•äº‹ä»¶ --> é“¸é€ å®Œæˆ[é“¸é€ æˆåŠŸ âœ…]

  ç¨³å®šå¸ç³»ç»Ÿ --> èµå›æµç¨‹ --> ç”¨æˆ·è¾“å…¥èµå›æ•°é‡[ç”¨æˆ·è¾“å…¥èµå›æ•°é‡]
  èµå›æµç¨‹ --> æ£€æŸ¥ä½™é¢[æ£€æŸ¥ç”¨æˆ· sUSD ä½™é¢]
  æ£€æŸ¥ä½™é¢ --> åˆ¤æ–­ä½™é¢{ä½™é¢æ˜¯å¦è¶³å¤Ÿ?}
  åˆ¤æ–­ä½™é¢ -- å¦ --> æ‹’ç»èµå›[äº¤æ˜“å›é€€ âŒ]
  åˆ¤æ–­ä½™é¢ -- æ˜¯ --> è®¡ç®—è¿”è¿˜æŠµæŠ¼[è®¡ç®—å¯è¿”è¿˜æŠµæŠ¼æ•°é‡]
  è®¡ç®—è¿”è¿˜æŠµæŠ¼ --> é”€æ¯ç¨³å®šå¸[é”€æ¯ sUSD ç¨³å®šå¸]
  é”€æ¯ç¨³å®šå¸ --> è½¬å›æŠµæŠ¼[è¿”è¿˜æŠµæŠ¼å“ SafeERC20.transfer]
  è½¬å›æŠµæŠ¼ --> è®°å½•èµå›äº‹ä»¶[è®°å½• Redeemed äº‹ä»¶]
  è®°å½•èµå›äº‹ä»¶ --> èµå›å®Œæˆ[èµå›æˆåŠŸ âœ…]

  ç®¡ç†å‘˜ --> ä¿®æ”¹ä»·æ ¼æº[æ›´æ–°ä»·æ ¼æºåœ°å€]
  ä¿®æ”¹ä»·æ ¼æº --> æ›´æ–°æº[æ›¿æ¢ Chainlink é¢„è¨€æœº]
  æ›´æ–°æº --> å‘å‡ºä»·æ ¼äº‹ä»¶[è®°å½• PriceFeedUpdated äº‹ä»¶]

  ç®¡ç†å‘˜ --> ä¿®æ”¹æŠµæŠ¼ç‡[æ›´æ–°æŠµæŠ¼ç‡å‚æ•°]
  ä¿®æ”¹æŠµæŠ¼ç‡ --> æ›´æ–°å‚æ•°[ä¿®æ”¹ collateralizationRatio]
  æ›´æ–°å‚æ•° --> å‘å‡ºæŠµæŠ¼äº‹ä»¶[è®°å½• CollateralizationRatioUpdated äº‹ä»¶]

```

### æ•°æ®åº“

| Contract | Type | Bases |
| --- | --- | --- |
| **SimpleStablecoin** | Implementation | ERC20, Ownable, ReentrancyGuard, AccessControl |

| â”” Function Name | Visibility | Mutability |
| --- | --- | --- |
| constructor | public | ğŸ›‘ |
| getCurrentPrice | public | view |
| mint | external | ğŸ›‘ |
| redeem | external | ğŸ›‘ |
| setCollateralizationRatio | external (onlyOwner) | ğŸ›‘ |
| setPriceFeedContract | external (onlyRole) | ğŸ›‘ |
| getRequiredCollateralForMint | public | view |
| getCollateralForRedeem | public | view |

# 2. ç»†èŠ‚è§£è¯´

# ğŸ“¦ `SimpleStablecoin.sol` ä¸­çš„å¯¼å…¥

åœ¨æˆ‘ä»¬æ·±å…¥ç¨³å®šå¸çš„é€»è¾‘ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥ä¸€äº›å¼ºå¤§çš„åº“å’Œæ¥å£ã€‚è¿™äº›å¯¼å…¥å¸¦æ¥äº†ç»è¿‡å®æˆ˜æ£€éªŒçš„å·¥å…·ï¼Œç”¨äºä»£å¸è¡Œä¸ºã€æ‰€æœ‰æƒã€å®‰å…¨æ€§ã€è§’è‰²ç®¡ç†â€”â€”ä»¥åŠç¬¬ä¸€æ¬¡ä» Chainlink è·å¾—å®æ—¶ä»·æ ¼æ•°æ®ã€‚

è¿™æ˜¯æˆ‘ä»¬å¼•å…¥åˆçº¦çš„æ‰€æœ‰å†…å®¹ï¼š

---

```solidity

import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
import "@openzeppelin/contracts/access/AccessControl.sol";
import "@openzeppelin/contracts/interfaces/IERC20Metadata.sol";
import "@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol";

```

---

# ğŸ§© è¯¦ç»†è§£è¯»

æˆ‘ä»¬é¦–å…ˆä» OpenZeppelin å¯¼å…¥ **ERC20**ï¼Œå®ƒä¸ºæˆ‘ä»¬æä¾›äº†æ‰€æœ‰æ ‡å‡†ä»£å¸åŠŸèƒ½â€”â€”é“¸é€ ã€è½¬è´¦å’Œç®¡ç†ä½™é¢â€”â€”æ— éœ€ä»å¤´å¼€å§‹ç¼–å†™ã€‚

ç„¶åï¼Œ**Ownable** ä»‹å…¥å¼•å…¥ä¸€ä¸ªç®€å•çš„æ‰€æœ‰æƒç³»ç»Ÿã€‚æ•æ„Ÿè®¾ç½®ï¼Œå¦‚æ›´æ–°æŠµæŠ¼ç‡ï¼Œåº”è¯¥åªç”±åˆçº¦æ‰€æœ‰è€…æ›´æ”¹ï¼Œè€Œè¿™ä¸ªæ¨¡å—ä¸ºæˆ‘ä»¬å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚

æ¥ä¸‹æ¥å¯¼å…¥ **ReentrancyGuard**ï¼Œä»¥ä¿æŠ¤åƒ `mint` å’Œ `redeem` è¿™æ ·çš„é‡è¦å‡½æ•°å…å—ä¸€ç§ç§°ä¸º"é‡å…¥"çš„æ”»å‡»ï¼Œåœ¨è¿™ç§æ”»å‡»ä¸­ï¼Œæ¶æ„åˆçº¦è¯•å›¾åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨å®Œæˆä¹‹å‰é‡å¤è°ƒç”¨å‡½æ•°ã€‚

**SafeERC20** æ˜¯å¤„ç†å…¶ä»– ERC-20 ä»£å¸çš„å®‰å…¨ç½‘ã€‚æœ‰æ—¶ï¼Œä»£å¸åˆçº¦è¡¨ç°ä¸ä½³ï¼ˆå¦‚åœ¨æ²¡æœ‰é”™è¯¯çš„æƒ…å†µä¸‹è½¬è´¦å¤±è´¥ï¼‰ï¼Œè€Œ SafeERC20 ç¡®ä¿æ‰€æœ‰ä»£å¸æ“ä½œè¦ä¹ˆæˆåŠŸå®Œæˆï¼Œè¦ä¹ˆå¹²å‡€åœ°å¤±è´¥ã€‚

æˆ‘ä»¬è¿˜å¼•å…¥ **AccessControl**ï¼Œå®ƒå…è®¸åˆçº¦å®šä¹‰è‡ªå®šä¹‰è§’è‰²ã€‚åœ¨è¿™ä¸ªç¨³å®šå¸ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ **ä»·æ ¼æºç®¡ç†å™¨** è§’è‰²â€”â€”æ‰€ä»¥ç‰¹å®šè´¦æˆ·å¯ä»¥åœ¨æ²¡æœ‰å®Œå…¨ç®¡ç†å‘˜æ§åˆ¶çš„æƒ…å†µä¸‹æ›´æ–°ä»·æ ¼æºã€‚

**IERC20Metadata** åœ¨è¿™é‡Œå¸®åŠ©æˆ‘ä»¬è·å–å…³äºæŠµæŠ¼ä»£å¸çš„é¢å¤–ä¿¡æ¯ï¼Œå¦‚å®ƒä½¿ç”¨å¤šå°‘ä½å°æ•°ã€‚ä¸åŒçš„ä»£å¸æœ‰ä¸åŒçš„å°æ•°è®¾ç½®ï¼Œæˆ‘ä»¬çš„æ•°å­¦éœ€è¦è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚

æœ€åï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ï¼Œæˆ‘ä»¬ä» Chainlink å¯¼å…¥ **AggregatorV3Interface**ã€‚

è¿™æ˜¯è®©æˆ‘ä»¬çš„ç¨³å®šå¸**çœ‹åˆ°æŠµæŠ¼ä»£å¸çš„çœŸå®ä¸–ç•Œä»·æ ¼**çš„ä¸œè¥¿ã€‚

è€Œä¸æ˜¯çŒœæµ‹æˆ–ä¾èµ–æ‰‹åŠ¨æ›´æ–°ï¼Œåˆçº¦å¯ä»¥è‡ªåŠ¨è·å–å—ä¿¡ä»»çš„ã€å»ä¸­å¿ƒåŒ–çš„ä»·æ ¼æ•°æ®â€”â€”ä¿æŒç³»ç»Ÿå‡†ç¡®ã€æœ€æ–°å¹¶é˜²æ­¢æ“çºµã€‚

---

# ğŸ—ï¸ åˆçº¦å£°æ˜

åœ¨é€šè¿‡å¯¼å…¥è®¾ç½®å¥½æ‰€æœ‰å·¥å…·ä¹‹åï¼Œæˆ‘ä»¬ç°åœ¨æ­£å¼å¼€å§‹æ„å»ºæˆ‘ä»¬çš„åˆçº¦ã€‚

è¿™æ˜¯å¯åŠ¨ä¸€åˆ‡çš„ç¬¬ä¸€è¡Œï¼š

---

```solidity

contract SimpleStablecoin is ERC20, Ownable, ReentrancyGuard, AccessControl {

```

---

# ğŸ§© è¯¦ç»†è§£è¯»

æˆ‘ä»¬å£°æ˜æˆ‘ä»¬çš„åˆçº¦å¹¶ç»™å®ƒä¸€ä¸ªåå­—ï¼š**SimpleStablecoin**ã€‚

ä½†æˆ‘ä»¬ä¸æ˜¯ä»å¤´å¼€å§‹æ„å»ºä¸€åˆ‡â€”â€”æˆ‘ä»¬**æ‰©å±•**å››ä¸ªå¼ºå¤§çš„ OpenZeppelin åˆçº¦ä»¥ç»§æ‰¿ç°æˆçš„åŠŸèƒ½ï¼š

- **ERC20**â€”â€”è¿™ä¸ºæˆ‘ä»¬çš„ç¨³å®šå¸æä¾›äº†æ‰€æœ‰åŸºæœ¬çš„ä»£å¸è¡Œä¸ºï¼Œå¦‚è½¬è´¦ä»£å¸ã€æ‰¹å‡†æ”¯å‡ºè€…å’Œæ£€æŸ¥ä½™é¢ã€‚
- **Ownable**â€”â€”æ·»åŠ ä¸€ä¸ªç®€å•çš„æ‰€æœ‰æƒæ¨¡å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ§åˆ¶è°æœ‰æƒæ‰§è¡Œæ•æ„Ÿæ“ä½œï¼Œå¦‚æ›´æ–°ç³»ç»Ÿè®¾ç½®ã€‚
- **ReentrancyGuard**â€”â€”ä¿æŠ¤å…³é”®å‡½æ•°å…å—é‡å…¥æ”»å‡»ï¼Œä½¿é“¸é€ å’Œèµå›ç­‰æ“ä½œæ›´åŠ å®‰å…¨ã€‚
- **AccessControl**â€”â€”å…è®¸æˆ‘ä»¬å®šä¹‰è‡ªå®šä¹‰è§’è‰²ï¼ˆå¦‚ä»·æ ¼æºç®¡ç†å™¨ï¼‰ï¼Œå¹¶ç²¾ç»†æ§åˆ¶è°å¯ä»¥è°ƒç”¨æŸäº›å‡½æ•°ã€‚

é€šè¿‡ä¸€æ¬¡ç»§æ‰¿æ‰€æœ‰è¿™äº›ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªå¼ºå¤§çš„åŸºç¡€ï¼Œå…¶ä¸­å®‰å…¨æ€§ã€è®¿é—®æ§åˆ¶å’Œä»£å¸è¡Œä¸ºå·²ç»å¾—åˆ°ä¸“ä¸šå¤„ç†â€”â€”æˆ‘ä»¬å¯ä»¥çº¯ç²¹ä¸“æ³¨äºç¨³å®šå¸ç‰¹å®šçš„é€»è¾‘ã€‚

---

# 

# ğŸ—ï¸ çŠ¶æ€å˜é‡

ç°åœ¨åˆçº¦å·²ç»è¢«å£°æ˜ï¼Œæˆ‘ä»¬ç»§ç»­è®¾ç½®**å…³é”®å˜é‡**ï¼Œè¿™äº›å˜é‡å®šä¹‰äº†æˆ‘ä»¬çš„ç¨³å®šå¸å°†å¦‚ä½•åœ¨å†…éƒ¨å·¥ä½œã€‚

è¿™äº›å˜é‡å°†å­˜å‚¨ä»æŠµæŠ¼ä»£å¸åˆ°å½“å‰ä»·æ ¼æºçš„æ‰€æœ‰å†…å®¹ï¼Œç¡®ä¿æˆ‘ä»¬çš„ç³»ç»ŸçŸ¥é“å®ƒæ­£åœ¨ç®¡ç†ä»€ä¹ˆèµ„äº§ä»¥åŠåœ¨ä»€ä¹ˆè§„åˆ™ä¸‹ã€‚

è¿™æ˜¯ä»£ç ï¼š

---

```solidity

using SafeERC20 for IERC20;

bytes32 public constant PRICE_FEED_MANAGER_ROLE = keccak256("PRICE_FEED_MANAGER_ROLE");
IERC20 public immutable collateralToken;
uint8 public immutable collateralDecimals;
AggregatorV3Interface public priceFeed;
uint256 public collateralizationRatio = 150; // ä»¥ç™¾åˆ†æ¯”è¡¨ç¤ºï¼ˆ150 = 150%ï¼‰

```

---

# ğŸ§© è¯¦ç»†è§£è¯»

---

```solidity

using SafeERC20 for IERC20;

```

è¿™ä¸€è¡Œä¸ºæˆ‘ä»¬ä¸ä¹‹äº¤äº’çš„æ‰€æœ‰ `IERC20` ä»£å¸æ¿€æ´» **SafeERC20**ã€‚

å®ƒè‡ªåŠ¨ç”¨å®‰å…¨æ£€æŸ¥åŒ…è£…åƒ `transferFrom` å’Œ `transfer` è¿™æ ·çš„æ–¹æ³•â€”â€”ç¡®ä¿ä»£å¸æ“ä½œè¦ä¹ˆæ­£ç¡®æˆåŠŸï¼Œè¦ä¹ˆåœ¨å‡ºç°ä»»ä½•é—®é¢˜æ—¶å®‰å…¨åœ°å›æ»šã€‚

---

```solidity
bytes32 public constant PRICE_FEED_MANAGER_ROLE = keccak256("PRICE_FEED_MANAGER_ROLE");

```

æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º `PRICE_FEED_MANAGER_ROLE` çš„ç‰¹æ®Šè§’è‰²ï¼Œå®ƒæ§åˆ¶è°å¯ä»¥æ›´æ–°ä»·æ ¼æºã€‚

ä½ ä¼šæ³¨æ„åˆ°å®ƒè¢«å­˜å‚¨ä¸º `bytes32` `constant`ã€‚
åŸå› å¦‚ä¸‹ï¼š

`bytes32` è¢«ä½¿ç”¨æ˜¯å› ä¸º AccessControl ä¸­çš„è§’è‰²æ ‡è¯†ç¬¦æ€»æ˜¯æœŸæœ›æ­£å¥½ 32 å­—èŠ‚â€”â€”è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–æ ¼å¼ï¼Œä½¿è§’è‰²æ£€æŸ¥åœ¨ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰å†…éƒ¨å¿«é€Ÿé«˜æ•ˆã€‚

constant æ„å‘³ç€è¿™ä¸ªå€¼ä¸€æ—¦éƒ¨ç½²å°±æ°¸è¿œä¸ä¼šæ”¹å˜ã€‚å®ƒè¢«æ°¸ä¹…ç¡¬ç¼–ç åˆ°åˆçº¦ä¸­ï¼Œä½¿å…¶åœ¨ gas ä¸Šæ›´ä¾¿å®œã€æ›´å®‰å…¨â€”â€”æ²¡æœ‰äººæœ‰æœºä¼šæ„å¤–åœ°ï¼ˆæˆ–æ¶æ„åœ°ï¼‰ç¨åä¿®æ”¹è§’è‰²æ ‡è¯†ç¬¦ã€‚

æˆ‘ä»¬ä½¿ç”¨ `keccak256("PRICE_FEED_MANAGER_ROLE")` ç”Ÿæˆå®ƒï¼Œè¿™æ ·è§’è‰²å°±æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„ã€åŠ å¯†å¼ºåº¦çš„æ ‡è¯†ç¬¦ï¼Œè€Œä¸æ˜¯åªä½¿ç”¨ä¸€ä¸ªæ™®é€šå­—ç¬¦ä¸²ã€‚

---

```solidity

IERC20 public immutable collateralToken;

```

è¿™ä¸ªå˜é‡å­˜å‚¨ç”¨æˆ·å¿…é¡»ä½œä¸ºæŠµæŠ¼å“å­˜å…¥çš„ **ERC-20 ä»£å¸çš„åœ°å€**ã€‚

é€šè¿‡ä½¿å®ƒæˆä¸º `immutable`ï¼Œæˆ‘ä»¬ç¡®ä¿å®ƒåªèƒ½è®¾ç½®ä¸€æ¬¡â€”â€”åœ¨éƒ¨ç½²æ—¶â€”â€”å¹¶ä¸”ä»¥åæ°¸è¿œä¸èƒ½æ›´æ”¹ï¼Œå¢åŠ äº†é¢å¤–çš„å®‰å…¨å±‚ã€‚

---

```solidity

uint8 public immutable collateralDecimals;

```

ä¸åŒçš„ ERC-20 ä»£å¸å¯ä»¥æœ‰ä¸åŒæ•°é‡çš„å°æ•°ï¼ˆä¾‹å¦‚ï¼ŒUSDC ä½¿ç”¨ 6ï¼ŒETH ä½¿ç”¨ 18ï¼‰ã€‚

æˆ‘ä»¬åœ¨åˆçº¦éƒ¨ç½²æ—¶å°†æŠµæŠ¼ä»£å¸çš„å°æ•°å­˜å‚¨åœ¨è¿™é‡Œï¼Œè¿™æ ·ä»¥åçš„é“¸é€ å’Œèµå›è®¡ç®—å°±ä¿æŒå‡†ç¡®ã€‚

---

```solidity

AggregatorV3Interface public priceFeed;

```

è¿™ä¸ªå˜é‡æŒ‡å‘ **Chainlink ä»·æ ¼æº** åˆçº¦ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨å®ƒåœ¨æœ‰äººé“¸é€ æˆ–èµå›ç¨³å®šå¸æ—¶è·å–æˆ‘ä»¬æŠµæŠ¼ä»£å¸çš„å®æ—¶ä»·æ ¼ã€‚

---

```solidity

uint256 public collateralizationRatio = 150; // ä»¥ç™¾åˆ†æ¯”è¡¨ç¤ºï¼ˆ150 = 150%ï¼‰

```

è¿™è®¾ç½®äº†**æŠµæŠ¼ç‡**â€”â€”æ„å‘³ç€ç”¨æˆ·åœ¨é“¸é€ ç¨³å®šå¸æ—¶å¿…é¡»å§‹ç»ˆå­˜å…¥å…¶ä»·å€¼çš„ **150%** çš„æŠµæŠ¼å“ã€‚

è¿™æ˜¯ä¸€ä¸ªå†…ç½®çš„å®‰å…¨ç¼“å†²ï¼Œä»¥ä¿æŠ¤ç³»ç»Ÿå…å—æŠµæŠ¼å“ä»·å€¼çªç„¶ä¸‹é™çš„å½±å“ã€‚

---

# ğŸ“£ äº‹ä»¶

æ™ºèƒ½åˆçº¦ä¸èƒ½åªæ˜¯ç›´æ¥ä¸ç½‘ç«™æˆ–ç”¨æˆ·"å¯¹è¯"ã€‚

ç›¸åï¼Œå®ƒä»¬**å‘å‡ºäº‹ä»¶**â€”â€”è®°å½•åœ¨åŒºå—é“¾ä¸Šçš„å°ä¿¡å·ã€‚

åƒå‰ç«¯ã€åŒºå—æµè§ˆå™¨å’Œé’±åŒ…è¿™æ ·çš„åº”ç”¨å¯ä»¥ç›‘å¬è¿™äº›äº‹ä»¶ï¼Œå¹¶å®æ—¶å‘ç”¨æˆ·æ˜¾ç¤ºæ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ã€‚

è¿™æ˜¯æˆ‘ä»¬ä» SimpleStablecoin å‘å‡ºçš„ä¸€ç»„äº‹ä»¶ï¼š

---

```solidity

event Minted(address indexed user, uint256 amount, uint256 collateralDeposited);
event Redeemed(address indexed user, uint256 amount, uint256 collateralReturned);
event PriceFeedUpdated(address newPriceFeed);
event CollateralizationRatioUpdated(uint256 newRatio);

```

---

# ğŸ§© è¯¦ç»†è§£è¯»

---

```solidity

event Minted(address indexed user, uint256 amount, uint256 collateralDeposited);

```

æ¯å½“æœ‰äººæˆåŠŸé“¸é€ æ–°ç¨³å®šå¸æ—¶ï¼Œå°±ä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚

å®ƒè®°å½•ï¼š

- **è°é“¸é€ çš„**ï¼ˆ`user`ï¼‰
- **ä»–ä»¬æ”¶åˆ°å¤šå°‘ç¨³å®šå¸**ï¼ˆ`amount`ï¼‰
- **ä»–ä»¬å­˜å…¥å¤šå°‘æŠµæŠ¼å“**ï¼ˆ`collateralDeposited`ï¼‰

`user` ä¸Šçš„ `indexed` å…³é”®å­—å…è®¸ä½ è½»æ¾åœ°åœ¨åŒºå—é“¾ä¸ŠæŒ‰ç‰¹å®šç”¨æˆ·åœ°å€è¿‡æ»¤å’Œæœç´¢æ‰€æœ‰é“¸é€ æ“ä½œã€‚

---

```solidity

event Redeemed(address indexed user, uint256 amount, uint256 collateralReturned);

```

æ¯å½“æœ‰äººå°†ç¨³å®šå¸èµå›ä¸ºæŠµæŠ¼å“æ—¶ï¼Œå°±ä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚

å®ƒå‘Šè¯‰æˆ‘ä»¬ï¼š

- **è°èµå›çš„**ï¼ˆ`user`ï¼‰
- **ä»–ä»¬é”€æ¯äº†å¤šå°‘ç¨³å®šå¸**ï¼ˆ`amount`ï¼‰
- **ä»–ä»¬å–å›äº†å¤šå°‘æŠµæŠ¼å“**ï¼ˆ`collateralReturned`ï¼‰

åŒæ ·ï¼Œ`user` æ˜¯ `indexed` çš„ï¼Œæ‰€ä»¥å‰ç«¯åº”ç”¨å¯ä»¥å¿«é€Ÿæ˜¾ç¤ºç”¨æˆ·çš„ä¸ªäººèµå›å†å²ã€‚

---

```solidity

event PriceFeedUpdated(address newPriceFeed);

```

æ­¤äº‹ä»¶è¡¨ç¤º**ä»·æ ¼æºåœ°å€**å·²æ›´æ–°ã€‚

å®ƒè®°å½•æ–°çš„æºåœ°å€ï¼Œæ‰€ä»¥ä¸€åˆ‡éƒ½ä¿æŒå®Œå…¨é€æ˜â€”â€”

ç”¨æˆ·å¯ä»¥ç›¸ä¿¡å¯¹å…³é”®æ•°æ®æºçš„ä»»ä½•æ›´æ”¹éƒ½æ˜¯å…¬å¼€å¯è§çš„ã€‚

---

```solidity

event CollateralizationRatioUpdated(uint256 newRatio);

```

æœ€åï¼Œæ¯å½“**æŠµæŠ¼ç‡**è¢«æ›´æ”¹æ—¶ï¼Œå°±ä¼šå‘å‡ºæ­¤äº‹ä»¶ã€‚

ç›‘æ§ç³»ç»Ÿçš„ç”¨æˆ·å’Œ dApp å¯ä»¥åœ¨æ‰€éœ€çš„å®‰å…¨ç¼“å†²è¢«æé«˜æˆ–é™ä½æ—¶ç«‹å³åšå‡ºååº”ã€‚

---

# ğŸš¨ è‡ªå®šä¹‰é”™è¯¯

å½“æ™ºèƒ½åˆçº¦å†…éƒ¨å‡ºç°é—®é¢˜æ—¶ï¼Œå¦‚æ— æ•ˆè¾“å…¥æˆ–æ£€æŸ¥å¤±è´¥ï¼Œæˆ‘ä»¬å¸Œæœ›äº¤æ˜“**ä¼˜é›…åœ°å¤±è´¥**å¹¶è§£é‡Š*åŸå› *ã€‚

åœ¨è¾ƒæ—§çš„ Solidity ä»£ç ä¸­ï¼Œè¿™é€šå¸¸ä½¿ç”¨å¸¦æœ‰é”™è¯¯å­—ç¬¦ä¸²çš„ `require()` è¯­å¥å®Œæˆâ€”â€”ä½†è¿™ç§æ–¹æ³•åœ¨ gas ä¸Šå¾ˆæ˜‚è´µã€‚

**è‡ªå®šä¹‰é”™è¯¯**æ˜¯ä¸€ç§æ›´æ–°ã€æ›´æ¸…æ´çš„å¤„ç†å¤±è´¥çš„æ–¹å¼ã€‚

å®ƒä»¬æ›´ä¾¿å®œã€æ›´æ˜“äºé˜…è¯»ï¼Œå¹¶ä¸”ä½¿ç”¨æˆ·å’Œå¼€å‘äººå‘˜çš„è°ƒè¯•å˜å¾—æ›´ç®€å•ã€‚

è¿™æ˜¯æˆ‘ä»¬å£°æ˜çš„è‡ªå®šä¹‰é”™è¯¯ï¼š

---

```solidity

error InvalidCollateralTokenAddress();
error InvalidPriceFeedAddress();
error MintAmountIsZero();
error InsufficientStablecoinBalance();
error CollateralizationRatioTooLow();

```

---

# ğŸ§© è¯¦ç»†è§£è¯»

---

```solidity

error InvalidCollateralTokenAddress();

```

å¦‚æœæœ‰äººè¯•å›¾ç”¨æ— æ•ˆï¼ˆé›¶ï¼‰æŠµæŠ¼ä»£å¸åœ°å€éƒ¨ç½²åˆçº¦ï¼Œå°±ä¼šæŠ›å‡ºæ­¤é”™è¯¯ã€‚

æ²¡æœ‰çœŸæ­£çš„ä»£å¸æ”¯æŒç³»ç»Ÿï¼Œæ•´ä¸ªç¨³å®šå¸å°†æ— æ³•å·¥ä½œâ€”â€”æ‰€ä»¥æˆ‘ä»¬ä¸€å¼€å§‹å°±é˜»æ­¢å®ƒã€‚

---

```solidity

error InvalidPriceFeedAddress();

```

å¦‚æœæä¾›çš„ä»·æ ¼æºåœ°å€æ— æ•ˆï¼Œå°±ä¼šè§¦å‘æ­¤é”™è¯¯ã€‚

ç”±äºæˆ‘ä»¬ä¸¥é‡ä¾èµ–å®æ—¶ä»·æ ¼æ•°æ®ï¼Œè¿æ¥åˆ°åçš„æºä¼šä½¿ç³»ç»Ÿä¸å®‰å…¨â€”â€”æ‰€ä»¥æˆ‘ä»¬ç«‹å³é˜»æ­¢å®ƒã€‚

---

```solidity

error MintAmountIsZero();

```

å¦‚æœç”¨æˆ·è¯•å›¾é“¸é€ **é›¶**ç¨³å®šå¸ï¼Œæˆ‘ä»¬æŠ›å‡ºæ­¤é”™è¯¯ã€‚

é“¸é€ é›¶ä»£å¸æ²¡æœ‰æ„ä¹‰ï¼Œåªä¼šæµªè´¹ gasï¼Œæ‰€ä»¥æˆ‘ä»¬å¹²å‡€åœ°é˜»æ­¢å®ƒã€‚

---

```solidity

error InsufficientStablecoinBalance();

```

å½“ç”¨æˆ·è¯•å›¾**èµå›**æ¯”ä»–ä»¬å®é™…ä½™é¢æ›´å¤šçš„ç¨³å®šå¸æ—¶ï¼Œä½¿ç”¨æ­¤é”™è¯¯ã€‚

å®ƒé˜²æ­¢æ„å¤–é”™è¯¯å’Œæ½œåœ¨æ»¥ç”¨ã€‚

---

```solidity

error CollateralizationRatioTooLow();

```

å¦‚æœæœ‰äººè¯•å›¾å°†æŠµæŠ¼ç‡è®¾ç½®ä¸ºä½äº 100%ï¼Œå°±ä¼šæŠ›å‡ºæ­¤é”™è¯¯ã€‚

å…è®¸ä½äº 100% çš„æ¯”ç‡æ„å‘³ç€ç¨³å®šå¸æ²¡æœ‰å®Œå…¨æ”¯æŒâ€”â€”è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„é£é™©â€”â€”æ‰€ä»¥æˆ‘ä»¬æ‰§è¡Œä¸¥æ ¼çš„æœ€ä½é™åº¦ã€‚

---

# ğŸ—ï¸ æ„é€ å‡½æ•°

æ„é€ å‡½æ•°æ˜¯æˆ‘ä»¬åˆçº¦çš„**å¯åŠ¨åºåˆ—**ã€‚

å®ƒè¿è¡Œ**ä¸€æ¬¡**â€”â€”åœ¨åˆçº¦éƒ¨ç½²çš„é‚£ä¸€åˆ»â€”â€”å¹¶è®¾ç½®æ‰€æœ‰å…³é”®éƒ¨åˆ†ï¼šæˆ‘ä»¬æ¥å—ä»€ä¹ˆä»£å¸ä½œä¸ºæŠµæŠ¼å“ã€æˆ‘ä»¬ä»å“ªé‡Œè·å¾—ä»·æ ¼æ•°æ®ä»¥åŠè°æ§åˆ¶åˆçº¦ã€‚

è¿™æ˜¯ä»£ç ï¼š

---

```solidity

constructor(
    address _collateralToken,
    address _initialOwner,
    address _priceFeed
) ERC20("Simple USD Stablecoin", "sUSD") Ownable(_initialOwner) {
    if (_collateralToken == address(0)) revert InvalidCollateralTokenAddress();
    if (_priceFeed == address(0)) revert InvalidPriceFeedAddress();

    collateralToken = IERC20(_collateralToken);
    collateralDecimals = IERC20Metadata(_collateralToken).decimals();
    priceFeed = AggregatorV3Interface(_priceFeed);

    _grantRole(DEFAULT_ADMIN_ROLE, _initialOwner);
    _grantRole(PRICE_FEED_MANAGER_ROLE, _initialOwner);
}

```

---

# ğŸ§© è¯¦ç»†è§£è¯»

---

```solidity

constructor(
    address _collateralToken,
    address _initialOwner,
    address _priceFeed
)

```

åœ¨éƒ¨ç½²åˆçº¦æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æä¾›ï¼š

- **æŠµæŠ¼ä»£å¸**çš„åœ°å€ï¼ˆåƒ USDCã€WETH ç­‰ ERC-20ï¼‰
- **åˆå§‹æ‰€æœ‰è€…**çš„åœ°å€ï¼ˆç®¡ç†å‘˜ï¼‰
- **Chainlink ä»·æ ¼æº**çš„åœ°å€ï¼ˆè·å–å®æ—¶æŠµæŠ¼å“ä»·æ ¼ï¼‰

---

```solidity

ERC20("Simple USD Stablecoin", "sUSD")

```

å°±åœ¨è¿™é‡Œï¼Œåœ¨æ„é€ å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬è°ƒç”¨ OpenZeppelin çš„ ERC-20 æ„é€ å‡½æ•°â€”â€”

ç»™æˆ‘ä»¬çš„ä»£å¸ä¸€ä¸ª**åç§°**ï¼ˆ"Simple USD Stablecoin"ï¼‰å’Œä¸€ä¸ª**ç¬¦å·**ï¼ˆ"sUSD"ï¼‰ï¼Œå®ƒä»¬å°†å‡ºç°åœ¨é’±åŒ…å’Œæµè§ˆå™¨ä¸­ã€‚

---

```solidity

Ownable(_initialOwner)

```

æˆ‘ä»¬è¿˜è°ƒç”¨ `Ownable` æ„é€ å‡½æ•°ï¼Œè®¾ç½®åˆçº¦çš„åˆå§‹æ‰€æœ‰è€…â€”â€”

å°†æ‹¥æœ‰ç‰¹æ®Šç®¡ç†å‘˜æƒé™çš„äººï¼Œå¦‚ç¨åè°ƒæ•´è®¾ç½®ã€‚

---

```solidity

if (_collateralToken == address(0)) revert InvalidCollateralTokenAddress();

```

åœ¨åšä»»ä½•å…¶ä»–äº‹æƒ…ä¹‹å‰ï¼Œæˆ‘ä»¬ä»”ç»†æ£€æŸ¥æä¾›çš„æŠµæŠ¼ä»£å¸åœ°å€æ˜¯æœ‰æ•ˆçš„ï¼ˆä¸æ˜¯é›¶åœ°å€ï¼‰ã€‚

å¦‚æœå®ƒæ— æ•ˆï¼Œæˆ‘ä»¬ç«‹å³**å›æ»š**éƒ¨ç½²ï¼Œå¹¶æ˜¾ç¤ºæ¸…æ™°çš„è‡ªå®šä¹‰é”™è¯¯ã€‚

---

```solidity

if (_priceFeed == address(0)) revert InvalidPriceFeedAddress();

```

åŒæ ·çš„æƒ³æ³•åœ¨è¿™é‡Œâ€”â€”æˆ‘ä»¬ç¡®ä¿ Chainlink ä»·æ ¼æºåœ°å€åœ¨ç»§ç»­ä¹‹å‰æ˜¯æœ‰æ•ˆçš„ã€‚

æ²¡æœ‰ä»·æ ¼æºï¼Œå°±æ²¡æœ‰ç¨³å®šå¸é€»è¾‘ã€‚

---

```solidity

collateralToken = IERC20(_collateralToken);

```

æˆ‘ä»¬ä¿å­˜æŠµæŠ¼ä»£å¸çš„åœ°å€ï¼Œæ‰€ä»¥åˆçº¦çŸ¥é“ç”¨æˆ·åœ¨é“¸é€ ç¨³å®šå¸æ—¶å°†å­˜å…¥**ä»€ä¹ˆä»£å¸**ã€‚

---

```solidity

collateralDecimals = IERC20Metadata(_collateralToken).decimals();

```

ä¸åŒçš„ä»£å¸æœ‰ä¸åŒçš„å°æ•°æ ¼å¼ã€‚

æˆ‘ä»¬ç°åœ¨è·å–å¹¶å­˜å‚¨æŠµæŠ¼ä»£å¸çš„å°æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ä»¥åæ­£ç¡®å¤„ç†æ‰€æœ‰æ•°å­¦ã€‚

---

```solidity

priceFeed = AggregatorV3Interface(_priceFeed);

```

æˆ‘ä»¬å°†åˆçº¦è¿æ¥åˆ° **Chainlink ä»·æ ¼æº**ï¼Œä½¿å…¶èƒ½å¤ŸæŒ‰éœ€è·å–å®æ—¶ä»·æ ¼æ•°æ®ã€‚

---

```solidity

_grantRole(DEFAULT_ADMIN_ROLE, _initialOwner);
_grantRole(PRICE_FEED_MANAGER_ROLE, _initialOwner);

```

æœ€åï¼Œæˆ‘ä»¬æˆäºˆä¸¤ä¸ªé‡è¦è§’è‰²ï¼š

- **DEFAULT_ADMIN_ROLE**â€”â€”è®©æ‰€æœ‰è€…å®Œå…¨æ§åˆ¶åˆçº¦çš„è§’è‰²ç³»ç»Ÿ
- **PRICE_FEED_MANAGER_ROLE**â€”â€”è®©æ‰€æœ‰è€…åœ¨å°†æ¥éœ€è¦æ—¶æ›´æ–°ä»·æ ¼æº

é€šè¿‡åœ¨éƒ¨ç½²æ—¶åˆ†é…è¿™äº›è§’è‰²ï¼Œæˆ‘ä»¬ç¡®ä¿ç³»ç»Ÿä»ç¬¬ä¸€å¤©èµ·å°±æ˜¯å®‰å…¨ä¸”å¯ç®¡ç†çš„ã€‚

---

# ğŸ§® ä» Chainlink è·å–å®æ—¶ä»·æ ¼

è¿™ä¸ªå‡½æ•°æ˜¯æˆ‘ä»¬åœ¨æ•´ä¸ªåˆçº¦ä¸­ä½¿ç”¨çš„**è¾…åŠ©å‡½æ•°**â€”â€”åœ¨é“¸é€ å’Œèµå›é€»è¾‘ä»¥åŠè§†å›¾å‡½æ•°ä¸­ã€‚

è€Œä¸æ˜¯åœ¨æ¯ä¸ªåœ°æ–¹é‡å¤ç›¸åŒçš„ä»·æ ¼è·å–é€»è¾‘ï¼Œæˆ‘ä»¬å°†å®ƒæ•´é½åœ°åŒ…è£…åœ¨ `getCurrentPrice()` ä¸­ï¼Œè¿™æ ·å®ƒå°±å¯é‡ç”¨ä¸”æ˜“äºç»´æŠ¤ã€‚

è¿™æ˜¯ä»£ç ï¼š

---

```solidity

function getCurrentPrice() public view returns (uint256) {
    (, int256 price, , , ) = priceFeed.latestRoundData();
    require(price > 0, "Invalid price feed response");
    return uint256(price);
}

```

---

# ğŸ§© è¯¦ç»†è§£è¯»

---

```solidity

function getCurrentPrice() public view returns (uint256)

```

è¿™æ˜¯ä¸€ä¸ª**å…¬å…±è§†å›¾**å‡½æ•°â€”â€”ä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨å®ƒæ¥è·å–æœ€æ–°ä»·æ ¼ï¼Œå¹¶ä¸”å®ƒä¸ä¼šæ”¹å˜ä»»ä½•çŠ¶æ€ã€‚

---

```solidity

(, int256 price, , , ) = priceFeed.latestRoundData();

```

æˆ‘ä»¬ä» Chainlink èšåˆå™¨æ¥å£è°ƒç”¨ `latestRoundData()`ã€‚

è¿™ç»™æˆ‘ä»¬**æœ€æ–°æŠ¥å‘Šçš„ä»·æ ¼**â€”â€”ä½†æˆ‘ä»¬åªå…³å¿ƒå…ƒç»„ä¸­çš„ç¬¬äºŒä¸ªå€¼ï¼Œè¿™æ˜¯å®é™…ä»·æ ¼ï¼ˆä½œä¸º `int256` è¿”å›ï¼‰ã€‚

---

```solidity

require(price > 0, "Invalid price feed response");

```

åªæ˜¯ä¸ºäº†å®‰å…¨èµ·è§ï¼Œæˆ‘ä»¬æ£€æŸ¥è¿”å›çš„ä»·æ ¼å¤§äºé›¶ã€‚

å¦‚æœé¢„è¨€æœºæ›¾ç»å¤±è´¥æˆ–è¿”å›åæ•°æ®ï¼Œæˆ‘ä»¬é˜»æ­¢äº¤æ˜“ä»¥é˜²æ­¢é”™è¯¯çš„æŠµæŠ¼å“è®¡ç®—ã€‚

---

```solidity

return uint256(price);

```

ç”±äº Solidity æ•°å­¦ä¸æ— ç¬¦å·æ•´æ•°ï¼ˆ`uint256`ï¼‰é…åˆæœ€ä½³ï¼Œæˆ‘ä»¬å°† `int256` å€¼è½¬æ¢ä¸ºæ­£æ•°å¹¶è¿”å›å®ƒã€‚

---

è¿™ä¸ªå‡½æ•°åœ¨æˆ‘ä»¬éœ€è¦å®æ—¶ä»·æ ¼æ—¶è¢«è°ƒç”¨â€”â€”è¿™åœ¨ç¨³å®šå¸ä¸­**å¾ˆå¸¸è§**ã€‚

é€šè¿‡åœ¨è¿™é‡Œé›†ä¸­é€»è¾‘ï¼Œæˆ‘ä»¬ä¿æŒäº‹ç‰©å¹²å‡€ã€å®‰å…¨ï¼Œå¹¶ä¸”å¦‚æœéœ€è¦çš„è¯ï¼Œæ˜“äºåœ¨ä¸€ä¸ªåœ°æ–¹æ›´æ–°ã€‚

---

# ğŸ—ï¸ é“¸é€ ç¨³å®šå¸

mint å‡½æ•°æ˜¯ç”¨æˆ·**å°†æŠµæŠ¼å“å­˜å…¥**åˆçº¦å¹¶æ¥æ”¶**æ–°é“¸é€ çš„ç¨³å®šå¸**ä½œä¸ºå›æŠ¥çš„åœ°æ–¹ã€‚

è¿™æ˜¯ä»»ä½•æƒ³è¦åŸºäºå…¶å­˜å…¥èµ„äº§çš„ä»·å€¼åˆ›å»ºæ–° sUSD ä»£å¸çš„äººçš„å…¥å£ç‚¹ã€‚

è¿™æ˜¯ä»£ç ï¼š

---

```solidity

function mint(uint256 amount) external nonReentrant {
    if (amount == 0) revert MintAmountIsZero();

    uint256 collateralPrice = getCurrentPrice();
    uint256 requiredCollateralValueUSD = amount * (10 ** decimals()); // å‡è®¾ sUSD ä¸º 18 ä½å°æ•°
    uint256 requiredCollateral = (requiredCollateralValueUSD * collateralizationRatio) / (100 * collateralPrice);
    uint256 adjustedRequiredCollateral = (requiredCollateral * (10 ** collateralDecimals)) / (10 ** priceFeed.decimals());

    collateralToken.safeTransferFrom(msg.sender, address(this), adjustedRequiredCollateral);
    _mint(msg.sender, amount);

    emit Minted(msg.sender, amount, adjustedRequiredCollateral);
}

```

---

# ğŸ§© è¯¦ç»†è§£è¯»

---

```solidity

function mint(uint256 amount) external nonReentrant {

```

è¿™æ˜¯ä¸€ä¸ª**é¢å‘å…¬ä¼—çš„å‡½æ•°**â€”â€”ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥è°ƒç”¨å®ƒæ¥é“¸é€ ç¨³å®šå¸ã€‚

æˆ‘ä»¬è¿˜ç”¨ `nonReentrant` ä¿æŠ¤å®ƒï¼Œä»¥é˜²æ­¢é“¸é€ è¿‡ç¨‹ä¸­çš„ç‹¡çŒ¾æ”»å‡»ã€‚

---

```solidity

if (amount == 0) revert MintAmountIsZero();

```

æˆ‘ä»¬ç«‹å³é˜»æ­¢ç”¨æˆ·é“¸é€ **é›¶**ç¨³å®šå¸ã€‚

é“¸é€ é›¶æ˜¯æ¯«æ— æ„ä¹‰çš„ï¼Œåªä¼šæµªè´¹ gasã€‚

---

```solidity

uint256 collateralPrice = getCurrentPrice();

```

æˆ‘ä»¬ä½¿ç”¨è¿æ¥çš„ Chainlink ä»·æ ¼æºè·å–æŠµæŠ¼ä»£å¸çš„**å½“å‰å®æ—¶ä»·æ ¼**ã€‚

è¿™ç¡®ä¿æ‰€éœ€çš„æŠµæŠ¼å“è®¡ç®—å§‹ç»ˆåŸºäº**çœŸå®ä¸–ç•Œæ•°æ®**ï¼Œè€Œä¸æ˜¯è¿‡æ—¶çš„å‡è®¾ã€‚

---

```solidity

uint256 requiredCollateralValueUSD = amount * (10 ** decimals());

```

æˆ‘ä»¬è®¡ç®—ç”¨æˆ·æƒ³è¦é“¸é€ çš„ç¨³å®šå¸çš„ **USD ä»·å€¼**ã€‚

ç”±äº sUSD ä½¿ç”¨ 18 ä½å°æ•°ï¼ˆå¦‚ ETHï¼‰ï¼Œæˆ‘ä»¬ä¹˜ä»¥ `10 ** 18` ä»¥æ­£ç¡®å¤„ç†ç¼©æ”¾ã€‚

---

```solidity

uint256 requiredCollateral = (requiredCollateralValueUSD * collateralizationRatio) / (100 * collateralPrice);

```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ ¹æ®æŠµæŠ¼ç‡ï¼ˆå¦‚ 150%ï¼‰è®¡ç®—ç”¨æˆ·éœ€è¦å­˜å…¥å¤šå°‘**æŠµæŠ¼å“ä»·å€¼**ï¼ˆä»¥ USD è®¡ï¼‰ã€‚

å¦‚æœä½ æƒ³ä»¥ 150% é“¸é€  $100 çš„ sUSDï¼Œä½ åº”è¯¥æä¾›ä»·å€¼ $150 çš„æŠµæŠ¼å“ã€‚

---

```solidity

uint256 adjustedRequiredCollateral = (requiredCollateral * (10 ** collateralDecimals)) / (10 ** priceFeed.decimals());

```

ç”±äºä»£å¸å’Œä»·æ ¼æºé€šå¸¸ä½¿ç”¨ä¸åŒæ•°é‡çš„å°æ•°ï¼ˆä¾‹å¦‚ï¼Œ6 vs 18ï¼‰ï¼Œ

æˆ‘ä»¬åœ¨è¿™é‡Œè°ƒæ•´æ•°å­—ä»¥ç¡®ä¿è®¡ç®—å¯¹äºæŠµæŠ¼ä»£å¸å’Œä»·æ ¼æºéƒ½æ˜¯**ç²¾åº¦æ­£ç¡®**çš„ã€‚

---

```solidity

collateralToken.safeTransferFrom(msg.sender, address(this), adjustedRequiredCollateral);

```

æˆ‘ä»¬å®‰å…¨åœ°å°†æ‰€éœ€æ•°é‡çš„æŠµæŠ¼å“ä»ç”¨æˆ·è½¬å…¥åˆçº¦ã€‚

`safeTransferFrom` ç¡®ä¿æ“ä½œè¦ä¹ˆå®Œå…¨æˆåŠŸï¼Œè¦ä¹ˆå¹²å‡€åœ°å¤±è´¥â€”â€”æ²¡æœ‰é™é»˜é”™è¯¯ã€‚

---

```solidity

_mint(msg.sender, amount);

```

ä¸€æ—¦æŠµæŠ¼å“å®‰å…¨å­˜å…¥ï¼Œæˆ‘ä»¬**é“¸é€ **è¯·æ±‚æ•°é‡çš„ sUSD ç¨³å®šå¸ç›´æ¥è¿›å…¥ç”¨æˆ·çš„é’±åŒ…ã€‚

---

```solidity

emit Minted(msg.sender, amount, adjustedRequiredCollateral);

```

æœ€åï¼Œæˆ‘ä»¬è§¦å‘ **Minted** äº‹ä»¶â€”â€”è®°å½•è°é“¸é€ çš„ã€ä»–ä»¬é“¸é€ äº†å¤šå°‘ä»¥åŠä»–ä»¬å­˜å…¥äº†å¤šå°‘æŠµæŠ¼å“â€”â€”

ä¸º dApp å’Œç”¨æˆ·æä¾›å¯¹åˆšåˆšå‘ç”Ÿçš„äº‹æƒ…çš„å®Œå…¨å¯è§æ€§ã€‚

---

# ğŸ”„ èµå›ç¨³å®šå¸

å¦‚æœé“¸é€ æ˜¯ç”¨æˆ·é€šè¿‡å­˜å…¥æŠµæŠ¼å“æ¥åˆ›å»º sUSD çš„æ–¹å¼ï¼Œ

**èµå›**æ˜¯ä»–ä»¬é”€æ¯ä»–ä»¬çš„ sUSD å¹¶**å–å›ä»–ä»¬çš„æŠµæŠ¼å“**çš„æ–¹å¼ã€‚

è¿™ä¸ªå‡½æ•°ä¸ `mint` ç›¸åï¼šå®ƒç¡®ä¿ç”¨æˆ·æœ‰è¶³å¤Ÿçš„ç¨³å®šå¸ï¼Œæ ¹æ®æœ€æ–°ä»·æ ¼è®¡ç®—ä»–ä»¬åº”è¯¥å–å›å¤šå°‘æŠµæŠ¼å“ï¼Œå¹¶å®‰å…¨åœ°å°†å…¶è¿”å›ç»™ä»–ä»¬ã€‚

è¿™æ˜¯ä»£ç ï¼š

---

```solidity

function redeem(uint256 amount) external nonReentrant {
    if (amount == 0) revert MintAmountIsZero();
    if (balanceOf(msg.sender) < amount) revert InsufficientStablecoinBalance();

    uint256 collateralPrice = getCurrentPrice();
    uint256 stablecoinValueUSD = amount * (10 ** decimals());
    uint256 collateralToReturn = (stablecoinValueUSD * 100) / (collateralizationRatio * collateralPrice);
    uint256 adjustedCollateralToReturn = (collateralToReturn * (10 ** collateralDecimals)) / (10 ** priceFeed.decimals());

    _burn(msg.sender, amount);
    collateralToken.safeTransfer(msg.sender, adjustedCollateralToReturn);

    emit Redeemed(msg.sender, amount, adjustedCollateralToReturn);
}

```

---

# ğŸ§© è¯¦ç»†è§£è¯»

---

```solidity

if (amount == 0) revert MintAmountIsZero();

```

æˆ‘ä»¬ç«‹å³é˜»æ­¢é›¶å€¼èµå›ã€‚

èµå›é›¶åªæ˜¯æµªè´¹ gasã€‚

---

```solidity

if (balanceOf(msg.sender) < amount) revert InsufficientStablecoinBalance();

```

æˆ‘ä»¬æ£€æŸ¥ç”¨æˆ·å®é™…æ‹¥æœ‰è¶³å¤Ÿçš„ sUSD æ¥èµå›ã€‚

å¦‚æœä»–ä»¬è¯•å›¾é”€æ¯æ¯”ä»–ä»¬æŒæœ‰çš„æ›´å¤šï¼Œäº¤æ˜“è¢«å›æ»šâ€”â€”å¹²å‡€è€Œæ¸…æ™°ã€‚

---

```solidity

uint256 collateralPrice = getCurrentPrice();

```

æˆ‘ä»¬ä» Chainlink è·å–æŠµæŠ¼ä»£å¸çš„**æœ€æ–°çœŸå®ä¸–ç•Œä»·æ ¼**ã€‚

è¿™ç¡®ä¿ç”¨æˆ·æ”¶åˆ°çš„æŠµæŠ¼å“æ•°é‡åŸºäºæœ€æ–°çš„ã€å—ä¿¡ä»»çš„å¸‚åœºæ•°æ®ã€‚

---

```solidity

uint256 stablecoinValueUSD = amount * (10 ** decimals());

```

æˆ‘ä»¬è®¡ç®—æ­£åœ¨èµå›çš„ sUSD ä»£å¸çš„ USD ä»·å€¼ï¼Œä½¿ç”¨ 18 ä½å°æ•°æ­£ç¡®ç¼©æ”¾ï¼ˆå› ä¸ºè¿™æ˜¯ sUSD ä½¿ç”¨çš„ï¼‰ã€‚

---

```solidity

uint256 collateralToReturn = (stablecoinValueUSD * 100) / (collateralizationRatio * collateralPrice);

```

ç„¶åæˆ‘ä»¬è®¡ç®—**åº”è¯¥è¿”å›å¤šå°‘æŠµæŠ¼å“ä»·å€¼**â€”â€”

åŸºäºæŠµæŠ¼ç‡å’Œå½“å‰å¸‚åœºä»·æ ¼ã€‚

> ä¾‹å¦‚ï¼šå¦‚æœä½ ä»¥ 150% èµå› $100ï¼Œä½ åº”è¯¥å–å›å¤§çº¦ $66.66 ä»·å€¼çš„æŠµæŠ¼å“ã€‚
> 

---

```solidity

uint256 adjustedCollateralToReturn = (collateralToReturn * (10 ** collateralDecimals)) / (10 ** priceFeed.decimals());

```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è°ƒæ•´æŠµæŠ¼ä»£å¸ä½¿ç”¨çš„å°æ•°æ•°é‡ä¸ä»·æ ¼æºä¹‹é—´çš„ä»»ä½•å·®å¼‚â€”â€”

æ‰€ä»¥è¿”å›çš„é‡‘é¢æ˜¯**ç²¾ç¡®å’Œå‡†ç¡®çš„**ã€‚

---

```solidity

_burn(msg.sender, amount);

```

æˆ‘ä»¬**é”€æ¯**æ­£åœ¨èµå›çš„ç¨³å®šå¸â€”â€”æ°¸ä¹…å°†å®ƒä»¬ä»æµé€šä¸­ç§»é™¤ã€‚

---

```solidity

collateralToken.safeTransfer(msg.sender, adjustedCollateralToReturn);

```

ä¸€æ—¦ sUSD è¢«é”€æ¯ï¼Œè®¡ç®—çš„æŠµæŠ¼å“æ•°é‡**å®‰å…¨åœ°å‘é€å›**ç”¨æˆ·çš„é’±åŒ…ã€‚

---

```solidity

emit Redeemed(msg.sender, amount, adjustedCollateralToReturn);

```

æˆ‘ä»¬å‘å‡ºä¸€ä¸ª **Redeemed** äº‹ä»¶ï¼Œè®°å½•ï¼š

- è°èµå›çš„
- ä»–ä»¬é”€æ¯äº†å¤šå°‘ sUSD
- ä»–ä»¬æ”¶åˆ°äº†å¤šå°‘æŠµæŠ¼å“

è¿™ä½¿ä¸€åˆ‡åœ¨é“¾ä¸Šä¿æŒé€æ˜å’Œå¯è¿½æº¯ã€‚

---

# âš™ï¸ æ›´æ–°æŠµæŠ¼ç‡

è¿™ä¸ªå‡½æ•°å…è®¸**æ‰€æœ‰è€…**è°ƒæ•´ç³»ç»Ÿçš„å®‰å…¨ç¼“å†²â€”â€”é“¸é€ æ–°ç¨³å®šå¸æ—¶æ‰€éœ€çš„è¶…é¢æŠµæŠ¼ç™¾åˆ†æ¯”ã€‚

è°ƒæ•´è¿™ä¸ªæ¯”ç‡å¯ä»¥å¸®åŠ©åº”å¯¹ä¸æ–­å˜åŒ–çš„å¸‚åœºæ¡ä»¶ï¼ˆå¦‚é«˜æ³¢åŠ¨æ€§ï¼‰ï¼Œä½†å®ƒå—åˆ°ä¸¥æ ¼æ§åˆ¶ä»¥é¿å…å±é™©è®¾ç½®ã€‚

è¿™æ˜¯å‡½æ•°ï¼š

---

```solidity

function setCollateralizationRatio(uint256 newRatio) external onlyOwner {
    if (newRatio < 100) revert CollateralizationRatioTooLow();
    collateralizationRatio = newRatio;
    emit CollateralizationRatioUpdated(newRatio);
}

```

---

# ğŸ§© è¯¦ç»†è§£è¯»

---

```solidity

function setCollateralizationRatio(uint256 newRatio) external onlyOwner {

```

è¿™æ˜¯ä¸€ä¸ª**ä»…é™æ‰€æœ‰è€…çš„å‡½æ•°**â€”â€”æ²¡æœ‰å…¶ä»–äººå¯ä»¥è°ƒç”¨å®ƒã€‚

å®ƒè®©æ‰€æœ‰è€…èƒ½å¤Ÿæ›´æ–°ç”¨æˆ·åœ¨é“¸é€ æ—¶å¿…é¡»å­˜å…¥å¤šå°‘æŠµæŠ¼å“ã€‚

---

```solidity

if (newRatio < 100) revert CollateralizationRatioTooLow();

```

æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ª**ä¸¥æ ¼çš„ä¸‹é™**ï¼šæ¯”ç‡æ°¸è¿œä¸èƒ½ä½äº 100%ã€‚

è¿™ç¡®ä¿æ¯ä¸ªç¨³å®šå¸å§‹ç»ˆè‡³å°‘ç”±å…¶å…¨éƒ¨ä»·å€¼çš„æŠµæŠ¼å“æ”¯æŒâ€”â€”ä¸å…è®¸éƒ¨åˆ†å‡†å¤‡é‡‘ã€‚

---

```solidity

collateralizationRatio = newRatio;

```

å¦‚æœæ–°æ¯”ç‡æœ‰æ•ˆï¼Œæˆ‘ä»¬å­˜å‚¨å®ƒã€‚

è¿™ä¸ªæ–°å€¼å°†åœ¨æ‰€æœ‰æœªæ¥çš„ `mint` å’Œ `redeem` è®¡ç®—ä¸­ä½¿ç”¨ã€‚

---

```solidity

emit CollateralizationRatioUpdated(newRatio);

```

æˆ‘ä»¬å‘å‡ºä¸€ä¸ªäº‹ä»¶ï¼Œæ‰€ä»¥æ›´æ”¹**åœ¨é“¾ä¸Šå¯è§**ã€‚

è¿™ä¿æŒç³»ç»Ÿé€æ˜â€”â€”dApp å’Œç”¨æˆ·å¯ä»¥çœ‹åˆ°è§„åˆ™ä½•æ—¶ï¼ˆä»¥åŠå¦‚ä½•ï¼‰æ”¹å˜ã€‚

---

# ğŸ”„ æ›´æ–°ä»·æ ¼æº

ä»·æ ¼æºæ˜¯ä»»ä½•æŠµæŠ¼æ”¯æŒçš„ç¨³å®šå¸çš„æ”¯æŸ±ã€‚

å¦‚æœæ•°æ®æºä¸­æ–­æˆ–éœ€è¦å‡çº§ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼**å®‰å…¨åœ°æ›´æ–°å®ƒ**è€Œä¸é‡æ–°éƒ¨ç½²æ•´ä¸ªåˆçº¦ã€‚

è¿™ä¸ªå‡½æ•°è®©å—ä¿¡ä»»çš„è§’è‰²â€”â€”ä¸ä»…ä»…æ˜¯æ‰€æœ‰è€…â€”â€”åœ¨éœ€è¦æ—¶æ›´æ–° Chainlink æºã€‚

---

```solidity

function setPriceFeedContract(address _newPriceFeed) external onlyRole(PRICE_FEED_MANAGER_ROLE) {
    if (_newPriceFeed == address(0)) revert InvalidPriceFeedAddress();
    priceFeed = AggregatorV3Interface(_newPriceFeed);
    emit PriceFeedUpdated(_newPriceFeed);
}

```

---

# ğŸ§© è¯¦ç»†è§£è¯»

---

```solidity

function setPriceFeedContract(address _newPriceFeed) external onlyRole(PRICE_FEED_MANAGER_ROLE) {

```

è¿™ä¸ªå‡½æ•°åªèƒ½ç”±æ‹¥æœ‰ **PRICE_FEED_MANAGER_ROLE** çš„äººè°ƒç”¨ã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬ä¸ä¼šå°†æ‰€æœ‰ä»·æ ¼æºæ§åˆ¶æƒäº¤ç»™æ‰€æœ‰è€…â€”â€”å®ƒæ˜¯ä¸€ä¸ªå•ç‹¬çš„ã€ä¸¥æ ¼é™å®šèŒƒå›´çš„è§’è‰²ã€‚

---

```solidity

if (_newPriceFeed == address(0)) revert InvalidPriceFeedAddress();

```

æˆ‘ä»¬æ£€æŸ¥æ–°åœ°å€æ˜¯æœ‰æ•ˆçš„ï¼ˆä¸æ˜¯é›¶ï¼‰ã€‚

å¦‚æœä¸æ˜¯ï¼Œæˆ‘ä»¬ç«‹å³ç”¨æ¸…æ™°çš„è‡ªå®šä¹‰é”™è¯¯åœæ­¢äº¤æ˜“ã€‚

---

```solidity

priceFeed = AggregatorV3Interface(_newPriceFeed);

```

ä¸€æ—¦éªŒè¯ï¼Œæˆ‘ä»¬æ›´æ–°å†…éƒ¨ `priceFeed` å¼•ç”¨â€”â€”å°†åˆçº¦è¿æ¥åˆ°æ–°çš„ Chainlink æºã€‚

---

```solidity

emit PriceFeedUpdated(_newPriceFeed);

```

æˆ‘ä»¬å‘å‡ºä¸€ä¸ªäº‹ä»¶ï¼Œæ‰€ä»¥æ›´æ–°æ˜¯å…¬å¼€å¯è§çš„ã€‚

è¿™ä¿æŒç³»ç»Ÿé€æ˜ï¼Œå¹¶ç¡®ä¿ä»»ä½•ä½¿ç”¨æ­¤åˆçº¦çš„ dApp æˆ–å‰ç«¯å¯ä»¥å“åº”æ›´æ”¹ã€‚

---

# ğŸ“Š é¢„è§ˆæ‰€éœ€æŠµæŠ¼å“

åœ¨ç”¨æˆ·è°ƒç”¨ `mint` ä¹‹å‰ï¼ŒçŸ¥é“ä»–ä»¬éœ€è¦å­˜å…¥**å¤šå°‘æŠµæŠ¼å“**æ˜¯æœ‰å¸®åŠ©çš„ã€‚

è¿™ä¸ªå‡½æ•°ä½¿è¿™å˜å¾—å®¹æ˜“â€”â€”å®ƒè®©å‰ç«¯å’Œç”¨æˆ·**é¢„è§ˆæ‰€éœ€é‡‘é¢**ï¼ŒåŸºäºå®æ—¶ä»·æ ¼æºå’Œå½“å‰æ¯”ç‡ï¼Œè€Œæ— éœ€å®é™…å‘é€äº¤æ˜“ã€‚

è¿™æ˜¯ä»£ç ï¼š

---

```solidity

function getRequiredCollateralForMint(uint256 amount) public view returns (uint256) {
    if (amount == 0) return 0;

    uint256 collateralPrice = getCurrentPrice();
    uint256 requiredCollateralValueUSD = amount * (10 ** decimals());
    uint256 requiredCollateral = (requiredCollateralValueUSD * collateralizationRatio) / (100 * collateralPrice);
    uint256 adjustedRequiredCollateral = (requiredCollateral * (10 ** collateralDecimals)) / (10 ** priceFeed.decimals());

    return adjustedRequiredCollateral;
}

```

---

# ğŸ§© è¯¦ç»†è§£è¯»

---

```solidity

function getRequiredCollateralForMint(uint256 amount) public view returns (uint256)

```

è¿™æ˜¯ä¸€ä¸ª**è§†å›¾å‡½æ•°**ï¼Œæ„å‘³ç€å®ƒä¸ä¿®æ”¹çŠ¶æ€â€”â€”å®ƒåªä»åˆçº¦ä¸­è¯»å–ã€‚

ä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨å®ƒæ¥æ£€æŸ¥ä»–ä»¬é“¸é€ ç»™å®šæ•°é‡çš„ sUSD éœ€è¦å¤šå°‘æŠµæŠ¼å“ã€‚

---

```solidity

if (amount == 0) return 0;

```

å¦‚æœç”¨æˆ·è¯¢é—®é“¸é€ é›¶ä»£å¸éœ€è¦å¤šå°‘æŠµæŠ¼å“ï¼Œç­”æ¡ˆå¾ˆç®€å•ï¼šæ— ã€‚

---

```solidity

uint256 collateralPrice = getCurrentPrice();

```

æˆ‘ä»¬ä½¿ç”¨å®æ—¶ Chainlink æºè·å–æŠµæŠ¼å“çš„**å½“å‰å¸‚åœºä»·æ ¼**ã€‚

---

```solidity

uint256 requiredCollateralValueUSD = amount * (10 ** decimals());

```

æˆ‘ä»¬å°†ç¨³å®šå¸çš„æ•°é‡ç¼©æ”¾åˆ° 18 ä½å°æ•°ä»¥ç”¨å®Œæ•´çš„ USD ä»·å€¼æœ¯è¯­è¡¨è¾¾å®ƒã€‚

è¿™ç»™æˆ‘ä»¬æŠµæŠ¼å“å¿…é¡»è¦†ç›–çš„æ€» USD ä»·å€¼ã€‚

---

```solidity

uint256 requiredCollateral = (requiredCollateralValueUSD * collateralizationRatio) / (100 * collateralPrice);

```

æˆ‘ä»¬åº”ç”¨**æŠµæŠ¼ç‡**ï¼ˆä¾‹å¦‚ï¼Œ150%ï¼‰æ¥ç¡®å®šç”¨æˆ·å¿…é¡»æä¾›æ¯” USD ä»·å€¼å¤šå¤šå°‘ã€‚

---

```solidity

uint256 adjustedRequiredCollateral = (requiredCollateral * (10 ** collateralDecimals)) / (10 ** priceFeed.decimals());

```

æˆ‘ä»¬è°ƒæ•´æŠµæŠ¼ä»£å¸å’Œä»·æ ¼æºä¹‹é—´çš„ä»»ä½•**å°æ•°ä¸åŒ¹é…**ã€‚

è¿™ç¡®ä¿æœ€ç»ˆæ•°å­—ä»¥æŠµæŠ¼ä»£å¸çš„å•ä½æ­£ç¡®ç¼©æ”¾ã€‚

---

```solidity

return adjustedRequiredCollateral;

```

æœ€åï¼Œæˆ‘ä»¬è¿”å›ç”¨æˆ·éœ€è¦å‘é€ä»¥é“¸é€ æ‰€éœ€ sUSD æ•°é‡çš„**æŠµæŠ¼ä»£å¸ï¼ˆä»¥æœ€å°å•ä½ï¼‰**çš„ç¡®åˆ‡æ•°é‡ã€‚

---

# ğŸ’µ é¢„è§ˆèµå›æ—¶è¿”å›çš„æŠµæŠ¼å“

è¿™ä¸ªå‡½æ•°æ˜¯ **`getRequiredCollateralForMint` çš„å¯¹åº”ç‰©**â€”â€”å®ƒå¸®åŠ©ç”¨æˆ·æ£€æŸ¥å¦‚æœä»–ä»¬èµå›ä¸€å®šæ•°é‡çš„ sUSDï¼Œä»–ä»¬å°†æ”¶åˆ°**å¤šå°‘æŠµæŠ¼å“**ã€‚

è¿™æ˜¯ä¸€ä¸ªçº¯ç²¹çš„ã€åªè¯»çš„å‡½æ•°ï¼Œå¯¹äºå‰ç«¯å’Œé’±åŒ…åœ¨ç”¨æˆ·é‡‡å–ä»»ä½•è¡ŒåŠ¨ä¹‹å‰ç»™ç”¨æˆ·æ¸…æ™°åº¦éå¸¸æœ‰ç”¨ã€‚

---

```solidity

function getCollateralForRedeem(uint256 amount) public view returns (uint256) {
    if (amount == 0) return 0;

    uint256 collateralPrice = getCurrentPrice();
    uint256 stablecoinValueUSD = amount * (10 ** decimals());
    uint256 collateralToReturn = (stablecoinValueUSD * 100) / (collateralizationRatio * collateralPrice);
    uint256 adjustedCollateralToReturn = (collateralToReturn * (10 ** collateralDecimals)) / (10 ** priceFeed.decimals());

    return adjustedCollateralToReturn;
}

```

---

# ğŸ§© è¯¦ç»†è§£è¯»

---

```solidity

if (amount == 0) return 0;

```

å¦‚æœç”¨æˆ·è¯¢é—®èµå›**é›¶**ç¨³å®šå¸ï¼Œç­”æ¡ˆæ˜¾ç„¶æ˜¯é›¶â€”â€”ä¸éœ€è¦è¿è¡Œå…¶ä½™çš„è®¡ç®—ã€‚

---

```solidity

uint256 collateralPrice = getCurrentPrice();

```

æˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„åŒä¸€è¾…åŠ©å‡½æ•°è·å–æŠµæŠ¼ä»£å¸çš„**å®æ—¶ä»·æ ¼**ã€‚

è¿™ç¡®ä¿æ‰€æœ‰æ•°å­¦éƒ½åŸºäºæœ€æ–°çš„å¸‚åœºæ•°æ®ã€‚

---

```solidity

uint256 stablecoinValueUSD = amount * (10 ** decimals());

```

æˆ‘ä»¬å°†ç”¨æˆ·æƒ³è¦èµå›çš„ sUSD æ•°é‡è½¬æ¢ä¸ºå…¶ **USD ä»·å€¼**ï¼Œä½¿ç”¨ 18 ä½å°æ•°ç¼©æ”¾ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç¨³å®šå¸ä½¿ç”¨è¯¥æ ¼å¼ã€‚

---

```solidity

uint256 collateralToReturn = (stablecoinValueUSD * 100) / (collateralizationRatio * collateralPrice);

```

è¿™å‘Šè¯‰æˆ‘ä»¬ç”¨æˆ·æœ‰æƒè·å¾—çš„**æŠµæŠ¼å“çš„ USD ä»·å€¼**ã€‚

ç”±äºç³»ç»Ÿæ˜¯è¶…é¢æŠµæŠ¼çš„ï¼ˆä¾‹å¦‚ï¼Œ150%ï¼‰ï¼Œç”¨æˆ·åªèƒ½å–å›ä»–ä»¬æœ€åˆé”å®šçš„å…¨éƒ¨ä»·å€¼çš„ä¸€éƒ¨åˆ†ã€‚

---

```solidity

uint256 adjustedCollateralToReturn = (collateralToReturn * (10 ** collateralDecimals)) / (10 ** priceFeed.decimals());

```

å†æ¬¡ï¼Œæˆ‘ä»¬å¤„ç†æŠµæŠ¼ä»£å¸å’Œä»·æ ¼æºä¹‹é—´**å°æ•°æ ¼å¼**çš„å·®å¼‚â€”â€”æ‰€ä»¥ç»“æœä»¥ä»£å¸å•ä½æ­£ç¡®ç¼©æ”¾ã€‚

---

```solidity

return adjustedCollateralToReturn;

```

æœ€åï¼Œæˆ‘ä»¬è¿”å›ç”¨æˆ·å¦‚æœèµå›ç»™å®š sUSD æ•°é‡å°†æ”¶åˆ°çš„æŠµæŠ¼å“æ•°é‡ï¼ˆä»¥æœ€å°å•ä½å¦‚ weiï¼‰ã€‚

---

æœ‰äº†è¿™ä¸ªï¼Œç”¨æˆ·å¯¹ç³»ç»Ÿçš„ä¸¤é¢éƒ½æœ‰å®Œå…¨çš„å¯è§æ€§ï¼š

- ä»–ä»¬éœ€è¦å¤šå°‘æŠµæŠ¼å“æ¥é“¸é€ ã€‚
- ä»–ä»¬èµå›æ—¶ä¼šå–å›å¤šå°‘æŠµæŠ¼å“ã€‚

---

# ğŸ§° åœ¨ Remix ä¸Šä½¿ç”¨ä¸»ç½‘åˆ†å‰éƒ¨ç½² SimpleStablecoin çš„åˆ†æ­¥æŒ‡å—

### 1. æ‰“å¼€ Remix IDE

- åœ¨æµè§ˆå™¨ä¸­å¯¼èˆªåˆ° Remix IDEã€‚

### 2. è®¾ç½®ä¸»ç½‘åˆ†å‰ç¯å¢ƒ

1. å•å‡»å·¦ä¾§è¾¹æ ä¸Šçš„ **"Deploy & Run Transactions"** æ ‡ç­¾ï¼ˆğŸš€ å›¾æ ‡ï¼‰ã€‚
2. åœ¨ **"Environment"** ä¸‹æ‹‰èœå•ä¸­ï¼Œé€‰æ‹© **"Remix VM - Mainnet fork"**ã€‚
    - è¿™ä¼šåˆ†å‰ä»¥å¤ªåŠä¸»ç½‘å¹¶å°†å…¶åŠ è½½åˆ° Remix VM ä¸­ï¼Œå…è®¸ä½ ä¸å·²éƒ¨ç½²çš„ä¸»ç½‘åˆçº¦äº¤äº’ã€‚
    - Remix æä¾› 10 ä¸ªè´¦æˆ·ï¼Œæ¯ä¸ªè´¦æˆ·é¢„åŠ è½½ 100 ETH ç”¨äºæµ‹è¯•ç›®çš„

*æ³¨æ„ï¼šä½¿ç”¨ä¸»ç½‘åˆ†å‰æ—¶è¦å°å¿ƒï¼Œå› ä¸ºå®ƒæ¨¡æ‹Ÿä¸»ç½‘ç¯å¢ƒã€‚ç¡®ä¿ä½ ä¸ä¼šå‘é€çœŸå®äº¤æ˜“ï¼Œé™¤éæœ‰æ„ä¸ºä¹‹ã€‚*

### 3. åˆ›å»ºå¹¶ç¼–è¯‘ä½ çš„è‡ªå®šä¹‰ ERC20 ä»£å¸

1. åœ¨ **File Explorer**ï¼ˆğŸ“ å›¾æ ‡ï¼‰ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `MyToken.sol` çš„æ–°æ–‡ä»¶ã€‚
2. å°†ä»¥ä¸‹ä»£ç ç²˜è´´åˆ° `MyToken.sol` ä¸­ï¼š
    
    ```solidity
    // SPDX-License-Identifier: MIT
    pragma solidity ^0.8.20;
    
    import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
    
    contract MyToken is ERC20 {
        constructor() ERC20("MyToken", "MTK") {
            _mint(msg.sender, 1_000_000 * 10 ** decimals());
        }
    }
    
    ```
    
3. å•å‡» **"Solidity Compiler"** æ ‡ç­¾ï¼ˆğŸ› ï¸ å›¾æ ‡ï¼‰ã€‚
4. ç¡®ä¿ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸ä½ çš„åˆçº¦ä¸­çš„ pragma åŒ¹é…ï¼ˆä¾‹å¦‚ï¼Œ`0.8.20`ï¼‰ã€‚
5. å•å‡» **"Compile MyToken.sol"**ã€‚

### 4. éƒ¨ç½²ä½ çš„è‡ªå®šä¹‰ ERC20 ä»£å¸

1. åœ¨ **"Deploy & Run Transactions"** æ ‡ç­¾ä¸­ï¼š
    - ç¡®ä¿ **Environment** è®¾ç½®ä¸º **"Remix VM - Mainnet fork"**ã€‚
    - ä»ä¸‹æ‹‰èœå•ä¸­é€‰æ‹© `MyToken` åˆçº¦ã€‚
2. å•å‡» **"Deploy"**ã€‚
3. éƒ¨ç½²åï¼Œä½ å°†åœ¨ **Deployed Contracts** ä¸‹çœ‹åˆ°ä½ çš„åˆçº¦ã€‚å±•å¼€å®ƒä»¥æŸ¥çœ‹å¯ç”¨å‡½æ•°ã€‚

### 5. è¯†åˆ« Chainlink ä»·æ ¼æºåœ°å€

ç”±äºä½ æ­£åœ¨ä½¿ç”¨ä¸»ç½‘åˆ†å‰ï¼Œä½ å¯ä»¥ä¸å®é™…éƒ¨ç½²çš„åˆçº¦äº¤äº’ã€‚ä¾‹å¦‚ï¼š

- **Chainlink ETH/USD ä»·æ ¼æºï¼ˆä»¥å¤ªåŠä¸»ç½‘ï¼‰ï¼š**
    - åœ°å€ï¼š`0x5f4ec3df9cbd43714fe2740f5e3616155c5b8419`
    - å°æ•°ï¼š8

*æ³¨æ„ï¼šè¿™äº›åœ°å€ç‰¹å®šäºä»¥å¤ªåŠä¸»ç½‘ã€‚é€šè¿‡å‚è€ƒ [Chainlink çš„å®˜æ–¹æ–‡æ¡£](https://docs.chain.link/data-feeds/price-feeds/addresses)ç¡®ä¿å®ƒä»¬å‡†ç¡®ä¸”æœ€æ–°ã€‚*

### 6. åˆ›å»ºå¹¶ç¼–è¯‘ SimpleStablecoin åˆçº¦

1. åœ¨ **File Explorer** ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `SimpleStablecoin.sol` çš„æ–°æ–‡ä»¶ã€‚
2. å°†ä½ å®Œæ•´çš„ **SimpleStablecoin** åˆçº¦ä»£ç ç²˜è´´åˆ°æ­¤æ–‡ä»¶ä¸­ã€‚
    - ç¡®ä¿åŒ…å«æ‰€æœ‰å¿…è¦çš„ OpenZeppelin å¯¼å…¥ã€‚
3. å•å‡» **"Solidity Compiler"** æ ‡ç­¾ã€‚
4. ç¡®ä¿ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸ä½ çš„åˆçº¦ä¸­çš„ pragma åŒ¹é…ã€‚
5. å•å‡» **"Compile SimpleStablecoin.sol"**ã€‚

### 7. éƒ¨ç½² SimpleStablecoin åˆçº¦

1. åœ¨ **"Deploy & Run Transactions"** æ ‡ç­¾ä¸­ï¼š
    - ç¡®ä¿ **Environment** è®¾ç½®ä¸º **"Remix VM - Mainnet fork"**ã€‚
    - ä»ä¸‹æ‹‰èœå•ä¸­é€‰æ‹© `SimpleStablecoin` åˆçº¦ã€‚
2. è¾“å…¥æ„é€ å‡½æ•°å‚æ•°ï¼š
    - `_collateralToken`ï¼šç²˜è´´ä½ éƒ¨ç½²çš„ `MyToken` åˆçº¦çš„åœ°å€ã€‚
    - `_initialOwner`ï¼šä½¿ç”¨ Remix æä¾›çš„é¢„èµ„åŠ©è´¦æˆ·åœ°å€ä¹‹ä¸€ã€‚
    - `_priceFeedContract`ï¼šç²˜è´´ Chainlink ETH/USD ä»·æ ¼æºåœ°å€ã€‚
3. å•å‡» **"Deploy"**ã€‚

### 8. ä¸å·²éƒ¨ç½²çš„åˆçº¦äº¤äº’

### æ‰¹å‡† SimpleStablecoin åˆçº¦èŠ±è´¹ä½ çš„ä»£å¸

1. åœ¨ **Deployed Contracts** éƒ¨åˆ†ï¼Œå±•å¼€ä½ çš„ `MyToken` åˆçº¦ã€‚
2. è°ƒç”¨ `approve` å‡½æ•°ï¼š
    - `_spender`ï¼šä½ éƒ¨ç½²çš„ `SimpleStablecoin` åˆçº¦çš„åœ°å€ã€‚
    - `_value`ï¼šè¦æ‰¹å‡†çš„ä»£å¸æ•°é‡ï¼ˆä¾‹å¦‚ï¼Œ`1000000000000000000000` è¡¨ç¤º 1000 ä¸ª 18 ä½å°æ•°çš„ä»£å¸ï¼‰ã€‚

### é“¸é€ ç¨³å®šå¸

1. åœ¨ **Deployed Contracts** éƒ¨åˆ†å±•å¼€ä½ çš„ `SimpleStablecoin` åˆçº¦ã€‚
2. è°ƒç”¨ `mint` å‡½æ•°ï¼š
    - `amount`ï¼šä½ å¸Œæœ›é“¸é€ çš„ç¨³å®šå¸æ•°é‡ï¼ˆ100 ä¸ªä»£å¸ï¼‰ã€‚

### èµå›ç¨³å®šå¸

1. è°ƒç”¨ `redeem` å‡½æ•°ï¼š
    - `amount`ï¼šä½ å¸Œæœ›èµå›çš„ç¨³å®šå¸æ•°é‡ã€‚

*æ³¨æ„ï¼šåœ¨æ‰§è¡Œè¿™äº›æ“ä½œä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ æœ‰è¶³å¤Ÿçš„ä½™é¢å’Œæ‰¹å‡†ã€‚*